import{a as l}from"./chunk-QVSLGYTS.js";import{T as s}from"./chunk-FEC2V4R3.js";import{Y as i,ba as n}from"./chunk-EG5ORV3B.js";var c=class o{toastService=n(l);hasShownUpdatePrompt=!1;isVersionMismatchError(e){let r=this.normalizeError(e),t=[/Loading chunk \d+ failed/i,/Failed to fetch dynamically imported module/i,/ChunkLoadError/i,/Cannot find module/i,/Failed to load resource/i,/Module not found/i],d=r.message||"",h=r.name||"";return t.some(a=>a.test(d)||a.test(h))}handleVersionMismatch(e){if(this.hasShownUpdatePrompt){console.warn("Version update already triggered");return}this.hasShownUpdatePrompt=!0;let r=s(e)?`A new version is available (${e}). The page will reload to get the latest version.`:"A new version is available. The page will reload to get the latest version.";this.toastService.showWarning("Update Available",r,{life:5e3}),setTimeout(()=>{this.performHardReload()},2500)}performHardReload(){try{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(r=>{r.forEach(t=>{t.unregister().then(()=>{console.log("Service Worker unregistered")}).catch(()=>{})})}).catch(r=>console.warn("Failed to unregister Service Workers:",r));let e=new URL(globalThis.location.href);e.searchParams.set("_v",Date.now().toString()),globalThis.location.replace(e.href)}catch(e){console.error("Error during reload:",e),globalThis.location.reload()}}normalizeError(e){return e instanceof Error?e:typeof e=="string"?new Error(e):e!=null&&typeof e=="object"&&"message"in e?new Error(String(e.message)):new Error(String(e))}resetUpdatePrompt(){this.hasShownUpdatePrompt=!1}static \u0275fac=function(r){return new(r||o)};static \u0275prov=i({token:o,factory:o.\u0275fac,providedIn:"root"})};export{c as a};
