import{a as oe}from"./chunk-YFYLIULU.js";import{b as ne}from"./chunk-PDXK54JZ.js";import{a as ie}from"./chunk-FNP4CVQN.js";import{b as Z}from"./chunk-JJVUWK2A.js";import{l as te}from"./chunk-YPVSUJNA.js";import"./chunk-UJGTUYJO.js";import{x as ee}from"./chunk-GVCBKH6U.js";import"./chunk-PHOSYVDR.js";import"./chunk-UUBV4PLA.js";import"./chunk-T2ASJLBG.js";import"./chunk-K3QSXHYQ.js";import"./chunk-L7NFYEY5.js";import"./chunk-BEAFDC2I.js";import"./chunk-53JQ5NAG.js";import"./chunk-GV42Z4ED.js";import"./chunk-SDMJKPKX.js";import{l as D}from"./chunk-HBFOC76W.js";import{b as Y}from"./chunk-MI5GPO5K.js";import{e as K,f as X}from"./chunk-PH5YALHE.js";import{l as H,m as J}from"./chunk-6C6CC4KT.js";import"./chunk-JAXNIEKX.js";import{N as z,Q as O,Qc as U,Rc as B,Uc as W,Vb as G,Zb as C,u as Q}from"./chunk-FEC2V4R3.js";import{F as M,Ic as V,Jb as v,Kb as g,Nb as $,Ob as k,Pb as s,Qb as a,Rb as r,S as E,Sb as m,Ta as L,U as A,Vc as h,Ya as l,Zb as T,Zc as j,ba as f,bc as S,cc as p,gc as x,ha as y,hc as _,ia as w,ic as b,j as F,mb as q,na as I,rc as u,sb as N,sc as R,ta as d}from"./chunk-EG5ORV3B.js";import"./chunk-VB56BUGO.js";var le=["appIconTemplate"],pe=["statusTemplate"],se=["actionsTemplate"],me=t=>["/app-store",t],de=(t,i)=>i.value;function ue(t,i){if(t&1){let e=T();a(0,"p-button",8),S("onClick",function(){let o=y(e).$implicit,c=p();return w(c.onStatusFilterChange(o.value))}),r()}if(t&2){let e=i.$implicit,n=p();s("label",e.label)("severity",n.statusFilter()===e.value?"primary":"secondary")("outlined",n.statusFilter()!==e.value)}}function ce(t,i){if(t&1&&(a(0,"div",7)(1,"div",9),m(2,"i",10),r(),a(3,"h3",11),u(4),r(),a(5,"p",12),u(6," Please try refreshing the page or adjusting filters. "),r()()),t&2){let e=p();l(4),R(e.error())}}function fe(t,i){if(t&1&&m(0,"app-grid",13),t&2){let e=p(2);s("columns",e.columns())("data",e.apps())("loading",e.loading())("pagination",!0)("rows",10)("sortable",!0)}}function ve(t,i){t&1&&(a(0,"div",14),m(1,"span",15),a(2,"h3",16),u(3," No apps found "),r(),a(4,"p",17),u(5," There are no applications matching the selected criteria. "),r()())}function ge(t,i){if(t&1&&v(0,fe,1,6,"app-grid",13)(1,ve,6,0,"div",14),t&2){let e=p();g(e.apps().length>0||e.loading()?0:1)}}function xe(t,i){if(t&1&&(a(0,"div",18),m(1,"img",19),a(2,"span",20),u(3),r()()),t&2){let e=i.$implicit;l(),s("src",e.iconUrl,L)("alt",e.name+" icon"),l(2),R(e.name)}}function _e(t,i){if(t&1&&m(0,"app-status-badge",21),t&2){let e=i.$implicit;s("status",e.status)}}function be(t,i){if(t&1){let e=T();a(0,"p-button",25),S("onClick",function(){y(e);let o=p().$implicit,c=p();return w(c.openReviewModal(o))}),r()}t&2&&s("text",!0)}function he(t,i){if(t&1&&(a(0,"div",22),m(1,"p-button",23),v(2,be,1,1,"p-button",24),r()),t&2){let e=i.$implicit;l(),s("routerLink",V(3,me,e.id))("text",!0),l(),g(e.status==="pendingReview"||e.status==="underReview"?2:-1)}}var ae=class t{appStoreService=f(ne);clientDataService=f(W);modalFormService=f(ee);destroyRef=f(I);appIconTemplate;statusTemplate;actionsTemplate;statusFilter=d("pendingReview");loading=d(!0);error=d(null);refreshTrigger=d(0);columns=d([]);apps$=U(j(()=>({status:this.statusFilter(),refresh:this.refreshTrigger()}))).pipe(A(()=>{this.loading.set(!0),this.error.set(null)}),E(({status:i})=>{let e=this.clientDataService.getSelectedClient()?.id??"",n=i==="ALL"?{owner:e}:{owner:e,status:i};return this.appStoreService.getApps(n).pipe(A(()=>{this.loading.set(!1)}),M(o=>(console.error("Error loading apps:",o),this.loading.set(!1),this.error.set("Unable to load apps. Please try again."),F([]))))}));apps=B(this.apps$,{initialValue:[]});statusOptions=[{label:"Draft",value:"draft"},{label:"Pending Review",value:"pendingReview"},{label:"Under Review",value:"underReview"},{label:"Changes Requested",value:"changesRequested"},{label:"Approved",value:"approved"},{label:"Rejected",value:"rejected"},{label:"Suspended",value:"suspended"},{label:"Withdrawn",value:"withdrawn"},{label:"All",value:"ALL"}];ngOnInit(){this.setupColumns()}setupColumns(){this.columns.set([{field:"name",header:"App",sortable:!0,cellTemplate:this.appIconTemplate},{field:"developerName",header:"Developer",sortable:!0},{field:"status",header:"Status",sortable:!0,cellTemplate:this.statusTemplate},{field:"createdAt",header:"Submitted",sortable:!0,valueGetter:i=>new Date(i.createdDate).toLocaleDateString()},{field:"actions",header:"Actions",cellTemplate:this.actionsTemplate}])}onStatusFilterChange(i){this.statusFilter.set(i)}openReviewModal(i){let e=C("dummy","dummy",void 0);this.modalFormService.openListItemModal({modalConfig:{modalComponent:ie,modalTitle:"Review App Submission",modalFields:[G("status","Decision",[{label:"Approve",value:"approved"},{label:"Reject",value:"rejected"},{label:"Suspend",value:"suspended"},{label:"Request Changes",value:"changesRequested"}],void 0,{validations:[{name:"required",validator:D.required}]}),C("comments","Comments to Developer",void 0,{placeholder:"Explain the reason for this decision...",validations:[{name:"required",validator:D.required}]}),C("internalNotes","Internal Notes",void 0,{placeholder:"Internal notes for the team..."})],onSubmit:(n,o)=>{let c={id:i.id,developerId:i.developerId,status:n.status,comments:n.comments,internalNotes:n.internalNotes};return new Promise(P=>{this.appStoreService.reviewApp(i.id,c).subscribe({next:()=>{this.refreshApps(),o.close(),P(!0)},error:re=>{console.error(re),P(!1)}})})}},itemData:{status:i.status,comments:"",internalNotes:""},destroyRef:this.destroyRef,field:e}).subscribe()}refreshApps(){this.refreshTrigger.update(i=>i+1)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=q({type:t,selectors:[["app-admin-panel"]],viewQuery:function(e,n){if(e&1&&(x(le,7),x(pe,7),x(se,7)),e&2){let o;_(o=b())&&(n.appIconTemplate=o.first),_(o=b())&&(n.statusTemplate=o.first),_(o=b())&&(n.actionsTemplate=o.first)}},decls:13,vars:1,consts:[["appIconTemplate",""],["statusTemplate",""],["actionsTemplate",""],[1,"flex","flex-col","h-full","w-full","overflow-hidden"],[1,"flex","flex-wrap","gap-2","p-4","flex-none","border-b","border-subtle"],["size","small","rounded","true",1,"!text-xs","font-semibold",3,"label","severity","outlined"],[1,"flex-1","min-h-0","w-full","overflow-hidden","p-6"],[1,"flex","flex-col","items-center","justify-center","py-20","text-center"],["size","small","rounded","true",1,"!text-xs","font-semibold",3,"onClick","label","severity","outlined"],[1,"w-16","h-16","rounded-full","flex","items-center","justify-center","mb-4"],[1,"pi","pi-exclamation-triangle","text-3xl"],[1,"text-xl","font-bold","text-surface-900","mb-2"],[1,"text-surface-600"],["styleClass","h-full",3,"columns","data","loading","pagination","rows","sortable"],[1,"text-center","py-20","border","border-subtle","rounded-2xl","mx-auto","max-w-2xl"],[1,"pi","pi-inbox","!text-6xl","muted","mb-4"],[1,"text-lg","font-medium","mb-2","text-surface-900"],[1,"text-surface-900"],[1,"flex","items-center","gap-2"],[1,"w-8","h-8","rounded","object-cover","shadow-sm-100",3,"src","alt"],[1,"font-medium","text-surface-900"],[3,"status"],[1,"flex","gap-2"],["icon","pi pi-eye","size","small","severity","secondary","pTooltip","View Details",3,"routerLink","text"],["icon","pi pi-file-edit","size","small","severity","info","pTooltip","Review Submission",3,"text"],["icon","pi pi-file-edit","size","small","severity","info","pTooltip","Review Submission",3,"onClick","text"]],template:function(e,n){e&1&&(a(0,"div",3)(1,"div",4),$(2,ue,1,3,"p-button",5,de),r(),a(4,"div",6),v(5,ce,7,1,"div",7)(6,ge,2,1),r()(),N(7,xe,4,3,"ng-template",null,0,h)(9,_e,1,1,"ng-template",null,1,h)(11,he,3,5,"ng-template",null,2,h)),e&2&&(l(2),k(n.statusOptions),l(3),g(n.error()?5:6))},dependencies:[Q,O,z,J,H,Z,Y,X,K,te,oe],encapsulation:2})};export{ae as AppAdminPanelComponent};
