import{C as pe,D as me,P as Ce,W as C,X as F}from"./chunk-2YP72RBM.js";import"./chunk-RCAL2UNJ.js";import"./chunk-FNP4CVQN.js";import{a as ae}from"./chunk-QVSLGYTS.js";import"./chunk-QJYXX6WB.js";import"./chunk-JJVUWK2A.js";import"./chunk-JHHTYGX5.js";import{a as re,b as ce,c as se,d as le,e as de}from"./chunk-FVFSV3SV.js";import"./chunk-YPVSUJNA.js";import"./chunk-UJGTUYJO.js";import"./chunk-GVCBKH6U.js";import"./chunk-PHOSYVDR.js";import"./chunk-UUBV4PLA.js";import"./chunk-T2ASJLBG.js";import"./chunk-K3QSXHYQ.js";import"./chunk-L7NFYEY5.js";import"./chunk-BEAFDC2I.js";import"./chunk-53JQ5NAG.js";import"./chunk-GV42Z4ED.js";import"./chunk-SDMJKPKX.js";import"./chunk-HBFOC76W.js";import{a as oe}from"./chunk-MI5GPO5K.js";import"./chunk-PH5YALHE.js";import"./chunk-6C6CC4KT.js";import"./chunk-JAXNIEKX.js";import{Db as $,Fb as N,K as Q,Pc as w,Qc as K,S as T,T as M,Uc as ee,Wc as te,Xc as ne,Z as X,_c as ie,ca as Z,f as G,sb as R,u as J}from"./chunk-FEC2V4R3.js";import{D as W,F as H,Jb as d,Kb as p,Nb as v,Ob as D,Pb as y,Qb as c,Rb as r,S as z,Sb as S,U as A,Ya as o,Yb as x,Zc as E,ba as _,cc as m,h as U,i as k,j as O,k as L,mb as Y,na as q,o as j,rc as h,s as B,sb as g,sc as V,ta as f}from"./chunk-EG5ORV3B.js";import{a as P}from"./chunk-VB56BUGO.js";var b=(t,e)=>e.id;function _e(t,e){t&1&&(c(0,"div",1),S(1,"p-progressSpinner"),r())}function fe(t,e){if(t&1&&(c(0,"div",2)(1,"p",4),h(2),r()()),t&2){let n=m();o(2),V(n.error())}}function Se(t,e){t&1&&x(0)}function he(t,e){t&1&&S(0,"p-divider")}function ge(t,e){if(t&1&&(g(0,Se,1,0,"ng-container",12),d(1,he,1,0,"p-divider")),t&2){let n=e.$implicit,i=e.$index,a=e.$count,s=m(2);y("ngComponentOutlet",n.component)("ngComponentOutletInputs",s.getSectionInputs(n)),o(),p(i!==a-1?1:-1)}}function ve(t,e){t&1&&x(0)}function De(t,e){t&1&&S(0,"p-divider")}function ye(t,e){if(t&1&&(g(0,ve,1,0,"ng-container",12),d(1,De,1,0,"p-divider")),t&2){let n=e.$implicit,i=e.$index,a=e.$count,s=m(3);y("ngComponentOutlet",n.component)("ngComponentOutletInputs",s.getSectionInputs(n)),o(),p(i!==a-1?1:-1)}}function xe(t,e){if(t&1&&(c(0,"p-accordion-panel",7)(1,"p-accordion-header")(2,"span",6),h(3,"Settings"),r()(),c(4,"p-accordion-content"),v(5,ye,2,3,null,null,b),r()()),t&2){let n=m(2);o(5),D(n.settingsSections())}}function Ee(t,e){t&1&&x(0)}function be(t,e){t&1&&S(0,"p-divider")}function Te(t,e){if(t&1&&(g(0,Ee,1,0,"ng-container",12),d(1,be,1,0,"p-divider")),t&2){let n=e.$implicit,i=e.$index,a=e.$count,s=m(3);y("ngComponentOutlet",n.component)("ngComponentOutletInputs",s.getSectionInputs(n)),o(),p(i!==a-1?1:-1)}}function Fe(t,e){if(t&1&&(c(0,"p-accordion-panel",8)(1,"p-accordion-header")(2,"span",6),h(3,"Limits"),r()(),c(4,"p-accordion-content"),v(5,Te,2,3,null,null,b),r()()),t&2){let n=m(2);o(5),D(n.limitsSections())}}function Me(t,e){t&1&&x(0)}function $e(t,e){t&1&&S(0,"p-divider")}function Ie(t,e){if(t&1&&(g(0,Me,1,0,"ng-container",12),d(1,$e,1,0,"p-divider")),t&2){let n=e.$implicit,i=e.$index,a=e.$count,s=m(3);y("ngComponentOutlet",n.component)("ngComponentOutletInputs",s.getSectionInputs(n)),o(),p(i!==a-1?1:-1)}}function Oe(t,e){if(t&1&&(c(0,"p-accordion-panel",9)(1,"p-accordion-header")(2,"span",6),h(3,"Features"),r()(),c(4,"p-accordion-content"),v(5,Ie,2,3,null,null,b),r()()),t&2){let n=m(2);o(5),D(n.featuresSections())}}function Ae(t,e){t&1&&x(0)}function Re(t,e){t&1&&S(0,"p-divider")}function Ne(t,e){if(t&1&&(g(0,Ae,1,0,"ng-container",12),d(1,Re,1,0,"p-divider")),t&2){let n=e.$implicit,i=e.$index,a=e.$count,s=m(3);y("ngComponentOutlet",n.component)("ngComponentOutletInputs",s.getSectionInputs(n)),o(),p(i!==a-1?1:-1)}}function we(t,e){if(t&1&&(c(0,"p-accordion-panel",10)(1,"p-accordion-header")(2,"span",6),h(3,"Statistics"),r()(),c(4,"p-accordion-content"),v(5,Ne,2,3,null,null,b),r()()),t&2){let n=m(2);o(5),D(n.statisticsSections())}}function Pe(t,e){t&1&&x(0)}function Ue(t,e){t&1&&S(0,"p-divider")}function ke(t,e){if(t&1&&(g(0,Pe,1,0,"ng-container",12),d(1,Ue,1,0,"p-divider")),t&2){let n=e.$implicit,i=e.$index,a=e.$count,s=m(3);y("ngComponentOutlet",n.component)("ngComponentOutletInputs",s.getSectionInputs(n)),o(),p(i!==a-1?1:-1)}}function Le(t,e){if(t&1&&(c(0,"p-accordion-panel",11)(1,"p-accordion-header")(2,"span",6),h(3,"Changes"),r()(),c(4,"p-accordion-content"),v(5,ke,2,3,null,null,b),r()()),t&2){let n=m(2);o(5),D(n.changesSections())}}function je(t,e){if(t&1&&(c(0,"div",3)(1,"p-accordion",5)(2,"p-accordion-panel",5)(3,"p-accordion-header")(4,"span",6),h(5,"Information"),r()(),c(6,"p-accordion-content"),v(7,ge,2,3,null,null,b),r()(),d(9,xe,7,0,"p-accordion-panel",7),d(10,Fe,7,0,"p-accordion-panel",8),d(11,Oe,7,0,"p-accordion-panel",9),d(12,we,7,0,"p-accordion-panel",10),d(13,Le,7,0,"p-accordion-panel",11),r()()),t&2){let n=m();o(7),D(n.informationSections()),o(2),p(n.hasSettingsSections()?9:-1),o(),p(n.hasLimitsSections()?10:-1),o(),p(n.hasFeaturesSections()?11:-1),o(),p(n.hasStatisticsSections()?12:-1),o(),p(n.hasChangesSections()?13:-1)}}var I=class t{broadcastService=_(te);authDataService=_(ie);accountsService=_(Z);clientDataService=_(ee);destroyRef=_(q);route=_(Q);toastService=_(ae);messageService=_(ne);operationRegistry=_(Ce);userProfile$=K(this.authDataService.getUserProfileSignal());informationSections=f([]);settingsSections=f([]);limitsSections=f([]);statisticsSections=f([]);featuresSections=f([]);changesSections=f([]);loading=f(!0);entity=f(null);error=f(null);hasInformationSections=E(()=>this.informationSections().length>0);hasSettingsSections=E(()=>this.settingsSections().length>0);hasLimitsSections=E(()=>this.limitsSections().length>0);hasStatisticsSections=E(()=>this.statisticsSections().length>0);hasChangesSections=E(()=>this.changesSections().length>0);hasFeaturesSections=E(()=>this.featuresSections().length>0);isEntityUpdatedMessage(e){return M(e)&&e!==null&&typeof e=="object"&&"entityType"in e&&"data"in e&&e.entityType==="client"}constructor(){this.operationRegistry.registerEntityOperations("client",{update:(e,n)=>this.accountsService.updateClient(e,n),create:e=>this.accountsService.createClient(e),get:e=>this.accountsService.getClient(e)})}ngOnInit(){this.initializeEntityData(),this.broadcastService.on("entity-updated").pipe(w(this.destroyRef)).subscribe(e=>{this.isEntityUpdatedMessage(e)&&(this.toastService.showSuccess("Success","Client updated successfully"),this.entity.set(e.data),this.updateSectionsWithEntityData(),this.clientDataService.getSelectedClient()?.id===e.data.id&&(this.messageService.sendAction("profile_changed",{clientId:e.data.id}),this.clientDataService.setSelectedClient(e.data)))})}initializeEntityData(){B([this.route.paramMap,this.route.parent?.parent?this.route.parent.parent.data:O({}),this.userProfile$]).pipe(w(this.destroyRef),W(([e,n,i])=>M(i)),A(()=>{this.loading.set(!0),this.setupSectionStructure()}),z(([e,n])=>{let i=e.get("clientId")??n.client?.id;return M(i)?k(this.clientDataService.fetchClientWithCache(i)):X(n.client)?L(()=>new Error("Client ID not found")):O(n.client)}),H(()=>(this.error.set("Failed to load client data"),U)),A(e=>{this.entity.set(e),this.loading.set(!1),this.updateSectionsWithEntityData()})).subscribe()}setupSectionStructure(){this.informationSections.set(C.createClientInformationSections(null));let e=this.authDataService.getUserProfile()?.owner?.id===R;if(this.settingsSections.set(C.createClientSettingsSections(null)),e&&this.limitsSections.set(C.createClientLimitsSections(null)),this.authDataService.getUserProfile()?.owner?.type!=="client"){this.changesSections.set(C.createClientChangesSections(null));let n=Object.keys($);(this.authDataService.flags.assetPerformanceEnabled()??!1)||(n=n.filter(u=>u!=="page-assetperformance")),(this.authDataService.flags.deviceHealthEnabled()??!1)||(n=n.filter(u=>u!=="page-devicehealth").filter(u=>u!=="page-reporting"));let i=this.authDataService.getUserProfile()?.owner?.type??"client",a=N(i),s=[...n.flatMap(u=>C.forClient(null).addSection(u,"Features",F).build()),...Object.keys(a.sections).flatMap(u=>C.forClient(null).addSection(u,"Backend Features",F).build())];this.featuresSections.set(s)}}updateSectionsWithEntityData(){let e=this.entity();if(T(e))return;this.informationSections.set(C.createClientInformationSections(e));let n=this.authDataService.getUserProfile()?.owner?.id===R;if(this.settingsSections.set(C.createClientSettingsSections(e)),n&&this.limitsSections.set(C.createClientLimitsSections(e)),this.statisticsSections.set(C.createClientStatisticsSections(e)),this.authDataService.getUserProfile()?.owner?.type!=="client"){this.changesSections.set(C.createClientChangesSections(e));let i=Object.keys($).filter(l=>l!=="page-reporting");(this.authDataService.flags.assetPerformanceEnabled()??!1)||(i=i.filter(l=>l!=="page-assetperformance")),(this.authDataService.flags.deviceHealthEnabled()??!1)||(i=i.filter(l=>l!=="page-devicehealth"));let a=this.authDataService.flags;T(a.assetPerformanceEnabled())&&(i=i.filter(l=>l!=="page-assetperformance")),T(a.deviceHealthEnabled())&&(i=i.filter(l=>l!=="page-devicehealth"));let s=this.authDataService.getUserProfile()?.owner?.type??"client",u=N(s),ue=[...i.flatMap(l=>C.forClient(e).addSection(l,"App Features",F,{category:"features"},{feature:$[l],entityType:"client"}).build()),...Object.keys(u.sections).flatMap(l=>C.forClient(e).addSection(l,"Backend Features",F,{category:"features"},{feature:u.sections[l],entityType:"client"}).build())];this.featuresSections.set(ue)}}async updateEntity(e){let n=this.entity();if(!T(n))try{this.loading.set(!0);let i=await j(this.accountsService.updateClient(n.id,e));this.entity.set(i),this.updateSectionsWithEntityData(),this.clientDataService.getSelectedClient()?.id===i.id&&this.clientDataService.setSelectedClient(i)}catch(i){this.error.set(`${i instanceof Error?i.message:String(i)}`)}finally{this.loading.set(!1)}}getSectionInputs(e){return P({},e.componentInputs)}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=Y({type:t,selectors:[["app-client-details-container"]],decls:4,vars:3,consts:[[1,"admin-details-container","h-full","flex","flex-col"],[1,"loading-container"],[1,"error-container"],[1,"details-container","h-full","flex","flex-col","overflow-hidden"],[1,"error-message"],["value","information"],[1,"uppercase"],["value","settings"],["value","limits"],["value","features"],["value","statistics"],["value","changes"],[4,"ngComponentOutlet","ngComponentOutletInputs"]],template:function(n,i){n&1&&(c(0,"div",0),d(1,_e,2,0,"div",1),d(2,fe,3,1,"div",2),d(3,je,14,5,"div",3),r()),n&2&&(o(),p(i.loading()?1:-1),o(),p(i.error()?2:-1),o(),p(!i.loading()&&!i.error()?3:-1))},dependencies:[de,le,re,ce,se,me,pe,oe,J,G],styles:["[_nghost-%COMP%]{display:block;height:100%}  p-accordion,   .p-accordion{display:flex!important;flex-direction:column!important;height:100%!important}  p-accordion-panel,   .p-accordionpanel{display:flex!important;flex-direction:column!important;flex:0 0 auto!important}  p-accordion-panel.p-accordionpanel-active,   p-accordion-panel.p-highlight,   .p-accordionpanel.p-accordionpanel-active,   .p-accordionpanel.p-highlight{flex:1 1 auto!important;min-height:0!important;overflow:hidden!important}  p-accordion-header,   .p-accordionheader{flex:0 0 auto!important;z-index:10}  p-accordion-content,   .p-accordioncontent{flex:1 1 auto!important;overflow-y:auto!important;height:100%!important}  p-accordion-content .p-accordioncontent-content,   .p-accordioncontent .p-accordioncontent-content{min-height:100%}"]})};var yt=[{path:"",component:I}];export{yt as ADMIN_CLIENT_DETAILS_ROUTES};
