import{a as We}from"./chunk-I6P6CPWJ.js";import{b as Pe}from"./chunk-PDXK54JZ.js";import{a as ke,b as De}from"./chunk-JJVUWK2A.js";import"./chunk-PHOSYVDR.js";import{a as ze,b as Ve}from"./chunk-K3QSXHYQ.js";import{b as Fe,c as Te}from"./chunk-GV42Z4ED.js";import{A as ye,C as we,D as Ie,P as Ee,j as _e,l as v,n as fe,o as ge,r as be,s as he,u as ve,v as Ce,w as xe,x as Se,z as Ae}from"./chunk-HBFOC76W.js";import"./chunk-PH5YALHE.js";import{l as ce,m as ue}from"./chunk-6C6CC4KT.js";import{xa as pe}from"./chunk-JAXNIEKX.js";import{Jb as se,K as oe,M as ae,Pc as O,Q as le,Rc as de,T as F,Uc as me,c as ne,u as re}from"./chunk-FEC2V4R3.js";import{Ac as Z,Bc as ee,Cc as te,Dc as G,F as k,Hc as ie,Jb as _,K as R,Kb as f,Lb as J,Nb as U,Ob as q,Pb as c,Qb as a,R as $,Rb as r,S as j,Sb as h,U as z,Vc as N,Ya as l,Zb as D,Zc as Q,ba as x,bc as S,cc as d,gc as V,ha as g,hc as W,ia as b,ic as P,j as I,mb as Y,na as H,oc as M,qc as K,rc as p,sb as E,sc as y,ta as A,tc as X,yc as L,zc as B}from"./chunk-EG5ORV3B.js";import{a as w,b as T}from"./chunk-VB56BUGO.js";var Me=[{id:"tripDetails",name:"Trip Details Screen"},{id:"positionActivityStats",name:"Vehicle Activity Screen"},{id:"appSidebar",name:"App Sidebar"}];var Re=["basicInfoStep"],Ue=["integrationPointsStep"],qe=["reviewStep"],Le=()=>({standalone:!0}),Be=(i,t)=>t.id;function Ge(i,t){if(i&1){let e=D();a(0,"div",7),h(1,"i",8),a(2,"div",9)(3,"h3",10),p(4,"Submitted for review"),r(),a(5,"p",11),p(6," Your app has been sent for approval. We'll notify you when the review is complete. "),r(),a(7,"div",12)(8,"p-button",13),S("onClick",function(){g(e);let o=d(2);return b(o.goToAppDetail(o.submittedApp().id))}),r(),a(9,"p-button",14),S("onClick",function(){g(e);let o=d(2);return b(o.goToMarketplace())}),r()()()()}}function Qe(i,t){i&1&&(a(0,"div",4)(1,"p-card",5),E(2,Ge,10,0,"ng-template",6),r()())}function Oe(i,t){i&1&&(a(0,"small",20),p(1,"App name is required"),r())}function $e(i,t){i&1&&p(0," Short description is required ")}function je(i,t){i&1&&p(0," Maximum 100 characters allowed ")}function He(i,t){if(i&1&&(a(0,"small",20),_(1,$e,1,0)(2,je,1,0),r()),i&2){let e,n=d(2);l(),f(!((e=n.appForm.get("basicInfo.shortDescription"))==null||e.errors==null)&&e.errors.required?1:2)}}function Ye(i,t){i&1&&(a(0,"small",20),p(1,"Full description is required"),r())}function Je(i,t){if(i&1&&(a(0,"div",4)(1,"h2",15),p(2,"Basic Information"),r(),a(3,"form",16)(4,"div",17)(5,"div")(6,"label",18),p(7,"App Name *"),r(),h(8,"input",19),_(9,Oe,2,0,"small",20),r(),a(10,"div")(11,"label",21),p(12,"Short Description *"),r(),h(13,"input",22),_(14,He,3,1,"small",20),r(),a(15,"div")(16,"label",23),p(17,"Full Description *"),r(),h(18,"textarea",24),_(19,Ye,2,0,"small",20),r(),a(20,"div",25)(21,"div")(22,"label",26),p(23,"Icon URL"),r(),h(24,"input",27),r(),a(25,"div")(26,"label",28),p(27,"Health Check URL"),r(),h(28,"input",29),r()()()()()),i&2){let e,n,o,s,m,C,u=d();l(3),c("formGroup",u.appForm),l(5),M("ng-invalid",((e=u.appForm.get("basicInfo.name"))==null?null:e.invalid)&&((e=u.appForm.get("basicInfo.name"))==null?null:e.touched)),l(),f((n=u.appForm.get("basicInfo.name"))!=null&&n.invalid&&((n=u.appForm.get("basicInfo.name"))!=null&&n.touched)?9:-1),l(4),M("ng-invalid",((o=u.appForm.get("basicInfo.shortDescription"))==null?null:o.invalid)&&((o=u.appForm.get("basicInfo.shortDescription"))==null?null:o.touched)),l(),f((s=u.appForm.get("basicInfo.shortDescription"))!=null&&s.invalid&&((s=u.appForm.get("basicInfo.shortDescription"))!=null&&s.touched)?14:-1),l(4),M("ng-invalid",((m=u.appForm.get("basicInfo.description"))==null?null:m.invalid)&&((m=u.appForm.get("basicInfo.description"))==null?null:m.touched)),l(),f((C=u.appForm.get("basicInfo.description"))!=null&&C.invalid&&((C=u.appForm.get("basicInfo.description"))!=null&&C.touched)?19:-1)}}function Ke(i,t){i&1&&(a(0,"small",20),p(1,"Valid HTTPS URL is required"),r())}function Xe(i,t){if(i&1&&(a(0,"div",37)(1,"div")(2,"label",38),p(3),r(),h(4,"input",39),_(5,Ke,2,0,"small",20),r()()),i&2){let e,n=d(2).$implicit,o=G(0);c("formGroup",o),l(2),c("for","base-url-"+n.id),l(),X("Base URL for ",n.name," *"),l(),c("id","base-url-"+n.id),l(),f((e=o.get("baseUrl"))!=null&&e.invalid&&((e=o.get("baseUrl"))!=null&&e.touched)?5:-1)}}function Ze(i,t){if(i&1){let e=D();a(0,"div",34)(1,"p-checkbox",35),S("onChange",function(o){g(e);let s=d().$implicit,m=d(2);return b(m.toggleIntegrationPoint(s.id,o))}),r(),a(2,"label",36),p(3),r()(),_(4,Xe,6,5,"div",37)}if(i&2){let e=d().$implicit,n=G(0),o=d(2);l(),c("inputId",e.id)("binary",!0)("ngModel",o.isScreenSelected(e.id))("ngModelOptions",ie(7,Le)),l(),c("for",e.id),l(),y(e.name),l(),f(o.isScreenSelected(e.id)&&n?4:-1)}}function et(i,t){if(i&1&&(ee(0),a(1,"p-card"),E(2,Ze,5,8,"ng-template",6),r()),i&2){let e=t.$implicit,n=d(2);te(n.getIntegrationPointControl(e.id)),l(),K(n.isScreenSelected(e.id)?"border-primary":"")}}function tt(i,t){i&1&&(a(0,"small",20),p(1,"Please select at least one integration point and fill in the URLs."),r())}function it(i,t){if(i&1&&(a(0,"div",4)(1,"h2",30),p(2,"Integration Points"),r(),a(3,"p",31),p(4," Where will your app integrate with CypherView? Provide the Base URL for each selected point. "),r(),a(5,"form",16)(6,"div",32),U(7,et,3,3,"p-card",33,Be),_(9,tt,2,0,"small",20),r()()()),i&2){let e=d();l(5),c("formGroup",e.appForm),l(2),q(e.availableScreens),l(2),f(e.integrationPoints.invalid&&e.integrationPoints.touched?9:-1)}}function nt(i,t){if(i&1&&(a(0,"div")(1,"span",51),p(2,"Health Check"),r(),a(3,"code",57),p(4),r()()),i&2){let e,n=d(3);l(4),y((e=n.formValue())==null||e.basicInfo==null?null:e.basicInfo.healthCheckUrl)}}function rt(i,t){if(i&1&&(a(0,"div",55)(1,"p",58),p(2),r(),a(3,"code",59),p(4),r()()),i&2){let e=t.$implicit;l(2),y(e.screenId),l(2),y(e.baseUrl)}}function ot(i,t){i&1&&(a(0,"span",56),p(1,"None selected"),r())}function at(i,t){if(i&1&&(a(0,"div",49)(1,"div",50)(2,"div")(3,"span",51),p(4,"App Name"),r(),a(5,"span",52),p(6),r()(),a(7,"div")(8,"span",51),p(9,"Short Description"),r(),a(10,"span",53),p(11),r()(),_(12,nt,5,1,"div"),r(),a(13,"div",50)(14,"div")(15,"span",51),p(16,"Integrations"),r(),a(17,"div",54),U(18,rt,5,2,"div",55,J),_(20,ot,2,0,"span",56),r()()()()),i&2){let e,n,o,s,m,C=d(2);l(6),y((e=C.formValue())==null||e.basicInfo==null?null:e.basicInfo.name),l(5),y((n=C.formValue())==null||n.basicInfo==null?null:n.basicInfo.shortDescription),l(),f(!((o=C.formValue())==null||o.basicInfo==null)&&o.basicInfo.healthCheckUrl?12:-1),l(6),q((s=C.formValue())==null||s.integration==null?null:s.integration.points),l(2),f(!((m=C.formValue())==null||m.integration==null||m.integration.points==null)&&m.integration.points.length?-1:20)}}function lt(i,t){i&1&&p(0," Please ensure all changes are correct before updating your app. ")}function pt(i,t){i&1&&p(0," Your app will be submitted to the review team. This usually takes 24-48 hours. ")}function st(i,t){if(i&1&&(a(0,"div",60),h(1,"i",61),a(2,"div")(3,"p",62),p(4,"Final Verification"),r(),a(5,"p",63),_(6,lt,1,0)(7,pt,1,0),r()()()),i&2){let e=d(2);l(6),f(e.isEditMode()?6:7)}}function dt(i,t){if(i&1&&(a(0,"div",42),h(1,"i",64),a(2,"span"),p(3),r()()),i&2){let e=d(2);l(3),y(e.submissionError())}}function mt(i,t){if(i&1){let e=D();a(0,"div",4)(1,"h2",15),p(2,"Review & Submit"),r(),a(3,"div")(4,"p-card",40),E(5,at,21,4,"ng-template",6),r(),a(6,"p-card",41),E(7,st,8,1,"ng-template",6),r(),_(8,dt,4,1,"div",42),a(9,"div",43)(10,"p-button",44),S("onClick",function(){g(e);let o=d();return b(o.onWizardCancel())}),r(),h(11,"div",45),a(12,"p-button",46),S("onClick",function(){g(e);let o=d();return b(o.currentStep.set(o.prevStepValue()))}),r(),a(13,"p-button",47),S("onClick",function(){g(e);let o=d();return b(o.saveDraft())}),r(),a(14,"p-button",48),S("onClick",function(){g(e);let o=d();return b(o.submitForReview())}),r()()()()}if(i&2){let e=d();l(8),f(e.submissionError()?8:-1),l(2),c("text",!0),l(2),c("outlined",!0),l(),c("outlined",!0)("loading",e.isSubmitting()&&e.submitAction==="draft")("disabled",!e.appForm.valid||e.isSubmitting()),l(),c("loading",e.isSubmitting()&&e.submitAction==="review")("disabled",!e.appForm.valid||e.isSubmitting())}}var Ne=class i{basicInfoStep;integrationPointsStep;reviewStep;fb=x(Se);router=x(ae);route=x(oe);appStoreService=x(Pe);destroyRef=x(H);userSessionService=x(se);clientDataService=x(me);location=x(ne);steps=A([]);isSubmitting=A(!1);visible=A(!0);submissionError=A(null);submittedApp=A(null);isEditMode=A(!1);existingAppId=null;existingAppData=null;currentStep=A(1);isLastStep=Q(()=>{let t=this.steps();return t.length>0&&this.currentStep()===t.at(-1)?.value});prevStepValue=Q(()=>{let t=this.steps(),e=t.findIndex(n=>n.value===this.currentStep());return e>0?t[e-1].value:1});appForm;formValue;submitAction=null;availableScreens=Me;constructor(){this.appForm=this.fb.group({basicInfo:this.fb.group({name:["",v.required],shortDescription:["",[v.required,v.maxLength(100)]],description:["",v.required],iconUrl:[""],healthCheckUrl:["",[v.pattern("https?://.+")]]}),integration:this.fb.group({points:this.fb.array([],v.required)})}),this.formValue=de(this.appForm.valueChanges.pipe($(this.appForm.value))),this.bootstrapEditContext()}get integrationPoints(){return this.appForm.get("integration.points")}toggleIntegrationPoint(t,e){let n=e.checked,o=this.integrationPoints.controls.findIndex(s=>s.value.screenId===t);n?o===-1&&this.integrationPoints.push(this.fb.group({screenId:[t],baseUrl:["",[v.required,v.pattern("https?://.+")]],requiredPermissions:[[]]})):o>=0&&this.integrationPoints.removeAt(o)}isScreenSelected(t){return this.integrationPoints.controls.some(e=>e.value.screenId===t)}getIntegrationPointControl(t){return this.integrationPoints.controls.find(e=>e.value.screenId===t)}ngAfterViewInit(){this.steps.set([{value:1,header:"Basic Info",content:this.basicInfoStep,disableNext:!0},{value:2,header:"Integration Points",content:this.integrationPointsStep,disableNext:!0},{value:3,header:"Review",content:this.reviewStep,disableNext:!1,hideDefaultFooter:!0}]),this.updateStepStates(),this.appForm.valueChanges.pipe(O(this.destroyRef)).subscribe(()=>this.updateStepStates())}onWizardComplete(){this.submit()}onWizardCancel(){this.location.back()}saveDraft(){this.submitAction="draft",this.submit()}submitForReview(){this.submitAction="review",this.submit()}submit(){if(!this.appForm.valid||this.isSubmitting())return;this.submissionError.set(null),this.isSubmitting.set(!0);let t=this.appForm.value,e=this.submitAction||"draft";F(this.existingAppId)&&this.existingAppData?this.handleEditSubmit(t,e):this.handleCreateSubmit(t,e)}handleEditSubmit(t,e){let n=T(w({},t.basicInfo),{integrationPoints:t.integration.points,status:e==="review"?"pendingReview":"draft"});F(this.existingAppId)&&this.appStoreService.updateApp(this.existingAppId,n).pipe(z(o=>{F(o)&&(this.submittedApp.set(o),this.visible.set(!1))}),k(()=>(this.submissionError.set("Could not update your app. Please try again."),I(null))),R(()=>{this.isSubmitting.set(!1),this.submitAction=null})).subscribe()}handleCreateSubmit(t,e){let n=this.userSessionService.currentUserSession(),o=T(w({},t.basicInfo),{iconUrl:t.basicInfo.iconUrl??"assets/default-app-icon.png",developerId:n?.id??"unknown-user",developerName:n?.name??"Unknown Developer",integrationPoints:t.integration.points,categories:["Productivity"],tags:[]});this.appStoreService.createApp(o).pipe(j(s=>e==="review"?this.appStoreService.submitForReview(s.id).pipe(k(()=>I(s))):I(s)),z(s=>{F(s)&&(this.submittedApp.set(s),this.visible.set(!1))}),k(()=>(this.submissionError.set("Could not save your app. Please try again."),I(null))),R(()=>{this.isSubmitting.set(!1),this.submitAction=null})).subscribe()}goToAppDetail(t){this.router.navigate(["/app-store",t]).catch(()=>{})}goToMarketplace(){this.location.back()}bootstrapEditContext(){let e=history.state?.appToEdit,n=this.route.snapshot.queryParamMap.get("appId");if(e){this.enterEditMode(e);return}F(n)&&this.loadAppForEdit(n)}loadAppForEdit(t){this.appStoreService.getAppById(t,this.clientDataService.getSelectedClient()?.id??"").pipe(z(e=>{e&&this.enterEditMode(e)}),k(()=>(this.submissionError.set("Could not load the app to edit."),I(null))),O(this.destroyRef)).subscribe()}enterEditMode(t){this.existingAppId=t.id,this.existingAppData=w({},t),this.isEditMode.set(!0),this.appForm.patchValue({basicInfo:{name:t.name,shortDescription:t.shortDescription,description:t.description,iconUrl:t.iconUrl,healthCheckUrl:t.healthCheckUrl}}),this.integrationPoints.clear(),t.integrationPoints.forEach(e=>{this.integrationPoints.push(this.fb.group({screenId:[e.screenId],baseUrl:[e.baseUrl,[v.required,v.pattern("https?://.+")]],requiredPermissions:[e.requiredPermissions]}))}),this.updateStepStates()}updateStepStates(){let t=this.steps();if(!t.length)return;let e=this.appForm.get("basicInfo")?.valid??!1,n=this.integrationPoints.valid&&(this.integrationPoints.length??0)>0;this.steps.set([T(w({},t[0]),{disableNext:!e}),T(w({},t[1]),{disableNext:!n}),t[2]])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=Y({type:i,selectors:[["app-create-wizard"]],viewQuery:function(e,n){if(e&1&&(V(Re,5),V(Ue,5),V(qe,5)),e&2){let o;W(o=P())&&(n.basicInfoStep=o.first),W(o=P())&&(n.integrationPointsStep=o.first),W(o=P())&&(n.reviewStep=o.first)}},decls:8,vars:9,consts:[["basicInfoStep",""],["integrationPointsStep",""],["reviewStep",""],[3,"visibleChange","currentStepChange","complete","contentOnly","visible","header","steps","showSteps","useWizardButtonsOnly","currentStep","loading"],[1,"p-4"],[1,"bg-surface-0","border-left-3","surface-border"],["pTemplate","content"],[1,"flex","items-start","gap-3"],[1,"pi","pi-check-circle","text-xl"],[1,"space-y-1"],[1,"text-lg","font-semibold"],[1,"text-sm","text-surface-800"],[1,"flex","gap-2","mt-2"],["label","View App","icon","pi pi-eye","size","small",3,"onClick"],["label","Back to More Apps","icon","pi pi-arrow-left","severity","secondary","size","small",3,"onClick"],[1,"text-xl","font-semibold","mb-4"],[3,"formGroup"],["formGroupName","basicInfo",1,"space-y-4"],["for","app-name",1,"block","text-sm","font-medium","mb-1"],["id","app-name","pInputText","","formControlName","name","type","text",1,"w-full"],[1,"p-error"],["for","app-short-desc",1,"block","text-sm","font-medium","mb-1"],["id","app-short-desc","pInputText","","formControlName","shortDescription","type","text","placeholder","Brief summary (max 100 chars)",1,"w-full"],["for","app-desc",1,"block","text-sm","font-medium","mb-1"],["id","app-desc","pTextarea","","formControlName","description","rows","5",1,"w-full"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["for","app-icon",1,"block","text-sm","font-medium","mb-1"],["id","app-icon","pInputText","","formControlName","iconUrl","type","text","placeholder","https://...",1,"w-full"],["for","health-check-url",1,"block","text-sm","font-medium","mb-1"],["id","health-check-url","pInputText","","formControlName","healthCheckUrl","type","text","placeholder","https://...",1,"w-full"],[1,"text-xl","font-semibold","mb-2"],[1,"text-sm","border-b","pb-2","mb-4"],["formGroupName","integration",1,"space-y-4"],[3,"class"],[1,"flex","items-center","mb-3"],[3,"onChange","inputId","binary","ngModel","ngModelOptions"],[1,"ml-2","block","text-sm","font-medium","cursor-pointer",3,"for"],[1,"pl-7","space-y-3",3,"formGroup"],[1,"block","text-xs","font-semibold","uppercase","text-surface-500","mb-1",3,"for"],["pInputText","","formControlName","baseUrl","type","text","placeholder","https://api.yourapp.com/widget/",1,"w-full","text-sm",3,"id"],[1,"mb-4","shadow-sm","border-surface-200"],[1,"bg-surface-0","mb-4","border-left-3","border-orange-400","surface-border"],[1,"p-3","mb-4","bg-red-50","text-red-700","rounded-md","border-left-3","border-red-500","flex","items-center","gap-2"],[1,"flex","gap-3","justify-end","mt-6","pt-4","border-t","surface-border"],["label","Cancel","icon","pi pi-times","severity","secondary",3,"onClick","text"],[1,"flex-grow"],["label","Back","icon","pi pi-arrow-left","severity","secondary",3,"onClick","outlined"],["label","Save Draft","icon","pi pi-save","severity","secondary",3,"onClick","outlined","loading","disabled"],["label","Submit for Review","icon","pi pi-send","severity","primary",3,"onClick","loading","disabled"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"space-y-4"],[1,"block","text-xs","font-semibold","uppercase","text-surface-500","mb-1"],[1,"text-lg","font-medium"],[1,"text-sm","line-clamp-2"],[1,"space-y-2"],[1,"p-2","bg-surface-50","rounded-md","border"],[1,"text-xs","p-error","italic"],[1,"text-xs"],[1,"text-sm","font-bold"],[1,"text-[10px]","break-all"],[1,"flex","items-start","gap-3","text-sm"],[1,"pi","pi-exclamation-triangle","text-lg","mt-0.5","text-orange-400"],[1,"font-medium","text-surface-900"],[1,"text-surface-700"],[1,"pi","pi-times-circle"]],template:function(e,n){if(e&1){let o=D();a(0,"app-wizard",3),Z("visibleChange",function(m){return g(o),B(n.visible,m)||(n.visible=m),b(m)})("currentStepChange",function(m){return g(o),B(n.currentStep,m)||(n.currentStep=m),b(m)}),S("complete",function(){return g(o),b(n.onWizardComplete())})("visibleChange",function(){return g(o),b(n.onWizardCancel())}),r(),_(1,Qe,3,0,"div",4),E(2,Je,29,10,"ng-template",null,0,N)(4,it,10,2,"ng-template",null,1,N)(6,mt,15,8,"ng-template",null,2,N)}e&2&&(c("contentOnly",!1),L("visible",n.visible),c("header",n.isEditMode()?"Edit App":"Create New App")("steps",n.steps())("showSteps",!0)("useWizardButtonsOnly",!0),L("currentStep",n.currentStep),c("loading",n.isSubmitting()),l(),f(n.submittedApp()?1:-1))},dependencies:[re,le,Ae,he,_e,fe,ge,be,ye,xe,Ce,ve,ue,ce,pe,Ie,we,Ve,ze,Ee,Te,Fe,De,ke,We],encapsulation:2})};export{Ne as AppCreateWizardComponent};
