import{a as ze}from"./chunk-I6P6CPWJ.js";import{a as _t,b as Mt,c as Tt,d as Ie}from"./chunk-QNWXBGES.js";import{a as At}from"./chunk-KZASHGYS.js";import"./chunk-KAPCDYJA.js";import{a as kt}from"./chunk-QVSLGYTS.js";import"./chunk-UJGTUYJO.js";import{a as Ct,h as Lt,i as Ot,z as Ft}from"./chunk-GVCBKH6U.js";import"./chunk-PHOSYVDR.js";import{q as yt}from"./chunk-UUBV4PLA.js";import{a as Ut,b as Dt}from"./chunk-T2ASJLBG.js";import"./chunk-K3QSXHYQ.js";import"./chunk-L7NFYEY5.js";import"./chunk-BEAFDC2I.js";import"./chunk-53JQ5NAG.js";import"./chunk-GV42Z4ED.js";import"./chunk-SDMJKPKX.js";import{A as ve,C as be,D as Ce,O as Se,P as xe,j as pe,l as v,n as de,o as me,s as ue,v as he,w as fe,y as ge}from"./chunk-HBFOC76W.js";import{a as Pt,b as Et}from"./chunk-MI5GPO5K.js";import"./chunk-PH5YALHE.js";import{l as ce,m as k}from"./chunk-6C6CC4KT.js";import{Ca as mt,Ea as St,Fa as xt,Ga as le,Ha as wt,ta as pt,ya as dt}from"./chunk-JAXNIEKX.js";import{E as st,Ib as vt,J as lt,Jb as D,K as ee,Kb as ne,L as ct,M,N as B,Pc as _,Q as U,Qc as re,R as A,S as y,Sb as oe,T as f,Tb as R,Ub as Ne,Uc as j,Vb as Re,Xc as ae,Y as te,_ as ut,_c as Y,c as rt,ca as ht,fa as ie,ga as ft,hd as se,id as bt,lb as gt,qb as Fe,u as at}from"./chunk-FEC2V4R3.js";import{$ as Qe,D as je,F as Ye,Gc as ot,Hc as N,J as K,Jb as x,K as Oe,Kb as w,Pb as d,Qb as s,Rb as l,S as Ge,Sb as g,U as He,Vb as Je,Vc as De,Y as I,Ya as p,Zb as E,Zc as Q,ba as a,bc as P,cc as m,dc as et,ec as tt,gc as V,gd as J,ha as b,hc as W,ia as C,ic as q,j as Z,ma as $e,mb as S,na as z,o as Le,qb as Xe,qc as it,rb as Ze,rc as c,s as Be,sb as Ke,sc as nt,ta as h,tc as O,ya as Ue}from"./chunk-EG5ORV3B.js";import"./chunk-VB56BUGO.js";var we=class n{canvas;ctx;particles=[];animationFrameId;mouse={x:0,y:0};running=!1;mouseMoveHandler=t=>{let e=this.canvas.getBoundingClientRect(),o=this.canvas.width/e.width,i=this.canvas.height/e.height;this.mouse.x=(t.clientX-e.left)*o,this.mouse.y=(t.clientY-e.top)*i};touchMoveHandler=t=>{if(y(this.canvas)||!te(this.canvas))return;let e=this.canvas.getBoundingClientRect(),o=this.canvas.width/e.width,i=this.canvas.height/e.height;this.mouse.x=(t.touches[0].clientX-e.left)*o,this.mouse.y=(t.touches[0].clientY-e.top)*i};resizeHandler=()=>{if(y(this.canvas)||!te(this.canvas))return;let t=this.canvas.width,e=this.canvas.height;this.resizeCanvas();let o=this.canvas.width/t,i=this.canvas.height/e;this.particles.forEach(r=>{r.x*=o,r.y*=i,r.x<0&&(r.x=0),r.x>this.canvas.width&&(r.x=this.canvas.width),r.y<0&&(r.y=0),r.y>this.canvas.height&&(r.y=this.canvas.height)})};initAnimation(t){if(y(t)||!te(t))return;this.canvas=t;let e=t.getContext("2d");e&&(this.ctx=e,this.resizeCanvas(),window.addEventListener("mousemove",this.mouseMoveHandler),window.addEventListener("touchmove",this.touchMoveHandler,{passive:!0}),window.addEventListener("resize",this.resizeHandler),this.running=!0,this.init())}init(){if(y(this.canvas)||y(this.ctx))return;this.particles=[];let t=this.canvas.width*this.canvas.height,e=1920*1080,o=Math.min(1,t/e),i=200,r=20,u=Math.floor(i*o),L=Math.floor(r*o);for(let T=0;T<u;T++)this.particles.push(new ye(this.canvas,this.particles));for(let T=0;T<L;T++)this.particles.push(new Ve(this.canvas,this.particles));this.animate()}resizeCanvas(){this.canvas.style.width="100vw",this.canvas.style.height="100vh",this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}animate(){if(y(this.canvas)||y(this.ctx)||!this.running)return;let t=this.ctx.createLinearGradient(0,0,0,this.canvas.height);t.addColorStop(0,"#000B1E"),t.addColorStop(1,"#000000"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.particles.forEach(e=>{e.update(this.mouse),e.draw(this.ctx)}),this.drawConnections(),this.animationFrameId=requestAnimationFrame(()=>this.animate())}drawConnections(){if(!(y(this.canvas)||y(this.ctx)))for(let t=0;t<this.particles.length;t++)for(let e=t+1;e<this.particles.length;e++){let o=this.particles[t].x-this.particles[e].x,i=this.particles[t].y-this.particles[e].y,r=Math.sqrt(o*o+i*i);if(r>150&&r<350){let u=1-(r-150)/100;this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(255, 255, 255, ${u*.3})`,this.ctx.lineWidth=.5,this.ctx.moveTo(this.particles[t].x,this.particles[t].y),this.ctx.lineTo(this.particles[e].x,this.particles[e].y),this.ctx.stroke()}}}destroy(){this.running=!1,f(this.animationFrameId)&&cancelAnimationFrame(this.animationFrameId),window.removeEventListener("mousemove",this.mouseMoveHandler),window.removeEventListener("touchmove",this.touchMoveHandler),window.removeEventListener("resize",this.resizeHandler)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=I({token:n,factory:n.\u0275fac,providedIn:"root"})},ye=class{constructor(t,e){this.canvas=t;this.particles=e;this.x=this.baseX=Math.random()*t.width,this.y=this.baseY=Math.random()*t.height}x;y;speed=.25;direction=Math.random()*Math.PI*2;radius=Math.random()*4.5+.5;baseX;baseY;update(t){this.x+=Math.cos(this.direction)*this.speed,this.y+=Math.sin(this.direction)*this.speed;let e=t.x-this.x,o=t.y-this.y,i=Math.sqrt(e*e+o*o);if(i<150){let r=(200-i)/200,u=Math.atan2(o,e);this.x-=Math.cos(u)*r*5,this.y-=Math.sin(u)*r*5}this.particles.forEach(r=>{if(r!==this){let u=r.x-this.x,L=r.y-this.y,T=Math.sqrt(u*u+L*L);if(T<100){let H=(100-T)/100;this.x-=u*H*.1,this.y-=L*H*.1}}}),(this.x<0||this.x>this.canvas.width)&&(this.direction=Math.PI-this.direction),(this.y<0||this.y>this.canvas.height)&&(this.direction=-this.direction)}draw(t){let e=t.createRadialGradient(this.x,this.y,0,this.x,this.y,this.radius);e.addColorStop(0,"rgba(255, 255, 255, 0.5)"),e.addColorStop(1,"rgba(255, 255, 255, 0)"),t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fillStyle=e,t.fill()}},Ve=class extends ye{originalX;amplitude=Math.random()*10+1;period=Math.random()*.25+.02;phase=Math.random()*Math.PI*2;constructor(t,e){super(t,e),this.originalX=this.x,this.speed=.01+Math.random()*.2}update(t){this.y-=this.speed,this.x=this.originalX+Math.sin(this.y*this.period+this.phase)*this.amplitude;let e=t.x-this.x,o=t.y-this.y,i=Math.sqrt(e*e+o*o);if(i<400){let r=(200-i)/200,u=Math.atan2(o,e);this.x-=Math.cos(u)*r*5,this.y-=Math.sin(u)*r*5}this.y<0&&(this.y=this.canvas.height,this.originalX=Math.random()*this.canvas.width)}};var Bt=["canvas"],_e=class n{networkAnimationService=a(we);canvasRef;ngAfterViewInit(){this.networkAnimationService.initAnimation(this.canvasRef.nativeElement)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-network-animation"]],viewQuery:function(e,o){if(e&1&&V(Bt,5),e&2){let i;W(i=q())&&(o.canvasRef=i.first)}},decls:2,vars:0,consts:[["canvas",""],[1,"network-animation"]],template:function(e,o){e&1&&Je(0,"canvas",1,0)},styles:["[_nghost-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:-1;overflow:hidden;margin:0;padding:0}canvas.network-animation[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:auto;image-rendering:-webkit-crisp-edges;image-rendering:-moz-crisp-edges;image-rendering:crisp-edges;image-rendering:pixelated;-webkit-backface-visibility:hidden;backface-visibility:hidden}"]})};var Me=class n{isRouteActive=h(!1);router=a(M);ngOnInit(){if(this.router.url==="/auth"||this.router.url==="/auth/"){let e=this.router.parseUrl(this.router.url).queryParams;this.router.navigate(["/auth/login"],{queryParams:e}).catch(()=>{})}this.router.events.pipe(je(t=>t instanceof lt)).subscribe(()=>{this.isRouteActive.set(this.router.url!=="/auth")})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-container"]],decls:5,vars:0,consts:[[1,"wrapper","bg-cover","bg-center","h-screen"],[1,"flex","flex-col","items-center","h-auto","sm:h-full"],["src","assets/images/logo.svg","alt","Cypherview logo",1,"logo-filter","w-1/3","my-16","max-w-[1050px]","hidden","sm:block"]],template:function(e,o){e&1&&(s(0,"div",0),g(1,"app-network-animation"),s(2,"div",1),g(3,"img",2)(4,"router-outlet"),l()())},dependencies:[U,ct,k,_e],styles:[".wrapper[_ngcontent-%COMP%]{position:relative;background:var(--color-background-dark, #000b1e);overflow:hidden;width:100%}.wrapper[_ngcontent-%COMP%]   app-network-animation[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:0}.wrapper[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{position:relative;z-index:1}.wrapper[_ngcontent-%COMP%]   .logo-filter[_ngcontent-%COMP%]{filter:brightness(0) invert(1);transition:filter .2s ease}"]})};var G=class n{router=a(M);clientDataService=a(j);messageService=a(ae);userSessionService=a(D);localStorageService=a(vt);isNavigating=!1;async navigateBasedOnSessions(t,e){if(this.isNavigating)return!1;this.isNavigating=!0;try{if(this.router.url.includes("context-selection"))return!1;this.localStorageService.removeItem(gt,!0);let o=e!=null&&e.trim()!==""?{returnUrl:e}:{};if(t.length===1){let i=t[0],r=i.owner?.type?.toUpperCase(),u=i.defaultClient?.id;if(r==="CLIENT"&&f(u)){this.userSessionService.setCurrentUserSession(i.id);try{return await this.clientDataService.setSelectedClientById(u),this.messageService.sendAction("profile_changed",{clientId:u}),await this.router.navigate(["/position"])}catch{return await this.router.navigate(["/auth","context-selection"],{queryParams:o})}}}return await this.router.navigate(["/auth","context-selection"],{queryParams:o})}finally{this.isNavigating=!1}}static \u0275fac=function(e){return new(e||n)};static \u0275prov=I({token:n,factory:n.\u0275fac,providedIn:"root"})};var Yt=["accountSelectionStep"],Gt=["clientSelectionStep"];function Ht(n,t){n&1&&(s(0,"div",7)(1,"div",9),g(2,"p-progressSpinner",10),s(3,"p",11),c(4,"Preparing your account..."),l()()())}function Qt(n,t){n&1&&(s(0,"p",13),c(1," Loading theme preview... "),l())}function $t(n,t){if(n&1){let e=E();s(0,"div",8)(1,"div",12),x(2,Qt,2,0,"p",13),l(),s(3,"app-client-selector",14),P("accountSelected",function(i){b(e);let r=m(2);return C(r.onAccountSelected(i))}),l()()}if(n&2){let e=m(2);p(2),w(e.loadingPreviewTheme()?2:-1),p(),d("clientAccounts",e.accounts)("maxHeightClass","max-h-[18rem]")}}function Xt(n,t){if(n&1&&x(0,Ht,5,0,"div",7)(1,$t,4,3,"div",8),n&2){let e=m();w(e.isAutoSelectingAccount()?0:1)}}function Zt(n,t){if(n&1&&(s(0,"div",15),g(1,"p-progressSpinner",16),s(2,"p",17),c(3),l()()),n&2){let e=m(2);p(3),O(" ",e.permissionsChecked()?"Preparing your experience...":"Checking permissions..."," ")}}function Kt(n,t){n&1&&(s(0,"div",15),g(1,"i",18),s(2,"p",19),c(3," No Permission to View Clients "),l(),s(4,"p",20),c(5," Your account does not have permission to list clients. Please contact your administrator for access. "),l()())}function Jt(n,t){n&1&&(s(0,"p",13),c(1," Loading clients... "),l())}function ei(n,t){if(n&1){let e=E();s(0,"div",12),x(1,Jt,2,0,"p",13),l(),s(2,"app-client-selection-form",21),P("clientSelected",function(i){b(e);let r=m(2);return C(r.onClientSelected(i))})("searchQuery",function(i){b(e);let r=m(2);return C(r.onClientSearch(i))})("lazyLoad",function(i){b(e);let r=m(2);return C(r.onLazyLoadClients(i))}),l()}if(n&2){let e=m(2);p(),w(e.loadingClients()&&e.availableClients().length===0?1:-1),p(),d("clients",e.availableClients())("loading",e.loadingClients())("useServerSearch",e.useServerSearch())("totalRecords",e.totalClientCount())("enablePagination",e.useServerSearch())("enableLazyLoad",e.useServerSearch())("recentClients",e.recentClients())}}function ti(n,t){if(n&1&&(s(0,"div",8),x(1,Zt,4,1,"div",15)(2,Kt,6,0,"div",15)(3,ei,3,8),l()),n&2){let e=m();p(),w(!e.permissionsChecked()||e.isLoading()?1:e.canListClients()?3:2)}}var qe={LOGIN:["/auth","login"],POSITION:["/position"],RESET_PASSWORD_WELCOME:["/auth","reset-password-welcome"]},Nt={SELECT_ACCOUNT:"Select Account",SELECT_CLIENT:"Select Client"},X={ACTIVE_STATE:"active",CLIENT_TYPE:"CLIENT",SORT_ORDER:"name:asc",FILTER_NAME:"name"},Te=class n{accountSelectionStep;clientSelectionStep;wizard;userSessionService=a(D);userSessionNavigationService=a(G);router=a(M);route=a(ee);apiAuthService=a(ie);authTokenManager=a(ne);clientDataService=a(j);clientsService=a(ft);messageService=a(ae);utilityService=a(yt);authDataService=a(Y);themeService=a(oe);cdr=a(J);destroyRef=a(z);uiMessageService=a(pt);recentClientsService=a(Mt);accounts=this.userSessionService.userSessions();selectedAccount=h(null);availableClients=h([]);totalClientCount=h(0);loadingClients=h(!1);loadingPreviewTheme=h(!1);isAutoSelectingAccount=h(!1);isPasswordResetMode=!1;returnUrl=null;isSubmitting=h(!1);searchTerm=h("");paginationOffset=h(0);pageSize=Fe;cachedEmptyClients=[];unfilteredTotalCount=h(0);useServerSearch=Q(()=>this.unfilteredTotalCount()>=Fe);canListClients=Q(()=>this.authDataService.hasPermission("client:list-clients")||this.authDataService.hasPermission("clients:list"));permissionsChecked=Q(()=>this.authDataService.getUserProfile()!==null);currentYear=new Date().getFullYear();isLoading=Q(()=>this.isSubmitting()||this.loadingPreviewTheme());recentClients=this.recentClientsService.recentClients;steps=[];constructor(){this.canListClients()&&this.setupClientsStream()}setupClientsStream(){let t=re(this.searchTerm).pipe(K()),e=re(this.paginationOffset).pipe(K()),o=re(this.selectedAccount).pipe(K((i,r)=>i?.id===r?.id));Be([t,e,o]).pipe(_(this.destroyRef),He(()=>this.loadingClients.set(!0)),Ge(([i,r,u])=>{let L=i.trim(),T=u?.owner?.id;if(!f(T))return Z(null);if(L===""&&r===0&&this.cachedEmptyClients.length>0)return Z({items:this.cachedEmptyClients,count:this.unfilteredTotalCount()});let H={state:{value:X.ACTIVE_STATE,operator:"="}};L!==""&&(H[X.FILTER_NAME]={value:`*${L}*`,operator:"="});let Wt=this.utilityService.constructRqlFilter(H);return this.clientsService.listClients(T,r,this.pageSize,X.SORT_ORDER,Wt).pipe(Ye(qt=>(console.error("Error loading clients:",qt),this.fallbackToDefaultClient(),Z(null))))})).subscribe(i=>{if(f(i)&&ut(i,"items")){let r=i.items??[];this.availableClients.set(r),this.totalClientCount.set(i.count??0),this.searchTerm().trim()===""&&this.paginationOffset()===0&&(this.cachedEmptyClients=r,this.unfilteredTotalCount.set(i.count??r.length))}this.loadingClients.set(!1),this.cdr.detectChanges()})}ngOnInit(){let t=this.route.snapshot.queryParams.resetPassword;this.isPasswordResetMode=t==="true",this.returnUrl=this.route.snapshot.queryParams.returnUrl??null}ngAfterViewInit(){let t=[],e=1;if(this.accounts.length>1&&t.push({value:e++,header:Nt.SELECT_ACCOUNT,content:this.accountSelectionStep,complete:!1,disableNext:!0}),t.push({value:e,header:Nt.SELECT_CLIENT,content:this.clientSelectionStep,complete:!1,disableNext:!0}),this.steps=t,this.cdr.detectChanges(),this.accounts.length===0){this.navigateToLogin();return}let o=this.accounts[0];o?.defaultClient?.id&&(this.loadingPreviewTheme.set(!0),this.clientsService.getClient(o.defaultClient.id).pipe(_(this.destroyRef),Oe(()=>this.loadingPreviewTheme.set(!1))).subscribe({next:i=>{this.clientDataService.setPreviewClient(i)},error:i=>{console.warn("Failed to load initial preview client:",i)}})),this.accounts.length===1&&(this.isAutoSelectingAccount.set(!0),this.userSessionNavigationService.navigateBasedOnSessions(this.accounts,this.returnUrl).then(i=>{i||this.onAccountSelected(this.accounts[0])}).catch(i=>console.error("Error auto-selecting account:",i)).finally(()=>this.isAutoSelectingAccount.set(!1)))}async onAccountSelected(t){this.selectedAccount.set(t),this.clearSessionState(),this.isSubmitting.set(!0);try{if(this.isPasswordResetMode){this.userSessionService.setCurrentUserSession(t.id),this.isSubmitting.set(!1),await this.router.navigate(qe.RESET_PASSWORD_WELCOME);return}if(this.accounts.length===1?this.userSessionService.setCurrentUserSession(t.id):await this.authenticateUser(t),await this.handleReturnUrl()){this.isSubmitting.set(!1);return}await this.handleClientSelectionFlow(t)}catch(e){console.error("Error selecting user:",e),this.uiMessageService.add({severity:"error",summary:"Error",detail:"Failed to select account. Please try again."}),this.isSubmitting.set(!1)}}clearSessionState(){this.clientDataService.clearSelectedClient(),this.clientDataService.clearPreviewClient(),this.themeService.clearTheme()}async authenticateUser(t){let e=await Le(this.apiAuthService.selectUser(t.id));this.authTokenManager.storeTokens({accessToken:e.accessToken,refreshToken:e.refreshToken,idToken:e.idToken??"",users:this.accounts});let o=await Le(this.apiAuthService.getUserProfile());f(o)&&await this.authDataService.setUserProfile(o),this.userSessionService.setCurrentUserSession(t.id)}async handleReturnUrl(){return f(this.returnUrl)&&this.returnUrl!==null&&this.returnUrl.trim()!==""?(await this.router.navigateByUrl(this.returnUrl),!0):!1}async handleClientSelectionFlow(t){let o=t?.owner?.type?.toUpperCase()===X.CLIENT_TYPE,i=t?.defaultClient?.id??(o?t?.owner?.id:void 0),r=o&&f(i);if(f(i)&&this.loadPreviewTheme(i),!this.canListClients()&&f(i)){this.attemptAutoSelectClient(i);return}if(!this.canListClients()&&!f(i)){await this.enableClientSelectionStep(),this.isSubmitting.set(!1);return}r||this.loadClientsForAccount(),r?this.attemptAutoSelectClient(i):(await this.enableClientSelectionStep(),this.isSubmitting.set(!1))}loadPreviewTheme(t){this.loadingPreviewTheme.set(!0),this.clientsService.getClient(t).pipe(_(this.destroyRef),Oe(()=>this.loadingPreviewTheme.set(!1))).subscribe({next:e=>{this.clientDataService.setPreviewClient(e)},error:e=>{console.warn("Failed to load preview client for theming:",e)}})}attemptAutoSelectClient(t){this.clientsService.getClient(t).pipe(_(this.destroyRef)).subscribe({next:e=>{this.finalizeClientSelection(e)},error:()=>{this.isSubmitting.set(!1),this.enableClientSelectionStep()}})}finalizeClientSelection(t){this.clientDataService.clearPreviewClient(),this.messageService.sendAction("profile_changed",{clientId:t.id}),this.clientDataService.setSelectedClient(t),f(t.name)&&this.recentClientsService.addRecentClient(t.id,t.name),this.router.navigate(qe.POSITION).then(e=>{e||this.isSubmitting.set(!1)}).catch(()=>{this.isSubmitting.set(!1)})}async enableClientSelectionStep(){Array.isArray(this.steps)&&this.steps.length>1&&(this.steps[0].complete=!0,this.steps[1].disableNext=!1,await this.wizard.goNext())}loadClientsForAccount(t=""){this.paginationOffset.set(0),this.searchTerm.set(t)}onClientSearch(t){this.canListClients()&&(this.paginationOffset.set(0),this.searchTerm.set(t))}onLazyLoadClients(t){this.canListClients()&&this.paginationOffset.set(t.first??0)}async onClientSelected(t){t&&(this.isSubmitting.set(!0),this.clientsService.getClient(t).pipe(_(this.destroyRef)).subscribe({next:e=>{this.finalizeClientSelection(e)},error:e=>{console.error("Error selecting client:",e),this.uiMessageService.add({severity:"error",summary:"Error",detail:"Failed to select client."}),this.isSubmitting.set(!1)}}))}onWizardCancel(){this.clientDataService.clearPreviewClient(),this.navigateToLogin()}navigateToLogin(){this.userSessionService.clearAllSessions(),this.router.navigate(qe.LOGIN).catch(t=>console.error("Error navigating to login:",t))}fallbackToDefaultClient(){let t=this.selectedAccount(),o=t?.owner?.type?.toUpperCase()===X.CLIENT_TYPE,i=t?.defaultClient?.id??(o?t?.owner?.id:void 0);f(i)?(console.warn("Attempting to proceed with default client due to loading failure"),this.isSubmitting.set(!0),this.clientsService.getClient(i).pipe(_(this.destroyRef)).subscribe({next:r=>{this.uiMessageService.add({severity:"info",summary:"Notice",detail:"Proceeding with your default client."}),this.finalizeClientSelection(r)},error:r=>{console.error("Failed to load default client:",r),this.isSubmitting.set(!1),this.uiMessageService.add({severity:"error",summary:"Error",detail:"Unable to proceed. Please contact support."})}})):console.warn("No default client available for fallback")}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-context-selection-wizard"]],viewQuery:function(e,o){if(e&1&&(V(Yt,5),V(Gt,5),V(ze,5)),e&2){let i;W(i=q())&&(o.accountSelectionStep=i.first),W(i=q())&&(o.clientSelectionStep=i.first),W(i=q())&&(o.wizard=i.first)}},decls:12,vars:7,consts:[["accountSelectionStep",""],["clientSelectionStep",""],[1,"panel","login-box","flex","flex-col","w-full","mx-auto","pb-8"],[1,"bg-[var(--main-background-color)]","p-6","rounded-border","shadow-card","justify-start","rounded-none"],["header","Context Selection",3,"onCancel","visibleChange","visible","steps","useWizardButtonsOnly","showFooterButtons","loading","contentOnly"],[1,"!text-white","pt-4","underline","cursor-pointer","self-center",3,"click"],[1,"!text-white","self-center"],[1,"flex","flex-col","items-center","w-full"],[1,"w-full"],[1,"flex","flex-col","items-center","gap-3","mt-6"],["styleClass","w-10 h-10 text-primary-500"],[1,"text-sm","text-gray-500"],[1,"text-center","mb-8"],[1,"text-sm","text-gray-400","text-center","mt-2"],[3,"accountSelected","clientAccounts","maxHeightClass"],[1,"text-center","p-8"],["styleClass","w-10 h-10"],[1,"text-sm","text-gray-400","mt-4"],[1,"pi","pi-lock","text-4xl","text-gray-400","mb-4"],[1,"text-lg","font-semibold","text-gray-700","mb-2"],[1,"text-sm","text-gray-500","mb-4"],[3,"clientSelected","searchQuery","lazyLoad","clients","loading","useServerSearch","totalRecords","enablePagination","enableLazyLoad","recentClients"]],template:function(e,o){if(e&1){let i=E();s(0,"div",2)(1,"div",3)(2,"app-theme")(3,"app-wizard",4),P("onCancel",function(){return b(i),C(o.onWizardCancel())})("visibleChange",function(){return b(i),C(o.onWizardCancel())}),l(),Ke(4,Xt,2,1,"ng-template",null,0,De)(6,ti,4,1,"ng-template",null,1,De),l()(),s(8,"a",5),P("click",function(){return b(i),C(o.onWizardCancel())}),c(9,"Back to Login"),l(),s(10,"a",6),c(11),l()()}e&2&&(p(3),d("visible",!0)("steps",o.steps)("useWizardButtonsOnly",!0)("showFooterButtons",!1)("loading",o.isLoading())("contentOnly",!0),p(8),O(" Copyright ",o.currentYear,". All rights reserved. "))},dependencies:[ze,k,Tt,_t,At,Et,Pt],styles:["[_nghost-%COMP%]{display:block;height:100%;width:100%}@media(min-width:640px){[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]{bottom:0;margin-bottom:0;height:100vh;padding:0}[_nghost-%COMP%]   .login-box[_ngcontent-%COMP%]{top:0;height:100%;padding:0;max-width:800px}}"]})};var Rt=`
    .p-floatlabel {
        display: block;
        position: relative;
    }

    .p-floatlabel label {
        position: absolute;
        pointer-events: none;
        top: 50%;
        transform: translateY(-50%);
        transition-property: all;
        transition-timing-function: ease;
        line-height: 1;
        font-weight: dt('floatlabel.font.weight');
        inset-inline-start: dt('floatlabel.position.x');
        color: dt('floatlabel.color');
        transition-duration: dt('floatlabel.transition.duration');
    }

    .p-floatlabel:has(.p-textarea) label {
        top: dt('floatlabel.position.y');
        transform: translateY(0);
    }

    .p-floatlabel:has(.p-inputicon:first-child) label {
        inset-inline-start: calc((dt('form.field.padding.x') * 2) + dt('icon.size'));
    }

    .p-floatlabel:has(input:focus) label,
    .p-floatlabel:has(input.p-filled) label,
    .p-floatlabel:has(input:-webkit-autofill) label,
    .p-floatlabel:has(textarea:focus) label,
    .p-floatlabel:has(textarea.p-filled) label,
    .p-floatlabel:has(.p-inputwrapper-focus) label,
    .p-floatlabel:has(.p-inputwrapper-filled) label,
    .p-floatlabel:has(input[placeholder]) label,
    .p-floatlabel:has(textarea[placeholder]) label {
        top: dt('floatlabel.over.active.top');
        transform: translateY(0);
        font-size: dt('floatlabel.active.font.size');
        font-weight: dt('floatlabel.active.font.weight');
    }

    .p-floatlabel:has(input.p-filled) label,
    .p-floatlabel:has(textarea.p-filled) label,
    .p-floatlabel:has(.p-inputwrapper-filled) label {
        color: dt('floatlabel.active.color');
    }

    .p-floatlabel:has(input:focus) label,
    .p-floatlabel:has(input:-webkit-autofill) label,
    .p-floatlabel:has(textarea:focus) label,
    .p-floatlabel:has(.p-inputwrapper-focus) label {
        color: dt('floatlabel.focus.color');
    }

    .p-floatlabel-in .p-inputtext,
    .p-floatlabel-in .p-textarea,
    .p-floatlabel-in .p-select-label,
    .p-floatlabel-in .p-multiselect-label,
    .p-floatlabel-in .p-multiselect-label:has(.p-chip),
    .p-floatlabel-in .p-autocomplete-input-multiple,
    .p-floatlabel-in .p-cascadeselect-label,
    .p-floatlabel-in .p-treeselect-label {
        padding-block-start: dt('floatlabel.in.input.padding.top');
        padding-block-end: dt('floatlabel.in.input.padding.bottom');
    }

    .p-floatlabel-in:has(input:focus) label,
    .p-floatlabel-in:has(input.p-filled) label,
    .p-floatlabel-in:has(input:-webkit-autofill) label,
    .p-floatlabel-in:has(textarea:focus) label,
    .p-floatlabel-in:has(textarea.p-filled) label,
    .p-floatlabel-in:has(.p-inputwrapper-focus) label,
    .p-floatlabel-in:has(.p-inputwrapper-filled) label,
    .p-floatlabel-in:has(input[placeholder]) label,
    .p-floatlabel-in:has(textarea[placeholder]) label {
        top: dt('floatlabel.in.active.top');
    }

    .p-floatlabel-on:has(input:focus) label,
    .p-floatlabel-on:has(input.p-filled) label,
    .p-floatlabel-on:has(input:-webkit-autofill) label,
    .p-floatlabel-on:has(textarea:focus) label,
    .p-floatlabel-on:has(textarea.p-filled) label,
    .p-floatlabel-on:has(.p-inputwrapper-focus) label,
    .p-floatlabel-on:has(.p-inputwrapper-filled) label,
    .p-floatlabel-on:has(input[placeholder]) label,
    .p-floatlabel-on:has(textarea[placeholder]) label {
        top: 0;
        transform: translateY(-50%);
        border-radius: dt('floatlabel.on.border.radius');
        background: dt('floatlabel.on.active.background');
        padding: dt('floatlabel.on.active.padding');
    }

    .p-floatlabel:has([class^='p-'][class$='-fluid']) {
        width: 100%;
    }

    .p-floatlabel:has(.p-invalid) label {
        color: dt('floatlabel.invalid.color');
    }
`;var ii=["*"],ni=`
    ${Rt}

    /* For PrimeNG */
    .p-floatlabel:has(.ng-invalid.ng-dirty) label {
        color: dt('floatlabel.invalid.color');
    }
`,oi={root:({instance:n})=>["p-floatlabel",{"p-floatlabel-over":n.variant==="over","p-floatlabel-on":n.variant==="on","p-floatlabel-in":n.variant==="in"}]},It=(()=>{class n extends mt{name="floatlabel";style=ni;classes=oi;static \u0275fac=(()=>{let e;return function(i){return(e||(e=Ue(n)))(i||n)}})();static \u0275prov=I({token:n,factory:n.\u0275fac})}return n})();var zt=new Qe("FLOATLABEL_INSTANCE"),Pe=(()=>{class n extends xt{_componentStyle=a(It);$pcFloatLabel=a(zt,{optional:!0,skipSelf:!0})??void 0;bindDirectiveInstance=a(le,{self:!0});onAfterViewChecked(){this.bindDirectiveInstance.setAttrs(this.ptms(["host","root"]))}variant="over";static \u0275fac=(()=>{let e;return function(i){return(e||(e=Ue(n)))(i||n)}})();static \u0275cmp=S({type:n,selectors:[["p-floatlabel"],["p-floatLabel"],["p-float-label"]],hostVars:2,hostBindings:function(o,i){o&2&&it(i.cx("root"))},inputs:{variant:"variant"},features:[ot([It,{provide:zt,useExisting:n},{provide:St,useExisting:n}]),Xe([le]),Ze],ngContentSelectors:ii,decls:1,vars:0,template:function(o,i){o&1&&(et(),tt(0))},dependencies:[at,dt,wt],encapsulation:2,changeDetection:0})}return n})();var Vt=()=>["/auth/login"];function ci(n,t){if(n&1){let e=E();s(0,"p-floatlabel")(1,"p-select",13),P("onChange",function(i){b(e);let r=m(2);return C(r.onApiUrlChange(i))}),l(),s(2,"label",14),c(3,"API URL*"),l()()}if(n&2){let e=m(2);p(),d("options",e.apiOptions)}}function pi(n,t){if(n&1){let e=E();s(0,"h2",5),c(1," Forgot Your Password "),l(),s(2,"span",6),c(3,"Enter your email address below and we'll send your password reset instructions by email."),l(),s(4,"form",7),P("ngSubmit",function(){b(e);let i=m();return C(i.onSubmit())}),s(5,"div",8),x(6,ci,4,1,"p-floatlabel"),s(7,"p-floatlabel"),g(8,"input",9),s(9,"label",10),c(10,"Email address*"),l()()(),s(11,"div",11)(12,"p-button",12),c(13," Reset Password "),l()()()}if(n&2){let e=m();p(4),d("formGroup",e.resetPasswordForm),p(2),w(e.environment.showApiDropdown?6:-1),p(2),d("autocomplete","username"),p(4),d("disabled",e.resetPasswordForm.invalid)("loading",e.loading)}}function di(n,t){if(n&1&&(s(0,"h2",5),c(1," Check Your Email "),l(),s(2,"div",15)(3,"p",16),c(4," If an account exists with the username "),s(5,"strong"),c(6),l(),c(7,", you will receive a password reset email shortly. Please check your inbox and follow the instructions to reset your password. "),l(),s(8,"p-button",17),c(9," Back to Login "),l()()),n&2){let e=m();p(6),nt(e.submittedUsername),p(2),d("routerLink",N(2,Vt))}}function mi(n,t){n&1&&(s(0,"a",3),c(1,"Login"),l()),n&2&&d("routerLink",N(1,Vt))}var Ee=class n{apiUrlService=a(se);authService=a(ie);document=a($e);fb=a(ge);location=a(rt);router=a(M);destroyRef=a(z);toastService=a(kt);apiSchemaService=a(Ct);environment=A;apiOptions=A.apiUrls.map(t=>({label:t,value:t}));resetPasswordForm=this.fb.group({username:this.fb.control("",v.required),apiUrl:this.fb.control("")});currentYear=new Date().getFullYear();loading=!1;submitted=!1;submittedUsername="";ngOnInit(){this.initializeApiUrl()}buildResetUrl(){if(this.apiSchemaService.usesModernSchema())return this.document.location.origin;let t=this.router.createUrlTree(["/auth/login"],{queryParams:{token:"{token}"}}).toString();return`${this.document.location.origin}/${this.location.prepareExternalUrl(t)}`}onSubmit(){if(this.resetPasswordForm.valid){this.loading=!0;let t=this.resetPasswordForm.value.username,e=this.buildResetUrl();this.authService.resetPassword({username:t,resetUrl:e}).pipe(_(this.destroyRef)).subscribe({next:()=>{this.loading=!1,this.submitted=!0,this.submittedUsername=t,this.toastService.showSuccess("Success","Password reset instructions sent.")},error:()=>{this.loading=!1}})}}onApiUrlChange(t){this.apiUrlService.setApiUrl(t.value)}initializeApiUrl(){if(!A.showApiDropdown){let r=A.apiUrls[0];r&&(this.apiUrlService.setApiUrl(r),this.resetPasswordForm.controls.apiUrl.setValue(r));return}let t=this.apiUrlService.getCurrentApiUrl(),e=this.apiOptions[0]?.value;if(!e)return;let o=this.apiOptions.some(r=>r.value===t),i;o?i=t:(i=e,this.apiUrlService.setApiUrl(i)),this.resetPasswordForm.get("apiUrl")?.setValue(i)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-forgot-password"]],decls:8,vars:3,consts:[[1,"panel","login-box","flex","flex-col","items-stretch","w-full","max-w-[800px]","mx-auto","pb-8"],[1,"bg-white","p-[15px_34px_35px]","justify-start","rounded-none","mb-4"],[1,"flex","flex-col"],[1,"!text-white","underline","cursor-pointer","self-center",3,"routerLink"],[1,"!text-white","self-center"],[1,"mt-8","text-[1.62rem]","font-normal","leading-[2.25]","text-center","!text-gray-500"],[1,"my-4","text-[1rem]","font-normal","leading-[1.5]","text-center","!text-gray-500"],[1,"mx-12","mt-10",3,"ngSubmit","formGroup"],[1,"grid","gap-6"],["id","username","pInputText","","formControlName","username",1,"w-full",3,"autocomplete"],["for","username"],[1,"flex","justify-center","items-center","my-6"],["styleClass","w-[120px] h-[50px] !text-white rounded border-none !bg-[#378bc0]","type","submit",3,"disabled","loading"],["id","resetUrl","optionLabel","label","optionValue","value","formControlName","apiUrl",1,"w-full",3,"onChange","options"],["for","resetUrl"],[1,"mx-12","mt-10","mb-6","text-center"],[1,"mb-6","text-[1rem]","font-normal","leading-[1.5]","!text-gray-500"],["styleClass","w-[160px] h-[50px] !text-white rounded border-none !bg-[#378bc0]",3,"routerLink"]],template:function(e,o){e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2),x(3,pi,14,5)(4,di,10,3),l()(),x(5,mi,2,2,"a",3),s(6,"a",4),c(7),l()()),e&2&&(p(3),w(o.submitted?4:3),p(2),w(o.submitted?-1:5),p(2),O(" Copyright ",o.currentYear,". All rights reserved. "))},dependencies:[U,B,ve,ue,pe,de,me,fe,he,Pe,k,ce,Ce,be,xe,Se],styles:["[_nghost-%COMP%]{display:flex;width:100%;align-items:center}[_nghost-%COMP%]     .p-inputtext{color:var(--form-field-color)!important;background:var(--p-inputtext-background)!important;border:1px solid var(--p-inputtext-border-color)!important}[_nghost-%COMP%]     .p-inputtext:enabled:focus{border-color:#378bc0!important}[_nghost-%COMP%]     .p-floatlabel:has(input:-webkit-autofill) label, [_nghost-%COMP%]     .p-floatlabel:has(input:focus) label{color:#378bc0}[_nghost-%COMP%]     p-select{background:var(--p-select-background)!important;border-color:var(--p-select-border-color)!important}[_nghost-%COMP%]     p-select .p-select-label{color:var(--form-field-color)!important}@media(min-width:640px){.panel[_ngcontent-%COMP%]{bottom:0;margin-bottom:0;height:100vh;padding:0}.login-box[_ngcontent-%COMP%]{top:0;height:100%;width:100%;padding:0}}"]})};var ui=()=>["/auth/forgot-password"];function hi(n,t){if(n&1&&(s(0,"div",4)(1,"p",7),c(2," Authenticating with your secure token... "),l(),s(3,"p-button",8),c(4," Logging in "),l()()),n&2){let e=m();p(3),d("loading",e.loading)("disabled",!0)}}function fi(n,t){n&1&&(s(0,"div",9)(1,"p-message",18),c(2,"Token authentication failed. Please login with your username and password."),l()())}function gi(n,t){if(n&1){let e=E();s(0,"p-floatlabel")(1,"label",19),c(2,"API URL*"),l(),s(3,"p-select",20),P("onChange",function(i){b(e);let r=m(2);return C(r.onApiUrlChange(i))}),l()()}if(n&2){let e=m(2);p(3),d("options",e.apiOptions)}}function vi(n,t){if(n&1){let e=E();x(0,fi,3,0,"div",9),s(1,"form",10),P("ngSubmit",function(){b(e);let i=m();return C(i.onSubmit())}),s(2,"div",11),x(3,gi,4,1,"p-floatlabel"),s(4,"p-floatlabel"),g(5,"input",12),s(6,"label",13),c(7,"Username*"),l()(),s(8,"p-floatlabel"),g(9,"p-password",14),s(10,"label",15),c(11,"Password*"),l()()(),s(12,"div",16)(13,"p-button",17),c(14," Login "),l()()()}if(n&2){let e=m();w(e.tokenLoginError()?0:-1),p(),d("formGroup",e.loginForm),p(2),w(e.environment.showApiDropdown?3:-1),p(2),d("autocomplete","username"),p(4),d("feedback",!1)("toggleMask",!0)("autocomplete","current-password"),p(4),d("disabled",e.loginForm.invalid)("loading",e.loading)}}var Ae=class n{apiUrlService=a(se);authService=a(bt);authTokenManagerService=a(ne);authDataService=a(Y);themeDataService=a(oe);clientDataService=a(j);route=a(ee);router=a(M);fb=a(ge);userSessionService=a(D);userSessionNavigationService=a(G);destroyRef=a(z);environment=A;apiOptions=A.apiUrls.map(t=>({label:t,value:t}));loginForm=this.fb.group({username:this.fb.control("",v.required),password:this.fb.control("",v.required),apiUrl:this.fb.control("",v.required)});currentYear=new Date().getFullYear();loading=!1;isTokenLogin=h(!1);tokenLoginError=h(!1);ngOnInit(){this.clearAllSessionData(),this.initializeApiUrl(),this.route.queryParams.pipe(_(this.destroyRef)).subscribe(t=>{f(t.token)?(this.isTokenLogin.set(!0),this.tokenLoginError.set(!1),this.handleTokenLogin(t.token)):this.tokenLoginError()||this.resetToNormalLogin()})}clearAllSessionData(){this.authDataService.clearAllUserData(),this.userSessionService.clearAllSessions(),this.authTokenManagerService.clearTokens(),this.themeDataService.clearTheme(),this.clientDataService.reset()}resetToNormalLogin(){this.isTokenLogin.set(!1),this.loading=!1}handleTokenLogin(t){this.loading=!0,this.authService.loginWithToken(t).pipe(_(this.destroyRef)).subscribe({next:e=>{(async()=>{try{this.authTokenManagerService.storeTokens(e),this.userSessionService.setUserSessions(e.users),e.users.length>1?await this.router.navigate(["/auth","context-selection"],{queryParams:{resetPassword:"true"}}):e.users.length===1&&(this.userSessionService.setCurrentUserSession(e.users[0].id),await this.router.navigate(["/auth","reset-password-welcome"]))}catch{this.clearAllSessionData(),this.loading=!1,this.isTokenLogin.set(!1),this.tokenLoginError.set(!0),this.router.navigate(["/auth/login"],{replaceUrl:!0})}finally{this.loading=!1}})()},error:()=>{this.loading=!1,this.isTokenLogin.set(!1),this.tokenLoginError.set(!0),this.router.navigate([],{relativeTo:this.route,queryParams:{},replaceUrl:!0})}})}initializeApiUrl(){if(!A.showApiDropdown){let r=A.apiUrls[0];r&&(this.apiUrlService.setApiUrl(r),this.loginForm.controls.apiUrl.setValue(r));return}let t=this.apiUrlService.getCurrentApiUrl(),e=this.apiOptions[0]?.value;if(!e){this.loginForm.controls.apiUrl.disable();return}let o=this.apiOptions.some(r=>r.value===t),i;o?i=t:(i=e,this.apiUrlService.setApiUrl(i)),this.loginForm.controls.apiUrl.setValue(i)}onSubmit(){if(this.loginForm.valid){this.clearAllSessionData(),this.loading=!0;let{username:t,password:e}=this.loginForm.getRawValue();this.authService.login(t,e).pipe(_(this.destroyRef)).subscribe({next:o=>{(async()=>{try{this.authTokenManagerService.storeTokens(o),this.userSessionService.setUserSessions(o.users);let i=this.route.snapshot.queryParams.returnUrl??null;await this.userSessionNavigationService.navigateBasedOnSessions(o.users,i),this.loading=!1}catch{this.clearAllSessionData(),this.loading=!1,this.loginForm.controls.password.reset()}})()},error:()=>{this.loading=!1,this.loginForm.controls.password.reset()}})}}onApiUrlChange(t){this.apiUrlService.setApiUrl(t.value)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-login"]],decls:11,vars:4,consts:[[1,"panel","login-box","flex","flex-col","items-stretch","w-full","max-w-[800px]","mx-auto","pb-8"],[1,"bg-white","p-[15px_34px_35px]","justify-start","rounded-none"],[1,"flex","flex-col"],[1,"mt-8","text-[1.62rem]","font-normal","leading-[2.25]","text-center","!text-gray-500"],[1,"mx-12","mt-10","flex","flex-col","items-center","gap-6"],[1,"!text-white","pt-4","underline","cursor-pointer","self-center",3,"routerLink"],[1,"!text-white","self-center"],[1,"text-center","text-gray-600"],["styleClass","w-[120px] h-[50px] !text-white rounded border-none !bg-[#378bc0]",3,"loading","disabled"],[1,"mx-12","mt-6"],[1,"mx-12","mt-10",3,"ngSubmit","formGroup"],[1,"grid","gap-6"],["id","username","pInputText","","formControlName","username",1,"w-full",3,"autocomplete"],["for","username"],["formControlName","password",1,"w-full",3,"feedback","toggleMask","autocomplete"],["for","password"],[1,"flex","justify-center","items-center","my-6"],["styleClass","w-[120px] h-[50px] !text-white rounded border-none !bg-[#378bc0]","type","submit",3,"disabled","loading"],["severity","error"],["for","apiUrl"],["id","apiUrl","formControlName","apiUrl","optionLabel","label","optionValue","value",1,"w-full",3,"onChange","options"]],template:function(e,o){e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),c(4," Welcome to Cypherview "),l(),x(5,hi,5,2,"div",4)(6,vi,15,9),l()(),s(7,"a",5),c(8,"Forgotten Password?"),l(),s(9,"a",6),c(10),l()()),e&2&&(p(5),w(o.isTokenLogin()?5:6),p(2),d("routerLink",N(3,ui)),p(3),O(" Copyright ",o.currentYear,". All rights reserved. "))},dependencies:[U,B,ve,ue,pe,de,me,fe,he,Pe,k,ce,Ot,Lt,Ce,be,xe,Se,Dt,Ut],styles:["[_nghost-%COMP%]{display:flex;width:100%;align-items:center}[_nghost-%COMP%]     .p-inputtext{color:var(--form-field-color)!important;background:var(--p-inputtext-background)!important;border:1px solid var(--p-inputtext-border-color)!important}[_nghost-%COMP%]     .p-inputtext:enabled:focus{border-color:#378bc0!important}[_nghost-%COMP%]     .p-password-toggle-mask-icon{color:#378bc0}[_nghost-%COMP%]     .p-floatlabel:has(input:-webkit-autofill) label, [_nghost-%COMP%]     .p-floatlabel:has(input:focus) label{color:#378bc0}[_nghost-%COMP%]     p-select{background:var(--p-select-background)!important;border-color:var(--p-select-border-color)!important}[_nghost-%COMP%]     p-select .p-select-label{color:var(--form-field-color)!important}[_nghost-%COMP%]     p-password .p-password, [_nghost-%COMP%]     p-password input{width:100%}[_nghost-%COMP%]     p-password input, [_nghost-%COMP%]     p-password textarea, [_nghost-%COMP%]     p-password p-select, [_nghost-%COMP%]     p-password .p-inputgroupaddon{color:var(--form-field-color)!important}@media(min-width:640px){.panel[_ngcontent-%COMP%]{bottom:0;margin-bottom:0;height:100vh;padding:0}.login-box[_ngcontent-%COMP%]{top:0;height:100%;width:100%;padding:0}}"]})};var bi=()=>["/auth/login"],ke=class n{http=a(st);authDataService=a(Y);accountsService=a(ht);userSessionService=a(D);cdr=a(J);router=a(M);formFields=[];isSubmitting=h(!1);timezones=[];currentYear=new Date().getFullYear();actions=[{label:"Cancel",visible:!1},{label:"Update",action:t=>{this.onSubmit(t)},severity:"primary",disabled:t=>y(t)||t.pristine,styleClass:"w-[120px] h-[50px] !text-white rounded border-none !bg-[#378bc0]"}];ngOnInit(){this.initializeFormFields(),this.loadTimezones()}initializeFormFields(){let t=this.userSessionService.currentUserSession();this.formFields=[R("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:v.required,message:"Name is required"}]}),R("emailAddress","Email Address",t?.emailAddress,{name:"email",validations:[{name:"email",validator:v.email,message:"Invalid email"}]}),R("mobile","Mobile Number",t?.mobile?.trim(),{name:"mobile",validations:[{name:"pattern",validator:v.pattern("^[0-9]*$"),message:"Mobile number must contain only numbers"}]}),Re("timeZoneId","Time Zone",this.timezones,t?.timeZoneId,{layout:"horizontal",labelWidth:"1/3",placeholder:"Select timezone",name:"timeZone",props:{appendTo:"body"}}),Ne("password","New Password",{name:"password",validations:[{name:"required",validator:v.required,message:"Password is required"}]})]}updateFormFields(){let t=this.authDataService.getUserProfile();this.formFields=[R("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:v.required,message:"Name is required"}]}),R("emailAddress","Email Address",t?.emailAddress,{name:"email",validations:[{name:"email",validator:v.email,message:"Invalid email"}]}),R("mobile","Mobile Number",t?.mobile?.trim(),{name:"mobile",validations:[{name:"pattern",validator:v.pattern("^[0-9]*$"),message:"Mobile number must contain only numbers"}]}),Re("timeZoneId","Time Zone",this.timezones,t?.timeZoneId,{layout:"horizontal",labelWidth:"1/3",placeholder:"Select timezone",name:"timeZone",props:{appendTo:"body"}}),Ne("password","New Password",{name:"password",validations:[{name:"required",validator:v.required,message:"Password is required"}]})]}loadTimezones(){this.http.get("/assets/docs/timezones.json").subscribe(t=>{this.timezones=t.map(e=>({label:e.id,value:e.id})).sort((e,o)=>e.label.localeCompare(o.label)),this.updateFormFields(),this.cdr.detectChanges()})}getDirtyValues(t){return Object.fromEntries(Object.entries(t.controls).filter(([e,o])=>o.dirty).map(([e,o])=>[e,o.value]))}onSubmit(t){let e=this.userSessionService.currentUserSession();if(y(e))return;this.isSubmitting.set(!0);let o=this.getDirtyValues(t);Object.keys(o).length>0?this.accountsService.updateUser(e.id,o).subscribe({next:i=>{this.authDataService.setUserProfile(i)},complete:()=>{this.isSubmitting.set(!1),this.cdr.detectChanges(),this.router.navigate(["/position"])}}):this.isSubmitting.set(!1)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-reset-password-welcome"]],decls:14,vars:5,consts:[[1,"wrapper","bg-cover","bg-center","h-screen"],[1,"panel","login-box","flex","flex-col","items-stretch","w-full","max-w-[800px]","mx-auto"],[1,"bg-white","p-[15px_34px]","mb-4"],[1,"p-2","flex","flex-col"],[1,"text-2xl","font-semibold","m-0","pb-1"],[1,"py-2","muted"],[3,"fields","actions"],[1,"!text-white","underline","cursor-pointer","self-center",3,"routerLink"],[1,"!text-white","self-center"]],template:function(e,o){e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),c(5,"Welcome"),l(),g(6,"hr"),s(7,"span",5),c(8,"Please update your account details and enter a new password for your account."),l()(),g(9,"app-dynamic-form",6),l(),s(10,"a",7),c(11,"Login"),l(),s(12,"a",8),c(13),l()()()),e&2&&(p(9),d("fields",o.formFields)("actions",o.actions),p(),d("routerLink",N(4,bi)),p(3),O(" Copyright ",o.currentYear,". All rights reserved. "))},dependencies:[Ft,k,U,B],styles:[".wrapper[_ngcontent-%COMP%]{position:relative;overflow:hidden;width:100%}[_nghost-%COMP%]{display:flex;width:100%;align-items:center}[_nghost-%COMP%]     .p-inputtext{color:var(--form-field-color)!important;background:var(--p-inputtext-background)!important;border:1px solid var(--p-inputtext-border-color)!important}[_nghost-%COMP%]     .p-inputtext:enabled:focus{border-color:#378bc0!important}[_nghost-%COMP%]     .p-password-toggle-mask-icon{color:#378bc0}[_nghost-%COMP%]     .p-floatlabel:has(input:-webkit-autofill) label, [_nghost-%COMP%]     .p-floatlabel:has(input:focus) label{color:#378bc0}[_nghost-%COMP%]     p-select{background:var(--p-select-background)!important;border-color:var(--p-select-border-color)!important}[_nghost-%COMP%]     p-select .p-select-label{color:var(--form-field-color)!important}[_nghost-%COMP%]     p-password .p-password, [_nghost-%COMP%]     p-password input{width:100%}[_nghost-%COMP%]     p-password input, [_nghost-%COMP%]     p-password textarea, [_nghost-%COMP%]     p-password p-select, [_nghost-%COMP%]     p-password .p-inputgroupaddon{color:var(--form-field-color)!important}@media(min-width:640px){.panel[_ngcontent-%COMP%]{bottom:0;margin-bottom:0;height:100vh;padding:0}.login-box[_ngcontent-%COMP%]{top:0;height:100%;width:100%;padding:0}}"]})};var lr=[{path:"",component:Me,children:[{path:"login",component:Ae},{path:"context-selection",component:Te,resolve:{userProfile:Ie}},{path:"forgot-password",component:Ee},{path:"reset-password-welcome",component:ke,resolve:{userProfile:Ie}},{path:"",redirectTo:"login",pathMatch:"full"}]}];export{lr as AUTH_ROUTES};
