import{e as U,f as x,z as B}from"./chunk-GVCBKH6U.js";import"./chunk-PHOSYVDR.js";import{q as z}from"./chunk-UUBV4PLA.js";import"./chunk-T2ASJLBG.js";import"./chunk-K3QSXHYQ.js";import"./chunk-L7NFYEY5.js";import"./chunk-BEAFDC2I.js";import"./chunk-53JQ5NAG.js";import"./chunk-GV42Z4ED.js";import"./chunk-SDMJKPKX.js";import{A as k,l as W}from"./chunk-HBFOC76W.js";import"./chunk-MI5GPO5K.js";import"./chunk-PH5YALHE.js";import{m as j}from"./chunk-6C6CC4KT.js";import"./chunk-JAXNIEKX.js";import{Pc as p,S as o,T as c,Vb as m,Wb as N,Wc as O,_ as w,ca as E,na as T,u as A,zb as q}from"./chunk-FEC2V4R3.js";import{F as h,H as v,Pb as R,Qb as l,Rb as d,S as y,Sb as F,Ya as b,ba as i,d as f,gd as M,j as a,mb as I,na as C,rc as D,ta as g,va as S}from"./chunk-EG5ORV3B.js";import{a as n,b as r}from"./chunk-VB56BUGO.js";var G=class u{entitiesService=i(T);broadcastService=i(O);utilityService=i(z);accountsService=i(E);destroyRef=i(C);dialogRef=i(x);dialogConfig=i(U);ownerId=null;assetId=null;formFields=[];clientsSearchResults=g(void 0);searchSubject=new f;cdr=i(M);actions=[{label:"Cancel",action:()=>this.onCancel(),severity:"secondary"},{label:"Ok",action:e=>{let t=r(n({},e.value),{destinationClientId:e.value.destinationClientId?.id});this.onWizardComplete(t)},severity:"primary",disabled:e=>o(e)?!0:e.pristine||e.invalid}];constructor(){S(()=>{let e=this.clientsSearchResults(),t=this.formFields.find(s=>s.key==="destinationClientId");t?.props&&(t.props=r(n({},t.props),{suggestions:e})),this.cdr.detectChanges()})}ngOnInit(){c(this.dialogConfig.data)&&(this.ownerId=this.dialogConfig.data.ownerId??null,this.assetId=this.dialogConfig.data.assetId??null),this.formFields=[N("destinationClientId","Destination Client",[],this.clientsSearchResults(),this.searchClient.bind(this),{layout:"horizontal",labelWidth:"1/3",name:"destinationClientId",props:{appendTo:"body",showClear:!0,multiple:!1,field:"name",completeOnFocus:!1,typeahead:!0,showEmptyMessage:!0,emptyMessage:"No clients found"}}),m("includeDevice","Include Device",[{label:"Yes",value:!0},{label:"No",value:!1}],!0,{layout:"horizontal",labelWidth:"1/3",name:"includeDevice",props:{appendTo:"body"},validations:[{name:"required",validator:W.required,message:"Include Device is required"}]}),m("includeSimCard","Include Sim Card",[{label:"Yes",value:!0},{label:"No",value:!1}],!0,{layout:"horizontal",labelWidth:"1/3",name:"includeSimCard",props:{appendTo:"body"}})],this.setUpClientsSearch()}setUpClientsSearch(){this.searchSubject.pipe(v(q),p(this.destroyRef),y(e=>{let t=e.trim();if(t.length===0)return a({items:[]});let s={state:{value:"active",operator:"="},name:{value:`*${t}*`,operator:"="}},P=this.utilityService.constructRqlFilter(s);return this.accountsService.listClients(this.ownerId??"",0,10,"name",P).pipe(h(()=>a({items:[]})))})).subscribe({next:e=>{c(e)&&w(e,"items")&&this.clientsSearchResults.set(o(e.items)?[]:e.items)},error:()=>{this.clientsSearchResults.set([])}})}searchClient(e){this.clientsSearchResults.set(void 0),this.searchSubject.next(e)}onWizardComplete(e){o(this.assetId)||this.entitiesService.moveAsset(this.assetId,e).pipe(p(this.destroyRef)).subscribe({next:t=>{this.broadcastService.broadcast("entity-updated",{entityType:"asset",operation:"update",entityId:t.id}),this.dialogRef.close(t)},error:()=>{}})}onCancel(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||u)};static \u0275cmp=I({type:u,selectors:[["app-asset-move-form"]],decls:4,vars:2,consts:[[1,"muted","text-justify"],[1,"p-fluid","mt-4"],[3,"fields","actions"]],template:function(t,s){t&1&&(l(0,"span",0),D(1,"Select the destination client into which you'd like to move this asset. The asset will be copied to the new client and then deleted in this client."),d(),l(2,"div",1),F(3,"app-dynamic-form",2),d()),t&2&&(b(3),R("fields",s.formFields)("actions",s.actions))},dependencies:[A,k,j,B],styles:[".p-dialog-content[_ngcontent-%COMP%]{margin-top:1rem}"]})};export{G as AssetMoveFormComponent};
