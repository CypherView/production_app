import{a as X}from"./chunk-PQZWFXG4.js";import{a as Q}from"./chunk-X5JPT4IA.js";import"./chunk-S4LLPIXD.js";import{b as K}from"./chunk-PDXK54JZ.js";import{b as H}from"./chunk-JJVUWK2A.js";import{a as J,b as G}from"./chunk-MI5GPO5K.js";import{e as q,f as z}from"./chunk-PH5YALHE.js";import{l as $,m as O}from"./chunk-6C6CC4KT.js";import"./chunk-JAXNIEKX.js";import{N as P,Q as B,Qc as F,Rc as R,S as c,Uc as U,u as j}from"./chunk-FEC2V4R3.js";import{F as f,Jb as D,Kb as T,Nb as L,Ob as N,Pb as y,Qb as t,Rb as i,S as _,Sb as p,U as g,Ya as m,Zb as M,Zc as C,ba as x,bc as b,cc as h,ha as A,ia as S,j as d,mb as w,r as E,rc as o,sc as W,ta as v,tc as V,x as k}from"./chunk-EG5ORV3B.js";import"./chunk-VB56BUGO.js";var Z=(r,n)=>n.id;function ee(r,n){r&1&&(t(0,"div",8),p(1,"p-progressSpinner",10),t(2,"p",11),o(3,"Loading your apps..."),i()())}function te(r,n){if(r&1){let e=M();t(0,"div",9)(1,"div",12),p(2,"i",13),i(),t(3,"h3",14),o(4),i(),t(5,"p",15),o(6,"Please check your connection or try again later."),i(),t(7,"p-button",16),b("onClick",function(){A(e);let u=h();return S(u.refresh())}),i()()}if(r&2){let e=h();m(4),W(e.error())}}function ie(r,n){r&1&&(t(0,"div",9)(1,"div",17),p(2,"i",18),i(),t(3,"h3",14),o(4,"No installed apps"),i(),t(5,"p",15),o(6," Browse the marketplace to discover and install apps that enhance your fleet management experience. "),i(),p(7,"p-button",19),i())}function ne(r,n){if(r&1){let e=M();t(0,"div",21),p(1,"app-card",26),t(2,"div",27)(3,"p-button",28),b("onClick",function(){let u=A(e).$implicit,I=h(2);return S(I.uninstallApp(u.installationId))}),i()(),t(4,"div",29)(5,"span",30),p(6,"i",31),o(7," Installed "),i()()()}if(r&2){let e=n.$implicit;m(),y("app",e),m(2),y("rounded",!0)("text",!0)}}function re(r,n){if(r&1&&(t(0,"div",20),L(1,ne,8,3,"div",21,Z),i(),t(3,"div",22)(4,"div",2)(5,"div")(6,"p",23),o(7," Total Installed "),i(),t(8,"p",24),o(9),i()(),p(10,"i",25),i()()),r&2){let e=h();m(),N(e.filteredApps()),m(8),V(" ",e.filteredApps().length," ")}}var Y=class r{appInstallationService=x(X);appStoreService=x(K);clientDataService=x(U);isLoading=v(!0);error=v(null);currentClientId=C(()=>this.clientDataService.getSelectedClient()?.id);refreshTrigger=v(0);installedApps=R(F(this.refreshTrigger).pipe(g(()=>this.isLoading.set(!0)),_(()=>c(this.currentClientId())?(this.isLoading.set(!1),d([])):this.appInstallationService.getInstallations({owner:this.currentClientId()}).pipe(_(n=>{if(n.length===0)return this.isLoading.set(!1),d([]);let e=n.filter(l=>!c(l.appId)&&l.appId.trim()!=="");if(e.length===0)return this.isLoading.set(!1),d([]);let a=new Set,I=e.filter(l=>a.has(l.appId)?!1:(a.add(l.appId),!0)).map(l=>this.appStoreService.getAppById(l.appId,this.currentClientId()??"").pipe(f(s=>(console.warn(`Failed to load app details for ${l.appId}:`,s),d(null))),g(s=>{s&&!c(s)&&(s.installationId=l.id,s.installedAt=l.createdAt,s.isEnabled=l.isEnabled)})));return k(I).pipe(E(l=>l.filter(s=>s!==null&&!c(s))),g(()=>this.isLoading.set(!1)),f(l=>(console.error("Error loading app details:",l),this.error.set("Unable to load app details."),this.isLoading.set(!1),d([]))))}),f(n=>(console.error("Error loading installations:",n),this.error.set("Unable to load your installed apps."),this.isLoading.set(!1),d([])))))),{initialValue:[]});filteredApps=C(()=>this.installedApps()??[]);hasInstalledApps=C(()=>this.filteredApps().length>0);refresh(){this.error.set(null),this.refreshTrigger.update(n=>n+1)}uninstallApp(n){c(this.currentClientId())||this.appInstallationService.uninstallApp(n,this.currentClientId()??"").pipe(g(()=>this.refresh()),f(e=>(console.error("Error uninstalling app:",e),this.error.set("Could not uninstall the app. Please try again."),d(null)))).subscribe()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=w({type:r,selectors:[["app-my-installed-apps"]],decls:15,vars:3,consts:[[1,"flex","flex-col","h-full"],[1,"p-6","border-b","border-subtle","flex-none"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-black","text-surface-900","tracking-tight"],[1,"pi","pi-box","text-primary","mr-2"],[1,"text-surface-600","text-sm","mt-1","font-medium"],["icon","pi pi-refresh","pTooltip","Refresh","severity","secondary",3,"onClick","text","loading"],[1,"flex-1","overflow-auto","p-6"],[1,"flex","flex-col","items-center","justify-center","h-full","gap-3","py-20"],[1,"flex","flex-col","items-center","justify-center","py-20","text-center","h-full"],["strokeWidth","3",1,"w-12","h-12"],[1,"font-medium"],[1,"w-20","h-20","rounded-full","flex","items-center","justify-center","mb-6"],[1,"pi","pi-exclamation-triangle","text-4xl"],[1,"text-2xl","font-bold","mb-2"],[1,"max-w-sm"],["label","Try Again","severity","secondary",1,"mt-8",3,"onClick"],[1,"w-20","h-20","rounded-full","flex","items-center","justify-center","mb-6","border-2","border-dashed","border-surface-300"],[1,"pi","pi-box","!text-4xl"],["routerLink","/app-store","label","Explore Apps","icon","pi pi-compass","severity","primary",1,"mt-8","font-black"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[1,"relative"],[1,"mt-8","p-6","rounded-2xl","border","border-subtle"],[1,"text-sm","font-bold","uppercase","tracking-widest"],[1,"text-3xl","font-black","text-primary","mt-1"],[1,"pi","pi-box","text-6xl"],[3,"app"],[1,"absolute","top-4","right-4","flex","gap-2","opacity-0","hover:opacity-100","transition-opacity"],["icon","pi pi-trash","severity","danger","size","small","pTooltip","Uninstall","styleClass","shadow-lg",3,"onClick","rounded","text"],[1,"absolute","top-4","left-4"],[1,"px-3","py-1","rounded-full","text-xs","font-bold","bg-green-100","text-green-700","shadow-sm","flex","items-center","gap-1"],[1,"pi","pi-check-circle"]],template:function(e,a){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h2",3),p(5,"i",4),o(6," Installed Apps "),i(),t(7,"p",5),o(8," Manage the apps you've installed "),i()(),t(9,"p-button",6),b("onClick",function(){return a.refresh()}),i()()(),t(10,"div",7),D(11,ee,4,0,"div",8)(12,te,8,1,"div",9)(13,ie,8,0,"div",9)(14,re,11,1),i()()),e&2&&(m(9),y("text",!0)("loading",a.isLoading()),m(2),T(a.isLoading()?11:a.error()?12:a.hasInstalledApps()?14:13))},dependencies:[j,B,P,O,$,H,G,J,z,q,Q],styles:["[_nghost-%COMP%]{display:block;height:100%}"]})};export{Y as MyInstalledAppsComponent};
