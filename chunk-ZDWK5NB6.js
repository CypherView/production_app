import{A as Gl,C as vi,D as Et,E as ql,F as B,G as Ul,H as Bt,I as it,J as Ci,K as Ht,M as zl,N as ge,O as Xe,P as Q,V as jl,W as at,X as Mt,b as ne,c as te,d as Fl,e as Il,f as El,g as Pn,h as Ml,j as Rl,l as Al,n as Vn,o as kl,r as Ol,s as Ln,t as Pl,u as Vl,x as Nn,y as Ll,z as Nl}from"./chunk-2YP72RBM.js";import{a as be}from"./chunk-FNP4CVQN.js";import{a as Ze}from"./chunk-QVSLGYTS.js";import{a as bl,b as kn}from"./chunk-JJVUWK2A.js";import{h as wl,j as jt,k as xl}from"./chunk-JHHTYGX5.js";import{a as Gt,b as hi,c as yi,d as qt,e as Ut}from"./chunk-FVFSV3SV.js";import{l as V}from"./chunk-YPVSUJNA.js";import{a as bt,e as al,g as En,s as Pe,t as zt,u as Dl,v as Tl,y as Ki,z as q}from"./chunk-GVCBKH6U.js";import{b as Nt,c as sl,d as ts,e as ll,f as dl,g as cl,h as is,i as Mn,j as ml,k as pl,l as ut,m as ul,n as Rn,o as fl,p as gl,q as he}from"./chunk-UUBV4PLA.js";import{a as se,b as X}from"./chunk-T2ASJLBG.js";import{f as On,h as Sl}from"./chunk-53JQ5NAG.js";import{A as We,D as Te,O as vl,P as Cl,f as ol,h as rl,l as w,n as hl,r as yl,z as An}from"./chunk-HBFOC76W.js";import{a as _l,b as fe}from"./chunk-MI5GPO5K.js";import{c as In,e as gi,f as vt}from"./chunk-PH5YALHE.js";import{d as tl,g as il,h as es,l as St,m as K}from"./chunk-6C6CC4KT.js";import{Ca as As,Ea as el,Fa as Ja,Ga as fi,Ha as Xa,Ja as nl,S as Is,l as xs,m as Fs,na as Es,oa as za,pa as Ee,q as mn,ta as Ms,ua as Rs,v as qi,w as pn,x as Ui,xa as un,ya as zi}from"./chunk-JAXNIEKX.js";import{$b as rt,Ab as js,Ba as Ha,D as dn,Da as $a,Db as Tt,E as It,Fa as Jt,Fb as Bs,Ga as Ns,I as Ss,Ia as Wa,Ib as Hs,K as cn,La as fn,Lb as pi,M as Ds,Ma as Hi,Mb as Ud,N as Ts,O as ws,Oa as Za,Ob as Cn,Pb as _n,Pc as W,Q as Ua,Qa as $i,Qb as $s,R as ks,Rb as bn,S as T,Sb as Ws,Sc as pt,T as f,Ta as Ka,Tb as k,Tc as Re,U as Ye,Ua as gn,Ub as ei,Uc as Dn,V as ji,Va as Qa,Vb as H,Wa as hn,Wb as mt,Wc as we,X as ci,Xb as ie,Y as Os,Ya,Yb as tt,Z as ce,Zb as Ge,_ as Yt,_a as Gs,_b as Zs,_c as ke,ab as Wi,ac as Lt,ad as Xs,bc as Ks,ca as me,cb as yn,cc as Qs,cd as ui,dc as ti,dd as Tn,e as z,eb as Zi,ec as De,f as ln,fc as Ys,fd as wn,g as _s,ga as Ps,gb as Xt,gc as Sn,gd as xn,h as Na,hb as qs,hc as _t,hd as Fn,ib as vn,ic as Js,ja as Vs,k as Ga,ka as $e,l as qa,m as bs,ma as Ls,na as P,sb as Oe,tb as yt,u as L,ub as Us,v as Gi,wa as ja,ya as Ba,yb as zs,za as Bi,zb as mi}from"./chunk-FEC2V4R3.js";import{$ as cs,Aa as us,Db as I,Ea as fs,F as lt,Gc as di,H as dt,Hc as sn,I as Aa,Ic as N,J as en,Jb as h,Jc as Pi,K as Pt,Kb as y,Lb as vs,Mb as Kt,Nb as Ue,Ob as ze,Pb as g,Qb as l,Rb as s,Rc as Vi,S as Be,Sa as ka,Sb as C,Sc as Li,Ta as li,Tb as on,U as Je,Ub as Oa,Vb as Pa,Vc as Se,Wb as rn,X as ds,Xb as an,Y as j,Ya as d,Yb as ot,Z as tn,Zb as S,Zc as v,_c as Cs,ad as ct,ba as c,bb as gs,bc as _,bd as E,cc as a,d as st,e as Ra,fb as Ai,fc as Vt,fd as Ni,gc as pe,gd as Me,h as Dt,ha as m,hc as le,ia as p,ic as de,j as re,ja as ht,k as ri,ka as Zt,kd as Va,la as ms,ld as La,mb as F,mc as Qt,na as Ne,nb as nn,o as Ce,oc as ki,pa as si,pb as hs,pc as Oi,qa as ps,qb as ys,qc as Le,r as Ve,rb as O,rc as D,s as Ft,sb as ae,sc as J,ta as R,tc as ye,va as U,w as ls,wa as _e,x as ai,ya as He}from"./chunk-EG5ORV3B.js";import{a as M,b as ee,d as xt,g as qd}from"./chunk-VB56BUGO.js";var _i=class n{constructor(t=null){this.entity=t;this.withDefaultCategories()}sections=[];categories=[];defaultExpandedCategory;allowMultipleExpanded=!1;showCategoryIcons=!1;withSection(t,e,i,o="information",r=10,u={}){return this.sections.push({id:t,title:e,component:i,category:o,order:r,componentInputs:M({entity:this.entity},u)}),this}withAdvancedSection(t){return this.sections.push(ee(M({},t),{componentInputs:M({entity:this.entity},t.componentInputs)})),this}withCategory(t,e,i,o){let r=this.categories.findIndex(b=>b.key===t),u=M({key:t,label:e,order:i},o);return r>=0?this.categories[r]=u:this.categories.push(u),this}withoutCategory(t){return this.categories=this.categories.filter(e=>e.key!==t),this}withDefaultExpanded(t){return this.defaultExpandedCategory=t,this}withMultipleExpansion(t=!0){return this.allowMultipleExpanded=t,this}withCategoryIcons(t=!0){return this.showCategoryIcons=t,this}withSections(t){return t.forEach(e=>{this.sections.push(ee(M({},e),{componentInputs:M({entity:this.entity},e.componentInputs)}))}),this}withDefaultCategories(){return this.categories=[{key:"information",label:"Information",order:10},{key:"settings",label:"Settings",order:20},{key:"events",label:"Events",order:30},{key:"statistics",label:"Statistics",order:40},{key:"io",label:"IO",order:50},{key:"accessories",label:"Accessories",order:60},{key:"controls",label:"Controls",order:70},{key:"assets",label:"Assets",order:80},{key:"users",label:"Users",order:90},{key:"features",label:"Features",order:100},{key:"customization",label:"Email Customization",order:110},{key:"feed",label:"Changes",order:120},{key:"backend",label:"Backend",order:130},{key:"custom",label:"Custom",order:140}],this}build(){let e={categories:this.categories.filter(i=>this.sections.some(o=>o.category===i.key)).sort((i,o)=>i.order-o.order),defaultExpandedCategory:this.defaultExpandedCategory,allowMultipleExpanded:this.allowMultipleExpanded,showCategoryIcons:this.showCategoryIcons};return{sections:this.sections,layout:e}}buildSections(){return this.sections}static forEntity(t){return new n(t)}};function jd(n,t){n&1&&(l(0,"div",4),C(1,"p-progressSpinner"),s())}function Bd(n,t){n&1&&(l(0,"span",12),D(1,"Information"),s())}function Hd(n,t){if(n&1&&(l(0,"h3",14),D(1),s()),n&2){let e=a().$implicit;d(),ye(" ",e.title," ")}}function $d(n,t){n&1&&ot(0)}function Wd(n,t){n&1&&C(0,"p-divider")}function Zd(n,t){if(n&1&&(l(0,"div",13),h(1,Hd,2,1,"h3",14),ae(2,$d,1,0,"ng-container",15),s(),h(3,Wd,1,0,"p-divider")),n&2){let e=t.$implicit,i=t.$index,o=t.$count,r=a(4);d(),y(e.title?1:-1),d(),g("ngComponentOutlet",e.component)("ngComponentOutletInputs",r.getSectionInputs(e)),d(),y(i!==o-1?3:-1)}}function Kd(n,t){if(n&1&&Ue(0,Zd,4,4,null,null,Kt),n&2){let e=a(3);ze(e.informationSections())}}function Qd(n,t){n&1&&(l(0,"p-accordion-panel",6),ae(1,Bd,2,0,"ng-template",10)(2,Kd,2,0,"ng-template",11),s())}function Yd(n,t){n&1&&(l(0,"span",12),D(1,"Settings"),s())}function Jd(n,t){if(n&1&&(l(0,"h3",14),D(1),s()),n&2){let e=a().$implicit;d(),ye(" ",e.title," ")}}function Xd(n,t){n&1&&ot(0)}function ec(n,t){n&1&&C(0,"p-divider")}function tc(n,t){if(n&1&&(l(0,"div",13),h(1,Jd,2,1,"h3",14),ae(2,Xd,1,0,"ng-container",15),s(),h(3,ec,1,0,"p-divider")),n&2){let e=t.$implicit,i=t.$index,o=t.$count,r=a(4);d(),y(e.title?1:-1),d(),g("ngComponentOutlet",e.component)("ngComponentOutletInputs",r.getSectionInputs(e)),d(),y(i!==o-1?3:-1)}}function ic(n,t){if(n&1&&Ue(0,tc,4,4,null,null,Kt),n&2){let e=a(3);ze(e.settingsSections())}}function nc(n,t){n&1&&(l(0,"p-accordion-panel",7),ae(1,Yd,2,0,"ng-template",10)(2,ic,2,0,"ng-template",11),s())}function oc(n,t){n&1&&(l(0,"span",12),D(1,"Statistics"),s())}function rc(n,t){if(n&1&&(l(0,"h3",14),D(1),s()),n&2){let e=a().$implicit;d(),ye(" ",e.title," ")}}function ac(n,t){n&1&&ot(0)}function sc(n,t){n&1&&C(0,"p-divider")}function lc(n,t){if(n&1&&(l(0,"div",13),h(1,rc,2,1,"h3",14),ae(2,ac,1,0,"ng-container",15),s(),h(3,sc,1,0,"p-divider")),n&2){let e=t.$implicit,i=t.$index,o=t.$count,r=a(4);d(),y(e.title?1:-1),d(),g("ngComponentOutlet",e.component)("ngComponentOutletInputs",r.getSectionInputs(e)),d(),y(i!==o-1?3:-1)}}function dc(n,t){if(n&1&&Ue(0,lc,4,4,null,null,Kt),n&2){let e=a(3);ze(e.statisticsSections())}}function cc(n,t){n&1&&(l(0,"p-accordion-panel",8),ae(1,oc,2,0,"ng-template",10)(2,dc,2,0,"ng-template",11),s())}function mc(n,t){n&1&&(l(0,"span",12),D(1,"Custom"),s())}function pc(n,t){if(n&1&&(l(0,"h3",14),D(1),s()),n&2){let e=a().$implicit;d(),ye(" ",e.title," ")}}function uc(n,t){n&1&&ot(0)}function fc(n,t){n&1&&C(0,"p-divider")}function gc(n,t){if(n&1&&(l(0,"div",13),h(1,pc,2,1,"h3",14),ae(2,uc,1,0,"ng-container",15),s(),h(3,fc,1,0,"p-divider")),n&2){let e=t.$implicit,i=t.$index,o=t.$count,r=a(4);d(),y(e.title?1:-1),d(),g("ngComponentOutlet",e.component)("ngComponentOutletInputs",r.getSectionInputs(e)),d(),y(i!==o-1?3:-1)}}function hc(n,t){if(n&1&&Ue(0,gc,4,4,null,null,Kt),n&2){let e=a(3);ze(e.customSections())}}function yc(n,t){n&1&&(l(0,"p-accordion-panel",9),ae(1,mc,2,0,"ng-template",10)(2,hc,2,0,"ng-template",11),s())}function vc(n,t){if(n&1&&(l(0,"div")(1,"p-accordion",5),h(2,Qd,3,0,"p-accordion-panel",6),h(3,nc,3,0,"p-accordion-panel",7),h(4,cc,3,0,"p-accordion-panel",8),h(5,yc,3,0,"p-accordion-panel",9),s()()),n&2){let e=a();d(),g("multiple",!0),d(),y(e.hasInformationSections()?2:-1),d(),y(e.hasSettingsSections()?3:-1),d(),y(e.hasStatisticsSections()?4:-1),d(),y(e.hasCustomSections()?5:-1)}}var Qi=class n{entity=E({});entityType=E("");detailsFactory=c(bi);isLoading=R(!1);currentMode=R("view");activeIndexes=[0];displayedSections=v(()=>{let t=this.getEntityConfig();return t?.sections?t.sections.filter(e=>typeof e.visible=="function"?e.visible(this.entity()):e.visible!==!1).sort((e,i)=>(e.order??0)-(i.order??0)):[]});informationSections=v(()=>this.displayedSections().filter(t=>t.category==="information"));settingsSections=v(()=>this.displayedSections().filter(t=>t.category==="settings"));statisticsSections=v(()=>this.displayedSections().filter(t=>t.category==="statistics"));customSections=v(()=>this.displayedSections().filter(t=>t.category==="custom"));hasInformationSections=v(()=>this.informationSections().length>0);hasSettingsSections=v(()=>this.settingsSections().length>0);hasStatisticsSections=v(()=>this.statisticsSections().length>0);hasCustomSections=v(()=>this.customSections().length>0);canToggleMode=v(()=>this.getEntityConfig()?.allowModeToggle!==!1);ngOnInit(){let t=this.getEntityConfig();t?.defaultMode&&this.currentMode.set(t.defaultMode),this.loadEntityDetails()}loadEntityDetails(){let t=this.entity()?.id,e=this.entityType();T(t)||T(e)||this.hasFullDetails()||(this.isLoading.set(!0),setTimeout(()=>{this.isLoading.set(!1)},500))}hasFullDetails(){return!0}getEntityConfig(){return this.detailsFactory.getEntityConfig(this.entityType())}getSectionInputs(t){return{entity:this.entity(),mode:this.currentMode(),options:{title:t.title,readonly:t.readonly??!1,expanded:t.expanded,category:t.category,order:t.order}}}toggleMode(){this.currentMode.set(this.currentMode()==="view"?"edit":"view")}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-generic-details-container"]],inputs:{entity:[1,"entity"],entityType:[1,"entityType"]},decls:7,vars:3,consts:[[1,"p-3","bg-surface-card","rounded-md","shadow-sm","h-full","overflow-auto"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-semibold"],[1,"text-sm","text-surface-600","ml-2"],[1,"flex","justify-center","items-center","p-5"],[3,"multiple"],["header","INFORMATION","styleClass","mb-2"],["header","SETTINGS","styleClass","mb-2"],["header","STATISTICS","styleClass","mb-2"],["header","CUSTOM","styleClass","mb-2"],["pTemplate","header"],["pTemplate","content"],[1,"uppercase"],[1,"section-container"],[1,"section-title"],[4,"ngComponentOutlet","ngComponentOutletInputs"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1)(2,"h2",2)(3,"span",3),D(4),s()()(),h(5,jd,2,0,"div",4),h(6,vc,6,5,"div"),s()),e&2&&(d(4),J(i.entityType()),d(),y(i.isLoading()?5:-1),d(),y(i.entity()&&!i.isLoading()?6:-1))},dependencies:[L,ln,Ut,qt,un,Gt,Et,vi,K,vt,fe,_l],styles:["[_nghost-%COMP%]{display:block;height:100%}[_nghost-%COMP%]     .p-accordion .p-accordion-header-link{font-weight:500}[_nghost-%COMP%]     .p-accordion .p-accordion-header-link:focus{--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}[_nghost-%COMP%]     .p-accordion .p-accordion-header-text{font-weight:600}[_nghost-%COMP%]     .p-accordion .p-accordion-content{padding-top:1rem;padding-bottom:1rem;padding-left:0;padding-right:0}[_nghost-%COMP%]     .p-divider{margin-top:1rem;margin-bottom:1rem}[_nghost-%COMP%]     .section-container{padding-top:.5rem;padding-bottom:.5rem}.section-title[_ngcontent-%COMP%]{margin-bottom:.75rem;border-bottom-width:1px;--tw-border-opacity: 1;border-color:color-mix(in srgb,var(--p-surface-200) calc(100% * var(--tw-border-opacity, 1)),transparent);padding-bottom:.25rem;font-size:1.125rem;line-height:1.75rem;font-weight:500}"],changeDetection:0})};var Gn=class n{entitiesService=c(P);http=c(It);apiUrlService=c(Fn);MAX_FILE_SIZE_MB=10;MAX_FILE_SIZE_BYTES=this.MAX_FILE_SIZE_MB*1024*1024;ALLOWED_MIME_TYPES=["image/jpeg","image/png","image/gif"];getAssetAvatar(t){let e=`${this.apiUrlService.getCurrentApiUrl()}/entities/assets/${t}/avatar`;return this.http.get(e,{responseType:"blob"}).pipe(Ve(i=>URL.createObjectURL(i)))}async uploadAssetAvatar(t,e){if(e.size>this.MAX_FILE_SIZE_BYTES)throw new Error(`File exceeds the maximum size of ${this.MAX_FILE_SIZE_MB} MB. Please choose a smaller file.`);if(!this.ALLOWED_MIME_TYPES.includes(e.type))throw new Error("Invalid file type. Please upload a PNG, JPEG, or GIF.");let i=new FormData;i.append("imageFile",e,e.name);let o=`${this.apiUrlService.getCurrentApiUrl()}/entities/assets/${t}/avatar?size=large`;try{await Ce(this.http.post(o,i))}catch(r){throw r instanceof dn?r.status===413?new Error("File is too large. Server rejected the upload."):r.status===403?new Error("You do not have permission to upload avatars."):new Error(`Failed to upload image: ${r.message}`):new Error("Failed to upload image. Please try again.")}}deleteAssetAvatar(t){return this.entitiesService.deleteAssetAvatar(t)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Cc=n=>({"cursor-pointer":n}),_c=n=>({"icon-primary":n});function bc(n,t){if(n&1&&C(0,"img",12),n&2){let e=a();ki("hover:border-primary-500",!0),g("src",e.currentImageUrl(),li)}}function Sc(n,t){if(n&1&&(ht(),l(0,"svg",4),C(1,"use"),s()),n&2){let e=a();g("ngClass",N(3,_c,e.isFormEditable())),I("aria-label","Upload asset image"),d(),I("href","assets/sprites/sprite.svg#truck-moving-solid")}}function Dc(n,t){n&1&&(l(0,"div",13),C(1,"span",15),s())}function Tc(n,t){n&1&&(l(0,"div",14),C(1,"i",16),s())}function wc(n,t){if(n&1&&h(0,Dc,2,0,"div",13)(1,Tc,2,0,"div",14),n&2){let e=a();y(!e.isUploadingImage()&&!e.isLoading()?0:1)}}function xc(n,t){if(n&1){let e=S();l(0,"div",8)(1,"span",17),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit asset details"))}function Fc(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",18),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Ic(n,t){if(n&1&&C(0,"app-grid",10),n&2){let e=a();g("data",e.assetDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function Ec(n,t){if(n&1){let e=S();l(0,"app-image-editor",19),_("visibleChange",function(o){m(e);let r=a();return p(r.onImageEditorVisibleChange(o))})("croppedFile",function(o){m(e);let r=a();return p(r.saveImage(o))})("imageRemoved",function(){m(e);let o=a();return p(o.removeAssetAvatar())}),s()}if(n&2){let e=a();g("visible",!0)("fileUrl",e.currentImageUrl())("saveOnEmpty",!0)}}var qn=class n extends B{ownerId=E(null);entitiesService=c(P);utilityService=c(he);assetGroupingService=c(Pe);assetAvatarService=c(Gn);toastService=c(Ze);imageDataUrl=R(null);currentLoadingAssetId=null;isUploadingImage=R(!1);cdr=c(Me);selectOptionsLoaded=R(!1);assetTypes=[];selectOptions={};colors=[...zs].sort((t,e)=>t.localeCompare(e)).map(t=>({label:this.utilityService.toTitleCase(t),value:t}));assetDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Name",value:t.name},{key:"Icon Name",value:t.mapIconName??"Default"},{key:"Tags",value:ce(t.tags)?"None":t?.tags?.map(e=>e).join(", ")},{key:"Type",value:f(t.assetType)?t.assetType.name:"Unknown"},{key:"Color",value:f(t.color)?this.utilityService.toTitleCase(t.color):"None"},{key:"Cost Centre",value:f(t.costCentre)?t.costCentre.name:"None"},{key:"Groups",value:ce(t.groups)?"":t.groups?.map(e=>e.name).join(", ")},{key:"Asset Tag",value:t.assetTag??"None"}]:[]});assetTagsSearchResults=R(void 0);searchSubject=new st;isImageEditorVisible=R(!1);currentImageUrl=v(()=>this.imageDataUrl());constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(async()=>{this.entity()&&!this.createMode()&&(this.updateFormFields(),await this.loadAssetImage())})}ngOnInit(){this.setUpAssetTagsSearch(),this.loadSelectOptions()}loadSelectOptions(){let t=this.entity(),e=this.ownerId(),i=t?.owner?.id??e;if(T(i)){this.selectOptions={},this.selectOptionsLoaded.set(!0),this.updateFormFields();return}Promise.all([this.assetGroupingService.getAssetTypes(i),Ce(this.entitiesService.listCostCentres(i)),this.assetGroupingService.getAssetGroupsAsTree(i)]).then(([o,r,u])=>{this.selectOptions={assetTypes:o.map(b=>({label:b.name??"",value:b.id})).sort((b,x)=>b.label.localeCompare(x.label)),costCentres:r.items.map(b=>({label:b.name??"",value:b.id})).sort((b,x)=>b.label.localeCompare(x.label)),groups:u},this.selectOptionsLoaded.set(!0),this.updateFormFields()}).catch(()=>{this.selectOptionsLoaded.set(!1)})}setUpAssetTagsSearch(){this.searchSubject.pipe(dt(mi),W(this.destroyRef),Be(t=>{let e=this.entity()?.owner;if(T(e?.id))return re({items:[]});let i=t.trim();if(i.length===0)return re({items:[]});let o={state:{value:"active",operator:"="},name:{value:`*${i}*`,operator:"="}},r=this.utilityService.constructRqlFilter(o);return this.entitiesService.listAssetTags(e.id,0,10,"name",r).pipe(lt(()=>re({items:[]})))})).subscribe({next:t=>{f(t)&&Yt(t,"items")&&this.assetTagsSearchResults.set(T(t.items)?[]:t.items)},error:t=>{console.error("Error searching asset tags:",t),this.assetTagsSearchResults.set([])}})}updateFormFields(){let t=this.entity();this.formFields=[k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),H("mapIconName","Icon Name",[{label:"Default",value:"Default"},{label:"Airplane",value:"Airplane"},{label:"Ambulance (small)",value:"Ambulance (small)"},{label:"Ambulance",value:"Ambulance"},{label:"Boat",value:"Boat"},{label:"Bus",value:"Bus"},{label:"Car",value:"Car"},{label:"Cement Mixer",value:"Cement Mixer"},{label:"Container",value:"Container"},{label:"Dump Truck",value:"Dump Truck"},{label:"Excavator",value:"Excavator"},{label:"Haul Truck",value:"Haul Truck"},{label:"Lawn Mower",value:"Lawn Mower"},{label:"Man",value:"Man"},{label:"Motorcycle",value:"Motorcycle"},{label:"Parcel",value:"Parcel"},{label:"Pickup Truck",value:"Pickup Truck"},{label:"School Bus (small)",value:"School Bus (small)"},{label:"School Bus",value:"School Bus"},{label:"Tractor",value:"Tractor"},{label:"Trailer",value:"Trailer"},{label:"Truck (small)",value:"Truck (small)"},{label:"Truck",value:"Truck"},{label:"Van (small)",value:"Van (small)"},{label:"Van",value:"Van"}],t?.mapIconName??"Default",{validations:[{name:"required",validator:w.required,message:"Icon name is required"}],props:{appendTo:"body"}}),mt("tags","Tags",t?.tags??[],[],()=>{},{layout:"horizontal",labelWidth:"1/3",name:"tags",placeholder:"Enter Tag(s) ...",hint:"\u2328\uFE0F Tip: Press Enter or Tab to add a tag",props:{appendTo:"body",typeahead:!1,multiple:!0,dropdown:!1,forceSelection:!1,tooltip:"<strong>How to add tags:</strong><br>\u2022 Type your tag text<br>\u2022 Press <kbd>Enter</kbd> or <kbd>Tab</kbd> to add a tag<br>\u2022 Click the \xD7 on any tag to remove it<br>"}}),H("assetType","Type",this.selectOptions?.assetTypes??[],t?.assetType?.id,{layout:"horizontal",labelWidth:"1/3",name:"assetType",props:{appendTo:"body"},validations:[{name:"required",validator:w.required,message:"Asset type is required"}]}),H("color","Color",this.colors,t?.color,{layout:"horizontal",labelWidth:"1/3",name:"color",props:{appendTo:"body"},validations:[{name:"required",validator:w.required,message:"Color is required"}]}),H("costCentre","Cost Centre",this.selectOptions?.costCentres??[],t?.costCentre?.id,{layout:"horizontal",labelWidth:"1/3",name:"costCentre",props:{appendTo:"body"},validations:[{name:"required",validator:w.required,message:"Cost centre is required"}]}),ti("groups","Groups",this.getSelectedGroupNodes(t?.groups,this.selectOptions?.groups),this.selectOptions?.groups??[],{layout:"horizontal",labelWidth:"1/3",name:"groups",props:{appendTo:"body",placeholder:"Select Group",multiple:!0,showClear:!0,selectionMode:"checkbox",filter:!0},validations:[{name:"required",validator:w.required,message:"At least one group is required"}]}),mt("assetTag","Asset Tag",typeof t?.assetTag=="string"?t.assetTag:void 0,()=>this.assetTagsSearchResults()??[],this.searchAssetTag.bind(this),{layout:"horizontal",labelWidth:"1/3",name:"assetTag",props:{appendTo:"body",showClear:!0,multiple:!1,field:"name",completeOnFocus:!1,typeahead:!0,showEmptyMessage:!0,emptyMessage:"No asset tags found"}})],this.cdr.detectChanges()}submitChanges(t){let e=this.entity();T(e)||this.entitiesService.updateAsset(e.id,this.transformData(t)).pipe(W(this.destroyRef)).subscribe({next:()=>{this.isFormEditable.set(!1),this.isSubmitting.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"asset",entityId:e.id})},error:()=>{this.isFormEditable.set(!0),this.isSubmitting.set(!1)}})}onFormValueChange(t){let e=this.transformData(t);this.formValueChange.emit(e)}getSelectedGroupNodes(t,e){if(!t||!e)return[];let i=[],o=(r,u)=>{for(let b of r){if(b.id===u)return b;if(b.children&&b.children.length>0){let x=o(b.children,u);if(x)return x}}};return t.forEach(r=>{let u=o(e,r.id);u&&i.push(u)}),i}transformData(t){let e=M({},t);if(f(e.assetType)&&typeof e.assetType=="string"){let i=this.selectOptions?.assetTypes?.find(o=>o.value===e.assetType);i&&(e.assetType={id:i.value,name:i.label})}if(f(e.costCentre)&&typeof e.costCentre=="string"){let i=this.selectOptions?.costCentres?.find(o=>o.value===e.costCentre);i&&(e.costCentre={id:i.value,name:i.label})}if(Array.isArray(e.groups)){let i=(o,r)=>{for(let u of o){if(u.id===r)return u;if(u.children&&u.children.length>0){let b=i(u.children,r);if(b)return b}}};e.groups=e.groups.map(o=>{let r=typeof o=="object"&&f(o.id)?o.id:o,u=i(this.selectOptions?.groups??[],r);return u?{id:u.id,name:u.label}:void 0}).filter(o=>f(o))}return Array.isArray(e.tags)?e.tags=e.tags.filter(i=>typeof i=="string").filter(i=>i.trim()!==""):typeof e.tags=="string"?e.tags=e.tags.trim()?[e.tags]:[]:f(e.tags)||(e.tags=[]),e.assetTag===""&&(e.assetTag=null),e}searchAssetTag(t){this.assetTagsSearchResults.set(void 0),this.searchSubject.next(t)}async loadAssetImage(){let t=this.entity();if(!f(t)||!f(t.id)){this.imageDataUrl.set(null),this.currentLoadingAssetId=null;return}this.isLoading.set(!0);let e=t.id;this.currentLoadingAssetId=e;try{let i=await Ce(this.assetAvatarService.getAssetAvatar(e));this.currentLoadingAssetId===e&&this.imageDataUrl.set(i)}catch(i){this.currentLoadingAssetId===e&&(this.imageDataUrl.set(null),i instanceof dn&&i.status!==404&&(console.error("Failed to load asset avatar:",i),this.toastService.showError("Failed to load asset avatar",i.message)))}finally{this.isLoading.set(!1)}}openImageEditor(){this.canEditAvatar()&&!this.isLoading()&&!this.isUploadingImage()&&this.isImageEditorVisible.set(!0)}onImageEditorVisibleChange(t){this.isImageEditorVisible.set(t)}canEditAvatar(){let t=this.entity();return!(T(t?.assetType?.name)||t.assetType.name.toLowerCase()!==Us)}async removeAssetAvatar(){let t=this.entity();if(!T(t?.id)){if(!this.canEditAvatar()){this.toastService.showError("Permission Denied","You do not have permission to delete this avatar.");return}this.isUploadingImage.set(!0),this.toastService.showInfo("Deleting Asset Avatar","Deleting Asset Avatar. Please wait."),this.assetAvatarService.deleteAssetAvatar(t.id).subscribe({next:()=>{this.toastService.showSuccess("Successful","The Asset Avatar was successfully deleted."),this.isImageEditorVisible.set(!1),this.isUploadingImage.set(!1),this.imageDataUrl.set(null),this.broadcastService.broadcast("entity-updated",{entityType:"asset",entityId:t.id})},error:e=>{this.toastService.showError("Error",`An error occurred while trying to delete the asset avatar: ${e}`),this.isUploadingImage.set(!1)}})}}async saveImage(t){let e=this.entity();if(!T(e?.id)){if(!this.canEditAvatar()){this.toastService.showError("Permission Denied","You do not have permission to upload an avatar.");return}try{this.isUploadingImage.set(!0),await this.assetAvatarService.uploadAssetAvatar(e.id,t),this.toastService.showSuccess("Upload Successful","Image uploaded successfully."),this.isImageEditorVisible.set(!1),await this.loadAssetImage()}catch(i){let o=i instanceof Error?i.message:"Failed to upload image. Please try again.";this.toastService.showError("Upload Failed",o)}finally{this.isUploadingImage.set(!1)}}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:16,vars:9,consts:[[1,"pt-2","card"],[1,"flex","justify-start","items-center","p-2","mb-4"],[1,"relative","profile-photo-icon",3,"click","ngClass"],["alt","Asset",1,"w-[4rem]","h-[4rem]","rounded-full","object-cover","border-2","border-gray-200",3,"src","hover:border-primary-500"],[1,"custom-icon-svg","w-[2.5rem]","h-[2.5rem]",3,"ngClass"],[1,"flex-1","pl-6"],[1,"flex","justify-between","items-center"],[1,"m-0","text-xl","font-semibold"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[3,"visible","fileUrl","saveOnEmpty"],["alt","Asset",1,"w-[4rem]","h-[4rem]","rounded-full","object-cover","border-2","border-gray-200",3,"src"],[1,"flex","absolute","inset-0","justify-center","items-center","bg-black","bg-opacity-50","rounded-full","opacity-0","transition-opacity","hover:opacity-100"],[1,"flex","absolute","inset-0","justify-center","items-center","bg-black","bg-opacity-50","rounded-full"],[1,"text-4xl","text-white","pi","pi-camera"],[1,"text-2xl","text-white","pi","pi-spin","pi-spinner"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"],[3,"visibleChange","croppedFile","imageRemoved","visible","fileUrl","saveOnEmpty"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1)(2,"div",2),_("click",function(){return i.openImageEditor()}),h(3,bc,1,3,"img",3)(4,Sc,2,5,":svg:svg",4),h(5,wc,2,1),s(),l(6,"div",5)(7,"div",6)(8,"h2",7),D(9,"Asset Details"),s(),h(10,xc,2,1,"div",8),s(),l(11,"span"),D(12,"The following information is required to identify your asset."),s()()(),h(13,Fc,1,3,"app-dynamic-form",9),h(14,Ic,1,4,"app-grid",10),s(),h(15,Ec,1,3,"app-image-editor",11)),e&2&&(d(2),g("ngClass",N(7,Cc,i.canEditAvatar()&&!i.isUploadingImage()&&!i.isLoading())),d(),y(i.currentImageUrl()&&!i.isLoading()?3:4),d(2),y(i.canEditAvatar()?5:-1),d(5),y(!i.isFormEditable()&&!i.createMode()?10:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?13:-1),d(),y(!i.isFormEditable()&&!i.createMode()?14:-1),d(),y(i.isImageEditorVisible()?15:-1))},dependencies:[L,z,We,K,Te,On,V,q,vt,Ul],encapsulation:2})};var Un=class n{requestCache=c(Re);assetGroupingService=c(Pe);broadcastService=c(we);constructor(){this.broadcastService.on("entity-updated").subscribe(t=>{this.handleEntityUpdate(t)})}handleEntityUpdate(t){let{entityType:e,operation:i}=t;switch(e){case"assetCategory":this.clearAssetCategoryCaches();break;case"assetGroup":this.clearAssetGroupCaches();break;case"costCentre":this.clearCostCentreCaches();break;case"asset":(i==="create"||i==="update")&&this.clearAssetCategoryCaches();break}}clearAssetCategoryCaches(){this.requestCache.clearCacheByPattern("assetCategories-"),this.assetGroupingService.clear()}clearAssetGroupCaches(){this.requestCache.clearCacheByPattern("assetGroups-"),this.assetGroupingService.clear()}clearCostCentreCaches(){this.requestCache.clearCacheByPattern("costCentres-"),this.assetGroupingService.clear()}clearClientCaches(t){this.requestCache.clearClientCache(t),this.assetGroupingService.clear()}clearAllCaches(){this.requestCache.clearCache(),this.assetGroupingService.clear()}refreshAssetCategories(t){this.requestCache.clearCacheByPattern(`assetCategories-${t}`)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Mc=n=>({"icon-primary":n});function Rc(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit asset details"))}function Ac(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function kc(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.assetDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var zn=class n extends B{ownerId=E(null);entitiesService=c(P);assetGroupingService=c(Pe);cacheInvalidationService=c(Un);cdr=c(Me);selectOptionsLoaded=R(!1);selectOptions={};assetDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Department",value:ce(t.categories)?"None":(t?.categories??[]).filter(e=>f(e)).map(e=>e?.name).join(", ")}]:[]});assetCategories=[];constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.selectOptionsLoaded()&&this.updateFormFields()})}ngOnInit(){this.loadSelectOptions()}loadSelectOptions(){let t=this.entity(),e=this.ownerId(),i=t?.owner?.id??e;if(!f(i)){this.selectOptions={},this.selectOptionsLoaded.set(!0);return}this.createMode()&&this.cacheInvalidationService.refreshAssetCategories(i),this.assetGroupingService.getAssetCategories(i).then(r=>{this.assetCategories=r,this.selectOptions={assetCategories:r.map(u=>({label:u.name??"",value:u.id})).sort((u,b)=>u.label.localeCompare(b.label))},this.selectOptionsLoaded.set(!0)}).catch(()=>{this.selectOptions={},this.selectOptionsLoaded.set(!0)})}updateFormFields(){let t=this.entity();this.formFields=[],this.assetCategories.filter(e=>e?.parent===Oe).forEach(e=>{let o=this.assetCategories.filter(r=>r.index===e.index&&r.parent!==Oe).map(r=>({label:r.name??"",value:r.id}));this.formFields.push(H(`category${e.index}`,e.name,o,t?.categories&&f(e.index)?t?.categories[e.index]?.id??"":"",{layout:"horizontal",labelWidth:"1/3",name:`category${e.index}`,props:{appendTo:"body"}}))}),this.cdr.detectChanges()}submitChanges(t){let e=this.entity();T(e)||this.entitiesService.updateAsset(e.id,this.transformFormData(t)).pipe(W(this.destroyRef)).subscribe({next:()=>{this.isFormEditable.set(!1),this.isSubmitting.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"asset",operation:"update",entityId:e.id})},error:()=>{this.isFormEditable.set(!0),this.isSubmitting.set(!1)}})}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e={categories:[]};return this.assetCategories.filter(o=>o?.parent===Oe).forEach(o=>{let r=`category${o.index}`,u=t[r],b;f(u)&&Ye(u)&&(b=this.assetCategories.find(x=>x.id===u)),b??=o,f(b)&&(e.categories[o.index??0]={id:b.id,name:b.name})}),e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-categories-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:13,vars:8,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"custom-icon-svg","w-[2.5rem]","h-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),ht(),l(2,"svg",2),C(3,"use"),s(),Zt(),l(4,"div",3)(5,"div",4)(6,"h2",5),D(7,"Categories"),s(),h(8,Rc,2,1,"div",6),s(),l(9,"span"),D(10,"Assets can belong to a number of user defined categories."),s()()(),h(11,Ac,1,3,"app-dynamic-form",7),h(12,kc,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(6,Mc,i.isFormEditable())),I("aria-label","Site map icon"),d(),I("href","assets/sprites/sprite.svg#sitemap-solid"),d(5),y(!i.isFormEditable()&&!i.createMode()?8:-1),d(3),y(i.isFormEditable()||i.createMode()?11:-1),d(),y(!i.isFormEditable()&&!i.createMode()?12:-1))},dependencies:[L,z,We,K,V,q],encapsulation:2})};var Oc=["iconTemplate"],Pc=n=>({"icon-primary":n}),$l=(n,t)=>t.id;function Vc(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit asset contacts."))}function Lc(n,t){n&1&&(l(0,"div",12)(1,"p"),D(2,'No contacts added yet. Click "Add" to create a contact.'),s()())}function Nc(n,t){if(n&1&&(l(0,"div",24)(1,"div",25),C(2,"i",26),s(),l(3,"span",27),D(4),s()()),n&2){let e=a().$implicit;d(4),J(e.phoneMobile)}}function Gc(n,t){if(n&1&&(l(0,"div",24)(1,"div",25),C(2,"i",28),s(),l(3,"span",27),D(4),s()()),n&2){let e=a().$implicit;d(4),J(e==null?null:e.emailAddress)}}function qc(n,t){if(n&1&&(l(0,"div",24)(1,"div",25),C(2,"i",29),s(),l(3,"span",27),D(4),s()()),n&2){let e=a().$implicit;d(4),J(e==null?null:e.phoneOffice)}}function Uc(n,t){if(n&1&&(l(0,"div",24)(1,"div",25),C(2,"i",30),s(),l(3,"span",27),D(4),s()()),n&2){let e=a().$implicit;d(4),J(e==null?null:e.notes)}}function zc(n,t){if(n&1){let e=S();l(0,"p-panel",13)(1,"div",19)(2,"span",20),D(3),s(),l(4,"span",21),D(5),s(),l(6,"div",22)(7,"button",23),_("click",function(){let o=m(e).$index,r=a(2);return p(r.deleteContact(o))}),s()()(),h(8,Nc,5,1,"div",24),h(9,Gc,5,1,"div",24),h(10,qc,5,1,"div",24),h(11,Uc,5,1,"div",24),s()}if(n&2){let e=t.$implicit,i=a(2);d(3),J(i.utilityService.toTitleCase(e.type)),d(2),J(e.name),d(2),I("aria-label","Delete Contact"),d(),y(e.phoneMobile?8:-1),d(),y(e!=null&&e.emailAddress?9:-1),d(),y(e!=null&&e.phoneOffice?10:-1),d(),y(e!=null&&e.notes?11:-1)}}function jc(n,t){if(n&1){let e=S();l(0,"div",7)(1,"div",11),h(2,Lc,3,0,"div",12),Ue(3,zc,12,7,"p-panel",13,$l),l(5,"div",14)(6,"p-button",15),_("onClick",function(){m(e);let o=a();return p(o.addContact())}),s()(),l(7,"div",16)(8,"p-button",17),_("onClick",function(){m(e);let o=a();return p(o.cancelEdit())}),s(),l(9,"p-button",18),_("onClick",function(){m(e);let o=a();return p(o.submitChanges({}))}),s()()()()}if(n&2){let e=a();d(2),y(e.contacts().length===0?2:-1),d(),ze(e.contacts()),d(6),g("loading",e.isSubmitting())("disabled",!e.hasFormChanges)}}function Bc(n,t){n&1&&(l(0,"div",12)(1,"p"),D(2,"No contacts added to this asset."),s()())}function Hc(n,t){if(n&1&&(l(0,"div",24)(1,"div",25),C(2,"i",26),s(),l(3,"span",27),D(4),s()()),n&2){let e=a().$implicit;d(4),J(e.phoneMobile)}}function $c(n,t){if(n&1&&(l(0,"div",24)(1,"div",25),C(2,"i",28),s(),l(3,"span",27),D(4),s()()),n&2){let e=a().$implicit;d(4),J(e.emailAddress)}}function Wc(n,t){if(n&1&&(l(0,"div",24)(1,"div",25),C(2,"i",29),s(),l(3,"span",27),D(4),s()()),n&2){let e=a().$implicit;d(4),J(e.phoneOffice)}}function Zc(n,t){if(n&1&&(l(0,"div",24)(1,"div",25),C(2,"i",30),s(),l(3,"span",32),D(4),s()()),n&2){let e=a().$implicit;d(4),J(e.notes)}}function Kc(n,t){n&1&&C(0,"p-divider",33)}function Qc(n,t){if(n&1&&(l(0,"div",31)(1,"div",19)(2,"div",20),D(3),s(),l(4,"span",32),D(5),s()(),h(6,Hc,5,1,"div",24),h(7,$c,5,1,"div",24),h(8,Wc,5,1,"div",24),h(9,Zc,5,1,"div",24),h(10,Kc,1,0,"p-divider",33),s()),n&2){let e=t.$implicit,i=t.$index,o=t.$count,r=a(3);d(3),ye(" ",r.utilityService.toTitleCase(e.type)," "),d(2),J(e.name),d(),y(e.phoneMobile?6:-1),d(),y(e.emailAddress?7:-1),d(),y(e.phoneOffice?8:-1),d(),y(e.notes?9:-1),d(),y(i!==o-1?10:-1)}}function Yc(n,t){if(n&1&&Ue(0,Qc,11,7,"div",31,$l),n&2){let e=a(2);ze(e.contacts())}}function Jc(n,t){if(n&1&&(l(0,"div",8),h(1,Bc,3,0,"div",12)(2,Yc,2,0),s()),n&2){let e=a();d(),y(e.contacts().length===0?1:2)}}var jn=class n extends B{iconTemplate;entitiesService=c(P);utilityService=c(he);selectOptionsLoaded=R(!1);assetContacts=v(()=>{let t=this.entity()?.contacts;return f(t)?t.flatMap(e=>[{key:e.type,value:e.name},{key:"mobile",value:e.phoneMobile,icon:"pi pi-mobile"}]):[]});contacts=R([]);originalContacts=[];showModal=R(!1);editingContact=R(null);editingContactIndex=R(-1);modalHeader=v(()=>this.editingContact()?"Edit Contact":"Add Contact");contactTypes=["owner","emergency","administrative","technical","operational","management"];actions=[{label:"Cancel",action:()=>{this.closeModal()},severity:"secondary"},{label:"OK",action:t=>{this.saveContact(t)},severity:"primary",disabled:t=>T(t)?!0:t.invalid}];constructor(){super(),U(()=>{let t=this.entity()?.contacts;t&&(this.contacts.set([...t]),this.updateFormFields())})}onEnterEditMode(){super.onEnterEditMode(),this.originalContacts=[...this.contacts()]}cancelEdit(){this.contacts.set([...this.originalContacts]),super.cancelEdit()}ngAfterViewInit(){super.ngAfterViewInit(),this.columns=[{field:"key",header:"",transform:"uppercase",cellTemplate:this.iconTemplate},{field:"value",header:""}]}updateFormFields(){let t=this.editingContact();this.formFields=[k("id","ID",t?.id??"",{name:"id",hidden:!0}),k("name","Name",t?.name??"",{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),H("type","Type",this.contactTypes.map(e=>({label:this.utilityService.toTitleCase(e),value:e})),t?.type??"owner",{name:"type",props:{appendTo:"body"},validations:[{name:"required",validator:w.required,message:"Type is required"}]}),k("emailAddress","Email",t?.emailAddress??"",{name:"emailAddress",validations:[{name:"email",validator:w.email,message:"Invalid email format"}]}),k("phoneMobile","Mobile",t?.phoneMobile??"",{name:"phoneMobile",validations:[{name:"mobile",validator:xn(),message:"Invalid mobile number (10-15 digits required)"}]}),k("phoneOffice","Phone",t?.phoneOffice??"",{name:"phoneOffice",validations:[{name:"phone",validator:wn(),message:"Invalid phone number (7-15 digits required)"}]}),k("notes","Notes",t?.notes??"",{name:"notes"})]}addContact(){this.editingContact.set(null),this.editingContactIndex.set(-1),this.updateFormFields(),this.showModal.set(!0)}editContact(t,e){this.editingContact.set(M({},t)),this.editingContactIndex.set(e),this.updateFormFields(),this.showModal.set(!0)}deleteContact(t){let e=[...this.contacts()];e.splice(t,1),this.contacts.set(e),this.markFormAsDirty()}saveContact(t){if(t.invalid)return;let e=t.value,i=[...this.contacts()],o=this.editingContactIndex();o>=0?i[o]=e:(e.id||(e.id=crypto.randomUUID()),i.push(e)),this.contacts.set(i),this.markFormAsDirty(),this.closeModal()}closeModal(){this.showModal.set(!1),this.editingContact.set(null),this.editingContactIndex.set(-1)}markFormAsDirty(){this.hasFormChanges=!0}showSuccessMessage(t){this.messageService.add({severity:"success",summary:"Success",detail:t,life:3e3})}showErrorMessage(t){let e=t instanceof Error?t.message:"An error occurred";this.messageService.add({severity:"error",summary:"Error",detail:e,life:5e3})}submitChanges(t){let e=this.entity();if(T(e))return;let i={contacts:this.contacts()};this.isSubmitting.set(!0),this.entitiesService.updateAsset(e.id,i).pipe(W(this.destroyRef)).subscribe({next:()=>{this.isFormEditable.set(!1),this.isSubmitting.set(!1),this.clearUnsavedChanges(),this.originalContacts=[...this.contacts()],this.showSuccessMessage("Contacts updated successfully"),this.broadcastService.broadcast("entity-updated",{entityType:"asset",entityId:e.id})},error:o=>{this.isFormEditable.set(!0),this.isSubmitting.set(!1),this.showErrorMessage(o)}})}onClose(){this.closeModal()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-contacts-section"]],viewQuery:function(e,i){if(e&1&&pe(Oc,7),e&2){let o;le(o=de())&&(i.iconTemplate=o.first)}},features:[O],decls:13,vars:11,consts:[[1,"asset-contacts-section","card","pt-2"],[1,"section-header","mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-id-card","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[1,"edit-contacts","p-field","p-2"],[1,"view-contacts","p-2"],[3,"modalClose","visible","header","fields","actions","styleClass"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[1,"flex","flex-col","justify-end","w-full"],[1,"empty-contacts","text-center","p-4"],[1,"mb-3"],[1,"add-contact-button","text-right","mt-3","mb-4"],["severity","secondary","label","Add Contact","icon","pi pi-plus",3,"onClick"],[1,"action-buttons","flex","justify-end","gap-2","mt-4"],["type","button","label","Cancel","severity","secondary",3,"onClick"],["type","button","label","Save","severity","primary",3,"onClick","loading","disabled"],[1,"grid","grid-cols-5","gap-4"],[1,"font-semibold","mb-2","col-span-1","text-right"],[1,"col-span-3"],[1,"icon-light","col-span-1","text-right","flex","gap-2","justify-end"],["type","button",1,"pi","pi-trash","action","hover","!text-xl","cursor-pointer","bg-transparent","border-0","p-0",3,"click"],[1,"grid","grid-cols-5","gap-4","mt-2"],[1,"col-span-1","text-right"],[1,"pi","pi-mobile","!text-[1.25rem]"],[1,"col-span-4","text-link"],[1,"pi","pi-envelope","!text-[1.25rem]"],[1,"pi","pi-phone","!text-[1.25rem]"],[1,"pi","pi-comment","!text-[1.25rem]"],[1,"contact-item","p-3"],[1,"col-span-4"],["styleClass","my-3"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Contacts"),s(),h(7,Vc,2,1,"div",6),s(),l(8,"span"),D(9,"Specify contact information specific to this asset."),s()()(),h(10,jc,10,3,"div",7)(11,Jc,3,1,"div",8),s(),l(12,"app-dynamic-form-modal",9),_("modalClose",function(){return i.onClose()}),s()),e&2&&(d(2),g("ngClass",N(9,Pc,i.isFormEditable())),I("aria-label","id card icon"),d(5),y(i.isFormEditable()?-1:7),d(3),y(i.isFormEditable()?10:11),d(2),g("visible",i.showModal())("header",i.modalHeader())("fields",i.formFields)("actions",i.actions)("styleClass","w-[40rem]"))},dependencies:[L,z,We,K,St,it,jt,Ht,Ci,Et,vi],encapsulation:2})};var Wl=qd(Ud());var Rt=class{constructor(t){this.mapping=t}transform(t){let e={};for(let[i,o]of Object.entries(this.mapping)){let r=t[i];if(!f(r)&&o.required!==!0)continue;if(o.validate&&!o.validate(r))throw new Error(`Validation failed for field: ${i}`);let u=o.transform?o.transform(r):r;e[o.requestProperty]=u}return e}};var Xc=n=>({"icon-primary":n});function em(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit asset profiles"))}function tm(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)}}function im(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.assetDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Bn=class n extends Bt{entitiesService=c(P);utilityService=c(he);selectOptionsLoaded=R(!1);selectOptions={};assetDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Asset Rating",value:t.ratingProfile?.name??"None"},{key:"Asset State",value:(0,Wl.isEmpty)(t.assetStateProfiles)?"None":t.assetStateProfiles?.map(e=>e.name).join(", ")},{key:"Road Profile",value:t.roadProfile?.name??"None"},{key:"Geo Lock Profile",value:t.geoLockProfile?.name??"None"}]:[]});searchAssetRatingSubject=new st;assetRatingSuggestions=R([]);requestMapper;constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.entity()&&this.selectOptionsLoaded()&&(this.initializeRequestMapper(),this.updateFormFields())})}ngOnInit(){this.loadSelectOptions(),this.setupSearchAssetRating()}loadSelectOptions(){let t=this.entity();if(!f(t)||!Ye(t.id)){this.selectOptions={},this.selectOptionsLoaded.set(!0);return}Ft([this.entitiesService.listGeoLockProfiles(t.owner.id,!0,0,100,"name","state=active"),this.entitiesService.listRoadProfiles(t.owner.id,!0,0,100,"name","state=active"),this.entitiesService.listAssetStateProfiles(t.owner.id)]).pipe(W(this.destroyRef),lt(()=>re([{items:[]},{items:[]},{items:[]}]))).subscribe(([e,i,o])=>{let r={label:"None",value:Oe};this.selectOptions={geoLockProfiles:[r,...e.items.map(u=>({label:u.name??"",value:u.id})).sort((u,b)=>u.label.localeCompare(b.label))],roadProfiles:[r,...i.items.map(u=>({label:u.name??"",value:u.id})).sort((u,b)=>u.label.localeCompare(b.label))],assetStateProfiles:o.items.map(u=>({label:u.name??"",value:u.id})).sort((u,b)=>u.label.localeCompare(b.label))},this.selectOptionsLoaded.set(!0)})}setupSearchAssetRating(){this.searchAssetRatingSubject.pipe(dt(300),W(this.destroyRef),Be(t=>{if(t==null)return re({count:0,offset:0,limit:yt,items:[]});let e=t.trim();if(e.length===0)return re({count:0,offset:0,limit:yt,items:[]});let i={state:{value:"active",operator:"="},name:{value:`*${e}*`,operator:"="}},o=this.utilityService.constructRqlFilter(i);return this.entitiesService.listAssetRatingProfiles(this.entity()?.owner.id??"",0,10,"name",o)})).subscribe(t=>{this.assetRatingSuggestions.set(t.items)})}searchAssetRating(t){if(t==null){this.assetRatingSuggestions.set([]);return}this.searchAssetRatingSubject.next(t)}initializeRequestMapper(){this.requestMapper=new Rt({ratingProfile:{requestProperty:"ratingProfile",transform:t=>{let e=t;return{id:e.id,name:e.name}}},assetStateProfiles:{requestProperty:"assetStateProfiles",transform:t=>t.map(i=>{let o=this.selectOptions?.assetStateProfiles?.find(r=>r.value===i.id);return{id:o?.value,name:o?.label}})},roadProfile:{requestProperty:"roadProfile",transform:t=>{let e=this.selectOptions?.roadProfiles?.find(i=>i.value===t);return{id:e?.value,name:e?.label}}},geoLockProfile:{requestProperty:"geoLockProfile",transform:t=>{let e=this.selectOptions?.geoLockProfiles?.find(i=>i.value===t);return{id:e?.value,name:e?.label}}}})}updateFormFields(){let t=this.entity();this.formFields=[mt("ratingProfile","Asset Rating",t?.ratingProfile?.name,()=>this.assetRatingSuggestions(),this.searchAssetRating.bind(this),{layout:"horizontal",labelWidth:"1/3",name:"ratingProfile",props:{appendTo:"body",showClear:!0,multiple:!1,field:"name",completeOnFocus:!1,typeahead:!0,showEmptyMessage:!0,forceSelection:!0}}),Zs("assetStateProfiles","Asset State",t?.assetStateProfiles??[],this.selectOptions?.assetStateProfiles??[],{layout:"horizontal",labelWidth:"1/3",name:"assetStateProfiles",props:{appendTo:"body",multiple:!0,showClear:!0}}),H("roadProfile","Road Profile",this.selectOptions?.roadProfiles??[],t?.roadProfile?.id,{layout:"horizontal",labelWidth:"1/3",name:"roadProfile",props:{appendTo:"body"}}),H("geoLockProfile","Geo Lock Profile",this.selectOptions?.geoLockProfiles??[],t?.geoLockProfile?.id,{layout:"horizontal",labelWidth:"1/3",name:"geoLockProfile",props:{appendTo:"body"}})]}getUpdateMethod(){return(t,e)=>this.entitiesService.updateAsset(t,e)}transformFormData(t){if(!this.requestMapper)throw new Error("Request mapper not initialized");try{let e=Array.isArray(t)?t.reduce((r,u)=>M(M({},r),u),{}):t,i=this.requestMapper.transform(e),o={};for(let r in i)if(Object.hasOwn(i,r)){let u=i[r];u!=null&&(o[r]=u)}return o}catch(e){throw console.error("Form data transformation failed:",e),e}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-profiles-section"]],features:[O],decls:12,vars:6,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-verified","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","fields","actions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Profiles"),s(),h(7,em,2,1,"div",6),s(),l(8,"span"),D(9," Profiles Select from the following profiles."),s()()(),h(10,tm,1,2,"app-dynamic-form",7)(11,im,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(4,Xc,i.isFormEditable())),I("aria-label","verified icon"),d(5),y(i.isFormEditable()?-1:7),d(3),y(i.isFormEditable()?10:11))},dependencies:[L,z,V,q],encapsulation:2})};var nm=["addEntityModal"],om=n=>({"icon-primary":n}),rm=(n,t)=>t.id;function am(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",14),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}}function sm(n,t){n&1&&C(0,"p-panel")}function lm(n,t){if(n&1){let e=S();l(0,"p-panel")(1,"div",22)(2,"div")(3,"span",23),D(4),s()(),l(5,"div",7)(6,"span",24),_("click",function(){let o=m(e).$implicit,r=a(2);return p(r.removeClientFromSharedList(o))})("keydown.enter",function(){let o=m(e).$implicit,r=a(2);return p(r.removeClientFromSharedList(o))}),s()()()()}if(n&2){let e=t.$implicit;d(4),ye(" ",e.name),d(2),I("aria-label","Delete Item")}}function dm(n,t){if(n&1){let e=S();l(0,"div",8)(1,"label",15),D(2,"Shared With"),s(),l(3,"div",16)(4,"div",17),h(5,sm,1,0,"p-panel"),Ue(6,lm,7,2,"p-panel",null,rm),l(8,"p-button",18),_("onClick",function(){m(e);let o=a();return p(o.openAddEntityModal())}),s(),l(9,"div",19)(10,"p-button",20),_("onClick",function(){m(e);let o=a();return p(o.cancelEdit())}),s(),l(11,"p-button",21),_("onClick",function(){m(e);let o=a();return p(o.submitChanges({}))}),s()()()()()}if(n&2){let e=a();d(5),y(e.sharedWith().length===0?5:-1),d(),ze(e.sharedWith()),d(5),g("disabled",!e.hasChanges()||e.sharedWith().length===0)("loading",e.isSubmitting())}}function cm(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.assetSharedWith())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function mm(n,t){n&1&&(l(0,"div",12),C(1,"i",25),l(2,"span"),D(3,"Searching for client..."),s()())}function pm(n,t){if(n&1&&(l(0,"div",12)(1,"div",26)(2,"div",27),D(3,"Client Found:"),s(),l(4,"div",28)(5,"span"),D(6),s()()()()),n&2){let e,i=a();d(6),J((e=i.selectedClient())==null?null:e.name)}}function um(n,t){n&1&&(l(0,"p",13),D(1," Enter the PIN number for the company you would like to share this asset with. If you do not know the PIN code, contact the company in question and ask for their PIN. "),s())}var Hn=class n extends B{addEntityModal;entitiesService=c(P);utilityService=c(he);accountsService=c(me);confirmationService=c(Ee);showModal=R(!1);isSearchingClient=R(!1);selectedClient=R(null);searchClientSubject=new st;sharedWith=R([]);assetSharedWith=v(()=>{let t=this.sharedWith();return t.length===0?[]:[{key:"Shared With",value:t.map(e=>e.name).join(", ")}]});hasChanges=v(()=>{let t=this.entity()?.sharedWith??[],e=this.sharedWith();if(t.length!==e.length)return!0;let i=new Set(t.map(o=>o.id));return e.some(o=>!i.has(o.id))});actions=[{label:"Cancel",action:()=>{this.onClose()},severity:"secondary"},{label:"Ok",action:()=>{let t=this.selectedClient();t&&this.addClientToSharedList(t)},severity:"primary",disabled:()=>this.selectedClient()===null}];constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.entity()?.sharedWith;t&&(this.sharedWith.set([...t]),this.updateFormFields())})}ngOnInit(){this.setupSearchClient()}setupSearchClient(){this.searchClientSubject.pipe(dt(300),en(),W(this.destroyRef),Be(t=>{let e=t.trim();return e.length===0?(this.selectedClient.set(null),this.isSearchingClient.set(!1),this.addEntityModal?.updateFieldValidity("pin",{emitEvent:!1}),Dt):this.accountsService.getClientByPin(e).pipe(lt(()=>(this.selectedClient.set(null),this.isSearchingClient.set(!1),this.addEntityModal?.updateFieldValidity("pin",{emitEvent:!1}),Dt)))})).subscribe({next:t=>{this.isSearchingClient.set(!1),ce(t)?this.selectedClient.set(null):this.selectedClient.set(t),this.addEntityModal?.updateFieldValidity("pin",{emitEvent:!1})},error:()=>{this.isSearchingClient.set(!1),this.selectedClient.set(null),this.addEntityModal?.updateFieldValidity("pin",{emitEvent:!1})}})}searchClient(t){if(T(t)){this.selectedClient.set(null),this.isSearchingClient.set(!1);return}this.isSearchingClient.set(!0),this.addEntityModal?.updateFieldValidity("pin",{emitEvent:!1}),this.searchClientSubject.next(t)}updateFormFields(){this.formFields=[k("pin","PIN","",{name:"pin",validations:[{name:"required",validator:w.required,message:"PIN is required"},{name:"minlength",validator:w.minLength(3),message:"PIN must be at least 3 characters"},{name:"clientNotFound",validator:t=>{let e=t.value;return T(e)||e.length<3||this.isSearchingClient()?null:this.selectedClient()===null?{clientNotFound:!0}:null},message:"No client found for this PIN"}],events:{onChange:t=>{t&&t.length>=3?this.searchClient(t):(this.selectedClient.set(null),this.isSearchingClient.set(!1))}}})]}openAddEntityModal(){this.selectedClient.set(null),this.updateFormFields(),this.showModal.set(!0)}addClientToSharedList(t){if(this.sharedWith().some(i=>i.id===t.id)){this.messageService.add({severity:"warn",summary:"Already Shared",detail:`Asset is already shared with ${t.name}`});return}this.sharedWith.update(i=>[...i,t]),this.onClose()}submitChanges(t){let e=this.entity();e&&(this.isSubmitting.set(!0),this.entitiesService.updateAsset(e.id,{sharedWith:this.sharedWith()}).pipe(W(this.destroyRef),lt(i=>(this.isSubmitting.set(!1),this.messageService.add({severity:"error",summary:"Error",detail:"Failed to update sharing settings"}),console.error("Failed to update shared entities",i),Dt))).subscribe({next:i=>{this.isSubmitting.set(!1),this.isFormEditable.set(!1),this.sharedWith.set(i.sharedWith??[]),this.messageService.add({severity:"success",summary:"Success",detail:"Sharing settings updated successfully"})}}))}onClose(){this.showModal.set(!1),this.selectedClient.set(null),this.isSearchingClient.set(!1)}removeClientFromSharedList(t){this.confirmationService.confirm({header:"Remove Sharing",message:`Are you sure you want to remove sharing with ${t.name}?`,accept:()=>{this.sharedWith.update(e=>e.filter(i=>i.id!==t.id))}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-sharing-section"]],viewQuery:function(e,i){if(e&1&&pe(nm,5),e&2){let o;le(o=de())&&(i.addEntityModal=o.first)}},features:[di([Ms,Ee]),O],decls:19,vars:10,consts:[["addEntityModal",""],[1,"card","pt-2"],[1,"section-header","mb-4","p-2","flex","justify-start","items-center"],["aria-label","share icon",1,"pi","pi-share-alt","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[1,"p-field","p-2","flex","align-items-center","gap-2"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],["header","Share Asset",3,"modalClose","formSubmit","visible","fields","actions","styleClass"],["formHeader",""],[1,"mt-2","mb-4"],[1,"mt-2","mb-4","muted"],["aria-label","Edit asset sharing",1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],["for","logo",1,"w-1/3","flex-shrink-0"],[1,"flex","flex-col","justify-end","w-full"],[1,"flex-grow-1","flex","flex-col"],["severity","secondary","label","Add",1,"self-end","p-2",3,"onClick"],[1,"flex","justify-end","gap-2","mt-4"],["type","button","label","Cancel","severity","secondary",3,"onClick"],["type","submit","label","Save","severity","primary",3,"onClick","disabled","loading"],[1,"flex","flex-row","justify-between"],[1,"px-4"],[1,"pi","pi-trash","action","hover","!text-xl",3,"click","keydown.enter"],[1,"pi","pi-spinner","pi-spin"],[1,"flex","flex-column","gap-2"],[1,"muted"],[1,"flex","justify-content-between"]],template:function(e,i){if(e&1){let o=S();l(0,"div",1)(1,"div",2),C(2,"span",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Sharing"),s(),h(7,am,2,0,"div",7),s(),l(8,"span"),D(9,"Add companies you'd like to share this asset with below."),s()()(),h(10,dm,12,3,"div",8)(11,cm,1,4,"app-grid",9),s(),l(12,"app-dynamic-form-modal",10,0),_("modalClose",function(){return m(o),p(i.onClose())})("formSubmit",function(u){return m(o),p(i.onSubmit(u))}),l(14,"div",11),h(15,mm,4,0,"div",12)(16,pm,7,1,"div",12)(17,um,2,0,"p",13),s()(),C(18,"p-confirmdialog")}e&2&&(d(2),g("ngClass",N(8,om,i.isFormEditable())),d(5),y(i.isFormEditable()?-1:7),d(3),y(i.isFormEditable()?10:11),d(2),g("visible",i.showModal())("fields",i.formFields)("actions",i.actions)("styleClass","w-[40rem]"),d(3),y(i.isLoading()?15:i.selectedClient()?16:17))},dependencies:[L,z,We,K,St,Te,it,jt,Ht,Ci,Et,V,zl,xl],encapsulation:2})};var fm=n=>({"icon-primary":n});function gm(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}}function hm(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)}}function ym(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.assetEventTriggers())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var $n=class n extends B{entitiesService=c(P);measurementUnitsService=c(pt);selectOptionsLoaded=R(!1);selectOptions={};assetEventTriggers=v(()=>{let t=this.entity(),e=t?.parameters;if(T(e))return[];let i=f(t?.overspeedProfile?.id),o=[{key:"Max Speed",value:f(e.overspeed)?this.measurementUnitsService.format(e.overspeed,"speed").format:"None"},{key:"Overspeed Profile",value:f(t?.overspeedProfile)?t?.overspeedProfile?.name:"None"}];return i||o.push({key:"Speed Tolerance",value:f(e.overspeedTolerance)?`${e.overspeedTolerance}%`:"None"}),o.push({key:"Excessive Idle",value:f(e.excessiveIdle)?`${e.excessiveIdle} minutes`:"None"},{key:"Max Trip Distance",value:f(e.maxTripDistance)?`${this.measurementUnitsService.format(e.maxTripDistance,"distance").value} ${this.measurementUnitsService.unit("distance")}`:"None"},{key:"Max Trip Time",value:f(e.maxTripTime)?`${e.maxTripTime} minutes`:"None"},{key:"Max inactive time",value:f(e.maxInactiveTime)?`${e.maxInactiveTime} minutes`:"None"}),o});constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.entity()&&this.selectOptionsLoaded()&&this.updateFormFields()})}ngOnInit(){this.loadSelectOptions()}loadSelectOptions(){let t=this.entity();if(!f(t)||!Ye(t.id)){this.selectOptions={},this.selectOptionsLoaded.set(!0),this.updateFormFields();return}this.entitiesService.listOverspeedProfiles(t.owner.id).pipe(W(this.destroyRef)).subscribe(e=>{this.selectOptions={overspeedProfiles:e.items.map(i=>({label:i.name??"",value:i.id})).sort((i,o)=>i.label.localeCompare(o.label))},this.selectOptionsLoaded.set(!0)})}updateFormFields(){let t=this.entity(),e=f(t?.overspeedProfile?.id);this.formFields=[ie("overspeed","Max Speed",t?.parameters?.overspeed!==void 0&&t?.parameters?.overspeed!==null?this.measurementUnitsService.fromBackend("speed",t.parameters.overspeed):void 0,{layout:"horizontal",labelWidth:"1/3",name:"overspeed",props:{suffix:this.measurementUnitsService.unitSymbol("speed")}}),H("overspeedProfile","Overspeed Profile",this.selectOptions.overspeedProfiles,t?.overspeedProfile?.id??void 0,{layout:"horizontal",labelWidth:"1/3",name:"overspeedProfile",props:{placeholder:"Select Overspeed Profile",filter:!0,showClear:!0,clearButtonAriaLabel:"Clear selection"}}),ie("overspeedTolerance","Speed Tolerance",t?.parameters?.overspeedTolerance??void 0,{layout:"horizontal",labelWidth:"1/3",name:"overspeedTolerance",hidden:e,props:{suffix:"%"}}),ie("excessiveIdle","Excessive Idle",t?.parameters?.excessiveIdle??void 0,{layout:"horizontal",labelWidth:"1/3",name:"excessiveIdle",props:{suffix:"minutes"}}),ie("maxTripDistance","Max Trip Distance",t?.parameters?.maxTripDistance!==void 0&&t?.parameters?.maxTripDistance!==null?this.measurementUnitsService.fromBackend("distance",t.parameters.maxTripDistance):void 0,{layout:"horizontal",labelWidth:"1/3",name:"maxTripDistance",props:{suffix:this.measurementUnitsService.unit("distance")}}),ie("maxTripTime","Max Trip Time",t?.parameters?.maxTripTime??void 0,{layout:"horizontal",labelWidth:"1/3",name:"maxTripTime",props:{suffix:"minutes"}}),ie("maxInactiveTime","Max inactive time",t?.parameters?.maxInactiveTime??void 0,{layout:"horizontal",labelWidth:"1/3",name:"maxInactiveTime",props:{suffix:"minutes"}})]}submitChanges(t){let e=this.entity();if(T(e))return;let x=t,{overspeedProfile:i}=x,o=xt(x,["overspeedProfile"]),r={};for(let[G,Z]of Object.entries(o))if(Z!=null&&Z!=="")switch(G){case"overspeed":r[G]=this.measurementUnitsService.toBackend("speed",Z);break;case"maxTripDistance":r[G]=this.measurementUnitsService.toBackend("distance",Z);break;default:r[G]=Z;break}let u={};Object.keys(r).length>0&&(u.parameters=r);let b=this.selectOptions.overspeedProfiles?.find(G=>G.value===i);b?u.overspeedProfile={id:b.value,name:b.label}:u.overspeedProfile=null,this.handleEntityUpdate(this.entitiesService.updateAsset(e.id,u).pipe(W(this.destroyRef)),"Asset Event triggers updated successfully")}onFormValueChange(t){super.onFormValueChange(t);let e=t.overspeedProfile,i=f(e)&&e!=="",o=this.formFields.find(r=>r.key==="overspeedTolerance");if(o&&o.hidden!==i){for(let r of this.formFields)t[r.key]!==void 0?r.value=t[r.key]:r.value=void 0;o.hidden=i,this.formFields=[...this.formFields]}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-event-triggers-section"]],features:[O],decls:12,vars:6,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-gauge","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],["aria-label","Edit event triggers",1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValueChange","fields","actions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Event Triggers"),s(),h(7,gm,2,0,"div",6),s(),l(8,"span"),D(9,"Define when speed, idle and trip limit events will be generated for this asset."),s()()(),h(10,hm,1,2,"app-dynamic-form",7)(11,ym,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(4,fm,i.isFormEditable())),I("aria-label","id card icon"),d(5),y(i.isFormEditable()?-1:7),d(3),y(i.isFormEditable()?10:11))},dependencies:[L,z,We,K,Te,On,V,q],encapsulation:2})};var Zl=`
    .p-menu {
        background: dt('menu.background');
        color: dt('menu.color');
        border: 1px solid dt('menu.border.color');
        border-radius: dt('menu.border.radius');
        min-width: 12.5rem;
    }

    .p-menu-list {
        margin: 0;
        padding: dt('menu.list.padding');
        outline: 0 none;
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: dt('menu.list.gap');
    }

    .p-menu-item-content {
        transition:
            background dt('menu.transition.duration'),
            color dt('menu.transition.duration');
        border-radius: dt('menu.item.border.radius');
        color: dt('menu.item.color');
        overflow: hidden;
    }

    .p-menu-item-link {
        cursor: pointer;
        display: flex;
        align-items: center;
        text-decoration: none;
        overflow: hidden;
        position: relative;
        color: inherit;
        padding: dt('menu.item.padding');
        gap: dt('menu.item.gap');
        user-select: none;
        outline: 0 none;
    }

    .p-menu-item-label {
        line-height: 1;
    }

    .p-menu-item-icon {
        color: dt('menu.item.icon.color');
    }

    .p-menu-item.p-focus .p-menu-item-content {
        color: dt('menu.item.focus.color');
        background: dt('menu.item.focus.background');
    }

    .p-menu-item.p-focus .p-menu-item-icon {
        color: dt('menu.item.icon.focus.color');
    }

    .p-menu-item:not(.p-disabled) .p-menu-item-content:hover {
        color: dt('menu.item.focus.color');
        background: dt('menu.item.focus.background');
    }

    .p-menu-item:not(.p-disabled) .p-menu-item-content:hover .p-menu-item-icon {
        color: dt('menu.item.icon.focus.color');
    }

    .p-menu-overlay {
        box-shadow: dt('menu.shadow');
    }

    .p-menu-submenu-label {
        background: dt('menu.submenu.label.background');
        padding: dt('menu.submenu.label.padding');
        color: dt('menu.submenu.label.color');
        font-weight: dt('menu.submenu.label.font.weight');
    }

    .p-menu-separator {
        border-block-start: 1px solid dt('menu.separator.border.color');
    }
`;var vm=["pMenuItemContent",""],Zn=n=>({$implicit:n}),Cm=()=>({exact:!1}),_m=n=>({item:n});function bm(n,t){n&1&&ot(0)}function Sm(n,t){if(n&1&&(l(0,"a",6),ae(1,bm,1,0,"ng-container",7),s()),n&2){let e=a(2),i=Qt(4);Le(e.cn(e.cx("itemLink"),e.item==null?null:e.item.linkClass)),g("ngStyle",e.item==null?null:e.item.linkStyle)("target",e.item.target)("pBind",e.getPTOptions("itemLink")),I("title",e.item.title)("href",e.item.url||null,li)("data-automationid",e.item.automationId)("tabindex",-1),d(),g("ngTemplateOutlet",i)("ngTemplateOutletContext",N(11,Zn,e.item))}}function Dm(n,t){n&1&&ot(0)}function Tm(n,t){if(n&1&&(l(0,"a",8),ae(1,Dm,1,0,"ng-container",7),s()),n&2){let e=a(2),i=Qt(4);Le(e.cn(e.cx("itemLink"),e.item==null?null:e.item.linkClass)),g("routerLink",e.item.routerLink)("queryParams",e.item.queryParams)("routerLinkActiveOptions",e.item.routerLinkActiveOptions||sn(19,Cm))("ngStyle",e.item==null?null:e.item.linkStyle)("target",e.item.target)("fragment",e.item.fragment)("queryParamsHandling",e.item.queryParamsHandling)("preserveFragment",e.item.preserveFragment)("skipLocationChange",e.item.skipLocationChange)("replaceUrl",e.item.replaceUrl)("state",e.item.state)("pBind",e.getPTOptions("itemLink")),I("data-automationid",e.item.automationId)("tabindex",-1)("title",e.item.title),d(),g("ngTemplateOutlet",i)("ngTemplateOutletContext",N(20,Zn,e.item))}}function wm(n,t){if(n&1&&(rn(0),ae(1,Sm,2,13,"a",4)(2,Tm,2,22,"a",5),an()),n&2){let e=a();d(),g("ngIf",!(e.item!=null&&e.item.routerLink)),d(),g("ngIf",e.item==null?null:e.item.routerLink)}}function xm(n,t){}function Fm(n,t){n&1&&ae(0,xm,0,0,"ng-template")}function Im(n,t){if(n&1&&(rn(0),ae(1,Fm,1,0,null,7),an()),n&2){let e=a();d(),g("ngTemplateOutlet",e.itemTemplate)("ngTemplateOutletContext",N(2,Zn,e.item))}}function Em(n,t){if(n&1&&C(0,"span",12),n&2){let e=a(2);Le(e.cn(e.cx("itemIcon",N(5,_m,e.item)),e.item.iconClass)),g("pBind",e.getPTOptions("itemIcon"))("ngStyle",e.item.iconStyle),I("data-pc-section","itemicon")}}function Mm(n,t){if(n&1&&(l(0,"span",13),D(1),s()),n&2){let e=a(2);Le(e.cn(e.cx("itemLabel"),e.item.labelClass)),g("ngStyle",e.item.labelStyle)("pBind",e.getPTOptions("itemLabel")),I("data-pc-section","itemlabel"),d(),J(e.item.label)}}function Rm(n,t){if(n&1&&(C(0,"span",14),Vi(1,"safeHtml")),n&2){let e=a(2);Le(e.cn(e.cx("itemLabel"),e.item.labelClass)),g("ngStyle",e.item.labelStyle)("innerHTML",Li(1,6,e.item.label),ka)("pBind",e.getPTOptions("itemLabel")),I("data-pc-section","itemlabel")}}function Am(n,t){if(n&1&&C(0,"p-badge",15),n&2){let e=a(2);g("styleClass",e.item.badgeStyleClass)("value",e.item.badge)("pt",e.getPTOptions("pcBadge"))("unstyled",e.unstyled())}}function km(n,t){if(n&1&&ae(0,Em,1,7,"span",9)(1,Mm,2,6,"span",10)(2,Rm,2,8,"ng-template",null,1,Se)(4,Am,1,4,"p-badge",11),n&2){let e=Qt(3),i=a();g("ngIf",i.item.icon),d(),g("ngIf",i.item.escape!==!1)("ngIfElse",e),d(3),g("ngIf",i.item.badge)}}var Om=["start"],Pm=["end"],Vm=["header"],Lm=["item"],Nm=["submenuheader"],Gm=["list"],qm=["container"],Yl=(n,t)=>({item:n,id:t});function Um(n,t){n&1&&ot(0)}function zm(n,t){if(n&1){let e=S();l(0,"p-motion",5),_("onBeforeEnter",function(o){m(e);let r=a();return p(r.onOverlayBeforeEnter(o))})("onAfterLeave",function(){m(e);let o=a();return p(o.onOverlayAfterLeave())}),ae(1,Um,1,0,"ng-container",6),s()}if(n&2){let e=a(),i=Qt(3);g("visible",e.visible)("appear",e.popup)("options",e.computedMotionOptions()),d(),g("ngTemplateOutlet",i)}}function jm(n,t){n&1&&ot(0)}function Bm(n,t){if(n&1&&ae(0,jm,1,0,"ng-container",6),n&2){a();let e=Qt(3);g("ngTemplateOutlet",e)}}function Hm(n,t){n&1&&ot(0)}function $m(n,t){if(n&1&&(l(0,"div",11),ae(1,Hm,1,0,"ng-container",6),s()),n&2){let e=a(2);Le(e.cx("start")),g("pBind",e.ptm("start")),I("data-pc-section","start"),d(),g("ngTemplateOutlet",e.startTemplate??e._startTemplate)}}function Wm(n,t){if(n&1&&C(0,"li",15),n&2){let e=a(4);Le(e.cx("separator")),g("pBind",e.ptm("separator")),I("data-pc-section","separator")}}function Zm(n,t){if(n&1&&(l(0,"span"),D(1),s()),n&2){let e=a(3).$implicit;d(),J(e.label)}}function Km(n,t){if(n&1&&(C(0,"span",19),Vi(1,"safeHtml")),n&2){let e=a(3).$implicit;g("innerHTML",Li(1,1,e.label),ka)}}function Qm(n,t){if(n&1&&(rn(0),ae(1,Zm,2,1,"span",18)(2,Km,2,3,"ng-template",null,3,Se),an()),n&2){let e=Qt(3),i=a(2).$implicit;d(),g("ngIf",i.escape!==!1)("ngIfElse",e)}}function Ym(n,t){n&1&&ot(0)}function Jm(n,t){if(n&1&&(l(0,"li",16),ae(1,Qm,4,2,"ng-container",10)(2,Ym,1,0,"ng-container",17),s()),n&2){let e=a(),i=e.$implicit,o=e.index,r=a(3);Le(r.cx("submenuLabel")),g("pBind",r.ptm("submenuLabel"))("tooltipOptions",i.tooltipOptions)("pTooltipUnstyled",r.unstyled()),I("data-automationid",i.automationId)("id",r.menuitemId(i,r.id,o))("data-pc-section","submenulabel"),d(),g("ngIf",!r.submenuHeaderTemplate&&!r._submenuHeaderTemplate),d(),g("ngTemplateOutlet",r.submenuHeaderTemplate??r._submenuHeaderTemplate)("ngTemplateOutletContext",N(11,Zn,i))}}function Xm(n,t){if(n&1&&C(0,"li",15),n&2){let e=a(5);Le(e.cx("separator")),g("pBind",e.ptm("separator")),I("data-pc-section","separator")}}function ep(n,t){if(n&1){let e=S();l(0,"li",21),_("onMenuItemClick",function(o){m(e);let r=a(),u=r.$implicit,b=r.index,x=a().index,G=a(3);return p(G.itemClick(o,G.menuitemId(u,G.id,x,b)))}),s()}if(n&2){let e=a(),i=e.$implicit,o=e.index,r=a().index,u=a(3);Oi(i.style),Le(u.cn(u.cx("item",Pi(17,Yl,i,u.menuitemId(i,u.id,r,o))),i==null?null:i.styleClass)),g("pMenuItemContent",i)("itemTemplate",u.itemTemplate??u._itemTemplate)("idx",o)("menuitemId",u.menuitemId(i,u.id,r,o))("tooltipOptions",i.tooltipOptions)("pTooltipUnstyled",u.unstyled())("unstyled",u.unstyled()),I("data-pc-section","menuitem")("aria-label",u.label(i.label))("data-p-focused",u.isItemFocused(u.menuitemId(i,u.id,r,o)))("data-p-disabled",u.disabled(i.disabled))("aria-disabled",u.disabled(i.disabled))("id",u.menuitemId(i,u.id,r,o))}}function tp(n,t){if(n&1&&ae(0,Xm,1,4,"li",13)(1,ep,1,20,"li",20),n&2){let e=t.$implicit,i=a().$implicit;g("ngIf",e.separator&&(e.visible!==!1||i.visible!==!1)),d(),g("ngIf",!e.separator&&e.visible!==!1&&(e.visible!==void 0||i.visible!==!1))}}function ip(n,t){if(n&1&&ae(0,Wm,1,4,"li",13)(1,Jm,3,13,"li",14)(2,tp,2,2,"ng-template",12),n&2){let e=t.$implicit;g("ngIf",e.separator&&e.visible!==!1),d(),g("ngIf",!e.separator),d(),g("ngForOf",e.items)}}function np(n,t){if(n&1&&ae(0,ip,3,3,"ng-template",12),n&2){let e=a(2);g("ngForOf",e.model)}}function op(n,t){if(n&1&&C(0,"li",15),n&2){let e=a(4);Le(e.cx("separator")),g("pBind",e.ptm("separator")),I("data-pc-section","separator")}}function rp(n,t){if(n&1){let e=S();l(0,"li",23),_("onMenuItemClick",function(o){m(e);let r=a(),u=r.$implicit,b=r.index,x=a(3);return p(x.itemClick(o,x.menuitemId(u,x.id,b)))}),s()}if(n&2){let e=a(),i=e.$implicit,o=e.index,r=a(3);Le(r.cn(r.cx("item",Pi(16,Yl,i,r.menuitemId(i,r.id,o))),i==null?null:i.styleClass)),g("pMenuItemContent",i)("itemTemplate",r.itemTemplate??r._itemTemplate)("idx",o)("menuitemId",r.menuitemId(i,r.id,o))("ngStyle",i.style)("tooltipOptions",i.tooltipOptions)("unstyled",r.unstyled())("pTooltipUnstyled",r.unstyled()),I("data-pc-section","menuitem")("aria-label",r.label(i.label))("data-p-focused",r.isItemFocused(r.menuitemId(i,r.id,o)))("data-p-disabled",r.disabled(i.disabled))("aria-disabled",r.disabled(i.disabled))("id",r.menuitemId(i,r.id,o))}}function ap(n,t){if(n&1&&ae(0,op,1,4,"li",13)(1,rp,1,19,"li",22),n&2){let e=t.$implicit;g("ngIf",e.separator&&e.visible!==!1),d(),g("ngIf",!e.separator&&e.visible!==!1)}}function sp(n,t){if(n&1&&ae(0,ap,2,2,"ng-template",12),n&2){let e=a(2);g("ngForOf",e.model)}}function lp(n,t){n&1&&ot(0)}function dp(n,t){if(n&1&&(l(0,"div",11),ae(1,lp,1,0,"ng-container",6),s()),n&2){let e=a(2);Le(e.cx("end")),g("pBind",e.ptm("end")),I("data-pc-section","end"),d(),g("ngTemplateOutlet",e.endTemplate??e._endTemplate)}}function cp(n,t){if(n&1){let e=S();l(0,"div",7,1),_("click",function(o){m(e);let r=a();return p(r.onOverlayClick(o))}),ae(2,$m,2,5,"div",8),l(3,"ul",9,2),_("focus",function(o){m(e);let r=a();return p(r.onListFocus(o))})("blur",function(o){m(e);let r=a();return p(r.onListBlur(o))})("keydown",function(o){m(e);let r=a();return p(r.onListKeyDown(o))}),ae(5,np,1,1,null,10)(6,sp,1,1,null,10),s(),ae(7,dp,2,5,"div",8),s()}if(n&2){let e=a();Oi(e.sx("root")),Le(e.cn(e.cx("root"),e.styleClass)),g("ngStyle",e.style)("pBind",e.ptm("root")),I("id",e.id)("data-p",e.dataP),d(2),g("ngIf",e.startTemplate??e._startTemplate),d(),Le(e.cx("list")),g("pBind",e.ptm("list")),I("id",e.id+"_list")("tabindex",e.getTabIndexValue())("data-pc-section","menu")("aria-activedescendant",e.activedescendant())("aria-label",e.ariaLabel)("aria-labelledBy",e.ariaLabelledBy),d(2),g("ngIf",e.hasSubMenu()),d(),g("ngIf",!e.hasSubMenu()),d(),g("ngIf",e.endTemplate??e._endTemplate)}}var mp={root:({instance:n})=>({position:n.popup?"absolute":"relative"})},pp={root:({instance:n})=>["p-menu p-component",{"p-menu-overlay":n.popup}],start:"p-menu-start",list:"p-menu-list",submenuLabel:"p-menu-submenu-label",separator:"p-menu-separator",end:"p-menu-end",item:({instance:n,item:t,id:e})=>["p-menu-item",{"p-focus":n.focusedOptionId()&&e===n.focusedOptionId(),"p-disabled":n.disabled(t.disabled)},t.styleClass],itemContent:"p-menu-item-content",itemLink:"p-menu-item-link",itemIcon:({item:n})=>["p-menu-item-icon",n.icon,n.iconClass],itemLabel:"p-menu-item-label"},Wn=(()=>{class n extends As{name="menu";style=Zl;classes=pp;inlineStyles=mp;static \u0275fac=(()=>{let e;return function(o){return(e||(e=He(n)))(o||n)}})();static \u0275prov=j({token:n,factory:n.\u0275fac})}return n})();var Kl=new cs("MENU_INSTANCE"),Jl=(()=>{class n{platformId;sanitizer;constructor(e,i){this.platformId=e,this.sanitizer=i}transform(e){return!e||!Gi(this.platformId)?e:this.sanitizer.bypassSecurityTrustHtml(e)}static \u0275fac=function(i){return new(i||n)(Ai(fs,16),Ai(Ss,16))};static \u0275pipe=hs({name:"safeHtml",type:n,pure:!0})}return n})(),up=(()=>{class n extends Ja{item;itemTemplate;menuitemId=E("");idx=E(0);onMenuItemClick=new si;menu;_componentStyle=c(Wn);hostName="Menu";constructor(e){super(),this.menu=e}onItemClick(e,i){this.onMenuItemClick.emit({originalEvent:e,item:i})}getPTOptions(e){return this.menu.getPTOptions(e,this.item,this.idx(),this.menuitemId())}static \u0275fac=function(i){return new(i||n)(Ai(ds(()=>Xl)))};static \u0275cmp=F({type:n,selectors:[["","pMenuItemContent",""]],inputs:{item:[0,"pMenuItemContent","item"],itemTemplate:"itemTemplate",menuitemId:[1,"menuitemId"],idx:[1,"idx"]},outputs:{onMenuItemClick:"onMenuItemClick"},features:[di([Wn]),O],attrs:vm,decls:5,vars:6,consts:[["itemContent",""],["htmlLabel",""],[3,"click","pBind"],[4,"ngIf"],["pRipple","",3,"class","ngStyle","target","pBind",4,"ngIf"],["routerLinkActive","p-menu-item-link-active","pRipple","",3,"routerLink","queryParams","routerLinkActiveOptions","class","ngStyle","target","fragment","queryParamsHandling","preserveFragment","skipLocationChange","replaceUrl","state","pBind",4,"ngIf"],["pRipple","",3,"ngStyle","target","pBind"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["routerLinkActive","p-menu-item-link-active","pRipple","",3,"routerLink","queryParams","routerLinkActiveOptions","ngStyle","target","fragment","queryParamsHandling","preserveFragment","skipLocationChange","replaceUrl","state","pBind"],[3,"class","pBind","ngStyle",4,"ngIf"],[3,"class","ngStyle","pBind",4,"ngIf","ngIfElse"],[3,"styleClass","value","pt","unstyled",4,"ngIf"],[3,"pBind","ngStyle"],[3,"ngStyle","pBind"],[3,"ngStyle","innerHTML","pBind"],[3,"styleClass","value","pt","unstyled"]],template:function(i,o){if(i&1){let r=S();l(0,"div",2),_("click",function(b){return m(r),p(o.onItemClick(b,o.item))}),ae(1,wm,3,2,"ng-container",3)(2,Im,2,4,"ng-container",3)(3,km,5,4,"ng-template",null,0,Se),s()}i&2&&(Le(o.cx("itemContent")),g("pBind",o.getPTOptions("itemContent")),I("data-pc-section","content"),d(),g("ngIf",!o.itemTemplate),d(),g("ngIf",o.itemTemplate))},dependencies:[L,Na,qa,Ga,Ua,Ts,ws,nl,vt,fi,es,il,zi,Xa,Jl],encapsulation:2})}return n})(),Xl=(()=>{class n extends Ja{overlayService;model;popup;style;styleClass;autoZIndex=!0;baseZIndex=0;showTransitionOptions=".12s cubic-bezier(0, 0, 0.2, 1)";hideTransitionOptions=".1s linear";ariaLabel;ariaLabelledBy;id;tabindex=0;appendTo=E(void 0);motionOptions=E(void 0);computedMotionOptions=v(()=>M(M({},this.ptm("motion")),this.motionOptions()));onShow=new si;onHide=new si;onBlur=new si;onFocus=new si;listViewChild;containerViewChild;$appendTo=v(()=>this.appendTo()||this.config.overlayAppendTo());container;scrollHandler;documentClickListener;documentResizeListener;preventDocumentDefault;target;visible;focusedOptionId=v(()=>this.focusedOptionIndex()!==-1?this.focusedOptionIndex():null);focusedOptionIndex=R(-1);selectedOptionIndex=R(-1);focused=!1;overlayVisible=!1;$pcMenu=c(Kl,{optional:!0,skipSelf:!0})??void 0;_componentStyle=c(Wn);bindDirectiveInstance=c(fi,{self:!0});onAfterViewChecked(){this.bindDirectiveInstance.setAttrs(this.ptm("host"))}constructor(e){super(),this.overlayService=e,this.id=this.id||Es("pn_id_")}getPTOptions(e,i,o,r){return this.ptm(e,{context:{item:i,index:o,focused:this.isItemFocused(r),disabled:this.disabled(i.disabled)}})}toggle(e){this.visible?this.hide():this.show(e),this.preventDocumentDefault=!0}show(e){this.container&&!this.overlayVisible&&(this.container=void 0),this.target=e.currentTarget,this.visible=!0,this.preventDocumentDefault=!0,this.overlayVisible=!0,this.cd.markForCheck()}onInit(){this.popup||this.bindDocumentClickListener()}startTemplate;_startTemplate;endTemplate;_endTemplate;headerTemplate;_headerTemplate;itemTemplate;_itemTemplate;submenuHeaderTemplate;_submenuHeaderTemplate;templates;onAfterContentInit(){this.templates?.forEach(e=>{switch(e.getType()){case"start":this._startTemplate=e.template;break;case"end":this._endTemplate=e.template;break;case"item":this._itemTemplate=e.template;break;case"submenuheader":this._submenuHeaderTemplate=e.template;break;default:this._itemTemplate=e.template;break}})}getTabIndexValue(){return this.tabindex!==void 0?this.tabindex.toString():null}onOverlayBeforeEnter(e){this.container=e.element,Fs(this.container,{position:"absolute",top:"0"}),this.appendOverlay(),this.moveOnTop(),this.$attrSelector&&this.container?.setAttribute(this.$attrSelector,""),this.bindDocumentClickListener(),this.bindDocumentResizeListener(),this.bindScrollListener(),xs(this.container,this.target),Ui(this.listViewChild?.nativeElement),this.onShow.emit({})}onOverlayAfterLeave(){this.restoreOverlayAppend(),this.onOverlayHide(),this.onHide.emit({})}appendOverlay(){this.$appendTo()&&this.$appendTo()!=="self"&&(this.$appendTo()==="body"?mn(this.document.body,this.container):mn(this.$appendTo(),this.container))}restoreOverlayAppend(){this.container&&this.$appendTo()!=="self"&&mn(this.el.nativeElement,this.container)}moveOnTop(){this.autoZIndex&&In.set("menu",this.container,this.baseZIndex+this.config.zIndex.menu)}hide(){this.visible=!1,this.overlayVisible=!1,this.cd.markForCheck()}onWindowResize(){this.visible&&!Is()&&this.hide()}menuitemId(e,i,o,r){return e?.id??`${i}_${o}${r!==void 0?"_"+r:""}`}isItemFocused(e){return this.focusedOptionId()===e}label(e){return typeof e=="function"?e():e}disabled(e){return typeof e=="function"?e():typeof e>"u"?!1:e}activedescendant(){return this.focused?this.focusedOptionId():void 0}onListFocus(e){this.focused||(this.focused=!0,!this.popup&&this.changeFocusedOptionIndex(0),this.onFocus.emit(e))}onListBlur(e){this.focused&&(this.focused=!1,this.changeFocusedOptionIndex(-1),this.selectedOptionIndex.set(-1),this.focusedOptionIndex.set(-1),this.onBlur.emit(e))}onListKeyDown(e){switch(e.code){case"ArrowDown":this.onArrowDownKey(e);break;case"ArrowUp":this.onArrowUpKey(e);break;case"Home":this.onHomeKey(e);break;case"End":this.onEndKey(e);break;case"Enter":this.onEnterKey(e);break;case"NumpadEnter":this.onEnterKey(e);break;case"Space":this.onSpaceKey(e);break;case"Escape":case"Tab":this.popup&&(Ui(this.target),this.hide()),this.overlayVisible&&this.hide();break;default:break}}onArrowDownKey(e){let i=this.findNextOptionIndex(this.focusedOptionIndex());this.changeFocusedOptionIndex(i),e.preventDefault()}onArrowUpKey(e){if(e.altKey&&this.popup)Ui(this.target),this.hide(),e.preventDefault();else{let i=this.findPrevOptionIndex(this.focusedOptionIndex());this.changeFocusedOptionIndex(i),e.preventDefault()}}onHomeKey(e){this.changeFocusedOptionIndex(0),e.preventDefault()}onEndKey(e){this.changeFocusedOptionIndex(qi(this.containerViewChild?.nativeElement,'li[data-pc-section="menuitem"][data-p-disabled="false"]').length-1),e.preventDefault()}onEnterKey(e){let i=pn(this.containerViewChild?.nativeElement,`li[id="${`${this.focusedOptionIndex()}`}"]`),o=i&&(pn(i,'[data-pc-section="itemlink"]')||pn(i,"a,button"));this.popup&&Ui(this.target),o?o.click():i&&i.click(),e.preventDefault()}onSpaceKey(e){this.onEnterKey(e)}findNextOptionIndex(e){let o=[...qi(this.containerViewChild?.nativeElement,'li[data-pc-section="menuitem"][data-p-disabled="false"]')].findIndex(r=>r.id===e);return o>-1?o+1:0}findPrevOptionIndex(e){let o=[...qi(this.containerViewChild?.nativeElement,'li[data-pc-section="menuitem"][data-p-disabled="false"]')].findIndex(r=>r.id===e);return o>-1?o-1:0}changeFocusedOptionIndex(e){let i=qi(this.containerViewChild?.nativeElement,'li[data-pc-section="menuitem"][data-p-disabled="false"]');if(i.length>0){let o=e>=i.length?i.length-1:e<0?0:e;o>-1&&this.focusedOptionIndex.set(i[o].getAttribute("id"))}}itemClick(e,i){let{originalEvent:o,item:r}=e;if(this.focused||(this.focused=!0,this.onFocus.emit()),r.disabled){o.preventDefault();return}!r.url&&!r.routerLink&&o.preventDefault(),r.command&&r.command({originalEvent:o,item:r}),this.popup&&this.hide(),!this.popup&&this.focusedOptionIndex()!==i&&this.focusedOptionIndex.set(i)}onOverlayClick(e){this.popup&&this.overlayService.add({originalEvent:e,target:this.el.nativeElement}),this.preventDocumentDefault=!0}bindDocumentClickListener(){if(!this.documentClickListener&&Gi(this.platformId)){let e=this.el?this.el.nativeElement.ownerDocument:"document";this.documentClickListener=this.renderer.listen(e,"click",i=>{let o=this.containerViewChild?.nativeElement&&!this.containerViewChild?.nativeElement.contains(i.target),r=!(this.target&&(this.target===i.target||this.target.contains(i.target)));!this.popup&&o&&r&&this.onListBlur(i),this.preventDocumentDefault&&this.overlayVisible&&o&&r&&(this.hide(),this.preventDocumentDefault=!1)})}}unbindDocumentClickListener(){this.documentClickListener&&(this.documentClickListener(),this.documentClickListener=null)}bindDocumentResizeListener(){if(!this.documentResizeListener&&Gi(this.platformId)){let e=this.document.defaultView;this.documentResizeListener=this.renderer.listen(e,"resize",this.onWindowResize.bind(this))}}unbindDocumentResizeListener(){this.documentResizeListener&&(this.documentResizeListener(),this.documentResizeListener=null)}bindScrollListener(){!this.scrollHandler&&Gi(this.platformId)&&(this.scrollHandler=new tl(this.target,()=>{this.visible&&this.hide()})),this.scrollHandler?.bindScrollListener()}unbindScrollListener(){this.scrollHandler&&(this.scrollHandler.unbindScrollListener(),this.scrollHandler=null)}onOverlayHide(){this.unbindDocumentClickListener(),this.unbindDocumentResizeListener(),this.unbindScrollListener(),this.preventDocumentDefault=!1,this.cd.destroyed||(this.target=null),this.container&&(this.autoZIndex&&In.clear(this.container),this.container=void 0)}onDestroy(){this.popup&&(this.scrollHandler&&(this.scrollHandler.destroy(),this.scrollHandler=null),this.container&&(this.autoZIndex&&In.clear(this.container),this.container=void 0),this.restoreOverlayAppend(),this.onOverlayHide()),this.popup||this.unbindDocumentClickListener()}hasSubMenu(){return this.model?.some(e=>e.items)??!1}isItemHidden(e){return e.separator?e.visible===!1||e.items&&e.items.some(i=>i.visible!==!1):e.visible===!1}get dataP(){return this.cn({popup:this.popup})}static \u0275fac=function(i){return new(i||n)(Ai(Rs))};static \u0275cmp=F({type:n,selectors:[["p-menu"]],contentQueries:function(i,o,r){if(i&1&&(Vt(r,Om,4),Vt(r,Pm,4),Vt(r,Vm,4),Vt(r,Lm,4),Vt(r,Nm,4),Vt(r,un,4)),i&2){let u;le(u=de())&&(o.startTemplate=u.first),le(u=de())&&(o.endTemplate=u.first),le(u=de())&&(o.headerTemplate=u.first),le(u=de())&&(o.itemTemplate=u.first),le(u=de())&&(o.submenuHeaderTemplate=u.first),le(u=de())&&(o.templates=u)}},viewQuery:function(i,o){if(i&1&&(pe(Gm,5),pe(qm,5)),i&2){let r;le(r=de())&&(o.listViewChild=r.first),le(r=de())&&(o.containerViewChild=r.first)}},inputs:{model:"model",popup:[2,"popup","popup",Va],style:"style",styleClass:"styleClass",autoZIndex:[2,"autoZIndex","autoZIndex",Va],baseZIndex:[2,"baseZIndex","baseZIndex",La],showTransitionOptions:"showTransitionOptions",hideTransitionOptions:"hideTransitionOptions",ariaLabel:"ariaLabel",ariaLabelledBy:"ariaLabelledBy",id:"id",tabindex:[2,"tabindex","tabindex",La],appendTo:[1,"appendTo"],motionOptions:[1,"motionOptions"]},outputs:{onShow:"onShow",onHide:"onHide",onBlur:"onBlur",onFocus:"onFocus"},features:[di([Wn,{provide:Kl,useExisting:n},{provide:el,useExisting:n}]),ys([fi]),O],decls:4,vars:1,consts:[["sharedcontent",""],["container",""],["list",""],["htmlSubmenuLabel",""],["name","p-anchored-overlay",3,"visible","appear","options"],["name","p-anchored-overlay",3,"onBeforeEnter","onAfterLeave","visible","appear","options"],[4,"ngTemplateOutlet"],[3,"click","ngStyle","pBind"],[3,"class","pBind",4,"ngIf"],["role","menu",3,"focus","blur","keydown","pBind"],[4,"ngIf"],[3,"pBind"],["ngFor","",3,"ngForOf"],["role","separator",3,"class","pBind",4,"ngIf"],["pTooltip","","role","none",3,"class","pBind","tooltipOptions","pTooltipUnstyled",4,"ngIf"],["role","separator",3,"pBind"],["pTooltip","","role","none",3,"pBind","tooltipOptions","pTooltipUnstyled"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngIf","ngIfElse"],[3,"innerHTML"],["pTooltip","","role","menuitem",3,"class","pMenuItemContent","itemTemplate","idx","menuitemId","style","tooltipOptions","pTooltipUnstyled","unstyled","onMenuItemClick",4,"ngIf"],["pTooltip","","role","menuitem",3,"onMenuItemClick","pMenuItemContent","itemTemplate","idx","menuitemId","tooltipOptions","pTooltipUnstyled","unstyled"],["pTooltip","","role","menuitem",3,"class","pMenuItemContent","itemTemplate","idx","menuitemId","ngStyle","tooltipOptions","unstyled","pTooltipUnstyled","onMenuItemClick",4,"ngIf"],["pTooltip","","role","menuitem",3,"onMenuItemClick","pMenuItemContent","itemTemplate","idx","menuitemId","ngStyle","tooltipOptions","unstyled","pTooltipUnstyled"]],template:function(i,o){i&1&&(h(0,zm,2,4,"p-motion",4)(1,Bm,1,1,"ng-container"),ae(2,cp,8,21,"ng-template",null,0,Se)),i&2&&y(o.popup?0:1)},dependencies:[L,_s,Na,qa,Ga,Ua,up,vt,gi,fi,es,zi,Xa,rl,ol,Jl],encapsulation:2,changeDetection:0})}return n})(),ed=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=nn({type:n});static \u0275inj=tn({imports:[Xl,zi,zi]})}return n})();var fp=["addReminderMenu"],gp=["addReminderBtn"],hp=n=>({"icon-primary":n});function yp(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit reminders"))}function vp(n,t){n&1&&C(0,"p-card")}function Cp(n,t){if(n&1){let e=S();l(0,"p-card",14)(1,"div",20)(2,"div")(3,"span",21),D(4),s()(),l(5,"div",6)(6,"span",22),_("click",function(){let o=m(e).$implicit,r=a(2);return p(r.deleteReminder(o))})("keydown.enter",function(){let o=m(e).$implicit,r=a(2);return p(r.deleteReminder(o))}),s()()()()}if(n&2){let e=t.$implicit;d(4),ye(" ",e==null?null:e.name)}}function _p(n,t){if(n&1){let e=S();l(0,"div",7)(1,"label",11),D(2,"Reminders"),s(),l(3,"div",12)(4,"div",13),h(5,vp,1,0,"p-card"),Ue(6,Cp,7,1,"p-card",14,Kt),l(8,"div",15),C(9,"p-splitbutton",16),s(),l(10,"div",17)(11,"p-button",18),_("onClick",function(){m(e);let o=a();return p(o.onCancel())}),s(),l(12,"p-button",19),_("onClick",function(){m(e);let o=a();return p(o.saveAllChanges())}),s()()()()()}if(n&2){let e=a();d(5),y(e.sortedReminders().length===0?5:-1),d(),ze(e.sortedReminders()),d(3),g("model",e.reminderOptions),d(3),g("loading",e.isLoadingAsset())("disabled",!e.hasChanges())}}function bp(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.reminders())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function Sp(n,t){if(n&1){let e=S();l(0,"app-dynamic-form-modal",23),_("modalClose",function(){m(e);let o=a();return p(o.showReminderModal.set(!1))})("formSubmit",function(o){m(e);let r=a();return p(r.onReminderSubmit(o))}),l(1,"div",24)(2,"p",25),D(3),s()()()}if(n&2){let e=a();g("visible",e.showReminderModal())("header",e.currentModalTitle())("fields",e.formFields)("actions",e.actions)("styleClass","w-[40rem]"),d(3),ye(" ",e.formHeader," ")}}var Kn=class n extends B{addReminderMenu;addReminderBtn;entitiesService=c(P);http=c(It);authDataService=c(ke);isLoadingAsset=R(!1);remindersData=R([]);showReminderModal=R(!1);currentModalTitle=R("Add Reminder");currentReminderType=R(null);newReminders=R([]);deletedReminderIds=R([]);loadedAssetId=null;reminderOptions=[{label:"Odometer Reminder",command:()=>this.openReminderModal("odo")},{label:"Engine Hours Reminder",command:()=>this.openReminderModal("hours")},{label:"Time Based Reminder",command:()=>this.openReminderModal("time")}];reminders=v(()=>{let t=this.remindersData();return[{key:"Reminders",value:ce(t)?"None":t.map(e=>e.name).join(", ")}]});sortedReminders=v(()=>[...this.remindersData().filter(e=>!this.deletedReminderIds().includes(e.id??"")),...this.newReminders().filter(e=>!this.deletedReminderIds().includes(e.id??""))].sort((e,i)=>{let o=e.modifiedDate??(f(e.id?.startsWith("temp-")??!1)?Date.now():0),r=i.modifiedDate??(f(i.id?.startsWith("temp-")??!1)?Date.now():0),u=typeof o=="string"?new Date(o).getTime():Number(o);return(typeof r=="string"?new Date(r).getTime():Number(r))-u}));hasChanges=v(()=>this.newReminders().length>0||this.deletedReminderIds().length>0);actions=[{label:"Cancel",action:()=>{this.showReminderModal.set(!1),this.resetModal()},severity:"secondary"},{label:"Ok",action:t=>{this.onReminderSubmit(t.value)},severity:"primary",disabled:t=>(t?.invalid??!1)||(t?.dirty??!1)&&!(t?.touched??!1)||this.isLoadingAsset()}];timezones=[];formHeader="";constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.entity();f(t?.id)&&f(t?.owner?.id)?t.id!==this.loadedAssetId&&this.loadReminders(t):(this.remindersData.set([]),this.loadedAssetId=null,this.resetChanges())})}ngOnInit(){this.loadTimezones()}loadReminders(t){this.isLoadingAsset()||(this.loadedAssetId=t.id,this.isLoadingAsset.set(!0),this.entitiesService.listReminders(t.owner.id,t.id).pipe(W(this.destroyRef),lt(()=>(this.isLoadingAsset.set(!1),re({items:[],count:0})))).subscribe({next:e=>{let i=e.items??[];this.remindersData.set(i),this.isLoadingAsset.set(!1),this.resetChanges()}}))}loadTimezones(){this.http.get("/assets/docs/timezones.json").subscribe(t=>{this.timezones=t.map(e=>({label:e.id,value:e.id})).sort((e,i)=>e.label.localeCompare(i.label))})}createResetCounterOptions(t){return Array.from({length:8},(e,i)=>({label:`${t}_cnt_${i+1}`,value:i+1}))}createResetConfig(t,e){let i=[{name:"reset",key:"reset",type:"group",fields:[]},H("timeZoneId","Timezone",this.timezones,this.authDataService.getUserProfile()?.timeZoneId,{layout:"horizontal",labelWidth:"1/3",placeholder:"Select timezone",name:"timeZoneId",props:{appendTo:"body"}})],o=i[0];switch(t){case"daily":o.fields=[{name:"daily",key:"daily",type:"group",fields:[ie("recurrence","Every",1,{name:"recurrence",validations:[{name:"required",validator:w.required,message:"Recurrence is required"}],props:{suffix:"Days"}})]},H("counter","Reset Counter",e,e[0].value,{name:"counter",validations:[{name:"required",validator:w.required,message:"Counter is required"}],props:{appendTo:"body"}})];break;case"weekly":o.fields=[{name:"weekly",key:"weekly",type:"group",fields:[rt("days","Weekdays",[],Nt,{name:"days",validations:[{name:"required",validator:w.required,message:"Weekdays is required"}],props:{checkmark:!0,multiple:!0}})]},H("counter","Reset Counter Value",e,e[0].value,{name:"counter",props:{appendTo:"body"},validations:[{name:"required",validator:w.required,message:"Counter is required"}]})];break;case"monthly":o.fields=[{name:"monthly",key:"monthly",type:"group",fields:[rt("months","Months",[],sl,{name:"months",validations:[{name:"required",validator:w.required,message:"Months is required"}],props:{checkmark:!0,multiple:!0}}),H("day","Day ",ts,ts[0].value,{name:"day",validations:[{name:"required",validator:w.required,message:"Day of month is required"}],props:{appendTo:"body"}})]},H("counter","Reset Counter",e,e[0].value,{name:"counter",props:{appendTo:"body"},validations:[{name:"required",validator:w.required,message:"Counter is required"}]})];break}return i}createResetTypeDropdown(t){let e=this.createResetCounterOptions(t);return H("resetType","Reset",[{label:"After each reminder",value:"none"},{label:"Daily",value:"daily"},{label:"Weekly",value:"weekly"},{label:"Monthly",value:"monthly"}],"none",{name:"resetType",conditional:!0,conditions:{none:[],daily:this.createResetConfig("daily",e),weekly:this.createResetConfig("weekly",e),monthly:this.createResetConfig("monthly",e)},props:{appendTo:"body"}})}createBaseReminderForm(t,e,i,o){return[k("name","Name",t,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),H("mode","Mode",e,"once",{name:"mode",conditional:!0,conditions:{once:[i()],repeating:o()},props:{appendTo:"body"}})]}openReminderModal(t){switch(this.currentReminderType.set(t),this.currentModalTitle.set(`Add ${this.getReminderTypeDisplay(t)} Reminder`),this.updateFormFields(),t){case"odo":this.formHeader="Odometer reminders will create an event (and optional alert) when the specified odometer value is reached.";break;case"hours":this.formHeader="Engine hours reminders will create an event (and optional alert) when the specified engine hours value is reached.";break;case"time":this.formHeader="Time based reminders will create an event (and optional alert) when the specified date and time is reached."}this.showReminderModal.set(!0)}resetModal(){this.currentReminderType.set(null),this.formFields=[]}updateFormFields(){let t=this.currentReminderType();t==="time"?this.formFields=this.createBaseReminderForm("Time Based Reminder",[{label:"At specific date/time",value:"once"},{label:"Every X days",value:"repeating"}],()=>({name:"trigger",key:"trigger",type:"group",fields:[tt("value","Date","",{name:"value",validations:[{name:"required",validator:w.required,message:"Starting date is required"}],props:{appendTo:"body",showTime:!0,showSeconds:!0,dateFormat:"yy/mm/dd"}})]}),()=>[{name:"trigger",key:"trigger",type:"group",fields:[ie("value","Days",1,{name:"value",validations:[{name:"required",validator:w.required,message:"Days is required"}]}),tt("start","Starting at",new Date,{name:"start",validations:[{name:"required",validator:w.required,message:"Starting date is required"}],props:{appendTo:"body",showTime:!0,showSeconds:!0,dateFormat:"yy/mm/dd"}})]}]):t==="odo"?this.formFields=this.createBaseReminderForm("Odometer Reminder",[{label:"At specific odometer",value:"once"},{label:"Every X kilometers",value:"repeating"}],()=>({name:"trigger",key:"trigger",type:"group",fields:[ie("value","Odometer",void 0,{name:"value",validations:[{name:"required",validator:w.required,message:"Odometer is required"}]})]}),()=>[ie("triggerValue","Kilometres",void 0,{name:"triggerValue",validations:[{name:"required",validator:w.required,message:"Kilometres is required"}],hint:"Trigger every X kilometres"}),ie("triggerStart","Starting at",void 0,{name:"triggerStart",validations:[{name:"required",validator:w.required,message:"Starting odometer is required"}],hint:"Starting odometer value"}),this.createResetTypeDropdown(t)]):t==="hours"&&(this.formFields=this.createBaseReminderForm("Engine Hours Reminder",[{label:"At specific hours",value:"once"},{label:"Every X hours",value:"repeating"}],()=>({name:"trigger",key:"trigger",type:"group",fields:[ie("value","Engine Hours",void 0,{name:"value",validations:[{name:"required",validator:w.required,message:"Engine hours is required"}]})]}),()=>[ie("triggerValue","Hours",void 0,{name:"triggerValue",validations:[{name:"required",validator:w.required,message:"Hours is required"}],hint:"Trigger every X hours"}),ie("triggerStart","Starting at",void 0,{name:"triggerStart",validations:[{name:"required",validator:w.required,message:"Starting engine hours is required"}],hint:"Starting engine hours value"}),this.createResetTypeDropdown(t)]))}convertToDate(t){if(t instanceof Date)return t;if(typeof t=="string"||typeof t=="number"){let e=new Date(t);return Number.isNaN(e.getTime())?null:e}return null}getReminderTypeDisplay(t){switch(t){case"odo":return"Odometer";case"hours":return"Engine Hours";case"time":return"Time Based";default:return"Unknown Type"}}onReminderSubmit(t){let e=this.entity();if(T(e?.id))return;let i=t.trigger,o=this.currentReminderType();if(f(i)){if(o==="time"){if(t.mode==="once"){let G=i.value;if(f(G)){let Z=this.convertToDate(G);Z&&!Number.isNaN(Z.getTime())&&(i=ee(M({},i),{value:Z.toISOString()}))}}else if(t.mode==="repeating"){let G=i.start,Z=i.value;if(i=M({},i),f(Z)&&(i.value=String(Z)),f(G)){let ve=this.convertToDate(G);ve&&!Number.isNaN(ve.getTime())&&(i.start=ve.toISOString())}}}else if(o==="odo"||o==="hours"){let G=t;t.mode==="repeating"?i={value:f(G.triggerValue)?String(G.triggerValue):void 0,start:f(G.triggerStart)?String(G.triggerStart):void 0}:(i=M({},i),f(i?.value)&&(i.value=String(i.value)))}}let r=t.resetType??"none",u={type:r,counter:1,daily:{recurrence:1},weekly:{days:[...Array(7).keys()].map(G=>G)},monthly:{months:[...Array(12).keys()].map(G=>++G),day:1}},b=ee(M(M({},u),t.reset),{type:r}),x={name:t.name,target:{type:"asset",id:e.id,name:e.name},type:this.currentReminderType(),mode:t.mode,timeZoneId:t.timeZoneId??this.authDataService.getUserProfile()?.timeZoneId,trigger:i,reset:b,ownerId:e?.owner.id,enabled:!0};this.newReminders.set([...this.newReminders(),x]),this.showReminderModal.set(!1),this.resetModal()}deleteReminder(t){T(t.id)?this.newReminders.set(this.newReminders().filter(e=>e!==t)):f(t.id)&&this.deletedReminderIds.set([...this.deletedReminderIds(),t.id]),this.messageService.add({severity:"info",summary:"Reminder Deleted",detail:`Reminder "${t.name}" has been marked for deletion.`})}resetChanges(){this.newReminders.set([]),this.deletedReminderIds.set([])}saveAllChanges(){let t=this.entity();if(T(t?.id))return;this.isLoadingAsset.set(!0);let e=this.newReminders().map(o=>{let r=ee(M({},o),{ownerId:t.owner.id});return this.entitiesService.createReminder(r)}),i=this.deletedReminderIds().map(o=>this.entitiesService.deleteReminder(o));ai({creates:ce(e)?re(null):ai(e),deletes:ce(i)?re(null):ai(i)}).pipe(W(this.destroyRef),Pt(()=>this.isLoadingAsset.set(!1)),lt(()=>(this.messageService.add({severity:"error",summary:"Error",detail:"Failed to save reminders"}),re(null)))).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Success",detail:"Reminders updated successfully"}),this.loadedAssetId=null,this.loadReminders(t),this.isFormEditable.set(!1),this.isSubmitting.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"asset",entityId:t.id})},error:()=>{this.isFormEditable.set(!0),this.isSubmitting.set(!1)}})}submitChanges(t){this.saveAllChanges()}onCancel(){this.isFormEditable.set(!1),this.resetChanges()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-reminders-section"]],viewQuery:function(e,i){if(e&1&&(pe(fp,5),pe(gp,5,us)),e&2){let o;le(o=de())&&(i.addReminderMenu=o.first),le(o=de())&&(i.addReminderBtn=o.first)}},features:[O],decls:13,vars:6,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],["aria-label","share icon",1,"pi","pi-clock","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[1,"p-field","p-2","flex","align-items-center","gap-2"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[3,"visible","header","fields","actions","styleClass"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],["for","",1,"w-1/3","flex-shrink-0"],[1,"flex","flex-col","justify-end","w-full"],[1,"flex-grow-1","flex","flex-col"],["styleClass","mb-2"],[1,"w-full","flex","justify-end","pt-2"],["label","Add Reminder","severity","secondary",1,"p-2",3,"model"],[1,"flex","justify-end","gap-2","mt-4"],["type","button","label","Cancel","severity","secondary",3,"onClick"],["type","submit","label","Save","severity","primary",3,"onClick","loading","disabled"],[1,"flex","flex-row","justify-between"],[1,"px-4"],["aria-label","'Delete Reminder'",1,"pi","pi-trash","action","hover","!text-xl",3,"click","keydown.enter"],[3,"modalClose","formSubmit","visible","header","fields","actions","styleClass"],["formHeader",""],[1,"mt-2","mb-4","muted"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Reminders"),s(),h(7,yp,2,1,"div",6),s(),l(8,"span"),D(9,"Set reminders on asset."),s()()(),h(10,_p,13,4,"div",7)(11,bp,1,4,"app-grid",8),s(),h(12,Sp,4,6,"app-dynamic-form-modal",9)),e&2&&(d(2),g("ngClass",N(4,hp,i.isFormEditable())),d(5),y(i.isFormEditable()?-1:7),d(3),y(i.isFormEditable()?10:11),d(2),y(i.showReminderModal()?12:-1))},dependencies:[L,z,K,St,Te,V,it,ed,jt,kn,bl,Tl,Dl],encapsulation:2})};var Dp=n=>({"icon-primary":n});function Tp(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}}function wp(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)}}function xp(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.assetAnalogAndTemperatureTriggersList())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Qn=class n extends B{entitiesService=c(P);measurementUnitsService=c(pt);utilityService=c(he);apiSchemaService=c(bt);selectOptionsLoaded=R(!1);selectOptions={};formState=R(null);analogModalConfig;temperatureModalConfig;constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.entity()&&!this.createMode()&&this.updateFormFields()})}ngOnInit(){this.loadSelectOptions(),this.setupModalConfigs()}setupModalConfigs(){this.analogModalConfig=new Ki().withModalComponent(be).withTitle("Analog Event Trigger").withFields(t=>this.createAnalogFields(t)).withDefaultProvider(()=>({id:"",minRange:0,maxRange:100,rangeDebounce:0,decValue:0,incValue:0})).withFormatter(t=>({id:t.id,title:t.name??this.selectOptions?.analogInputTypes?.find(e=>e.value===t.id)?.label,display:`Range of ${t.minRange} to ${t.maxRange} with a debounce of ${t.rangeDebounce} positions`,icon:"wave-pulse"})).withSubHeader("Define when speed, idle and trip limit analogs will be generated.").withShowEditButton(!0).build(),this.temperatureModalConfig=new Ki().withModalComponent(be).withTitle("Temperature Event Trigger").withFields(t=>this.createTemperatureFields(t)).withDefaultProvider(()=>({id:"",minRange:0,maxRange:100,rangeDebounce:0})).withFormatter(t=>({id:t.id,title:t.name??this.selectOptions?.temperatureInputTypes?.find(e=>e.value===t.id)?.label,display:`Range of ${t.minRange} to ${t.maxRange} with a debounce of ${t.rangeDebounce} positions`,icon:"thermometer"})).withSubHeader("Define when temperature analogs will be generated for this asset.").withShowEditButton(!0).build()}createAnalogFields(t){return[H("id","Analog Input",this.selectOptions?.analogInputTypes??[],"",{layout:"horizontal",labelWidth:"1/3",name:"id",props:{appendTo:"body"}}),ie("minRange","Min Range",0,{layout:"horizontal",labelWidth:"1/3",name:"minRange"}),ie("maxRange","Max Range",100,{layout:"horizontal",labelWidth:"1/3",name:"maxRange"}),ie("rangeDebounce","Range Debounce",0,{layout:"horizontal",labelWidth:"1/3",name:"rangeDebounce"}),ie("decValue","Drop Amount",0,{layout:"horizontal",labelWidth:"1/3",name:"decValue"}),ie("incValue","Increase Amount",0,{layout:"horizontal",labelWidth:"1/3",name:"incValue"})]}createTemperatureFields(t){return[H("id","Temperature Input",this.selectOptions?.temperatureInputTypes??[],"",{layout:"horizontal",labelWidth:"1/3",name:"id",props:{appendTo:"body"}}),ie("minRange","Min Range",0,{layout:"horizontal",labelWidth:"1/3",name:"minRange",props:{suffix:this.measurementUnitsService.unitSymbol("temperature")}}),ie("maxRange","Max Range",100,{layout:"horizontal",labelWidth:"1/3",name:"maxRange",props:{suffix:this.measurementUnitsService.unitSymbol("temperature")}}),ie("rangeDebounce","Range Debounce",0,{layout:"horizontal",labelWidth:"1/3",name:"rangeDebounce"})]}assetAnalogAndTemperatureTriggersList=v(()=>{let t=this.entity();if(!t)return[];let e=this.formState()??{analogs:t.parameters?.analogs??[],temperatures:t.parameters?.temperatures??[]};return[{key:"Analogs",value:e.analogs.length>0?e.analogs.map(i=>i.name).join(", "):"None"},{key:"Temperature",value:e.temperatures.length>0?e.temperatures.map(i=>i.name).join(", "):"None"}]});loadSelectOptions(){let t=this.entity();!f(t)||!Ye(t.id)||Ft([this.loadIOTypes(t.owner.id,["analog_input","can_input"]),this.loadIOTypes(t.owner.id,["temperature_input"])]).pipe(W(this.destroyRef)).subscribe(([e,i])=>{this.selectOptions={analogInputTypes:e.items.map(o=>({label:o.name??"",value:o.id,type:this.apiSchemaService.getEntityType(o,"iotype")??""})).sort((o,r)=>o.label.localeCompare(r.label)),temperatureInputTypes:i.items.map(o=>({label:o.name??"",value:o.id,type:this.apiSchemaService.getEntityType(o,"iotype")??""})).sort((o,r)=>o.label.localeCompare(r.label))},this.selectOptionsLoaded.set(!0)})}loadIOTypes(t,e){let i=this.apiSchemaService.getTypePropertyKey("Iotype"),o=ce(e)?{state:{value:"active",operator:"in"}}:{state:{value:"active",operator:"="},[i]:{value:e,operator:"in"}};return this.entitiesService.listIoTypes(t,!0,0,yt,"name",this.utilityService.constructRqlFilter(o)).pipe(W(this.destroyRef))}updateFormFields(){let t=this.entity();t&&(this.formState.set({analogs:t.parameters?.analogs??[],temperatures:t.parameters?.temperatures??[]}),this.formFields=[De("analogs","Analogs",t.parameters?.analogs??[],{name:"analogs",props:{modalConfig:this.analogModalConfig}}),De("temperatures","Temperatures",t.parameters?.temperatures??[],{name:"temperatures",props:{modalConfig:this.temperatureModalConfig}})],this.form?.valueChanges.pipe(W(this.destroyRef)).subscribe(e=>{this.formState.set({analogs:e.analogs??[],temperatures:e.temperatures??[]})}))}submitChanges(t){let e=this.entity();if(T(e))return;this.isSubmitting.set(!0);let i=(t.analogs??e.parameters?.analogs??[]).map(r=>{let u=this.selectOptions?.analogInputTypes?.find(b=>b.value===r.id);return ee(M({},r),{ioType:u?.type??"",name:u?.label??r.id})}),o=(t.temperatures??e.parameters?.temperatures??[]).map(r=>{let u=this.selectOptions?.temperatureInputTypes?.find(b=>b.value===r.id);return ee(M({},r),{ioType:u?.type??"",name:u?.label??r.id})});this.handleEntityUpdate(this.entitiesService.updateAsset(e.id,{parameters:{analogs:i,temperatures:o}}).pipe(W(this.destroyRef),Pt(()=>{this.isSubmitting.set(!1),this.formState.set(null)})),"Asset Analog triggers updated successfully")}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-analog-triggers-section"]],features:[O],decls:12,vars:6,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-wave-pulse","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],["aria-label","Edit analog triggers",1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValueChange","formValidityChange","fields","actions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Analog Triggers"),s(),h(7,Tp,2,0,"div",6),s(),l(8,"span"),D(9,"Define when speed, idle and trip limit analogs will be generated for this asset."),s()()(),h(10,wp,1,2,"app-dynamic-form",7)(11,xp,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(4,Dp,i.isFormEditable())),I("aria-label","pulse icon"),d(5),y(i.isFormEditable()?-1:7),d(3),y(i.isFormEditable()?10:11))},dependencies:[L,z,We,K,V,q],encapsulation:2})};var Fp=n=>({"icon-primary":n});function Ip(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}}function Ep(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formReady",function(o){m(e);let r=a();return p(r.form=o)})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))})("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)}}function Mp(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.assetCurfewEvents())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Yn=class n extends B{http=c(It);entitiesService=c(P);utilityService=c(he);operationRegistry=c(Q);authDataService=c(ke);timezones=[];selectOptions={};formState=R([]);assetCurfewEvents=v(()=>{let t=this.entity(),e=this.formState()??t?.parameters?.curfews;return T(e)?[]:[{key:"Working Hours",value:e.map(i=>`${i.from} - ${i.to}`).join(", ")}]});showModal=!1;assetCurfewModalConfig;constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.entity()&&!this.createMode()&&this.updateFormFields()})}ngOnInit(){this.loadTimezones(),this.assetCurfewModalConfig=new Ki().withModalComponent(be).withTitle("Working Hours").withFields(t=>this.createWorkingHoursFields(t)).withDefaultProvider(()=>({id:Xe(),from:"00:00",to:"23:59",timeZoneId:this.authDataService.getUserProfile()?.timeZoneId??"",days:Nt.map(t=>t.value)})).withFormatter(t=>({id:t.id,title:`${t.from} - ${t.to}`,display:`Between ${t.from} and ${t.to} on ${this.utilityService.getWeekdaysString(t.days)}`,icon:"clock"})).withShowEditButton(!0).build()}createWorkingHoursFields(t){return[k("id","ID",t?.id,{name:"id",hidden:!0}),tt("from","From",t?.from??"",{name:"from",placeholder:"Select time",props:{timeOnly:!0,showSeconds:!1},style:{width:"100%"}}),tt("to","To",t?.to??"",{name:"to",placeholder:"Select time",props:{timeOnly:!0,showSeconds:!1},style:{width:"100%"}}),H("timeZoneId","Time Zone",this.timezones,t?.timeZoneId??"",{layout:"horizontal",labelWidth:"1/3",placeholder:"Select timezone",name:"timeZone",props:{appendTo:"body"}}),rt("days","Weekdays",t?.days??[],Nt,{name:"days",validations:[{name:"required",validator:w.required,message:"Days is required"}],props:{checkmark:!0,multiple:!0}})]}loadTimezones(){this.http.get("/assets/docs/timezones.json").subscribe(t=>{this.timezones=t.map(e=>({label:e.id,value:e.id})).sort((e,i)=>e.label.localeCompare(i.label)),this.updateFormFields()})}updateFormFields(){let t=this.entity();if(!t)return;this.formState.set(t.parameters?.curfews??[]);let e=this.formState();this.formFields=[De("curfews","Working Hours",e,{layout:"horizontal",labelWidth:"1/3",name:"curfews",props:{modalConfig:this.assetCurfewModalConfig}})]}onFormValueChange(t){super.onFormValueChange(t),Array.isArray(t?.curfews)&&this.formState.set(t.curfews)}getUpdateMethod(){return this.operationRegistry.getOperation("asset","update")??((t,e)=>this.entitiesService.updateAsset(t,{parameters:e}))}onClose(){this.showModal=!1}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-curfew-events-section"]],features:[O],decls:12,vars:6,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-clock","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],["aria-label","Edit working hours",1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formReady","formValueChange","formSubmit","fields","actions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Working Hours"),s(),h(7,Ip,2,0,"div",6),s(),l(8,"span"),D(9,"Define the working hours of this asset in order to generate curfew violation events. "),s()()(),h(10,Ep,1,2,"app-dynamic-form",7)(11,Mp,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(4,Fp,i.isFormEditable())),I("aria-label","clock icon"),d(5),y(i.isFormEditable()?-1:7),d(3),y(i.isFormEditable()?10:11))},dependencies:[L,z,We,K,V,q,kn],encapsulation:2})};var Rp=n=>({"icon-primary":n});function Ap(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit asset default labels"))}function kp(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)}}function Op(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.assetDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Jn=class n extends B{entitiesService=c(P);utilityService=c(he);assetDetails=v(()=>{let t=this.entity(),e=this.labels();return f(t)?[{key:"Default Trip Labels",value:(t.defaultTripLabels??[]).map(o=>{let[r,u]=o.split("/"),b=e.find(Z=>Z.label===r),x;b?.values&&(x=b.values.find(Z=>Z.label===u));let G=b?[b.name,x?.name].filter(Z=>f(Z)).join(": "):o;return{id:o,name:G}}).map(o=>o.name).join(", ")||"None"}]:[]});searchDefaultLabelsSubject=new st;defaultLabelsSuggestions=R([]);labels=R([]);constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}]}ngOnInit(){this.loadLabels(),this.setupSearchDefaultLabels(),this.updateFormFields()}loadLabels(){let t=this.entity();if(!f(t)||!Ye(t.id)){this.labels.set([]);return}this.entitiesService.listLabels(t.owner.id,!0,0,yt,"name","state=active").pipe(W(this.destroyRef)).subscribe(e=>{this.labels.set(e.items)})}setupSearchDefaultLabels(){this.searchDefaultLabelsSubject.pipe(dt(300),W(this.destroyRef),Be(t=>{if(T(t))return re({count:0,offset:0,limit:yt,items:[]});let e=t.trim();if(e.length===0)return re({count:0,offset:0,limit:yt,items:[]});let i={state:{value:"active",operator:"="},name:{value:`*${e}*`,operator:"="}},o=this.utilityService.constructRqlFilter(i);return this.entitiesService.listLabels(this.entity()?.owner.id??"",!0,0,10,"name",o)})).subscribe(t=>{this.defaultLabelsSuggestions.set(t.items)})}searchDefaultLabels(t){if(T(t)){this.defaultLabelsSuggestions.set([]);return}this.defaultLabelsSuggestions.set(void 0),this.searchDefaultLabelsSubject.next(t)}updateFormFields(){let t=this.entity();this.formFields=[mt("defaultLabels","Asset Rating",t?.ratingProfile?.name,this.defaultLabelsSuggestions(),this.searchDefaultLabels.bind(this),{layout:"horizontal",labelWidth:"1/3",name:"defaultLabels",props:{appendTo:"body",multiple:!1,field:"name",typeahead:!0,showEmptyMessage:!0,emptyMessage:"No labels found",completeOnFocus:!1}})]}submitChanges(t){let e=this.entity();T(e)||this.entitiesService.updateAsset(e.id,t).pipe(W(this.destroyRef)).subscribe({next:()=>{this.isFormEditable.set(!1),this.isSubmitting.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"asset",entityId:e.id})},error:()=>{this.isFormEditable.set(!0),this.isSubmitting.set(!1)}})}searchLabel(t){if(ce(t)){this.labels.set(this.labels());return}let e=this.labels().filter(i=>((i.name?.toLowerCase().includes(t.toLowerCase())??!1)||(i.label?.toLowerCase().includes(t.toLowerCase())??!1))??!1);this.labels.set(e)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-labels-section"]],features:[O],decls:12,vars:6,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-tag","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","fields","actions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Default Labels"),s(),h(7,Ap,2,1,"div",6),s(),l(8,"span"),D(9,"Configure labels that will be applied to data from this asset by default."),s()()(),h(10,kp,1,2,"app-dynamic-form",7)(11,Op,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(4,Rp,i.isFormEditable())),I("aria-label","tag icon"),d(5),y(i.isFormEditable()?-1:7),d(3),y(i.isFormEditable()?10:11))},dependencies:[L,z,K,V,q],encapsulation:2})};var Pp=n=>({"icon-primary":n});function Vp(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit"))}function Lp(n,t){if(n&1&&(l(0,"div",7)(1,"p-message",11),C(2,"span",12),D(3),s()()),n&2){let e=a();d(3),ye(" ",e.warning()," ")}}function Np(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",13),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)}}function Gp(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.assetDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Ji=class n extends B{counterType=E("hours");location=E(null);entitiesService=c(P);measurementsService=c(pt);assetLocation=R(null);assetIdSource=new st;warning=v(()=>{let t=this.assetLocation();return t&&t.countersAvailable==!1?"Counter values are currently unavailable and cannot be updated. This may be because the asset has no device assigned or telemetry data is not available.":null});canEdit=v(()=>this.assetLocation()?.countersAvailable===!0);formatDateString(t){if(!f(t))return"";try{let e=new Date(t);return Number.isNaN(e.getTime())?"Invalid Date":e.toLocaleDateString(void 0,{weekday:"long",day:"numeric",month:"long"})}catch(e){return console.error("Error parsing date:",e),"Invalid Date"}}toDisplayValue(t){return this.counterType()==="odometer"?this.measurementsService.fromBackend("distance",t,4):this.counterType()==="hours"?Math.round(t*10)/10:t}toBackendValue(t){let e=Number(t);return this.counterType()==="odometer"?Number(this.measurementsService.toBackend("distance",e,4)):this.counterType()==="hours"?Math.round(e*10)/10:e}getCounterLabel(){return this.counterType()==="odometer"?"Odometer":"Engine Hours"}assetDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.assetLocation();if(!e?.counters||ce(e.counters))return[];let i=e.counters[this.counterType()]??0,o=this.toDisplayValue(i),r=this.formatDateString(e.date);return[{key:this.getCounterLabel(),value:o},{key:"Date",value:r}]});title=v(()=>this.counterType()==="odometer"?"Odometer":"Engine Hours");constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],this.assetIdSource.pipe(Be(e=>(this.assetLocation.set(null),this.entitiesService.getAssetLocation(e).pipe(lt(()=>(this.assetLocation.set(null),Dt))))),W()).subscribe(e=>{this.assetLocation.set(e)});let t;U(()=>{let e=this.location();if(f(e)){_e(()=>this.assetLocation.set(e));return}let o=this.entity()?.id;f(o)&&o!==t&&(t=o,this.assetIdSource.next(o))}),U(()=>{let e=this.entity(),i=this.assetLocation();e&&i&&this.updateFormFields()})}updateFormFields(){let t=this.assetLocation(),e=t?.counters?.[this.counterType()]??0,i=this.toDisplayValue(e),o=t?.date,r=f(o)?new Date(o):null;this.formFields=[ie("value",this.getCounterLabel(),i,{name:"value",props:{suffix:this.counterType()==="odometer"?this.measurementsService.getUnitConfig("distance"):"hours",maxFractionDigits:4}}),tt("date","Date",r,{name:"date",props:{showTime:!0,timeOnly:!1,dateFormat:"mm/dd/yy",hourFormat:"24",showIcon:!0,appendTo:"body"}})]}submitChanges(t){let e=this.entity();if(T(e))return;let i=this.transformFormData(t);this.entitiesService.updateAsset(e.id,{counterValues:{[this.counterType()]:i}}).pipe(W(this.destroyRef),Pt(()=>this.isSubmitting.set(!1))).subscribe({next:()=>{this.isFormEditable.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"asset",entityId:e.id})},error:()=>{this.isFormEditable.set(!0)}})}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);return f(e.value)&&(e.value=this.toBackendValue(e.value)),e.date instanceof Date&&(e.date=e.date.toISOString()),e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-counter-type-section"]],inputs:{counterType:[1,"counterType"],location:[1,"location"]},features:[O],decls:14,vars:11,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-tag","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[1,"mb-4"],[3,"fields","actions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],["severity","warn"],[1,"pi","pi-exclamation-triangle","mr-2"],[3,"formSubmit","fields","actions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6),s(),h(7,Vp,2,1,"div",6),s(),l(8,"span"),D(9),Vi(10,"lowercase"),s()()(),h(11,Lp,4,1,"div",7),h(12,Np,1,2,"app-dynamic-form",8)(13,Gp,1,4,"app-grid",9),s()),e&2&&(d(2),g("ngClass",N(9,Pp,i.isFormEditable())),I("aria-label","tag icon"),d(4),J(i.title()),d(),y(!i.isFormEditable()&&i.canEdit()?7:-1),d(2),ye("Adjust the ",Li(10,7,i.title())," below"),d(2),y(i.warning()?11:-1),d(),y(i.isFormEditable()?12:13))},dependencies:[L,z,K,X,se,V,q,bs],encapsulation:2})};var qp=n=>({"icon-primary":n});function Up(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit entity details"))}function zp(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function jp(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.entityDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Di=class n extends B{entitiesService=c(P);adminStateService=c(pi);cacheService=c(Re);accountsService=c(me);cdr=c(Me);customFieldsResource=Cs({params:()=>({request:this.adminStateService.selectedClient()?.id}),loader:({params:t})=>{let e=t.request;return T(e)?Ce(re([])):Ce(this.cacheService.getOrFetch(`custom-fields-${e}`,()=>this.accountsService.getClient(e)).pipe(Ve(i=>{let o=this.entity();return[...i?.customFields?.[this.entityType()]??[],...(o?.assetType&&i?.customFields?.[o.assetType.id])??[]]})))}});entityCustomFields=R([]);entityDetails=v(()=>{let t=this.entity(),e=this.adminStateService.selectedClient();return T(t)||T(e)?[]:this.entityCustomFields().map(i=>({key:i.title,value:t.fields?.[i.id]??"None"}))});constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.customFieldsResource.value(),e=this.entity();t&&e&&(this.entityCustomFields.set(t),_e(()=>{this.updateFormFields(),this.cdr.detectChanges()}))})}updateFormFields(){let t=this.entity();this.formFields=this.entityCustomFields().map(e=>this.createFormField(e,t))}createFormField(t,e){let i=e?.fields?.[t.id],o=this.formatFieldValue(i);switch(t.type){case"number":return this.createNumberFieldConfig(t,o);case"combo":return this.createDropdownFieldConfig(t,o);case"memo":return this.createTextAreaFieldConfig(t,o);case"checkbox":return this.createToggleSwitchFieldConfig(t,o);case"date":return this.createDateFieldConfig(t,e,!1);case"datetime":return this.createDateFieldConfig(t,e,!0);default:return this.createTextFieldConfig(t,o)}}formatFieldValue(t){return f(t)?typeof t=="object"?JSON.stringify(t):t:""}getFieldValidations(t){return t.required?[{name:"required",validator:w.required,message:`${t.title} is required`}]:[]}createNumberFieldConfig(t,e){return ie(String(t.id),String(t.title),e,{name:String(t.id),validations:this.getFieldValidations(t)})}createDropdownFieldConfig(t,e){return H(String(t.id),String(t.title),t.values?.map(i=>({label:String(i.key),value:String(i.value)}))??[],e,{name:String(t.id),validations:this.getFieldValidations(t)})}createTextAreaFieldConfig(t,e){return Ge(String(t?.id),String(t.title),e,{name:String(t?.id),validations:this.getFieldValidations(t),hint:t.description})}createToggleSwitchFieldConfig(t,e){return _t(t.id,t.title,e,{name:t.id,validations:this.getFieldValidations(t),hint:t.description})}createDateFieldConfig(t,e,i){return tt(t.id,t.title,e?.fields?.[t.id],{name:t.id,validations:this.getFieldValidations(t),hint:t.hint,props:{showTime:i,timeOnly:!1,dateFormat:"mm/dd/yy",hourFormat:"24",showIcon:!0,appendTo:"body"}})}createTextFieldConfig(t,e){return k(String(t.id),String(t.title),e,{name:String(t.id),validations:this.getFieldValidations(t)})}getUpdateMethod(){switch(this.entityType()){case"asset":return(t,e)=>this.entitiesService.updateAsset(t,{fields:e});case"simcard":return(t,e)=>this.entitiesService.updateSimCard(t,{fields:e});case"device":return(t,e)=>this.entitiesService.updateDevice(t,{fields:e});case"assettag":return(t,e)=>this.entitiesService.updateAssetTag(t,e);default:throw new Error(`Update for '${this.entityType()}' not yet supported`)}}onFormValueChange(t){let e={fields:t};this.formValueChange.emit(e)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-info-section"]],features:[O],decls:13,vars:8,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"custom-icon-svg","w-[2.5rem]","h-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),ht(),l(2,"svg",2),C(3,"use"),s(),Zt(),l(4,"div",3)(5,"div",4)(6,"h2",5),D(7,"Information"),s(),h(8,Up,2,1,"div",6),s(),l(9,"span"),D(10,"The following supplemental information is required."),s()()(),h(11,zp,1,3,"app-dynamic-form",7),h(12,jp,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(6,qp,i.isFormEditable())),I("aria-label","Book open icon"),d(),I("href","assets/sprites/sprite.svg#book-open-solid"),d(5),y(!i.isFormEditable()&&!i.createMode()?8:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?11:-1),d(),y(!i.isFormEditable()&&!i.createMode()?12:-1))},dependencies:[L,z,K,V,q],encapsulation:2})};var Bp=n=>({"icon-primary":n});function Hp(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit asset profiles"))}function $p(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)}}function Wp(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.assetDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Xn=class n extends Bt{entitiesService=c(P);utilityService=c(he);assetDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Geofences",value:(t.zones??[])?.length>0?t.zones?.map(e=>e.targetName).join(", "):"None"},{key:"Borders",value:t.parameters?.borders?.map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(", ")??"None"}]:[]});requestMapper;faRoute=Vl;constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.entity()&&(this.initializeRequestMapper(),this.updateFormFields())})}initializeRequestMapper(){this.requestMapper=new Rt({zones:{requestProperty:"zones",transform:t=>t.map(i=>({zoneType:i.zoneType??"location",targetSelectionType:i.actorSelectionType==="group"?"group":"specific",targetId:i.actorId,targetName:i.actorName}))},borders:{requestProperty:"parameters",transform:t=>({borders:t})}})}updateFormFields(){let t=this.entity(),e=(t?.zones??[]).map(i=>({actorId:i.targetId??"",actorName:i.targetName??"",actorSelectionType:i.targetSelectionType==="group"?"group":"specific",actorType:"zone",actorTypeId:i.zoneType??"location",actorTypeName:"Zone",text:i.targetName??"",zoneType:i.zoneType}));this.formFields=[Qs("zones","Zones",e,{layout:"horizontal",labelWidth:"1/3",name:"zones",props:{ownerId:t?.owner?.id,multi:!0}}),rt("borders","Borders",t?.parameters?.borders??[],[{label:"Country",value:"country"},{label:"State",value:"state"}],{name:"borders",layout:"horizontal",labelWidth:"1/3",props:{checkbox:!0,multiple:!0}})]}getUpdateMethod(){return(t,e)=>this.entitiesService.updateAsset(t,e)}transformFormData(t){if(!this.requestMapper)throw new Error("Request mapper not initialized");try{let e=Array.isArray(t)?t.reduce((r,u)=>M(M({},r),u),{}):t,i=this.requestMapper.transform(e),o={};for(let r in i)if(Object.hasOwn(i,r)){let u=i[r];u!=null&&(o[r]=u)}return o}catch(e){throw console.error("Form data transformation failed:",e),e}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-zones-section"]],features:[O],decls:12,vars:6,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","fields","actions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Geographic Triggers"),s(),h(7,Hp,2,1,"div",6),s(),l(8,"span"),D(9," Trigger geographic events based on geofence, route and border changes."),s()()(),h(10,$p,1,2,"app-dynamic-form",7)(11,Wp,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faRoute)("ngClass",N(4,Bp,i.isFormEditable())),d(5),y(i.isFormEditable()?-1:7),d(3),y(i.isFormEditable()?10:11))},dependencies:[L,z,V,q,te,ne],encapsulation:2})};var eo=class n{createAssetInformationSections(t){return[{id:"asset-details",title:"Asset Details",component:qn,componentInputs:{entity:t},category:"information",order:10},{id:"asset-categories",title:"Categories",component:zn,componentInputs:{entity:t},category:"information",order:20},{id:"asset-information",title:"Asset Information",component:Di,componentInputs:{entity:t,dataPath:"customFields",entityType:"asset"},category:"information",order:30},{id:"asset-contacts",title:"Contacts",component:jn,componentInputs:{entity:t},category:"information",order:40}]}createAssetSettingsSections(t,e){return[{id:"profiles",title:"Profiles",component:Bn,componentInputs:{entity:t},category:"settings",order:10},{id:"asset-sharing",title:"Sharing",component:Hn,componentInputs:{entity:t},category:"settings",order:20},...f(e)?[{id:"asset-odometer",title:"Odometer",component:Ji,componentInputs:{entity:t,counterType:"odometer",location:e},category:"settings",order:30}]:[],...f(e)?[{id:"asset-hours",title:"Engine Hours",component:Ji,componentInputs:{entity:t,counterType:"hours",location:e},category:"settings",order:40}]:[],{id:"asset-reminders",title:"Reminders",component:Kn,componentInputs:{entity:t},category:"settings",order:50},{id:"asset-default-labels",title:"Default Labels",component:Jn,componentInputs:{entity:t},category:"settings",order:60}]}createAssetEventsSections(t){return[{id:"asset-event-triggers",title:"Event Triggers",component:$n,componentInputs:{entity:t},category:"events",order:10},{id:"asset-curfew-events",title:"Working Hours",component:Yn,componentInputs:{entity:t},category:"events",order:20},{id:"asset-analog-triggers",title:"Analog Triggers",component:Qn,componentInputs:{entity:t},category:"events",order:30},{id:"asset-zone-triggers",title:"Geographic Triggers",component:Xn,componentInputs:{entity:t},category:"events",order:40}]}createChangesSection(t){return[{id:"asset-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllAssetSections(t,e){return[...this.createAssetInformationSections(t),...this.createAssetSettingsSections(t,e),...this.createAssetEventsSections(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Zp=(n,t)=>t.key,Kp=(n,t)=>t.id;function Qp(n,t){n&1&&ot(0)}function Yp(n,t){n&1&&C(0,"p-divider")}function Jp(n,t){if(n&1&&(ae(0,Qp,1,0,"ng-container",4),h(1,Yp,1,0,"p-divider")),n&2){let e=t.$implicit,i=t.$index,o=t.$count,r=a(2);g("ngComponentOutlet",e.component)("ngComponentOutletInputs",r.getSectionInputs(e)),d(),y(i!==o-1?1:-1)}}function Xp(n,t){if(n&1&&(l(0,"p-accordion-panel",2)(1,"p-accordion-header")(2,"span",3),D(3),s()(),l(4,"p-accordion-content"),Ue(5,Jp,2,3,null,null,Kp),s()()),n&2){let e=t.$implicit,i=a();g("value",e.key),d(3),J(e.label),d(2),ze(i.getSections(e.key))}}var ue=class n{sections=E([]);entity=E(null);title=E("Details");subtitle=E("");allowModeToggle=E(!0);initialMode=E("view");layout=E(null);entityChange=ct();unsavedChangesService=c(ql);accordionValue=R("information");_sectionInputsCache=new Map;constructor(){U(()=>{this.entity();let t=this.sections();this._clearStaleCache(t)}),U(()=>{let e=this.layout()?.defaultExpandedCategory;f(e)&&e.trim()!==""&&this.accordionValue.set(e)})}_clearStaleCache(t){let e=new Set(t.map(o=>o.id)),i=Array.from(this._sectionInputsCache.keys());for(let o of i){let r=o.replace("_inputs","");e.has(r)||this._sectionInputsCache.delete(o)}}async handleAccordionChange(t){await this.unsavedChangesService.checkUnsavedChanges()&&this.accordionValue.set(t)}informationSections=v(()=>this.visibleSections().filter(t=>t.category==="information"||T(t.category)).sort((t,e)=>(t.order??0)-(e.order??0)));settingsSections=v(()=>this.visibleSections().filter(t=>t.category==="settings").sort((t,e)=>(t.order??0)-(e.order??0)));statisticsSections=v(()=>this.visibleSections().filter(t=>t.category==="statistics").sort((t,e)=>(t.order??0)-(e.order??0)));eventsSections=v(()=>this.visibleSections().filter(t=>t.category==="events").sort((t,e)=>(t.order??0)-(e.order??0)));customSections=v(()=>this.visibleSections().filter(t=>t.category==="custom").sort((t,e)=>(t.order??0)-(e.order??0)));ioSections=v(()=>this.visibleSections().filter(t=>t.category==="io").sort((t,e)=>(t.order??0)-(e.order??0)));accessoriesSections=v(()=>this.visibleSections().filter(t=>t.category==="accessories").sort((t,e)=>(t.order??0)-(e.order??0)));feedSections=v(()=>this.visibleSections().filter(t=>t.category==="feed").sort((t,e)=>(t.order??0)-(e.order??0)));controlsSections=v(()=>this.visibleSections().filter(t=>t.category==="controls").sort((t,e)=>(t.order??0)-(e.order??0)));assetsSections=v(()=>this.visibleSections().filter(t=>t.category==="assets").sort((t,e)=>(t.order??0)-(e.order??0)));usersSections=v(()=>this.visibleSections().filter(t=>t.category==="users").sort((t,e)=>(t.order??0)-(e.order??0)));featureSections=v(()=>this.visibleSections().filter(t=>t.category==="features").sort((t,e)=>(t.order??0)-(e.order??0)));customizationSections=v(()=>this.visibleSections().filter(t=>t.category==="customization").sort((t,e)=>(t.order??0)-(e.order??0)));backendSections=v(()=>this.visibleSections().filter(t=>t.category==="backend").sort((t,e)=>(t.order??0)-(e.order??0)));visibleSections=v(()=>this.sections().filter(t=>typeof t.visible=="function"?t.visible(this.entity())===!0:t.visible!==!1));sortedCategories=v(()=>{let t=this.layout();return t?.categories?t.categories.filter(e=>typeof e.visible=="function"?e.visible(this.entity()):typeof e.visible=="boolean"?e.visible:this.hasSections(e.key)).sort((e,i)=>e.order-i.order):this.defaultSectionTypes().filter(e=>this.hasSections(e.key))});defaultSectionTypes=v(()=>[{key:"information",label:"Information",order:10},{key:"settings",label:"Settings",order:20},{key:"events",label:"Events",order:30},{key:"statistics",label:"Statistics",order:40},{key:"io",label:"IO",order:50},{key:"accessories",label:"Accessories",order:60},{key:"controls",label:"Controls",order:70},{key:"assets",label:"Assets",order:80},{key:"users",label:"Users",order:90},{key:"features",label:"Features",order:100},{key:"customization",label:"Email Customization",order:110},{key:"feed",label:"Changes",order:120},{key:"backend",label:"Backend",order:130},{key:"custom",label:"Custom",order:140}]);getSections(t){switch(t){case"information":return this.informationSections();case"settings":return this.settingsSections();case"events":return this.eventsSections();case"statistics":return this.statisticsSections();case"io":return this.ioSections();case"accessories":return this.accessoriesSections();case"controls":return this.controlsSections();case"feed":return this.feedSections();case"custom":return this.customSections();case"assets":return this.assetsSections();case"users":return this.usersSections();case"features":return this.featureSections();case"customization":return this.customizationSections();case"backend":return this.backendSections();default:return[]}}hasSections(t){let e=this.getSections(t);return f(e)&&e.length>0}getSectionInputs(t){let e=`${t.id}_inputs`,i=ee(M({},t.componentInputs),{onEntityChange:r=>{this.entityChange.emit(r)}}),o=this._sectionInputsCache.get(e);return!o||this._hasInputsChanged(o,i)?(this._sectionInputsCache.set(e,i),i):o}_hasInputsChanged(t,e){let i=Object.keys(t).filter(r=>r!=="onEntityChange"),o=Object.keys(e).filter(r=>r!=="onEntityChange");return i.length!==o.length?!0:i.some(r=>t[r]!==e[r])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-details-accordion-container"]],inputs:{sections:[1,"sections"],entity:[1,"entity"],title:[1,"title"],subtitle:[1,"subtitle"],allowModeToggle:[1,"allowModeToggle"],initialMode:[1,"initialMode"],layout:[1,"layout"]},outputs:{entityChange:"entityChange"},decls:4,vars:2,consts:[[1,"p-3","bg-surface-card","rounded-md","shadow-sm","h-full","flex","flex-col","overflow-hidden"],[3,"valueChange","value","multiple"],[3,"value"],[1,"uppercase"],[4,"ngComponentOutlet","ngComponentOutletInputs"]],template:function(e,i){if(e&1&&(l(0,"div",0)(1,"p-accordion",1),_("valueChange",function(r){return i.handleAccordionChange(r)}),Ue(2,Xp,7,2,"p-accordion-panel",2,Zp),s()()),e&2){let o;d(),g("value",i.accordionValue())("multiple",((o=i.layout())==null?null:o.allowMultipleExpanded)??!1),d(),ze(i.sortedCategories())}},dependencies:[L,ln,Ut,qt,Gt,hi,yi,Et,vi,K,vt],styles:["[_nghost-%COMP%]{display:block;height:100%}  p-accordion,   .p-accordion{display:flex!important;flex-direction:column!important;height:100%!important}  p-accordion-panel,   .p-accordionpanel{display:flex!important;flex-direction:column!important;flex:0 0 auto!important}  p-accordion-panel.p-accordionpanel-active,   p-accordion-panel.p-highlight,   .p-accordionpanel.p-accordionpanel-active,   .p-accordionpanel.p-highlight{flex:1 1 auto!important;min-height:0!important;overflow:hidden!important}  p-accordion-header,   .p-accordionheader{flex:0 0 auto!important;z-index:10}  p-accordion-content,   .p-accordioncontent{flex:1 1 auto!important;overflow-y:auto!important;height:100%!important}  p-accordion-content .p-accordioncontent-content,   .p-accordioncontent .p-accordioncontent-content{min-height:100%}"],changeDetection:0})};var Y=class n{showPanel=R(!1);selectedItem=R(null);detailsComponent=R(null);detailsInputs=R({});isLoading=R(!1);activePopover=R(null);detailsFactory=c(bi);broadcastService=c(we);destroyRef=c(Ne);router=c(Ds);injector=c(ms);selectedItemTitle=v(()=>{let t=this.selectedItem();return T(t)?"Details":f(t.name)&&Ye(t.name)?t.name:f(t.entityType)&&Ye(t.entityType)?`${this.formatEntityType(t.entityType)} Details`:"Item Details"});selectedItemType=v(()=>{let t=this.selectedItem();return t?String(t.entityType):""});selectedItemId=v(()=>{let t=this.selectedItem();return t?String(t.id):""});getSelectedItemTitle(){return this.selectedItemTitle()}getSelectedItemType(){return this.selectedItemType()}getSelectedItemId(){return this.selectedItemId()}constructor(){this.broadcastService.on("entity-updated").pipe(W(this.destroyRef)).subscribe(t=>{let e=this.selectedItem();e&&e.id===t.data?.id&&this.refreshSelectedItem(t.data)}),this.broadcastService.on("entity-deleted").pipe(W(this.destroyRef)).subscribe(t=>{let e=this.selectedItem(),i=t;e&&e.id===i.entityId&&this.closeDetailsPanel()})}refreshSelectedItem(t){this.selectedItem()&&this.selectedItem.set(t)}softRefreshSelectedItem(t){if(!this.selectedItem())return;this.isLoading.set(!0);let i=this.selectedItemType(),o=this.selectedItemId();i&&o?import("./chunk-CPDZ447U.js").then(({EntityDetailsLoaderService:r})=>{this.injector.get(r).softLoadEntityDetailsObservable(i,o).pipe(W(this.destroyRef)).subscribe({next:b=>{if(f(b)){this.selectedItem.set(b);let x=this.detailsInputs();f(x)?(x.entity=b,this.detailsInputs.set(x)):this.detailsInputs.set({entity:b})}this.isLoading.set(!1)},error:()=>this.isLoading.set(!1)})}).catch(()=>this.isLoading.set(!1)):this.isLoading.set(!1)}isSoftRefreshing=v(()=>this.isLoading()&&this.selectedItem()!==null);openDetailsPanel(t,e){this.selectedItem.set(t);let i=e??this.detailsFactory.getDetailsComponent(String(t.entityType));this.detailsComponent.set(i),this.detailsInputs.set({entity:t}),this.showPanel.set(!0)}closeDetailsPanel(){this.showPanel.set(!1),this.selectedItem.set(null),this.detailsComponent.set(null),this.detailsInputs.set({})}formatEntityType(t){return t?t.replaceAll(/[-_]/g," ").replaceAll(/\w\S*/g,e=>e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()):"Item"}updateEntity(t){let e=M({},t);this.selectedItem.set(e),this.detailsInputs.set({entity:e}),this.isLoading()&&this.isLoading.set(!1)}togglePopover(t){this.activePopover()===t?this.activePopover.set(null):this.activePopover.set(t)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};function eu(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullAsset())("title",((e=i.fullAsset())==null?null:e.name)||"Asset Details")("allowModeToggle",!0)}}function tu(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function iu(n,t){if(n&1&&h(0,eu,1,4,"app-details-accordion-container",0)(1,tu,2,0,"div",1),n&2){let e=a();y(e.fullAsset()?0:1)}}var to=class n{entity=E(null);assetSectionFactory=c(eo);entitiesService=c(P);destroyRef=c(Ne);entityDetailsState=c(Y);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullAsset());fullAsset=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});assetLocation=R(null);sections=v(()=>{let t=this.fullAsset();if(!t)return[];let e=this.assetLocation();return this.assetSectionFactory.createAllAssetSections(t,e)});error=R(null);constructor(){U(()=>{let t=this.fullAsset();f(t?.id)&&this.loadAssetLocation(t.id)})}loadAssetLocation(t){this.entitiesService.getAssetLocation(t).pipe(W(this.destroyRef)).subscribe(e=>{this.assetLocation.set(e)})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Asset","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Asset","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No asset details available."]],template:function(e,i){e&1&&h(0,iu,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function nu(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullSimCard())("title",((e=i.fullSimCard())==null?null:e.name)||"Sim Card Details")("allowModeToggle",!0)}}function ou(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function ru(n,t){if(n&1&&h(0,nu,1,4,"app-details-accordion-container",0)(1,ou,2,0,"div",1),n&2){let e=a();y(e.fullSimCard()?0:1)}}var io=class n{entity=E(null);simCardSectionFactory=c(no);entityDetailsState=c(Y);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullSimCard());fullSimCard=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullSimCard();return t?this.simCardSectionFactory.createAllSimCardSections(t):[]});error=R(null);onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-sim-card-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Sim Card","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Sim Card","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No sim card details available."]],template:function(e,i){e&1&&h(0,ru,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function au(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullAssetTag())("title",((e=i.fullAssetTag())==null?null:e.name)||"Asset Tag Details")("allowModeToggle",!0)}}function su(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function lu(n,t){if(n&1&&h(0,au,1,4,"app-details-accordion-container",0)(1,su,2,0,"div",1),n&2){let e=a();y(e.fullAssetTag()?0:1)}}var oo=class n{entity=E(null);assetTagSectionFactory=c(ro);entityDetailsState=c(Y);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullAssetTag());fullAssetTag=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullAssetTag();return t?this.assetTagSectionFactory.createAllAssetTagSections(t):[]});error=R(null);onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-tag-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Asset Tag","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Asset Tag","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No asset tag details available."]],template:function(e,i){e&1&&h(0,lu,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function du(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullDeviceConfigProfile())("title",((e=i.fullDeviceConfigProfile())==null?null:e.name)||"Device Config Profile Details")("allowModeToggle",!0)}}function cu(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function mu(n,t){if(n&1&&h(0,du,1,4,"app-details-accordion-container",0)(1,cu,2,0,"div",1),n&2){let e=a();y(e.fullDeviceConfigProfile()?0:1)}}var ao=class n{entity=E(null);deviceConfigProfileSectionFactory=c(so);entityDetailsState=c(Y);entitiesService=c(P);operationRegistry=c(Q);cacheService=c(Re);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullDeviceConfigProfile());fullDeviceConfigProfile=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullDeviceConfigProfile(),e=this.deviceType(),i=this.ioTypes();return t||e||f(i)?this.deviceConfigProfileSectionFactory.createAllDeviceConfigProfileSections(t,this.deviceTypeAccessories(),e,i):[]});error=R(null);deviceTypeAccessories=R(void 0);deviceType=R(null);ioTypes=R([]);constructor(){this.operationRegistry.registerEntityOperations("device-config-profile",{update:(t,e)=>this.entitiesService.updateDeviceConfigProfile(t,e),create:t=>this.entitiesService.createDeviceConfigProfile(t),get:t=>this.entitiesService.getDeviceConfigProfile(t)}),this.operationRegistry.registerEntityOperations("device",{update:(t,e)=>this.entitiesService.updateDeviceConfigProfile(t,e),create:t=>Dt,get:t=>Dt}),U(()=>{let t=this.fullDeviceConfigProfile();t&&(this.loadDeviceType(t.deviceType?.id??"").catch(e=>{this.error.set(e.message)}),this.loadIoTypes().catch(e=>{this.error.set(e.message)}))})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}async loadDeviceType(t){let e=this.entity()?.owner?.id;!t||T(e)||await this.cacheService.getOrFetchAsync(`deviceType-${t}-${e}`,()=>Ce(this.entitiesService.getDeviceType(t,e)),3e5).then(i=>{this.deviceType.set(i),this.deviceTypeAccessories.set(i.accessories)})}async loadIoTypes(){let t=this.entity()?.owner?.id;T(t)||await this.cacheService.getOrFetchAsync(`ioTypes-${t}`,()=>Ce(this.entitiesService.listIoTypes(t,!0,0,300)),3e5).then(e=>{this.ioTypes.set(e.items)})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-config-profile-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Device Config Profile","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Device Config Profile","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No device config profile details available."]],template:function(e,i){e&1&&h(0,mu,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function pu(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullDevice())("title",((e=i.fullDevice())==null?null:e.name)||"Device Details")("allowModeToggle",!0)}}function uu(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function fu(n,t){if(n&1&&h(0,pu,1,4,"app-details-accordion-container",0)(1,uu,2,0,"div",1),n&2){let e=a();y(e.fullDevice()?0:1)}}var lo=class n{entity=E(null);deviceSectionFactory=c(co);entityDetailsState=c(Y);entitiesService=c(P);operationRegistry=c(Q);cacheService=c(Re);broadcastService=c(we);toastService=c(Ze);destroyRef=c(Ne);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullDevice());fullDevice=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullDevice(),e=this.deviceType(),i=this.ioTypes();return t||e||f(i)?this.deviceSectionFactory.createAllDeviceSections(t,this.deviceTypeAccessories(),e,i):[]});error=R(null);deviceTypeAccessories=R(void 0);deviceType=R(null);ioTypes=R([]);isEntityUpdatedMessage(t){return f(t)&&t!==null&&typeof t=="object"&&"entityType"in t&&"data"in t&&t.entityType==="device"}constructor(){this.operationRegistry.registerEntityOperations("device",{update:(t,e)=>this.entitiesService.updateDevice(t,e),create:t=>this.entitiesService.createDevice(t),get:t=>this.entitiesService.getDevice(t)}),U(()=>{let t=this.fullDevice();t&&(this.loadDeviceType(t.deviceType?.id??"").catch(e=>{this.error.set(e.message)}),this.loadIoTypes().catch(e=>{this.error.set(e.message)}))})}ngOnInit(){this.broadcastService.on("entity-updated").pipe(W(this.destroyRef)).subscribe(t=>{this.isEntityUpdatedMessage(t)&&(this.toastService.showSuccess("Success","Device updated successfully"),this.onEntityChange(t.data))})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}async loadDeviceType(t){let e=this.entity()?.owner?.id;!t||T(e)||await this.cacheService.getOrFetchAsync(`deviceType-${t}-${e}`,()=>Ce(this.entitiesService.getDeviceType(t,e)),3e5).then(i=>{this.deviceType.set(i),this.deviceTypeAccessories.set(i.accessories)})}async loadIoTypes(){let t=this.entity()?.owner?.id;T(t)||await this.cacheService.getOrFetchAsync(`ioTypes-${t}`,()=>Ce(this.entitiesService.listIoTypes(t,!0,0,300)),3e5).then(e=>{this.ioTypes.set(e.items)})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Device","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Device","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No device details available."]],template:function(e,i){e&1&&h(0,fu,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function gu(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullGeofence())("title",((e=i.fullGeofence())==null?null:e.name)||"Geofence Details")("allowModeToggle",!0)}}function hu(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function yu(n,t){if(n&1&&h(0,gu,1,4,"app-details-accordion-container",0)(1,hu,2,0,"div",1),n&2){let e=a();y(e.fullGeofence()?0:1)}}var mo=class n{entity=E(null);geofenceSectionFactory=c(po);entityDetailsState=c(Y);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullGeofence());fullGeofence=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullGeofence();return t?this.geofenceSectionFactory.createAllGeofenceSections(t):[]});error=R(null);onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-geofence-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Geofence","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Geofence","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No geofence details available."]],template:function(e,i){e&1&&h(0,yu,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function vu(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullDeviceProvider())("title",((e=i.fullDeviceProvider())==null?null:e.name)||"Device Provider Details")("allowModeToggle",!0)}}function Cu(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function _u(n,t){if(n&1&&h(0,vu,1,4,"app-details-accordion-container",0)(1,Cu,2,0,"div",1),n&2){let e=a();y(e.fullDeviceProvider()?0:1)}}var uo=class n{entity=E(null);deviceProviderSectionFactory=c(fo);entityDetailsState=c(Y);entitiesService=c(P);operationRegistry=c(Q);cacheService=c(Re);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullDeviceProvider());fullDeviceProvider=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullDeviceProvider(),e=this.deviceProviderType();return t||f(e)?this.deviceProviderSectionFactory.createAllDeviceProviderSections(t,e):[]});error=R(null);deviceProviderType=R(null);constructor(){this.operationRegistry.registerEntityOperations("device-provider",{update:(t,e)=>this.entitiesService.updateDeviceProvider(t,e),create:t=>this.entitiesService.createDeviceProvider(t),get:t=>this.entitiesService.getDeviceProvider(t)}),U(()=>{let t=this.fullDeviceProvider();f(t?.deviceProviderType?.id)&&this.loadDeviceProviderType(t?.deviceProviderType?.id??"").catch(e=>{this.error.set(e.message)})})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}async loadDeviceProviderType(t){await this.cacheService.getOrFetchAsync(`deviceProviderType-${t}`,()=>Ce(this.entitiesService.getDeviceProviderType(t)),3e5).then(e=>{this.deviceProviderType.set(e)})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-provider-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Device Provider","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Device Provider","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No device provider details available."]],template:function(e,i){e&1&&h(0,_u,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function bu(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullSmsGatewayProvider())("title",((e=i.fullSmsGatewayProvider())==null?null:e.name)||"SMS Gateway Provider Details")("allowModeToggle",!0)}}function Su(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function Du(n,t){if(n&1&&h(0,bu,1,4,"app-details-accordion-container",0)(1,Su,2,0,"div",1),n&2){let e=a();y(e.fullSmsGatewayProvider()?0:1)}}var go=class n{entity=E(null);smsGatewayProviderSectionFactory=c(ho);entityDetailsState=c(Y);entitiesService=c(P);operationRegistry=c(Q);cacheService=c(Re);apiSchemaService=c(bt);entityName="smsgatewayprovider";isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullSmsGatewayProvider());fullSmsGatewayProvider=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullSmsGatewayProvider(),e=this.smsGatewayProviderType();return t||f(e)?this.smsGatewayProviderSectionFactory.createAllSmsGatewayProviderSections(t,e):[]});error=R(null);smsGatewayProviderType=R(null);constructor(){this.operationRegistry.registerEntityOperations("sms-gateway-provider",{update:(t,e)=>this.entitiesService.updateSmsGatewayProvider(t,e),create:t=>this.entitiesService.createSmsGatewayProvider(t),get:t=>this.entitiesService.getSmsGatewayProvider(t)}),U(()=>{let t=this.fullSmsGatewayProvider(),e=null;t&&(e=this.apiSchemaService.getEntityType(t,this.entityName)?.id),f(e)&&e!==""?this.loadSmsGatewayProviderType(e).catch(i=>{this.error.set(i.message??"Failed to load SMS gateway provider type")}):t&&(T(e)||e==="")&&this.smsGatewayProviderType.set(null)})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}async loadSmsGatewayProviderType(t){if(!t){this.smsGatewayProviderType.set(null);return}await this.cacheService.getOrFetchAsync(`smsGatewayProviderType-${t}`,()=>Ce(this.entitiesService.getSmsGatewayProviderType(t)),3e5).then(e=>{this.smsGatewayProviderType.set(e)})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-sms-gateway-provider-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","SMS Gateway Provider","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","SMS Gateway Provider","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No SMS gateway provider details available."]],template:function(e,i){e&1&&h(0,Du,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function Tu(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullIoType())("title",((e=i.fullIoType())==null?null:e.name)||"IO Type Details")("allowModeToggle",!0)}}function wu(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function xu(n,t){if(n&1&&h(0,Tu,1,4,"app-details-accordion-container",0)(1,wu,2,0,"div",1),n&2){let e=a();y(e.fullIoType()?0:1)}}var yo=class n{entity=E(null);ioTypeSectionFactory=c(vo);entityDetailsState=c(Y);broadcastService=c(we);toastService=c(Ze);destroyRef=c(Ne);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullIoType());fullIoType=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullIoType();return t?this.ioTypeSectionFactory.createAllIoTypeSections(t):[]});error=R(null);isEntityUpdatedMessage(t){return f(t)&&t!==null&&typeof t=="object"&&"entityType"in t&&"data"in t&&t.entityType==="iotype"}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}ngOnInit(){this.broadcastService.on("entity-updated").pipe(W(this.destroyRef)).subscribe(t=>{this.isEntityUpdatedMessage(t)&&(this.toastService.showSuccess("Success","IO Type updated successfully"),this.onEntityChange(t.data))})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-io-type-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","IO Type","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","IO Type","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No IO type details available."]],template:function(e,i){e&1&&h(0,xu,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function Fu(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullOverspeedProfile())("title",((e=i.fullOverspeedProfile())==null?null:e.name)||"Overspeed Profile Details")("allowModeToggle",!0)}}function Iu(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function Eu(n,t){if(n&1&&h(0,Fu,1,4,"app-details-accordion-container",0)(1,Iu,2,0,"div",1),n&2){let e=a();y(e.fullOverspeedProfile()?0:1)}}var Co=class n{entity=E(null);overspeedProfileSectionFactory=c(_o);entityDetailsState=c(Y);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullOverspeedProfile());fullOverspeedProfile=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullOverspeedProfile();return t?this.overspeedProfileSectionFactory.createAllOverspeedProfileSections(t):[]});error=R(null);onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-overspeed-profile-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Overspeed Profile","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Overspeed Profile","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No overspeed profile details available."]],template:function(e,i){e&1&&h(0,Eu,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function Mu(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullAlert())("title",((e=i.fullAlert())==null?null:e.name)||"Alert Details")("allowModeToggle",!0)}}function Ru(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function Au(n,t){if(n&1&&h(0,Mu,1,4,"app-details-accordion-container",0)(1,Ru,2,0,"div",1),n&2){let e=a();y(e.fullAlert()?0:1)}}var bo=class n{entity=E(null);alertSectionFactory=c(So);entityDetailsState=c(Y);entitiesService=c(P);operationRegistry=c(Q);broadcastService=c(we);toastService=c(Ze);destroyRef=c(Ne);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullAlert());fullAlert=v(()=>{let t=this.entityDetailsState.selectedItem();return T(t)?null:t});sections=v(()=>{let t=this.fullAlert();return T(t)?[]:this.alertSectionFactory.createAllAlertSections(t)});error=R(null);isEntityUpdatedMessage(t){return f(t)&&t!==null&&typeof t=="object"&&"entityType"in t&&"data"in t&&t.entityType==="alert"}constructor(){this.operationRegistry.registerEntityOperations("alert",{update:(t,e)=>this.entitiesService.updateAlert(t,e),create:t=>this.entitiesService.createAlert(t),get:t=>this.entitiesService.getAlert(t)})}ngOnInit(){this.broadcastService.on("entity-updated").pipe(W(this.destroyRef)).subscribe(t=>{this.isEntityUpdatedMessage(t)&&(this.toastService.showSuccess("Success","Alert updated successfully"),this.onEntityChange(t.data))})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-alert-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Alert","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Alert","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No alert details available."]],template:function(e,i){e&1&&h(0,Au,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function ku(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullUserRole())("title",((e=i.fullUserRole())==null?null:e.name)||"User Role Details")("allowModeToggle",!0)}}function Ou(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function Pu(n,t){if(n&1&&h(0,ku,1,4,"app-details-accordion-container",0)(1,Ou,2,0,"div",1),n&2){let e=a();y(e.fullUserRole()?0:1)}}var Do=class n{entity=E(null);userRoleSectionFactory=c(To);entityDetailsState=c(Y);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullUserRole());fullUserRole=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullUserRole();return t?this.userRoleSectionFactory.createAllUserRoleSections(t):[]});error=R(null);onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-user-role-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","User Role","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","User Role","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No user role details available."]],template:function(e,i){e&1&&h(0,Pu,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function Vu(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullUser())("title",((e=i.fullUser())==null?null:e.name)||"User Details")("allowModeToggle",!0)}}function Lu(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function Nu(n,t){if(n&1&&h(0,Vu,1,4,"app-details-accordion-container",0)(1,Lu,2,0,"div",1),n&2){let e=a();y(e.fullUser()?0:1)}}var wo=class n{entity=E(null);userSectionFactory=c(xo);entityDetailsState=c(Y);activatedRoute=c(cn);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullUser());fullUser=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullUser();if(!t)return[];let e=this.getRouteParams(),i=e.clientId??e.vendorId??e.distributorId??"none";return this.userSectionFactory.createAllUserSections(t,`${i}`)});error=R(null);onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}getRouteParams(){let t=this.activatedRoute;for(;t.parent;)t=t.parent;let e={};return this.collectParamsFromRoute(t,e),e}collectParamsFromRoute(t,e){Object.assign(e,t.snapshot.params),t.children.forEach(i=>{this.collectParamsFromRoute(i,e)})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-user-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","User","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","User","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No user details available."]],template:function(e,i){e&1&&h(0,Nu,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function Gu(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullCustomField())("title",((e=i.fullCustomField())==null?null:e.name)||"Custom Field Details")("allowModeToggle",!0)}}function qu(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function Uu(n,t){if(n&1&&h(0,Gu,1,4,"app-details-accordion-container",0)(1,qu,2,0,"div",1),n&2){let e=a();y(e.fullCustomField()?0:1)}}var Fo=class n{entity=E(null);customFieldSectionFactory=c(Io);entityDetailsState=c(Y);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullCustomField());fullCustomField=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullCustomField();return t?this.customFieldSectionFactory.createAllCustomFieldSections(t):[]});error=R(null);onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-custom-field-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Custom Field","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Custom Field","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No custom field details available."]],template:function(e,i){e&1&&h(0,Uu,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function zu(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullEmailProvider())("title",((e=i.fullEmailProvider())==null?null:e.name)||"Email Provider Details")("allowModeToggle",!0)}}function ju(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function Bu(n,t){if(n&1&&h(0,zu,1,4,"app-details-accordion-container",0)(1,ju,2,0,"div",1),n&2){let e=a();y(e.fullEmailProvider()?0:1)}}var Eo=class n{entity=E(null);emailProviderSectionFactory=c(Mo);entityDetailsState=c(Y);entitiesService=c(P);operationRegistry=c(Q);cacheService=c(Re);apiSchemaService=c(bt);entityName="EmailProvider";isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullEmailProvider());fullEmailProvider=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullEmailProvider(),e=this.emailProviderType();return t||f(e)?this.emailProviderSectionFactory.createAllEmailProviderSections(t,e):[]});error=R(null);emailProviderType=R(null);constructor(){this.operationRegistry.registerEntityOperations("email-provider",{update:(t,e)=>this.entitiesService.updateEmailProvider(t,e),create:t=>this.entitiesService.createEmailProvider(t),get:t=>this.entitiesService.getEmailProvider(t)}),U(()=>{let t=this.fullEmailProvider(),e=null;t&&(e=this.apiSchemaService.getEntityType(t,this.entityName)?.id),f(e)&&e!==""?this.loadEmailProviderType(e).catch(i=>{this.error.set(i.message)}):this.emailProviderType.set(null)})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}async loadEmailProviderType(t){if(!t){this.emailProviderType.set(null);return}await this.cacheService.getOrFetchAsync(`emailProviderType-${t}`,()=>Ce(this.entitiesService.getEmailProviderType(t)),3e5).then(e=>{this.emailProviderType.set(e)})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-email-provider-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Email Provider","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Email Provider","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No email provider details available."]],template:function(e,i){e&1&&h(0,Bu,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function Hu(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullTheme())("title",((e=i.fullTheme())==null?null:e.name)||"Theme Details")("allowModeToggle",!0)}}function $u(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function Wu(n,t){if(n&1&&h(0,Hu,1,4,"app-details-accordion-container",0)(1,$u,2,0,"div",1),n&2){let e=a();y(e.fullTheme()?0:1)}}var Ro=class n{entity=E(null);themeSectionFactory=c(Ao);entityDetailsState=c(Y);themeService=c(Ws);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullTheme());fullTheme=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullTheme();return t?this.themeSectionFactory.createAllThemeSections(t):[]});error=R(null);onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}constructor(){U(()=>{let t=this.entity();f(t)&&this.themeService.setTheme(t)})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Theme","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Theme","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No theme details available."]],template:function(e,i){e&1&&h(0,Wu,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function Zu(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullCostCentre())("title",((e=i.fullCostCentre())==null?null:e.name)||"Cost Centre Details")("allowModeToggle",!0)}}function Ku(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function Qu(n,t){if(n&1&&h(0,Zu,1,4,"app-details-accordion-container",0)(1,Ku,2,0,"div",1),n&2){let e=a();y(e.fullCostCentre()?0:1)}}var ko=class n{entity=E(null);costCentreSectionFactory=c(Oo);entityDetailsState=c(Y);entitiesService=c(P);operationRegistry=c(Q);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullCostCentre());fullCostCentre=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullCostCentre();return t?this.costCentreSectionFactory.createAllCostCentreSections(t):[]});error=R(null);constructor(){this.operationRegistry.registerEntityOperations("cost-centre",{update:(t,e)=>this.entitiesService.updateCostCentre(t,e),create:t=>this.entitiesService.createCostCentre(t),get:t=>this.entitiesService.getCostCentre(t)})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-cost-centre-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Cost Centre","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Cost Centre","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No cost centre details available."]],template:function(e,i){e&1&&h(0,Qu,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function Yu(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullGeofenceGroup())("title",((e=i.fullGeofenceGroup())==null?null:e.name)||"Geofence Group Details")("allowModeToggle",!0)}}function Ju(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function Xu(n,t){if(n&1&&h(0,Yu,1,4,"app-details-accordion-container",0)(1,Ju,2,0,"div",1),n&2){let e=a();y(e.fullGeofenceGroup()?0:1)}}var Po=class n{entity=E(null);geofenceGroupSectionFactory=c(Vo);entityDetailsState=c(Y);entitiesService=c(P);operationRegistry=c(Q);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullGeofenceGroup());fullGeofenceGroup=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullGeofenceGroup();return t?this.geofenceGroupSectionFactory.createAllGeofenceGroupSections(t):[]});error=R(null);constructor(){this.operationRegistry.registerEntityOperations("geofence-group",{update:(t,e)=>this.entitiesService.updateZoneGroup(t,e),create:t=>this.entitiesService.createZoneGroup(t),get:t=>this.entitiesService.getZoneGroup(t)})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-geofence-group-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Geofence Group","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Geofence Group","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No geofence group details available."]],template:function(e,i){e&1&&h(0,Xu,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function ef(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullAssetGroup())("title",((e=i.fullAssetGroup())==null?null:e.name)||"Asset Group Details")("allowModeToggle",!0)}}function tf(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function nf(n,t){if(n&1&&h(0,ef,1,4,"app-details-accordion-container",0)(1,tf,2,0,"div",1),n&2){let e=a();y(e.fullAssetGroup()?0:1)}}var Lo=class n{entity=E(null);assetGroupSectionFactory=c(No);entityDetailsState=c(Y);entitiesService=c(P);operationRegistry=c(Q);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullAssetGroup());fullAssetGroup=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullAssetGroup();return t?this.assetGroupSectionFactory.createAllAssetGroupSections(t):[]});error=R(null);constructor(){this.operationRegistry.registerEntityOperations("asset-group",{update:(t,e)=>this.entitiesService.updateAssetGroup(t,e),create:t=>this.entitiesService.createAssetGroup(t),get:t=>this.entitiesService.getAssetGroup(t)})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-group-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Asset Group","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Asset Group","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No asset group details available."]],template:function(e,i){e&1&&h(0,nf,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function of(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullAssetCategory())("title",((e=i.fullAssetCategory())==null?null:e.name)||"Asset Category Details")("allowModeToggle",!0)}}function rf(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function af(n,t){if(n&1&&h(0,of,1,4,"app-details-accordion-container",0)(1,rf,2,0,"div",1),n&2){let e=a();y(e.fullAssetCategory()?0:1)}}var Go=class n{entity=E(null);assetCategorySectionFactory=c(qo);entityDetailsState=c(Y);entitiesService=c(P);operationRegistry=c(Q);broadcastService=c(we);toastService=c(Ze);destroyRef=c(Ne);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullAssetCategory());fullAssetCategory=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullAssetCategory();return t?this.assetCategorySectionFactory.createAllAssetCategorySections(t):[]});error=R(null);isEntityUpdatedMessage(t){return f(t)&&t!==null&&typeof t=="object"&&"entityType"in t&&"data"in t&&t.entityType==="asset-category"}constructor(){this.operationRegistry.registerEntityOperations("asset-category",{update:(t,e)=>this.entitiesService.updateAssetCategory(t,e),create:t=>this.entitiesService.createAssetCategory(t),get:t=>this.entitiesService.getAssetCategory(t)})}ngOnInit(){this.broadcastService.on("entity-updated").pipe(W(this.destroyRef)).subscribe(t=>{this.isEntityUpdatedMessage(t)&&(this.toastService.showSuccess("Success","Asset category updated successfully"),this.onEntityChange(t.data))})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-category-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Asset Category","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Asset Category","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No asset category details available."]],template:function(e,i){e&1&&h(0,af,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function sf(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullClient())("title",((e=i.fullClient())==null?null:e.name)||"Client Details")("allowModeToggle",!0)}}function lf(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function df(n,t){if(n&1&&h(0,sf,1,4,"app-details-accordion-container",0)(1,lf,2,0,"div",1),n&2){let e=a();y(e.fullClient()?0:1)}}var Uo=class n{entity=E(null);clientSectionFactory=c(zo);entityDetailsState=c(Y);accountsService=c(me);operationRegistry=c(Q);authDataService=c(ke);broadcastService=c(we);destroyRef=c(Ne);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullClient());fullClient=v(()=>{let t=this.entityDetailsState.selectedItem();return T(t)?null:t});sections=v(()=>{let t=this.fullClient();if(T(t))return[];if(this.authDataService.getUserProfile()?.owner?.type!=="client"){let e=Object.keys(Tt),i=this.authDataService.flags;return T(i.assetPerformanceEnabled())&&(e=e.filter(o=>o!=="page-assetperformance")),T(i.deviceHealthEnabled())&&(e=e.filter(o=>o!=="page-devicehealth")),this.clientSectionFactory.createAllClientSections(t,e)}return[]});error=R(null);isEntityUpdatedMessage(t){return f(t)&&t!==null&&typeof t=="object"&&"entityType"in t&&"data"in t&&t.entityType==="client"}constructor(){this.operationRegistry.registerEntityOperations("client",{update:(t,e)=>this.accountsService.updateClient(t,e),create:t=>this.accountsService.createClient(t),get:t=>this.accountsService.getClient(t)})}ngOnInit(){this.broadcastService.on("entity-updated").pipe(W(this.destroyRef)).subscribe(t=>{if(this.isEntityUpdatedMessage(t)){let e=t.data.state===Jt.StateEnum.Deleted?"delete":"update";this.broadcastService.broadcast("tree-refresh-required",{entityType:"client",operation:e,entityId:t.data.id,vendorId:t.data.owner.id,distributorId:t.data.owner?.owner?.id,state:t.data.state})}})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-vendor-client-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Client","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Client","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No client details available."]],template:function(e,i){e&1&&h(0,df,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function cf(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.flexibleConfiguration().sections)("layout",i.flexibleConfiguration().layout)("entity",i.fullVendor())("title",((e=i.fullVendor())==null?null:e.name)||"Vendor Details")("allowModeToggle",!0)}}function mf(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function pf(n,t){if(n&1&&h(0,cf,1,5,"app-details-accordion-container",0)(1,mf,2,0,"div",1),n&2){let e=a();y(e.fullVendor()?0:1)}}var jo=class n{entity=E(null);vendorSectionFactory=c(Bo);entityDetailsState=c(Y);accountsService=c(me);operationRegistry=c(Q);broadcastService=c(we);destroyRef=c(Ne);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullVendor());fullVendor=v(()=>{let t=this.entityDetailsState.selectedItem();return T(t)?null:t});flexibleConfiguration=v(()=>{let t=this.fullVendor();if(T(t))return{sections:[],layout:{categories:[]}};let e=["page-moreapps"];return this.vendorSectionFactory.createFlexibleVendorConfiguration(t,e)});error=R(null);useFlexibleApproach=R(!1);isEntityUpdatedMessage(t){return f(t)&&t!==null&&typeof t=="object"&&"entityType"in t&&"data"in t&&t.entityType==="vendor"}constructor(){this.operationRegistry.registerEntityOperations("vendor",{update:(t,e)=>this.accountsService.updateVendor(t,e),create:t=>this.accountsService.createVendor(t),get:t=>this.accountsService.getVendor(t)})}ngOnInit(){this.broadcastService.on("entity-updated").pipe(W(this.destroyRef)).subscribe(t=>{if(this.isEntityUpdatedMessage(t)){let e=t.data.state===Xt.StateEnum.Deleted;this.broadcastService.broadcast("tree-refresh-required",M({entityType:"vendor",operation:e?"delete":"update",entityId:t.data.id,distributorId:t.data.owner.id},e?{}:{state:t.data.state}))}})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-distributor-vendor-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Vendor (Flexible Configuration)","initialMode","view",3,"sections","layout","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Vendor (Flexible Configuration)","initialMode","view",3,"entityChange","sections","layout","entity","title","allowModeToggle"],["severity","info","text","No vendor details available."]],template:function(e,i){e&1&&h(0,pf,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};var uf=n=>({"icon-primary":n});function ff(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",8),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit asset rating profile details"))}function gf(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",9),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function hf(n,t){if(n&1&&(l(0,"div",10)(1,"p-message",12),C(2,"span",13),D(3),s()()),n&2){let e=a(2);d(3),ye(" ",e.warning())}}function yf(n,t){if(n&1&&(h(0,hf,4,1,"div",10),C(1,"app-grid",11)),n&2){let e=a();y(e.warning()?0:-1),d(),g("data",e.assetRatingProfileDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Ho=class n extends B{ownerId=E(null);entitiesService=c(P);eventFilterService=c(zt);assetRatingProfileDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Name",value:t.name},{key:"Penalties",value:ce(t.items)?"None":t.items?.map(e=>e.name).join(", ")}]:[]});assetRatingProfilePenaltyModalConfig;warning=R(null);constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.entity();T(t?.items)||t.items.length<1?this.warning.set("At least one penalty is required for the asset rating profile to be useful."):this.warning.set(null)})}updateFormFields(){let t=this.entity();this.assetRatingProfilePenaltyModalConfig={modalComponent:be,modalTitle:"Rating Penalty",defaultItemProvider:()=>({id:Xe(),name:"",max:100,offset:void 0,penalty:1,cost:void 0}),listItemFormatter:e=>this.stateItemToListItem(e),modalFields:e=>[k("id","ID",e?.id,{name:"id",hidden:!0}),k("name","Name",e?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),ie("penalty","Penalty",void 0,{name:"penalty",validations:[{name:"required",validator:w.required,message:"Penalty is required"},{name:"min",validator:w.min(1),message:"Min must be 1 or greater"},{name:"max",validator:w.max(100),message:"Max must be 100 or less"}],layout:"horizontal",labelWidth:"1/3"}),ie("max","Max",void 0,{name:"max",validations:[{name:"required",validator:w.required,message:"Max is required"},{name:"min",validator:w.min(1),message:"Min must be 1 or greater"},{name:"max",validator:w.max(100),message:"Max must be 100 or less"}],layout:"horizontal",labelWidth:"1/3"}),ie("cost","Cost",void 0,{name:"cost",validations:[{name:"required",validator:w.required,message:"Cost is required"},{name:"min",validator:w.min(0),message:"Min must be 0 or greater"},{name:"max",validator:w.max(1e6),message:"Max must be 1000000 or less"}],layout:"horizontal",labelWidth:"1/3"}),Lt("filter","Event Filter",void 0,["costcentres","groups","types"],{name:"filter",required:!0,validations:[{name:"required",validator:w.required,message:"Event filter is required"}]})],subHeader:"Choose penalty severity and configure the event filter to trigger this penalty."},this.formFields=[k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]})],this.createMode()||this.formFields.push(De("items","Penalties",t?.items??[],{layout:"horizontal",labelWidth:"1/3",name:"items",props:{modalConfig:this.assetRatingProfilePenaltyModalConfig}}))}submitChanges(t){let e=this.entity();T(e)||this.entitiesService.updateAssetRatingProfile(e.id,this.transformFormData(t)).pipe(W(this.destroyRef)).subscribe({next:i=>{this.isFormEditable.set(!1),this.isSubmitting.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"asset-rating-profile",operation:"update",entityId:e.id,data:i})},error:()=>{this.isFormEditable.set(!0),this.isSubmitting.set(!1)}})}stateItemToListItem(t){let e=t.cost?`, cost ${t.cost}`:"",i=`${t.penalty} (${t.max} max${e})`;return{id:t.id,title:t.name,display:i,icon:"pi pi-star"}}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);return Array.isArray(e.items)&&(e.items=e.items.map(i=>{let o=M({},i);if(f(o.filter)){let r=o.filter;o.filter=ee(M({},r),{actor:r?.actor?.data,action:r?.action?.data,target:r?.target?.data,conditions:r?.conditions?.map(x=>{var G=x,{id:u}=G,b=xt(G,["id"]);return b})??[]})}return o})),e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-rating-profile-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-star","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"],[1,"mb-4"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],["severity","warn"],[1,"pi","pi-exclamation-triangle","mr-2"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Asset Rating Profile Details"),s(),h(7,ff,2,1,"div",6),s(),l(8,"span"),D(9,"Configure the rating penalties for your asset rating profile"),s()()(),h(10,gf,1,3,"app-dynamic-form",7),h(11,yf,2,5),s()),e&2&&(d(2),g("ngClass",N(5,uf,i.isFormEditable())),I("aria-label","star icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q,X,se],encapsulation:2})};var $o=class n{createAssetRatingProfileInformationSections(t){return[{id:"asset-rating-profile-details",title:"Asset Rating Profile Details",component:Ho,componentInputs:{entity:t},category:"information",order:10}]}createChangesSection(t){return[{id:"asset-rating-profile-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllAssetRatingProfileSections(t){return[...this.createAssetRatingProfileInformationSections(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};function vf(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullAssetRatingProfile())("title",((e=i.fullAssetRatingProfile())==null?null:e.name)||"Asset Rating Profile Details")("allowModeToggle",!0)}}function Cf(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function _f(n,t){if(n&1&&h(0,vf,1,4,"app-details-accordion-container",0)(1,Cf,2,0,"div",1),n&2){let e=a();y(e.fullAssetRatingProfile()?0:1)}}var Wo=class n{entity=E(null);assetRatingProfileSectionFactory=c($o);entityDetailsState=c(Y);isLoading=v(()=>this.entityDetailsState.isLoading());fullAssetRatingProfile=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullAssetRatingProfile();return t?this.assetRatingProfileSectionFactory.createAllAssetRatingProfileSections(t):[]});error=R(null);onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-rating-profile-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Asset Rating Profile","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Asset Rating Profile","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No asset rating profile details available."]],template:function(e,i){e&1&&h(0,_f,2,1),e&2&&y(!i.isLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function bf(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullDistributor())("title",((e=i.fullDistributor())==null?null:e.name)||"Distributor Details")("allowModeToggle",!0)}}function Sf(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function Df(n,t){if(n&1&&h(0,bf,1,4,"app-details-accordion-container",0)(1,Sf,2,0,"div",1),n&2){let e=a();y(e.fullDistributor()?0:1)}}var Zo=class n{entity=E(null);distributorSectionFactory=c(Ko);entityDetailsState=c(Y);accountsService=c(me);operationRegistry=c(Q);broadcastService=c(we);toastService=c(Ze);destroyRef=c(Ne);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullDistributor());fullDistributor=v(()=>{let t=this.entityDetailsState.selectedItem();return T(t)?null:t});sections=v(()=>{let t=this.fullDistributor();return T(t)?[]:this.distributorSectionFactory.createAllDistributorSections(t)});error=R(null);isEntityUpdatedMessage(t){return f(t)&&t!==null&&typeof t=="object"&&"entityType"in t&&"data"in t&&t.entityType==="distributor"}constructor(){this.operationRegistry.registerEntityOperations("distributor",{update:(t,e)=>this.accountsService.updateDistributor(t,e),create:t=>this.accountsService.createDistributor(t),get:t=>this.accountsService.getDistributor(t)})}ngOnInit(){this.broadcastService.on("entity-updated").pipe(W(this.destroyRef)).subscribe(t=>{if(this.isEntityUpdatedMessage(t)){this.toastService.showSuccess("Success","Distributor updated successfully"),this.onEntityChange(t.data);let e=t.data.state===$i.StateEnum.Deleted?"delete":"update";this.broadcastService.broadcast("tree-refresh-required",{entityType:"distributor",operation:e,entityId:t.data.id,state:t.data.state})}})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-super-admin-distributors-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Distributor","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Distributor","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No distributor details available."]],template:function(e,i){e&1&&h(0,Df,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function Tf(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullAssetStateProfile())("title",((e=i.fullAssetStateProfile())==null?null:e.name)||"Asset State Profile Details")("allowModeToggle",!0)}}function wf(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function xf(n,t){if(n&1&&h(0,Tf,1,4,"app-details-accordion-container",0)(1,wf,2,0,"div",1),n&2){let e=a();y(e.fullAssetStateProfile()?0:1)}}var Qo=class n{entity=E(null);assetStateProfileSectionFactory=c(Yo);entityDetailsState=c(Y);isLoading=v(()=>this.entityDetailsState.isLoading());fullAssetStateProfile=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullAssetStateProfile();return t?this.assetStateProfileSectionFactory.createAllAssetStateProfileSections(t):[]});error=R(null);onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-state-profile-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Asset State Profile","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Asset State Profile","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No asset state profile details available."]],template:function(e,i){e&1&&h(0,xf,2,1),e&2&&y(!i.isLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function Ff(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.flexibleConfiguration().sections)("layout",i.flexibleConfiguration().layout)("entity",i.fullCompanyGroup())("title",((e=i.fullCompanyGroup())==null?null:e.name)||"Company Group Details")("allowModeToggle",!0)}}function If(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function Ef(n,t){if(n&1&&h(0,Ff,1,5,"app-details-accordion-container",0)(1,If,2,0,"div",1),n&2){let e=a();y(e.fullCompanyGroup()?0:1)}}var Jo=class n{entity=E(null);companyGroupSectionFactory=c(Xo);entityDetailsState=c(Y);operationRegistry=c(Q);accountsService=c(me);authDataService=c(ke);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullCompanyGroup());fullCompanyGroup=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});flexibleConfiguration=v(()=>{let t=this.fullCompanyGroup();if(!t)return{sections:[],layout:{categories:[]}};if(this.authDataService.getUserProfile()?.owner?.type!=="client"){let e=Object.keys(Tt),i=Bs(this.authDataService.getUserProfile()?.owner?.type??""),o=this.authDataService.flags;return T(o.assetPerformanceEnabled())&&(e=e.filter(r=>r!=="page-assetperformance")),T(o.deviceHealthEnabled())&&(e=e.filter(r=>r!=="page-devicehealth")),this.companyGroupSectionFactory.createFlexibleCompanyGroupConfiguration(t,e,i)}return{sections:[],layout:{categories:[]}}});error=R(null);constructor(){this.operationRegistry.registerEntityOperations("company-group",{update:(t,e)=>this.accountsService.updateCompanyGroup(t,e),create:t=>this.accountsService.createCompanyGroup(t),get:t=>this.accountsService.getCompanyGroup(t)})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-company-group-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Company Group (Custom Order & Titles)","initialMode","view",3,"sections","layout","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Company Group (Custom Order & Titles)","initialMode","view",3,"entityChange","sections","layout","entity","title","allowModeToggle"],["severity","info","text","No company group details available."]],template:function(e,i){e&1&&h(0,Ef,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function Mf(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullRoadProfile())("title",((e=i.fullRoadProfile())==null?null:e.name)||"Road Profile Details")("allowModeToggle",!0)}}function Rf(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function Af(n,t){if(n&1&&h(0,Mf,1,4,"app-details-accordion-container",0)(1,Rf,2,0,"div",1),n&2){let e=a();y(e.fullRoadProfile()?0:1)}}var er=class n{entity=E(null);roadProfileSectionFactory=c(tr);entityDetailsState=c(Y);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullRoadProfile());fullRoadProfile=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullRoadProfile();return t?this.roadProfileSectionFactory.createAllRoadProfileSections(t):[]});error=R(null);onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-road-profile-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Road Profile","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Road Profile","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No road profile details available."]],template:function(e,i){e&1&&h(0,Af,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function kf(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullGeoLockProfile())("title",((e=i.fullGeoLockProfile())==null?null:e.name)||"Geo Lock Profile Details")("allowModeToggle",!0)}}function Of(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function Pf(n,t){if(n&1&&h(0,kf,1,4,"app-details-accordion-container",0)(1,Of,2,0,"div",1),n&2){let e=a();y(e.fullGeoLockProfile()?0:1)}}var ir=class n{entity=E(null);geoLockProfileSectionFactory=c(nr);entityDetailsState=c(Y);isLoading=v(()=>this.entityDetailsState.isLoading());fullGeoLockProfile=v(()=>{let t=this.entityDetailsState.selectedItem();return t||null});sections=v(()=>{let t=this.fullGeoLockProfile();return t?this.geoLockProfileSectionFactory.createAllGeoLockProfileSections(t):[]});error=R(null);onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-geo-lock-profile-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Geo Lock Profile","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Geo Lock Profile","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No geo lock profile details available."]],template:function(e,i){e&1&&h(0,Pf,2,1),e&2&&y(!i.isLoading()&&!i.error()?0:-1)},dependencies:[ue,fe,X,se],encapsulation:2})};function Vf(n,t){if(n&1){let e=S();l(0,"app-details-accordion-container",2),_("entityChange",function(o){m(e);let r=a(2);return p(r.onEntityChange(o))}),s()}if(n&2){let e,i=a(2);g("sections",i.sections())("entity",i.fullDeviceType())("title",((e=i.fullDeviceType())==null?null:e.name)||"Device Type Details")("allowModeToggle",!0)}}function Lf(n,t){n&1&&(l(0,"div",1),C(1,"p-message",3),s())}function Nf(n,t){if(n&1&&h(0,Vf,1,4,"app-details-accordion-container",0)(1,Lf,2,0,"div",1),n&2){let e=a();y(e.fullDeviceType()?0:1)}}var or=class n{constructor(){this.operationRegistry.registerEntityOperations("device-types",{update:(t,e)=>this.deviceTypesService.updateDeviceType(t,e),create:t=>this.deviceTypesService.createDeviceType(t),get:t=>this.deviceTypesService.getDeviceType(t)})}entity=E(null);entityDetailsState=c(Y);deviceTypesSectionFactory=c(rr);operationRegistry=c(Q);broadcastService=c(we);toastService=c(Ze);destroyRef=c(Ne);deviceTypesService=c($e);isLoading=v(()=>this.entityDetailsState.isLoading());isSoftRefreshing=v(()=>this.entityDetailsState.isSoftRefreshing());isInitialLoading=v(()=>this.isLoading()&&!this.isSoftRefreshing()&&!this.fullDeviceType());fullDeviceType=v(()=>{let t=this.entityDetailsState.selectedItem();return T(t)?null:t});sections=v(()=>{let t=this.fullDeviceType();return t?this.deviceTypesSectionFactory.createAllDeviceTypeSections(t):[]});error=R(null);isEntityUpdatedMessage(t){return f(t)&&t!==null&&typeof t=="object"&&"entityType"in t&&"data"in t&&t.entityType==="device-types"}ngOnInit(){this.broadcastService.on("entity-updated").pipe(W(this.destroyRef)).subscribe(t=>{this.isEntityUpdatedMessage(t)&&(this.toastService.showSuccess("Success","Device Type updated successfully"),this.onEntityChange(t.data))})}onEntityChange(t){this.entityDetailsState.updateEntity(t),this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-types-details-container"]],inputs:{entity:[1,"entity"]},decls:1,vars:1,consts:[["subtitle","Device Type","initialMode","view",3,"sections","entity","title","allowModeToggle"],[1,"p-4"],["subtitle","Device Type","initialMode","view",3,"entityChange","sections","entity","title","allowModeToggle"],["severity","info","text","No device type details available."]],template:function(e,i){e&1&&h(0,Nf,2,1),e&2&&y(!i.isInitialLoading()&&!i.error()?0:-1)},dependencies:[ue,X,se],encapsulation:2})};var bi=class n{componentRegistry={};configRegistry={};entityTypeMapping={"client-assets":"asset","client-sim-cards":"simcard","client-alerts":"alert","client-asset-tags":"asset-tag","client-hardware-devices":"device","client-geofences":"geofence","client-io-types":"io-type","client-sms-gateway-providers":"sms-gateway-provider","client-device-providers":"device-provider","client-device-config-profiles":"device-config-profile","client-overspeed-profiles":"overspeed-profile","client-user-roles":"user-role","client-users":"user","client-custom-fields":"custom-field","client-cost-centres":"cost-centre","client-geofence-groups":"geofence-group","client-asset-groups":"asset-group","client-asset-categories":"asset-category","client-asset-rating-profiles":"asset-rating-profile","client-asset-state-profiles":"asset-state-profile","client-road-profiles":"road-profile","client-geo-lock-profiles":"geo-lock-profile","vendor-io-types":"io-type","vendor-overspeed-profiles":"overspeed-profile","vendor-device-config-profiles":"device-config-profile","vendor-sms-gateway-providers":"sms-gateway-provider","vendor-custom-fields":"custom-field","vendor-email-providers":"email-provider","vendor-users":"user","vendor-user-roles":"user-role","vendor-clients":"client","vendor-themes":"theme","vendor-company-groups":"company-group","vendor-road-profiles":"road-profile","vendor-geo-lock-profiles":"geo-lock-profile","distributor-device-providers":"device-provider","distributor-overspeed-profiles":"overspeed-profile","distributor-road-profiles":"road-profile","distributor-themes":"theme","distributor-users":"user","distributor-user-roles":"user-role","distributor-company-groups":"company-group","distributor-vendors":"vendor","super-admin-distributors":"distributor","super-admin-device-types":"device-types","system-users":"user","system-user-roles":"user-role"};constructor(){this.registerDefaultComponents()}registerDefaultComponents(){this.registerComponent("asset",to),this.registerComponent("simcard",io),this.registerComponent("asset-tag",oo),this.registerComponent("device-config-profile",ao),this.registerComponent("device",lo),this.registerComponent("geofence",mo),this.registerComponent("device-provider",uo),this.registerComponent("sms-gateway-provider",go),this.registerComponent("io-type",yo),this.registerComponent("overspeed-profile",Co),this.registerComponent("alert",bo),this.registerComponent("user-role",Do),this.registerComponent("user",wo),this.registerComponent("custom-field",Fo),this.registerComponent("theme",Ro),this.registerComponent("cost-centre",ko),this.registerComponent("geofence-group",Po),this.registerComponent("asset-group",Lo),this.registerComponent("asset-category",Go),this.registerComponent("email-provider",Eo),this.registerComponent("client",Uo),this.registerComponent("vendor",jo),this.registerComponent("asset-rating-profile",Wo),this.registerComponent("distributor",Zo),this.registerComponent("asset-state-profile",Qo),this.registerComponent("company-group",Jo),this.registerComponent("road-profile",er),this.registerComponent("geo-lock-profile",ir),this.registerComponent("device-types",or)}registerComponent(t,e){this.componentRegistry[t.toLowerCase()]=e}registerEntityConfig(t,e){this.configRegistry[t.toLowerCase()]=e}getDetailsComponent(t){if(!t)return Qi;let e=t.toLowerCase();return this.componentRegistry[e]??Qi}getEntityConfig(t){if(!t)return;let e=t.toLowerCase();return this.configRegistry[e]}getEntityTypeFromRoute(t,e="type"){if(typeof t=="string")return this.normalizeEntityType(t);let i="";if(t.params.pipe(Aa(1)).subscribe(o=>{f(o)&&f(o[e])&&(i=this.normalizeEntityType(o[e]))}),i||t.queryParams.pipe(Aa(1)).subscribe(o=>{f(o)&&f(o[e])&&(i=this.normalizeEntityType(o[e]))}),!i){let o=t.snapshot.data;f(o)&&f(o[e])&&(i=this.normalizeEntityType(o[e]))}return i}normalizeEntityType(t){if(!t)return"";let e=t.toLowerCase();return this.entityTypeMapping[e]||e}registerEntityTypeMapping(t,e){this.entityTypeMapping[t.toLowerCase()]=e.toLowerCase()}getEntityTypeMapping(t){let e=t.toLowerCase();return this.entityTypeMapping[e]||e}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Gf=n=>({"icon-primary":n});function qf(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit sim card details"))}function Uf(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function zf(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.simCardDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var ar=class n extends B{ownerId=E(null);entitiesService=c(P);simCardDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Serial Number",value:t.name},{key:"Network",value:t.networkName},{key:"Number",value:t.number},{key:"Description",value:t.description}]:[]});constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.entity();f(t)&&!this.createMode()&&_e(()=>{this.updateFormFields()})})}updateFormFields(){let t=this.entity();this.formFields=[k("name","Serial Number",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Serial Number is required"}]}),k("networkName","Network",t?.networkName,{name:"networkName",validations:[{name:"required",validator:w.required,message:"Network is required"}]}),k("number","Number",t?.number,{name:"number",validations:[{name:"required",validator:w.required,message:"Number is required"}]}),k("description","Description",t?.description,{name:"description",validations:[]})]}submitChanges(t){let e=this.entity();T(e)||this.entitiesService.updateSimCard(e.id,t).pipe(W(this.destroyRef)).subscribe({next:i=>{this.isFormEditable.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"simcard",operation:"update",entityId:e.id,data:i})},error:()=>{this.isFormEditable.set(!0)}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-sim-card-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-mobile","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"SIM Card Details"),s(),h(7,qf,2,1,"div",6),s(),l(8,"span"),D(9,"Configure various details about your SIM card."),s()()(),h(10,Uf,1,3,"app-dynamic-form",7),h(11,zf,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(5,Gf,i.isFormEditable())),I("aria-label","mobile icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q],encapsulation:2})};var no=class n{createSimCardInformationSections(t){return[{id:"sim-card-details",title:"Sim Card Details",component:ar,componentInputs:{entity:t},category:"information",order:10}]}createChangesSection(t){return[{id:"sim-card-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllSimCardSections(t){return[...this.createSimCardInformationSections(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var jf=n=>({"icon-primary":n});function Bf(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit asset tag details"))}function Hf(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function $f(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.assetTagDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var sr=class n extends B{ownerId=E(null);entitiesService=c(P);cdr=c(Me);selectOptionsLoaded=R(!1);assetTagDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Name",value:t.name},{key:"Serial Number",value:t.serialNumber??"None"},{key:"Tag Type",value:t.assetTagType?.name??"None"},{key:"Mode",value:t.mode??"None"}]:[]});selectOptions={};constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.selectOptionsLoaded()&&_e(()=>{this.updateFormFields(),this.cdr.detectChanges()})})}ngOnInit(){this.loadSelectOptions()}loadSelectOptions(){let t=this.entity(),e=this.ownerId(),i=t?.owner?.id??e;if(T(i)){this.selectOptions={},this.selectOptionsLoaded.set(!0),this.updateFormFields();return}this.entitiesService.listAssetTagTypes(i).pipe(W(this.destroyRef)).subscribe(o=>{this.selectOptions={assetTagTypes:o.items.map(r=>({label:r.name??"",value:r.id})).sort((r,u)=>r.label.localeCompare(u.label))},this.selectOptionsLoaded.set(!0)})}updateFormFields(){let t=this.entity();this.formFields=[k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),k("serialNumber","Serial Number",t?.serialNumber,{name:"serialNumber",validations:[{name:"required",validator:w.required,message:"Serial Number is required"}]}),H("assetTagType","Tag Type",this.selectOptions?.assetTagTypes??[],t?.assetTagType?.id,{name:"assetTagType",validations:[{name:"required",validator:w.required,message:"Tag Type is required"}],props:{appendTo:"body"}}),H("mode","Mode",[{label:"Fixed",value:"fixed"},{label:"Movable",value:"movable"},{label:"Stock",value:"stock"}],t?.mode,{name:"mode",validations:[{name:"required",validator:w.required,message:"Mode is required"}],props:{appendTo:"body"}})]}submitChanges(t){let e=this.entity();if(T(e))return;let i=M({},t);if(f(i.assetTagType)){let o=i.assetTagType,r=this.selectOptions?.assetTagTypes?.find(u=>u.value===o);if(r)i.assetTagType={id:o,name:r.label};else{let u=e.assetTagType;i.assetTagType={id:o,name:u?.name??"Unknown Tag Type"}}}this.entitiesService.updateAssetTag(e.id,i).pipe(W(this.destroyRef),Pt(()=>this.isSubmitting.set(!1))).subscribe({next:o=>{this.isFormEditable.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"asset-tag",operation:"update",entityId:e.id,data:o})},error:()=>{this.isFormEditable.set(!0)}})}onFormValueChange(t){let e=M({},t);if(f(e.assetTagType)){let i=e.assetTagType,o=this.selectOptions?.assetTagTypes?.find(r=>r.value===i);o&&(e.assetTagType={id:i,name:o.label})}this.formValueChange.emit(e)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-tag-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-tags","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Asset Tag Details"),s(),h(7,Bf,2,1,"div",6),s(),l(8,"span"),D(9,"The following information is required in order to identify your asset tag."),s()()(),h(10,Hf,1,3,"app-dynamic-form",7),h(11,$f,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(5,jf,i.isFormEditable())),I("aria-label","tags icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,We,V,q],encapsulation:2})};var ro=class n{createAssetTagInformationSections(t){return[{id:"assetTag-details",title:"Asset Tag Details",component:sr,componentInputs:{entity:t},category:"information",order:10}]}createChangesSection(t){return[{id:"asset-tag-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllAssetTagSections(t){return[...this.createAssetTagInformationSections(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Wf=n=>({"icon-primary":n});function Zf(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit device config profile details"))}function Kf(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Qf(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.deviceConfigProfileDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var lr=class n extends B{ownerId=E(null);entitiesService=c(P);operationRegistry=c(Q);cdr=c(Me);selectOptionsLoaded=R(!1);deviceConfigProfileDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Name",value:t.name},{key:"Device Type",value:t.deviceType?.name??"None"}]:[]});selectOptions={};constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.selectOptionsLoaded()&&_e(()=>{this.updateFormFields(),this.cdr.detectChanges()})}),U(()=>{let t=this.entity();f(t)&&!this.createMode()&&_e(()=>{this.updateFormFields()})})}ngOnInit(){this.loadSelectOptions()}loadSelectOptions(){let t=this.entity(),e=this.ownerId(),i=t?.owner?.id??e;if(T(i)){this.selectOptions={},this.selectOptionsLoaded.set(!0),this.updateFormFields();return}this.entitiesService.listDeviceTypes(i).pipe(W(this.destroyRef)).subscribe(o=>{this.selectOptions={deviceTypes:o.items.filter(r=>r.state==="active"&&(!this.createMode()||f(r.parent)&&r.owner.id===i)).map(r=>({label:`${r?.parent?.name} - ${r?.name}`,value:r.id,data:r})).sort((r,u)=>r.label.localeCompare(u.label))},this.selectOptionsLoaded.set(!0)})}updateFormFields(){let t=this.entity();this.formFields=[k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),H("deviceType","Device Type",this.selectOptions?.deviceTypes,t?.deviceType?.id,{name:"deviceType",validations:[{name:"required",validator:w.required,message:"Device Type is required"}],disabled:!this.createMode(),props:{appendTo:"body"}})]}getUpdateMethod(){return this.operationRegistry.getOperation("device-config-profile","update")??((t,e)=>this.entitiesService.updateDeviceConfigProfile(t,e))}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);if(f(e.deviceType)){let i=e.deviceType,o=this.selectOptions?.deviceTypes?.find(r=>r.value===i);o&&(e.deviceType={id:i,name:o.data?.name})}return e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-config-profile-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-microchip","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Device Config Profile Details"),s(),h(7,Zf,2,1,"div",6),s(),l(8,"span"),D(9,"Configure your device configuration profile."),s()()(),h(10,Kf,1,3,"app-dynamic-form",7),h(11,Qf,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(5,Wf,i.isFormEditable())),I("aria-label","microchip icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,Te,V,q],encapsulation:2})};var Yf=n=>({"icon-primary":n});function Jf(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit device parameters details"))}function Xf(n,t){if(n&1){let e=S();l(0,"div",11)(1,"p-button",12),_("onClick",function(){m(e);let o=a(2);return p(o.onAddSecondaryInput())}),s(),l(2,"span",13),D(3,"Add secondary idling condition"),s()()}n&2&&(d(),g("outlined",!0))}function eg(n,t){if(n&1){let e=S();l(0,"div",11)(1,"p-button",14),_("onClick",function(){m(e);let o=a(2);return p(o.onRemoveSecondaryInput())}),s(),l(2,"span",13),D(3,"Remove AND condition and threshold"),s()()}n&2&&(d(),g("outlined",!0))}function tg(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s(),h(1,Xf,4,1,"div",11),h(2,eg,4,1,"div",11)}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode()),d(),y(e.isFormEditable()&&!e.showSecondaryInput()?1:-1),d(),y(e.isFormEditable()&&e.showSecondaryInput()?2:-1)}}function ig(n,t){if(n&1&&C(0,"app-grid",7),n&2){let e=a();g("data",e.deviceDeviceParameters())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function ng(n,t){if(n&1){let e=S();l(0,"app-dynamic-form-modal",15),_("modalClose",function(){m(e);let o=a();return p(o.onClose())}),l(1,"div",16)(2,"p",17),D(3," Enter the name of the custom input you'd like to use below. "),s()()()}if(n&2){let e=a();g("visible",e.isCustomInputModalOpen)("fields",e.customInputFormFields)("actions",e.modalActions)("styleClass","w-[40rem]")}}var Ti=class n extends B{ownerId=E(null);deviceType=E.required();entitiesService=c(P);operationRegistry=c(Q);cdr=c(Me);customValues=R({});showSecondaryInput=R(!1);secondaryInputValue=R(null);thresholdValue=R(null);showThresholdField=v(()=>this.showSecondaryInput()&&f(this.secondaryInputValue())&&this.secondaryInputValue()!==""&&this.secondaryInputValue()!=="_custom_");deviceDeviceParameters=v(()=>{let t=this.entity()?.parameters;return f(t)?[{key:"Active Input",value:ce(t.active_input)?"None":t.active_input},{key:"Hours Input",value:ce(t.hours_input)?"None":t.hours_input},{key:"Idling Input",value:ce(t.idling_input)?"None":t.idling_input},{key:"Secondary Idling Input",value:ce(t.idling_input_2)?"None":t.idling_input_2},{key:"Secondary Input Threshold",value:f(t.idling_input_2_threshold)?`> ${t.idling_input_2_threshold}`:"N/A"},{key:"Invert Idling Input",value:t.idling_input_invert??!1?"Yes":"No"}]:[]});isCustomInputModalOpen=!1;customInputFormFields=[];currentEditField=null;modalActions=[{label:"Cancel",action:()=>this.onClose(),severity:"secondary"},{label:"Save",action:t=>{this.onSaveCustomInput(t)},severity:"primary"}];constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.deviceType();f(t)&&_e(()=>{this.updateFormFields()})})}onEntityLoaded(t){if(this.customValues.set({}),t?.parameters){let e=f(t.parameters.idling_input_2)&&t.parameters.idling_input_2!=="";this.showSecondaryInput.set(e),this.secondaryInputValue.set(t.parameters.idling_input_2??null),this.thresholdValue.set(t.parameters.idling_input_2_threshold??null)}else this.showSecondaryInput.set(!1),this.secondaryInputValue.set(null),this.thresholdValue.set(null);super.onEntityLoaded(t)}clearThresholdField(){let t=this.getFormGroup();t?.get("idling_input_2_threshold")&&(t.get("idling_input_2_threshold")?.reset(),t.get("idling_input_2_threshold")?.setValue(null)),this.thresholdValue.set(null)}onAddSecondaryInput(){this.showSecondaryInput.set(!0),this.updateFormFields()}onRemoveSecondaryInput(){this.showSecondaryInput.set(!1),this.secondaryInputValue.set(null),this.clearThresholdField();let t=this.getFormGroup();t&&(t.get("idling_input_2")?.reset(),t.get("idling_input_2")?.setValue(null),t.get("idling_input_2_threshold")?.reset(),t.get("idling_input_2_threshold")?.setValue(null),t.get("idling_input_2")?.markAsDirty(),t.get("idling_input_2_threshold")?.markAsDirty()),this.updateFormFields()}getIOOptions(t,e){let i=[];if(f(t?.digital_input))for(let o of Object.keys(t.digital_input)){let r=o;o==="ignition"?r="Ignition Wire":o==="movement"&&(r="Movement Detection"),i.push({label:r,value:o})}if(f(t?.digital_output))for(let o of Object.keys(t.digital_output))i.push({label:o,value:o});return i.sort((o,r)=>o.label.localeCompare(r.label)),f(e)&&!i.some(o=>o.value===e)&&!["","none","emulate","speed"].includes(e)&&i.push({label:e,value:e}),i.push({label:"Custom...",value:"_custom_"}),i}updateFormFields(){let t=this.entity(),e=this.deviceType(),i=M(M({},t?.parameters),this.customValues()),o=this.getIOOptions(e?.ioCapabilities,i.active_input),r=this.getIOOptions(e?.ioCapabilities,i.hours_input),u=this.getIOOptions(e?.ioCapabilities,i.idling_input);this.formFields=[H("active_input","Active Input",[{label:"None",value:""},{label:"Emulate",value:"emulate"},...o],i.active_input,{name:"active_input",props:{appendTo:"body"},events:{onChange:b=>{b==="_custom_"&&this.openCustomInputModal("active_input")}}}),H("hours_input","Hours Input",[{label:"None",value:""},{label:"Emulate",value:"emulate"},...r],i.hours_input,{name:"hours_input",props:{appendTo:"body"},events:{onChange:b=>{b==="_custom_"&&this.openCustomInputModal("hours_input")}}}),H("idling_input","Idling Input",[{label:"Speed",value:"speed"},...u],i.idling_input,{name:"idling_input",props:{appendTo:"body"},events:{onChange:b=>{if(b==="_custom_")this.openCustomInputModal("idling_input");else{let x=this.getFormGroup()?.get("idling_input_2");x&&x.updateValueAndValidity()}}}})],this.showSecondaryInput()&&this.formFields.push(H("idling_input_2","Secondary Idling Input (AND)",this.getSecondaryIdlingOptions(e?.ioCapabilities,i.idling_input_2),i.idling_input_2,{name:"idling_input_2",props:{appendTo:"body",showClear:!1},events:{onChange:b=>{b==="_custom_"?this.openCustomInputModal("idling_input_2"):this.secondaryInputValue.set(b)}},validations:[{name:"differentFromPrimary",validator:b=>{let G=this.getFormGroup()?.get("idling_input")?.value;return f(b.value)&&b.value!==""&&b.value===G?{differentFromPrimary:!0}:null},message:"Secondary input must be different from primary input"}]}),ie("idling_input_2_threshold","Threshold (greater than)",i.idling_input_2_threshold,{name:"idling_input_2_threshold",placeholder:"e.g., 300 for RPM > 300",hint:"Device will idle when this value is exceeded",props:{minFractionDigits:0,maxFractionDigits:2,min:0},validations:[{name:"required",validator:w.required,message:"Threshold is required when secondary input is selected"}]})),this.formFields.push(H("idling_input_invert","Invert Idling Input",[{label:"Yes",value:!0},{label:"No",value:!1}],i.idling_input_invert,{name:"idling_input_invert",props:{appendTo:"body"}})),this.cdr.detectChanges()}getUpdateMethod(){return this.operationRegistry.getOperation("device","update")??((t,e)=>this.entitiesService.updateDevice(t,e))}openCustomInputModal(t){this.currentEditField=t;let e=this.entity()?.parameters?.[t]??"";this.customInputFormFields=[k("custom_input","Input",e,{name:"custom_input"})],this.isCustomInputModalOpen=!0}onClose(){this.isCustomInputModalOpen=!1,this.currentEditField=null}onSaveCustomInput(t){let e=t.get("custom_input")?.value,i=this.currentEditField;if(!f(e)||!f(i))return;this.updateEntityWithCustomValue(i,e);let o=this.captureFormState();o.state[i]=e,o.dirty.add(i),o.touched.add(i),this.updateFormFields(),setTimeout(()=>{this.restoreFormState(o),this.cdr.detectChanges()},0),this.onClose()}updateEntityWithCustomValue(t,e){let i=this.entity();i&&(i.parameters??={},i.parameters[t]=e),this.customValues.update(o=>ee(M({},o),{[t]:e})),t==="idling_input_2"&&this.secondaryInputValue.set(e)}captureFormState(){let t=this.getFormGroup(),e={},i=new Set,o=new Set;return t?(Object.keys(t.controls).forEach(r=>{let u=t.get(r);u&&(e[r]=u.value,u.dirty&&i.add(r),u.touched&&o.add(r))}),{state:e,dirty:i,touched:o}):{state:e,dirty:i,touched:o}}restoreFormState(t){let e=this.getFormGroup();e&&(Object.keys(t.state).forEach(i=>{let o=e.get(i);o&&(o.setValue(t.state[i],{emitEvent:!1}),t.dirty.has(i)&&o.markAsDirty(),t.touched.has(i)&&o.markAsTouched())}),e.updateValueAndValidity())}transformFormData(t){let i=this.getFormValue().idling_input_2;if(ce(i)&&(delete t.idling_input_2,delete t.idling_input_2_threshold),this.injectDataAtPath()){let o={};return ui(o,this.dataPath(),t),o}else return t}getSecondaryIdlingOptions(t,e){return this.getIOOptions(t,e).filter(o=>o.value!=="speed")}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-parameters-section"]],inputs:{ownerId:[1,"ownerId"],deviceType:[1,"deviceType"]},features:[O],decls:13,vars:8,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-wrench","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],["header","Custom Input",3,"visible","fields","actions","styleClass"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"],[1,"flex","items-center","gap-3","mt-4","mb-6","px-2"],["label","AND","icon","pi pi-plus","size","small","severity","secondary",3,"onClick","outlined"],[1,"text-sm","text-gray-600"],["label","Remove Secondary Condition","icon","pi pi-times","size","small","severity","danger",3,"onClick","outlined"],["header","Custom Input",3,"modalClose","visible","fields","actions","styleClass"],["formHeader",""],[1,"mt-2","mb-4","muted"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Device Parameters"),s(),h(7,Jf,2,1,"div",6),s(),l(8,"span"),D(9,"Configure various device parameters below."),s()()(),h(10,tg,3,5),h(11,ig,1,4,"app-grid",7),s(),h(12,ng,4,4,"app-dynamic-form-modal",8)),e&2&&(d(2),g("ngClass",N(6,Yf,i.isFormEditable())),I("aria-label","wrench icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1),d(),y(i.isCustomInputModalOpen?12:-1))},dependencies:[L,z,K,St,Te,V,q,it],encapsulation:2})};function ii(n,t,e=!0,i=["analog_input","digital_input","digital_output","can_input","counter_input","temperature_input","value_input","camera_input"]){if(!n)return[];let o=[],r=G=>{let Z=Object.keys(G);for(let ve of Z)(e||!(G[ve].optional??!1))&&o.push(ve)};for(let G of i){let Z=n.ioCapabilities?.[G]??{};r(Z),t?.accessories&&Object.keys(t.accessories).forEach(ve=>{let qe=n.accessories?.[ve]?.ioCapabilities?.[G]??{};r(qe)})}let b=(t?.parameters?.bitmaps??[]).filter(G=>i.includes(G.target_type)).map(G=>G.target_input);return o.push(...b),[...new Set(o)].sort((G,Z)=>G.localeCompare(Z))}function td(n,t,e,i){let o=ii(n,t,!0,[e]),r=ii(n,t,!1,[e]),u=[],b=t?.parameters?.io?.[e];if(f(b)&&f(i)){let G=b[i];f(G?.input)&&!o.includes(G.input)&&u.push(G.input),Object.keys(b).forEach(Z=>{if(Z.startsWith("custom_")&&Z.endsWith(`_${i}`)){let ve=b[Z];f(ve?.input)&&!u.includes(ve.input)&&u.push(ve.input)}})}else if(f(b)&&!f(i))for(let G of Object.keys(b)){let ve=b[G]?.input;f(ve)&&!o.includes(ve)&&u.push(ve)}let x=t?.parameters?.io_whitelist??[];return x.length>0?[...o.filter(G=>x.includes(G)),...u]:[...r,...u]}function os(n){switch(n){case"analog_input":return{input:"",minVolts:0,maxVolts:100,minValue:0,maxValue:100};case"can_input":return{input:"",minValue:0,maxValue:100,multiplier:1};case"counter_input":return{input:"",multiplier:1};case"digital_input":return{input:"",invert:!1};case"digital_output":return{input:"",invert:!1,pulsed:!1};case"camera_input":return{input:"",enableLiveStream:!1};default:return{input:""}}}function rs(n,t,e){switch(t){case"analog_input":n.minVolts=Number(e.get("minVolts")?.value??0),n.maxVolts=Number(e.get("maxVolts")?.value??100),n.minValue=Number(e.get("minValue")?.value??0),n.maxValue=Number(e.get("maxValue")?.value??100);break;case"can_input":n.minValue=Number(e.get("minValue")?.value??0),n.maxValue=Number(e.get("maxValue")?.value??100),n.multiplier=Number(e.get("multiplier")?.value??1);break;case"counter_input":n.multiplier=Number(e.get("multiplier")?.value??1);break;case"digital_input":n.invert=!!(e.get("invert")?.value??!1);break;case"digital_output":n.invert=!!(e.get("invert")?.value??!1),n.pulsed=!!(e.get("pulsed")?.value??!1);break;case"camera_input":n.enableLiveStream=!!(e.get("enableLiveStream")?.value??!1);break}}function id(n,t){return t[n]??n}function nd(n,t,e){return f(n[t]?.[e])&&(delete n[t][e],Object.keys(n[t]).length===0&&delete n[t]),M({},n)}function od(n){return n?.parameters?.io?M({},n.parameters.io):{}}var je={input:k("input","Input Name","",{name:"input",validations:[{name:"required",validator:w.required,message:"Input name is required"}]}),minVolts:ie("minVolts","Min Volts",0,{name:"minVolts",validations:[{name:"required",validator:w.required,message:"Minimum volts is required"},{name:"min",validator:w.min(-2e6),message:"Minimum volts must be greater than or equal to -20000000"},{name:"max",validator:w.max(2e6),message:"Minimum volts must be less than or equal to 20000000"}],props:{suffix:"volts"}}),maxVolts:ie("maxVolts","Max Volts",100,{name:"maxVolts",validations:[{name:"required",validator:w.required,message:"Maximum volts is required"},{name:"min",validator:w.min(-2e6),message:"Maximum volts must be greater than or equal to -20000000"},{name:"max",validator:w.max(2e6),message:"Maximum volts must be less than or equal to 20000000"}],props:{suffix:"volts"}}),minValue:ie("minValue","Min Value",0,{name:"minValue",validations:[{name:"required",validator:w.required,message:"Minimum value is required"}]}),maxValue:ie("maxValue","Max Value",100,{name:"maxValue",validations:[{name:"required",validator:w.required,message:"Maximum value is required"}]}),invert:H("invert","Invert Signal",[{label:"No",value:!1},{label:"Yes",value:!0}],!1,{name:"invert",props:{appendTo:"body"}}),pulsed:H("pulsed","Pulsed Output",[{label:"No",value:!1},{label:"Yes",value:!0}],!1,{name:"pulsed",props:{appendTo:"body"}}),multiplier:ie("multiplier","Multiplier",1,{name:"multiplier"}),enableLiveStream:H("enableLiveStream","Enable Live Stream",[{label:"No",value:!1},{label:"Yes",value:!0}],!1,{name:"enableLiveStream",props:{appendTo:"body"}})};function rd(n,t,e,i){return{analog_input:()=>[ee(M({},je.input),{value:t.input}),ee(M({},je.minVolts),{value:t.minVolts}),ee(M({},je.maxVolts),{value:t.maxVolts}),ee(M({},je.minValue),{value:t.minValue,props:{suffix:i}}),ee(M({},je.maxValue),{value:t.maxValue,props:{suffix:i}})],digital_input:()=>[ee(M({},je.input),{value:t.input}),ee(M({},je.invert),{value:t.invert})],digital_output:()=>[ee(M({},je.input),{value:t.input}),ee(M({},je.invert),{value:t.invert}),ee(M({},je.pulsed),{value:t.pulsed})],can_input:()=>[ee(M({},je.input),{value:t.input}),ee(M({},je.minValue),{value:t.minValue,props:{suffix:i}}),ee(M({},je.maxValue),{value:t.maxValue,props:{suffix:i}}),ee(M({},je.multiplier),{value:t.multiplier})],counter_input:()=>[ee(M({},je.input),{value:t.input}),ee(M({},je.multiplier),{value:t.multiplier})],camera_input:()=>(e?.accessories&&Object.values(e.accessories).some(u=>u.features?.video_live_stream&&u.ioCapabilities?.camera_input?.[t.input]))??!1?[ee(M({},je.input),{value:t.input}),ee(M({},je.enableLiveStream),{value:t.enableLiveStream})]:[ee(M({},je.input),{value:t.input})],value_input:()=>[ee(M({},je.input),{value:t.input})],temperature_input:()=>[ee(M({},je.input),{value:t.input})]}[n]?.()??[]}function ad(n,t,e){return n.map(i=>({key:i.name??"",value:t[e]?.[i.id]?.input??"None"}))}function og(n,t){let e={},i=!1;for(let o in n){let r=n[o],u=t[o];(T(u)||JSON.stringify(r)!==JSON.stringify(u))&&(e[o]=r,i=!0)}return[e,i]}function rg(n,t,e){let i=!1;for(let o in n)o in t||(e[o]=null,i=!0);return i}function sd(n,t){let e={};if(!t)return e;for(let i in n){let o=n[i],r=t[i]??{},[u,b]=og(o,r),x=rg(r,o,u);(b||x)&&(e[i]=u)}for(let i in t)i in n||(e[i]=null);return e}var ag=n=>({"icon-primary":n});function sg(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit device parameters details"))}function lg(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function dg(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.ioWhitelistDisplay())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var wi=class n extends B{ownerId=E(null);deviceType=E.required();entitiesService=c(P);operationRegistry=c(Q);ioWhitelistDisplay=v(()=>{let t=this.entity()?.parameters;if(T(t?.io_whitelist))return[];let e=[{key:"Selection",value:ce(t.io_whitelist)?"Default":"Custom"}];return ce(t.io_whitelist)||e.push({key:"Inputs",value:t.io_whitelist.join(", ")}),e});constructor(){super(),this.columns=[{field:"key",header:"Mode",transform:"uppercase"},{field:"value",header:"Configuration"}],U(()=>{let t=this.deviceType(),e=this.entity();f(t)&&f(e)&&_e(()=>{this.updateFormFields()})})}updateFormFields(){let t=this.entity(),e=this.deviceType(),i=t?.parameters??{},o=ii(e,t,!0),r=Array.isArray(i.io_whitelist)&&i.io_whitelist.length>0,u=r?"custom":"default",b=r?i.io_whitelist??[]:ii(e,t,!1);this.formFields=[H("mode","Selection Mode",[{label:"Default",value:"default"},{label:"Custom",value:"custom"}],u,{name:"mode",props:{appendTo:"body"},conditional:!0,conditions:{default:[],custom:[rt("whitelist","Inputs",b,o.map(x=>({label:x,value:x})),{name:"whitelist",props:{appendTo:"body",multiple:!0,filter:!0,filterPlaceholder:"Search I/O",optionLabel:"label",style:{height:"250px"}}})]}})]}getUpdateMethod(){return this.operationRegistry.getOperation("device","update")??((t,e)=>this.entitiesService.updateDevice(t,e))}onSubmit(t){if(T(this.entity())||!t.valid)return;this.isSubmitting.set(!0);let e={};if(Object.keys(t.controls).forEach(i=>{let o=t.controls[i];e[i]=o.value}),Object.keys(e).length===0){this.isFormEditable.set(!1),this.isSubmitting.set(!1);return}this.submitChanges(e)}transformFormData(t){let e=t.mode,i=t.whitelist??[],o={},r={io_whitelist:e==="custom"?i:null};return this.injectDataAtPath()?ui(o,this.dataPath(),r):Object.assign(o,r),o}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-io-whitelist-section"]],inputs:{ownerId:[1,"ownerId"],deviceType:[1,"deviceType"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-list-check","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"IO Selection"),s(),h(7,sg,2,1,"div",6),s(),l(8,"span"),D(9,"Select which of the various inputs and outputs available on the device you would like to have captured and persisted."),s()()(),h(10,lg,1,3,"app-dynamic-form",7),h(11,dg,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(5,ag,i.isFormEditable())),I("aria-label","list icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q],encapsulation:2})};var cg=["iconTemplate"],mg=n=>({"icon-primary":n});function pg(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",12),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit bitmapped IO properties."))}function ug(n,t){n&1&&(l(0,"div",14)(1,"p"),D(2,'No bitmaps added yet. Click "Add" to create a bitmap.'),s()())}function fg(n,t){if(n&1){let e=S();l(0,"p-panel",23)(1,"div",24)(2,"div",25),ht(),l(3,"svg",26),C(4,"use"),s(),Zt(),l(5,"div",27)(6,"span"),D(7),s(),l(8,"span",28),D(9),s()()(),l(10,"div",29)(11,"span",30),_("click",function(){let o=m(e).$index,r=a(3);return p(r.removeBitmap(o))})("keydown.enter",function(){let o=m(e).$index,r=a(3);return p(r.removeBitmap(o))}),s()()()()}if(n&2){let e=t.$implicit,i=a(3);g("showHeader",!1),d(3),I("aria-label","square binary icon"),d(),I("href","assets/sprites/sprite.svg#square-binary-solid"),d(3),J(e.target_input),d(2),J(i.getBitMapDescription(e)),d(2),I("aria-label","Delete Bitmap")}}function gg(n,t){if(n&1&&(l(0,"div",15)(1,"span",21),D(2,"Inputs"),s(),l(3,"div",22),Ue(4,fg,12,6,"p-panel",23,vs),s()()),n&2){let e=a(2);d(4),ze(e.bitmaps)}}function hg(n,t){if(n&1){let e=S();l(0,"div",7)(1,"div",13),h(2,ug,3,0,"div",14)(3,gg,6,0,"div",15),l(4,"div",16)(5,"p-button",17),_("onClick",function(){m(e);let o=a();return p(o.addBitmap())}),s()(),l(6,"div",18)(7,"p-button",19),_("onClick",function(){m(e);let o=a();return p(o.isFormEditable.set(!1))}),s(),l(8,"p-button",20),_("onClick",function(){m(e);let o=a();return p(o.submitChanges({bitmaps:o.bitmaps}))}),s()()()()}if(n&2){let e=a();d(2),y(e.bitmaps.length===0?2:3)}}function yg(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.deviceBitmaps())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var xi=class n extends B{iconTemplate;utilityService=c(he);operationRegistry=c(Q);entitiesService=c(P);deviceBitmaps=v(()=>{let t=this.entity()?.parameters?.bitmaps;return f(t)?[{key:"Inputs",value:t?.length>0?t.map(e=>e.target_input).join(", "):"None"}]:[]});actions=[{label:"Cancel",action:()=>{this.showModal=!1},severity:"secondary"},{label:"Ok",action:t=>{if(t.valid){let e={target_input:t.get("target_input")?.value,target_type:t.get("target_type")?.value,source_input:t.get("source_input")?.value,bitshift:Number(t.get("bitshift")?.value??0),bitmask:parseInt((t.get("bitmask")?.value??"").startsWith("0x")?t.get("bitmask")?.value.slice(2):t.get("bitmask")?.value,16)};this.bitmaps=[...this.bitmaps,e],this.showModal=!1}},severity:"primary",disabled:t=>T(t)?!0:t.pristine||t.invalid}];bitmaps=[];showModal=!1;bitmapTypes=["owner","emergency","administrative","technical","operational","management"];constructor(){super(),U(()=>{let t=this.entity()?.parameters?.bitmaps;t&&(this.bitmaps=[...t],_e(()=>{this.updateFormFields()}))})}ngAfterViewInit(){super.ngAfterViewInit(),this.columns=[{field:"key",header:"",transform:"uppercase",cellTemplate:this.iconTemplate},{field:"value",header:""}]}updateFormFields(){this.formFields=[k("target_input","Target Input","",{name:"target_input",validations:[{name:"required",validator:w.required,message:"Target Input is required"}]}),H("target_type","Target Type",Tn(Ns.TargetTypeEnum),"",{name:"target_type",validations:[{name:"required",validator:w.required,message:"Target Type is required"}],props:{appendTo:"body"}}),k("source_input","Source Input","",{name:"source_input",validations:[{name:"required",validator:w.required,message:"Source Input is required"}]}),ie("bitshift","Bitshift",0,{name:"bitshift",validations:[{name:"required",validator:w.required,message:"Bitshift is required"}],hint:"Number of bits the source input value will be shifted to the right"}),k("bitmask","Bitmask","0x1",{name:"bitmask",validations:[{name:"required",validator:w.required,message:"Bitmask is required"}],hint:"Bitmask to be applied to the value after shifting, in hex format (i.e. 0x01)"})]}getUpdateMethod(){return this.operationRegistry.getOperation("device","update")??((t,e)=>this.entitiesService.updateDevice(t,e))}onClose(){this.showModal=!1}getBitMapDescription(t){return`(${t.source_input} >> ${(t.bitshift||0).toString()}) & 0x${(t.bitmask||1).toString(16)}`}addBitmap(){this.updateFormFields(),this.showModal=!0}removeBitmap(t){this.bitmaps=this.bitmaps.filter((e,i)=>i!==t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-bitmap-section"]],viewQuery:function(e,i){if(e&1&&pe(cg,7),e&2){let o;le(o=de())&&(i.iconTemplate=o.first)}},features:[O],decls:17,vars:12,consts:[[1,"card","pt-2"],[1,"section-header","mb-4","p-2","flex","justify-start","items-center"],[1,"custom-icon-svg","w-[2.5rem]","h-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[1,"edit-bitmaps","p-field","p-2"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],["header","Bitmapped IO Properties",3,"modalClose","formSubmit","visible","fields","actions","styleClass"],["formHeader",""],[1,"mt-2","mb-4","muted"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[1,"flex","flex-col","justify-end","w-full"],[1,"empty-bitmaps","text-center","p-4","text-surface-500"],[1,"grid","grid-cols-5","gap-4","mt-2"],[1,"add-bitmap-button","text-right","mt-3","mb-4"],["severity","secondary","label","Add",3,"onClick"],[1,"action-buttons","flex","justify-end","gap-2","mt-4"],["type","button","label","Cancel","severity","secondary",3,"onClick"],["type","submit","label","Save","severity","primary",3,"onClick"],[1,"font-semibold","mb-2","col-span-2"],[1,"col-span-3"],["styleClass","mb-3",3,"showHeader"],[1,"flex","items-center","justify-between","mt-4"],[1,"flex","flex-row","gap-2","items-center"],[1,"custom-icon-svg","w-[1.25rem]","h-[1.25rem]"],[1,"flex","flex-col"],[1,"muted"],[1,"icon-light","col-span-1","text-right"],[1,"pi","pi-trash","action","hover","!text-xl",3,"click","keydown.enter"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),ht(),l(2,"svg",2),C(3,"use"),s(),Zt(),l(4,"div",3)(5,"div",4)(6,"h2",5),D(7,"Bitmapped IO"),s(),h(8,pg,2,1,"div",6),s(),l(9,"span"),D(10,"You can create new inputs from composite values using I/O bitmaps. Configure these below."),s()()(),h(11,hg,9,1,"div",7),h(12,yg,1,4,"app-grid",8),s(),l(13,"app-dynamic-form-modal",9),_("modalClose",function(){return i.onClose()})("formSubmit",function(r){return i.onSubmit(r)}),l(14,"div",10)(15,"p",11),D(16," Specify the details for your new bitmapped input. "),s()()()),e&2&&(d(2),g("ngClass",N(10,mg,i.isFormEditable())),I("aria-label","square binary icon"),d(),I("href","assets/sprites/sprite.svg#square-binary-solid"),d(5),y(i.isFormEditable()?-1:8),d(3),y(i.isFormEditable()?11:-1),d(),y(!i.isFormEditable()&&!i.createMode()?12:-1),d(),g("visible",i.showModal)("fields",i.formFields)("actions",i.actions)("styleClass","w-[40rem]"))},dependencies:[L,z,We,K,St,Te,it,jt,Ht,Ci,Et,V],encapsulation:2})};var vg=n=>({"icon-primary":n}),Cg=n=>({"text-primary":n}),_g=(n,t)=>({"text-primary":n,"text-surface-300":t}),bg=(n,t)=>t.id;function Sg(n,t){if(n&1&&(ht(),l(0,"svg",2),C(1,"use"),s()),n&2){let e=a();g("ngClass",N(3,vg,e.isFormEditable())),I("aria-label","input/output icon"),d(),I("href","assets/sprites/sprite.svg#"+e.iconName())}}function Dg(n,t){if(n&1&&C(0,"i",11),n&2){let e=a();Le(e.iconName()+" !text-[2.5rem]"),g("ngClass",N(4,Cg,e.isFormEditable())),I("aria-label","input/output icon")}}function Tg(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",12),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}if(n&2){let e=a();d(),I("aria-label","Edit "+e.getDisplayName(e.ioType()))}}function wg(n,t){if(n&1){let e=S();l(0,"div",14)(1,"span",18),D(2),s(),l(3,"div",19)(4,"p-select",20),_("onChange",function(o){let r=m(e).$implicit,u=a(2);return p(u.handleConfigChange(o,r.id||"",r.name,r.unit))}),s(),l(5,"button",21),_("click",function(){let o,r=m(e).$implicit,u=a(2);return p(u.openCalibrationModal(r.id,(o=u.ioValues()[u.ioType()])==null?null:o[r.id||""],r.name,r.unit))}),C(6,"i",22),s()()()}if(n&2){let e,i,o=t.$implicit,r=a(2);d(2),J(o.name),d(2),g("options",r.getLookupValues(o.id||""))("ngModel",r.getSelectedConfigOption(o.id||""))("appendTo","body"),d(),g("disabled",!((e=r.ioValues()[r.ioType()])!=null&&e[o.id||""])),I("aria-label","Configure "+o.name),d(),g("ngClass",Pi(7,_g,(i=r.ioValues()[r.ioType()])==null?null:i[o.id||""],!((i=r.ioValues()[r.ioType()])!=null&&i[o.id||""])))}}function xg(n,t){if(n&1){let e=S();l(0,"div",8)(1,"div",13),Ue(2,wg,7,10,"div",14,bg),l(4,"div",15)(5,"p-button",16),_("onClick",function(){m(e);let o=a();return p(o.cancelIoEdit())}),s(),l(6,"p-button",17),_("onClick",function(){m(e);let o=a();return p(o.saveIOChanges())}),s()()()()}if(n&2){let e=a();d(2),ze(e.filteredIoTypes()),d(4),g("loading",e.isSubmitting())}}function Fg(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.ioSummary())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function Ig(n,t){if(n&1){let e=S();l(0,"app-dynamic-form-modal",23),_("modalClose",function(){m(e);let o=a();return p(o.showModal.set(!1))}),l(1,"div",24)(2,"p",25),D(3," Configure calibration settings for your IO "),s()()()}if(n&2){let e=a();g("header",(e.selectedInputName()||"Input")+" calibration")("fields",e.formFields)("actions",e.actions)("styleClass","w-[40rem]")("visible",e.showModal())}}var Ke=class n extends B{ioType=E.required();deviceType=E.required();ioTypes=E.required();iconType=E.required();iconName=E.required();utilityService=c(he);entitiesService=c(P);operationRegistry=c(Q);apiSchemaService=c(bt);selectedInputName=R(null);selectedInputId=R("");selectedInputUnit=R(void 0);calibrationData=R(null);showModal=R(!1);originalInputIdForCustom=R("");ioValues=R({});ioTypeMap=ll;actions=[{label:"Cancel",action:()=>{this.showModal.set(!1)},severity:"secondary"},{label:"Ok",action:t=>{t.valid&&this.applyCalibration(t)},severity:"primary",disabled:t=>T(t)}];ioSummary=v(()=>ad(this.filteredIoTypes(),this.ioValues(),this.ioType()));filteredIoTypes=v(()=>{let t=this.ioType();return this.ioTypes().filter(e=>{let i=this.apiSchemaService.getEntityType(e,"iotype");return e.state==="active"&&i===t}).sort((e,i)=>(e.name??"").localeCompare(i.name??""))});getDisplayName=t=>id(t,this.ioTypeMap);originalIoValues=null;constructor(){super(),this.columns=[{field:"key",header:"Mode",transform:"uppercase"},{field:"value",header:"Configuration"}],U(()=>{let t=this.entity();t&&this.ioValues.set(JSON.parse(JSON.stringify(od(t))))})}getUpdateMethod(){return this.operationRegistry.getOperation("device","update")??((t,e)=>this.entitiesService.updateDevice(t,e))}transformFormData(t){let e={};return this.injectDataAtPath()?ui(e,this.dataPath(),t):Object.assign(e,t),e}getSelectedConfigOption(t){let e=this.ioType();if(T(e))return"none";let i=this.ioValues()[e]?.[t];if(f(i))return i.input??t;let r=this.entity()?.parameters?.default_inputs?.[e]?.[t];return f(r)?r:"none"}updateFormFields(){let t=this.calibrationData(),e=this.ioType();t&&(this.formFields=rd(e,t,this.deviceType(),this.selectedInputUnit()))}openCalibrationModal(t,e,i,o){let r=this.ioType();if(T(r))return;this.selectedInputName.set(i??""),this.selectedInputId.set(t),this.selectedInputUnit.set(o??void 0);let u=t==="_custom_",b=e;T(b)&&(b=os(r)),u?b.input="":b.input=b.input??t,this.calibrationData.set(b),this.updateFormFields(),this.showModal.set(!0)}applyCalibration(t){let e=this.ioType(),i=this.selectedInputId();if(T(i))return;let o=t.get("input")?.value;if(i==="_custom_"){let u=this.originalInputIdForCustom(),b={input:o};rs(b,e,t);let x=this.ioValues();T(x[e])&&(x[e]={}),x[e][u]=M({},b),this.ioValues.set(M({},x))}else{let u={input:o};rs(u,e,t);let b=this.ioValues();T(b[e])&&(b[e]={}),f(b[e][i])?b[e][i]=M(M({},b[e][i]),u):b[e][i]=u,this.ioValues.set(M({},b))}this.showModal.set(!1)}async onEdit(){await super.onEdit(),this.originalIoValues=JSON.parse(JSON.stringify(this.ioValues()))}cancelIoEdit(){this.originalIoValues&&this.ioValues.set(M({},this.originalIoValues)),this.clearUnsavedChanges(),this.isFormEditable.set(!1)}getIoChanges(){return sd(this.ioValues(),this.originalIoValues)}saveIOChanges(){let t=this.getIoChanges();this.submitChanges({parameters:{io:t}})}handleConfigChange(t,e,i,o){let r=t.value,u=this.ioType();if(!T(u)){if(r==="none"){this.ioValues.set(nd(this.ioValues(),this.ioType(),e));return}if(r==="_custom_"){this.originalInputIdForCustom.set(e),this.openCalibrationModal("_custom_",null,i,o);return}this.handleInputSelection(r,e,i,o,u)}}handleInputSelection(t,e,i,o,r){let u=this.ioValues(),b=this.findCustomConfigForValue(t,e,r),x=f(b),G=u[r]?.[e];T(G)?(G=os(r),G.input=t,T(u[r])&&(u[r]={}),u[r][e]=G):G.input!==t&&(x&&f(b)?G=M({},b):G.input=t,u[r][e]=M({},G)),this.ioValues.set(M({},u)),!x&&t!==e&&this.openCalibrationModal(e,G,i,o)}findCustomConfigForValue(t,e,i){let r=this.ioValues()[i];if(!f(r))return null;for(let u of Object.keys(r))if(u.startsWith("custom_")&&u.endsWith(`_${e}`)){let b=r[u];if(b?.input===t)return b}return null}getLookupValues(t){let e=this.deviceType(),i=this.ioType(),o=this.entity();if(T(i)||!e||!o)return[{label:"None",value:"none"}];let r=td(e,o,i,t),u=[];if(f(t)){let G=this.ioValues()[i];f(G)&&Object.keys(G).forEach(Z=>{if(Z===t){let ve=G[Z];f(ve?.input)&&!u.includes(ve.input)&&u.push(ve.input)}})}let b=[...u];return[{label:"None",value:"none"},...r.map(x=>({label:x,value:x})).sort((x,G)=>x.label.localeCompare(G.label)),...b.filter(x=>!r.includes(x)).map(x=>({label:x,value:x})),{label:"Custom...",value:"_custom_"}]}getIoKeys(t){if(!t)return[];let e=this.ioType(),i=this.entity();return ii(t,i,!0,[e])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-io-section"]],inputs:{ioType:[1,"ioType"],deviceType:[1,"deviceType"],ioTypes:[1,"ioTypes"],iconType:[1,"iconType"],iconName:[1,"iconName"]},features:[O],decls:14,vars:7,consts:[[1,"card","pt-2"],[1,"section-header","mb-4","p-2","flex","justify-start","items-center"],[1,"custom-icon-svg","w-[2.5rem]","h-[2.5rem]",3,"ngClass"],[3,"class","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[1,"io-config","p-field","p-2"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[3,"header","fields","actions","styleClass","visible"],[3,"ngClass"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[1,"flex","flex-col","justify-end","w-full"],[1,"p-field","flex","align-items-center","gap-2","mb-3"],[1,"action-buttons","flex","justify-end","gap-2","mt-4"],["type","button","label","Cancel","severity","secondary",3,"onClick"],["type","submit","label","Save","severity","primary",3,"onClick","loading"],[1,"form-label","p-2","flex-shrink-0","w-1/3"],[1,"flex","flex-row","w-full","flex-grow-1"],["styleClass","w-full","placeholder","Select configuration",3,"onChange","options","ngModel","appendTo"],["type","button",1,"ml-2","p-2","flex","items-center","justify-center","rounded-md","hover:bg-surface-100",3,"click","disabled"],[1,"pi","pi-cog",3,"ngClass"],[3,"modalClose","header","fields","actions","styleClass","visible"],["formHeader",""],[1,"mt-2","mb-4","text-surface-600"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),h(2,Sg,2,5,":svg:svg",2)(3,Dg,1,6,"i",3),l(4,"div",4)(5,"div",5)(6,"h2",6),D(7),s(),h(8,Tg,2,1,"div",7),s(),l(9,"span"),D(10),s()()(),h(11,xg,7,1,"div",8),h(12,Fg,1,4,"app-grid",9),s(),h(13,Ig,4,5,"app-dynamic-form-modal",10)),e&2&&(d(2),y(i.iconType()==="svg"?2:3),d(5),ye(" ",i.getDisplayName(i.ioType())," "),d(),y(i.isFormEditable()?-1:8),d(2),ye("Configure ",i.getDisplayName(i.ioType()).toLowerCase()," with calibration settings"),d(),y(i.isFormEditable()?11:-1),d(),y(!i.isFormEditable()&&!i.createMode()?12:-1),d(),y(i.showModal()?13:-1))},dependencies:[L,z,We,hl,K,St,Te,Ht,it,V,An,yl,Cl,vl],styles:[".io-calibration-summary[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.io-calibration-summary[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background-color:var(--surface-100);padding:.25rem .5rem;border-radius:4px}.io-actions[_ngcontent-%COMP%]{display:flex;align-items:center}.io-actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]{cursor:pointer;color:var(--primary-color);transition:color .2s}.io-actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:hover{color:var(--primary-600)}[_nghost-%COMP%]     .p-tabview .p-tabview-nav li.p-highlight .p-tabview-nav-link{border-color:var(--primary-color);color:var(--primary-color)}[_nghost-%COMP%]     .p-panel .p-panel-header{padding:.75rem 1.25rem;background-color:var(--surface-50)}[_nghost-%COMP%]     .p-panel .p-panel-content{padding:1rem 1.25rem}"]})};var Eg=n=>({"icon-primary":n});function Mg(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit device accessories details"))}function Rg(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Ag(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.accessoriesDisplay())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Fi=class n extends B{sectionHeader=E("Device Accessory Configuration");deviceTypeAccessory=E.required();accessoryId=E.required();ownerId=E(null);entitiesService=c(P);operationRegistry=c(Q);accessoriesDisplay=v(()=>{let e=this.entity()?.accessories?.[this.accessoryId()],i=this.parsedSettingsDefinition();return e?this.mapSettingsToKeyValuePairs(e.settings??{},i):[{key:"Enabled",value:"No"}]});ngOnInit(){this.updateFormFields(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}]}mapSettingsToKeyValuePairs(t,e){return Object.entries(t).map(([i,o])=>{let r=e.find(u=>u.id===i);return{key:r?.title??i,value:r?this.formatFieldValue(o,r):String(o??"N/A")}})}formatFieldValue(t,e){return t==="true"?"Yes":t==="false"?"No":e.type==="combo"&&e.values?e.values.find(i=>i.key===String(t))?.value??"N/A":String(t??"N/A")}parsedSettingsDefinition=v(()=>{let t=this.deviceTypeAccessory();return f(t?.settingsDefinition)?structuredClone(JSON.parse(t.settingsDefinition))?.fields??[]:[]});updateFormFields(){let t=this.entity(),e=this.deviceTypeAccessory(),o=(f(e?.settingsDefinition)?structuredClone(JSON.parse(e.settingsDefinition))?.fields:[]).map(r=>r.type==="combo"?H(r.id,r.title,(r.values??[]).map(u=>({label:u.value,value:u.key})),t?.accessories?.[this.accessoryId()]?.settings?.[r.id]??"",{name:r.id,validations:r.required??!1?[{name:"required",validator:w.required,message:`${r.title} is required`}]:[],props:{appendTo:"body"}}):k(r.id,r.title,t?.accessories?.[this.accessoryId()]?.settings?.[r.id]??"",{name:r.id,validations:r.required??!1?[{name:"required",validator:w.required,message:`${r.title} is required`}]:[]}));this.formFields=[H("enabled","Enabled",[{label:"Yes",value:!0},{label:"No",value:!1}],!0,{name:"enabled",props:{appendTo:"body"}}),...o]}getUpdateMethod(){return this.operationRegistry.getOperation("device","update")??((t,e)=>this.entitiesService.updateDevice(t,e))}static \u0275fac=(()=>{let t;return function(i){return(t||(t=He(n)))(i||n)}})();static \u0275cmp=F({type:n,selectors:[["app-device-accessory-section"]],inputs:{sectionHeader:[1,"sectionHeader"],deviceTypeAccessory:[1,"deviceTypeAccessory"],accessoryId:[1,"accessoryId"],ownerId:[1,"ownerId"]},features:[O],decls:12,vars:8,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-cog","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6),s(),h(7,Mg,2,1,"div",6),s(),l(8,"span"),D(9,"Enable and configure this accessory below."),s()()(),h(10,Rg,1,3,"app-dynamic-form",7),h(11,Ag,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(6,Eg,i.isFormEditable())),I("aria-label","cog icon"),d(4),J(i.sectionHeader()),d(),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q],encapsulation:2})};var so=class n{createDeviceConfigProfileInformationSection(t,e){return[{id:"device-config-profile-details",title:"Device Config Details",component:lr,componentInputs:{entity:t},category:"information",order:10},{id:"device-config-profile-parameters",title:"Device Config Parameters",component:Ti,componentInputs:{entity:t,entityType:"device-config-profile",dataPath:"parameters",injectDataAtPath:!0,deviceType:e},category:"information",order:20}]}createDeviceConfigProfileIOSection(t,e,i){return[{id:"device-config-profile-io-selection",title:"IO Selection",component:wi,componentInputs:{entity:t,entityType:"device-config-profile",dataPath:"parameters",injectDataAtPath:!0,deviceType:e},category:"io",order:10},{id:"device-config-profile-bitmapped-io",title:"Bitmapped IO",component:xi,componentInputs:{entity:t,entityType:"device-config-profile",dataPath:"parameters.io",injectDataAtPath:!0},category:"io",order:20},{id:"device-config-profile-analog-inputs",title:"Analog Inputs",component:Ke,componentInputs:{entity:t,entityType:"device-config-profile",dataPath:"parameters.io",injectDataAtPath:!0,ioType:"analog_input",iconType:"svg",iconName:"gauge-simple-high-solid",deviceType:e,ioTypes:i},category:"io",order:30},{id:"device-config-profile-camera-inputs",title:"Camera Inputs",component:Ke,componentInputs:{entity:t,entityType:"device-config-profile",dataPath:"parameters.io",injectDataAtPath:!0,ioType:"camera_input",iconType:"primeng",iconName:"pi pi-camera",deviceType:e,ioTypes:i},category:"io",order:40},{id:"device-config-profile-can-bus-inputs",title:"CAN Bus Inputs",component:Ke,componentInputs:{entity:t,entityType:"device-config-profile",dataPath:"parameters.io",injectDataAtPath:!0,ioType:"can_input",iconType:"svg",iconName:"oil-can-solid",deviceType:e,ioTypes:i},category:"io",order:50},{id:"device-config-profile-counter-inputs",title:"Counter Inputs",component:Ke,componentInputs:{entity:t,entityType:"device-config-profile",dataPath:"parameters.io",injectDataAtPath:!0,ioType:"counter_input",iconType:"primeng",iconName:"pi pi-clock",deviceType:e,ioTypes:i},category:"io",order:60},{id:"device-config-profile-digital-inputs",title:"Digital Inputs",component:Ke,componentInputs:{entity:t,entityType:"device-config-profile",dataPath:"parameters.io",injectDataAtPath:!0,ioType:"digital_input",iconType:"primeng",iconName:"pi pi-arrow-left",deviceType:e,ioTypes:i},category:"io",order:70},{id:"device-config-profile-digital-outputs",title:"Digital Outputs",component:Ke,componentInputs:{entity:t,entityType:"device-config-profile",dataPath:"parameters.io",injectDataAtPath:!0,ioType:"digital_output",iconType:"primeng",iconName:"pi pi-arrow-right",deviceType:e,ioTypes:i},category:"io",order:80},{id:"device-config-profile-temperature-inputs",title:"Temperature Inputs",component:Ke,componentInputs:{entity:t,entityType:"device-config-profile",dataPath:"parameters.io",injectDataAtPath:!0,ioType:"temperature_input",iconType:"svg",iconName:"temperature-half-solid",deviceType:e,ioTypes:i},category:"io",order:90},{id:"device-config-profile-value-inputs",title:"Value Inputs",component:Ke,componentInputs:{entity:t,entityType:"device-config-profile",dataPath:"parameters.io",injectDataAtPath:!0,ioType:"value_input",iconType:"primeng",iconName:"pi pi-list-check",deviceType:e,ioTypes:i},category:"io",order:100}]}createDeviceConfigProfileAccessoriesSection(t,e){if(!t)return[];let i=[];return Object.entries(t?.accessories??{}).forEach(([o])=>{i.push({id:`device-config-profile-accessory-${o}`,title:e?.[o]?.name??o,component:Fi,componentInputs:{entity:t,entityType:"device-config-profile",dataPath:`accessories.${o}`,injectDataAtPath:!0,deviceTypeAccessory:e?.[o],accessoryId:o,sectionHeader:e?.[o]?.name??o},category:"accessories",order:10+Number(o)})}),i}createAllDeviceConfigProfileSections(t,e,i,o){return[...this.createDeviceConfigProfileInformationSection(t,i),...this.createDeviceConfigProfileIOSection(t,i,o),...this.createDeviceConfigProfileAccessoriesSection(t,e)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var kg=n=>({"icon-primary":n});function Og(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit device details"))}function Pg(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Vg(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.detailsDisplay())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var dr=class n extends B{sectionHeader=E("Device Details");ownerId=E(null);entitiesService=c(P);operationRegistry=c(Q);clientDataService=c(Dn);adminState=c(pi);accountsService=c(me);cdr=c(Me);requestCache=c(Re);selectOptionsLoaded=R(!1);route=c(cn);detailsDisplay=v(()=>{let t=M({},this.entity());return T(t)?[]:(T(t.configProfile)&&(t.configProfile={id:Oe,name:"Manually Configured"}),[{key:"Serial Number",value:t.name??"None"},{key:"Device Type",value:t.deviceType?.name??"None"},{key:"Configuration",value:t.configProfile?.name??"None"}])});selectOptions={};constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.selectOptionsLoaded()&&_e(()=>{this.updateFormFields(),this.cdr.detectChanges()})}),U(()=>{let t=this.entity();f(t)&&!this.createMode()&&_e(()=>{this.updateFormFields()})})}ngOnInit(){this.loadSelectOptions()}loadSelectOptions(){let t=this.entity(),e=this.ownerId(),i=t?.owner?.id??e;if(T(i)){this.selectOptions={deviceTypes:[],deviceProviders:[],deviceConfigProfiles:[]},this.selectOptionsLoaded.set(!0),this.updateFormFields();return}let o=3e5;Ft([this.requestCache.getOrFetch(`device-types-${i}`,()=>this.entitiesService.listDeviceTypes(i),o),this.requestCache.getOrFetch(`device-providers-${i}-true`,()=>this.entitiesService.listDeviceProviders(i,!0),o),this.requestCache.getOrFetch(`device-config-profiles-${i}-true`,()=>this.entitiesService.listDeviceConfigProfiles(i,!0),o),ls(()=>this.getAvailableRootDeviceTypeIdsForClient().catch(()=>[]))]).pipe(W(this.destroyRef)).subscribe(([r,u,b,x])=>{let G=r.items.filter(Z=>Z.state==="active"&&f(Z.parent)&&(Z.owner.id===i||x.length===0||x.includes(Z.parent.id)));this.selectOptions={deviceTypes:G.map(Z=>({label:`${Z?.parent?.name} - ${Z?.name}`,value:Z.id,data:Z})).sort((Z,ve)=>Z.label.localeCompare(ve.label)),deviceProviders:u.items.map(Z=>({label:Z.name??"",value:Z.id})),deviceConfigProfiles:b.items.map(Z=>({label:Z.name??"",value:Z.id,data:Z}))},this.selectOptionsLoaded.set(!0)})}getConfigProfiles(t){let e=this.entity();return[{label:"Manually Configured",value:Oe},...(this.selectOptions.deviceConfigProfiles??[]).filter(i=>{let o=i.data;return(o.state==="active"||o.id===e?.configProfile?.id)&&o?.deviceType?.id===t}).map(i=>{let o=i.data;return{label:o.name??"",value:o.id}})]}updateFormFields(){let t=this.entity();this.formFields=[k("name","Serial Number",t?.name??"",{name:"name",validations:[{name:"required",validator:w.required,message:"Serial Number is required"},{name:"pattern",validator:w.pattern(/^[a-zA-Z0-9]+$/),message:"Serial Number must be alphanumeric"}]}),H("deviceType","Device Type",this.selectOptions.deviceTypes??[],t?.deviceType?.id??"",{name:"deviceType",validations:[{name:"required",validator:w.required,message:"Device Type is required"}],props:{appendTo:"body"},events:{onChange:e=>{let i=this.formFields.find(o=>o.key==="configProfile");i&&(i.options=this.getConfigProfiles(e),this.form?.patchValue({configProfile:Oe}))}}}),H("configProfile","Configuration Profile",this.getConfigProfiles(t?.deviceType?.id),t?.configProfile?.id??Oe,{name:"configProfile",props:{appendTo:"body"}})],this.createMode()&&this.selectOptions.deviceProviders?.length>0&&this.formFields.push(H("provider","Device Provider",this.selectOptions.deviceProviders??[],t?.provider?.id??"",{name:"provider",validations:[{name:"required",validator:w.required,message:"Device Provider is required"}],props:{appendTo:"body"}}))}getUpdateMethod(){return this.operationRegistry.getOperation("device","update")??((t,e)=>this.entitiesService.updateDevice(t,e))}async getAvailableRootDeviceTypeIdsForClient(){let e=Xs(this.route.snapshot).clientId;if(T(e)){let i=this.adminState.selectedClient();return T(i?.id)?[]:this.getAvailableDeviceTypesForClient(i.id)}return this.getAvailableDeviceTypesForClient(e)}async getAvailableDeviceTypesForClient(t){try{let e=this.adminState.selectedClient();if(e?.id===t&&f(e.availableDeviceTypes))return this.extractAvailableDeviceTypeIds(e);let i=await this.requestCache.getOrFetchAsync(`client-${t}`,()=>Ce(this.accountsService.getClient(t)),3e5);return this.extractAvailableDeviceTypeIds(i)}catch(e){return console.error("Error fetching client device types:",e),[]}}async extractAvailableDeviceTypeIds(t){let e=(t.availableDeviceTypes??[]).map(i=>i.id);if(e.length===0&&f(t.owner?.id)){let i=t.owner.id;e=((await this.requestCache.getOrFetchAsync(`vendor-${i}`,()=>Ce(this.accountsService.getVendor(i)),3e5)).availableDeviceTypes??[]).map(r=>r.id)}return e}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);if(f(e.deviceType)&&typeof e.deviceType=="string"){let i=this.selectOptions?.deviceTypes?.find(o=>o.value===e.deviceType);i&&(e.deviceType={id:i.value,name:i.label})}if(f(e.configProfile)&&typeof e.configProfile=="string"){let i=this.selectOptions?.deviceConfigProfiles?.concat({label:"Manually Configured",value:Oe})?.find(o=>o.value===e.configProfile);i&&(e.configProfile={id:i.value,name:i.label})}if(f(e.provider)&&typeof e.provider=="string"){let i=this.selectOptions?.deviceProviders?.find(o=>o.value===e.provider);i&&(e.provider={id:i.value,name:i.label})}return e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-details-section"]],inputs:{sectionHeader:[1,"sectionHeader"],ownerId:[1,"ownerId"]},features:[O],decls:12,vars:8,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-microchip","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6),s(),h(7,Og,2,1,"div",6),s(),l(8,"span"),D(9,"Configure various details about your device."),s()()(),h(10,Pg,1,3,"app-dynamic-form",7),h(11,Vg,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(6,kg,i.isFormEditable())),I("aria-label","microchip icon"),d(4),J(i.sectionHeader()),d(),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q],encapsulation:2})};var Lg=n=>({"icon-primary":n});function Ng(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",8),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit linked entities details"))}function Gg(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",9),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function qg(n,t){if(n&1&&(l(0,"div",10)(1,"p-message",12),C(2,"span",13),D(3),s()()),n&2){let e=a(2);d(3),ye(" ",e.warning())}}function Ug(n,t){if(n&1&&(h(0,qg,4,1,"div",10),C(1,"app-grid",11)),n&2){let e=a();y(e.warning()?0:-1),d(),g("data",e.deviceLinkedDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var cr=class n extends B{ownerId=E(null);entitiesService=c(P);operationRegistry=c(Q);utilityService=c(he);deviceLinkedDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Sim Card",value:t.simcard?.name??"None"},{key:"Asset",value:t.asset?.name??"None"}]:[]});searchSIMCardsSubject=new Ra(null);searchAssetsSubject=new Ra(null);simCardSuggestions=R([]);assetSuggestions=R([]);warning=R(null);constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.entity();f(t)&&t.asset&&this.checkAssetDevices(t)})}ngOnInit(){this.setupSearch(this.searchSIMCardsSubject,this.simCardSuggestions,this.entitiesService.listSimCards.bind(this.entitiesService),{state:"active"}),this.setupSearch(this.searchAssetsSubject,this.assetSuggestions,this.entitiesService.listAssets.bind(this.entitiesService),{state:"active"})}checkAssetDevices(t){t?.asset?this.entitiesService.getAsset(t.asset.id).subscribe(e=>{e.devices&&e.devices.length>1?this.warning.set("Multiple Devices assigned to linked Asset"):this.warning.set(null)}):this.warning.set(null)}setupSearch(t,e,i,o){t.pipe(dt(300),W(this.destroyRef),Be(r=>{if(T(r))return re({items:[]});let u=r.trim();if(u.length===0)return re({items:[]});let b=this.utilityService.constructRqlFilter(ee(M({},o),{name:{value:`*${u}*`,operator:"="}}));return i(this.entity()?.owner.id??"",0,10,"name",b)})).subscribe(r=>{e.set(r.items)})}searchSIMCards(t){let e=t?.trim()??"";if(T(t)||e===this.searchSIMCardsSubject.getValue())return this.simCardSuggestions.set([...this.simCardSuggestions()]);this.searchSIMCardsSubject.next(e)}searchAssets(t){let e=t?.trim()??"";if(T(t)||e===this.searchAssetsSubject.getValue())return this.assetSuggestions.set([...this.assetSuggestions()]);this.searchAssetsSubject.next(e)}updateFormFields(){let t=this.entity();t?.simcard&&this.simCardSuggestions.set([{id:t.simcard.id,name:t.simcard.name}]),t?.asset&&this.assetSuggestions.set([{id:t.asset.id,name:t.asset.name}]),this.formFields=[mt("simcard","SIM Card",t?.simcard?.name,()=>this.simCardSuggestions(),this.searchSIMCards.bind(this),{layout:"horizontal",labelWidth:"1/3",name:"simcard",props:{appendTo:"body",showClear:!0,multiple:!1,field:"name",completeOnFocus:!1,typeahead:!0,showEmptyMessage:!0}}),mt("asset","Asset",t?.asset?.name,()=>this.assetSuggestions(),this.searchAssets.bind(this),{layout:"horizontal",labelWidth:"1/3",name:"asset",props:{appendTo:"body",showClear:!0,multiple:!1,field:"name",completeOnFocus:!1,typeahead:!0,showEmptyMessage:!0}})]}getUpdateMethod(){return this.operationRegistry.getOperation("device-config-profile","update")??((t,e)=>this.entitiesService.updateDevice(t,e))}transformFormData(t){let e=M({},t);return f(e.simcard)&&(e.simcard={id:e?.simcard?.id,name:e.simcard?.name}),f(e.asset)&&(e.asset={id:e.asset?.id,name:e.asset?.name}),e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-linked-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-link","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"],[1,"mb-4"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],["severity","warn"],[1,"pi","pi-exclamation-triangle","mr-2"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Linked Entities"),s(),h(7,Ng,2,1,"div",6),s(),l(8,"span"),D(9,"The following supplemental information is required."),s()()(),h(10,Gg,1,3,"app-dynamic-form",7),h(11,Ug,2,5),s()),e&2&&(d(2),g("ngClass",N(5,Lg,i.isFormEditable())),I("aria-label","link icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,Te,V,q,X,se],encapsulation:2})};var zg=n=>({"icon-primary":n});function jg(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit entity details"))}function Bg(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)}}function Hg(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.entityDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var mr=class n extends B{valuesKey=E.required();formConfig=E.required();entitiesService=c(P);adminStateService=c(pi);entityCustomFields=R([]);entityDetails=v(()=>{let t=this.entity(),e=this.formConfig();if(T(t)||T(e))return[];let i=t[this.valuesKey()]??{};return e.fields.map(o=>({key:o.title,value:i[o.id]??"None"}))});constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}]}updateFormFields(){let t=this.entity(),e=this.formConfig(),i=t?.[this.valuesKey()]??{};this.formFields=e.fields.map(o=>{switch(o.type){case"text":return k(o.id,o.title,i[o.id]??o.value?.toString()??o.defaultValue?.toString(),{validations:o.required??!1?[{name:"required",validator:w.required,message:`${o.title} is required`}]:[],hint:o.description});case"number":{let r=[];return(o.required??!1)&&r.push({name:"required",validator:w.required,message:`${o.title} is required`}),ji(o.min)&&r.push({name:"min",validator:w.min(o.min),message:`Value must be greater than ${o.min}`}),ji(o.max)&&r.push({name:"max",validator:w.max(o.max),message:`Value must be less than ${o.max}`}),ie(o.id,o.title,i[o.id]??o.value??o.defaultValue,{validations:r,hint:o.description})}default:return}}).filter(o=>o!==void 0)}getUpdateMethod(){switch(this.entityType()){case"asset":return(t,e)=>this.entitiesService.updateAsset(t,e);case"simcard":return(t,e)=>this.entitiesService.updateSimCard(t,e);case"device":return(t,e)=>this.entitiesService.updateDevice(t,e);case"assettag":return(t,e)=>this.entitiesService.updateAssetTag(t,e);default:throw new Error(`Update for '${this.entityType}' not yet supported`)}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-form-section"]],inputs:{valuesKey:[1,"valuesKey"],formConfig:[1,"formConfig"]},features:[O],decls:10,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-sliders-v","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","fields","actions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6),s(),h(7,jg,2,1,"div",6),s()()(),h(8,Bg,1,2,"app-dynamic-form",7)(9,Hg,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(5,zg,i.isFormEditable())),I("aria-label","sliders vertical icon"),d(4),J(i.formConfig().name),d(),y(i.isFormEditable()?-1:7),d(),y(i.isFormEditable()?8:9))},dependencies:[L,z,K,V,q],encapsulation:2})};var co=class n{createDeviceInformationSection(t){return[{id:"device-details",title:"Device Config Details",component:dr,componentInputs:{entity:t},category:"information",order:10},{id:"device-information",title:"Device Information",component:Di,componentInputs:{entity:t,dataPath:"device_information",entityType:"device"},category:"information",order:20},{id:"device-linked-entities",title:"Linked Entities",component:cr,componentInputs:{entity:t,entityType:"device",dataPath:"linked_entities"},category:"information",order:30}]}createDeviceIOSection(t,e,i){return[{id:"device-io-selection",title:"IO Selection",component:wi,componentInputs:{entity:t,entityType:"device",deviceType:e,injectDataAtPath:!0,dataPath:"parameters"},category:"io",order:10},{id:"device-bitmapped-io",title:"Bitmapped IO",component:xi,componentInputs:{entity:t,entityType:"device"},category:"io",order:20},{id:"device-analog-inputs",title:"Analog Inputs",component:Ke,componentInputs:{entity:t,entityType:"device",ioType:"analog_input",iconType:"svg",iconName:"gauge-simple-high-solid",deviceType:e,ioTypes:i},category:"io",order:30},{id:"device-camera-inputs",title:"Camera Inputs",component:Ke,componentInputs:{entity:t,entityType:"device",ioType:"camera_input",iconType:"primeng",iconName:"pi pi-camera",deviceType:e,ioTypes:i},category:"io",order:40},{id:"device-can-bus-inputs",title:"CAN Bus Inputs",component:Ke,componentInputs:{entity:t,entityType:"device",ioType:"can_input",iconType:"svg",iconName:"oil-can-solid",deviceType:e,ioTypes:i},category:"io",order:50},{id:"device-counter-inputs",title:"Counter Inputs",component:Ke,componentInputs:{entity:t,entityType:"device",ioType:"counter_input",iconType:"primeng",iconName:"pi pi-clock",deviceType:e,ioTypes:i},category:"io",order:60},{id:"device-digital-inputs",title:"Digital Inputs",component:Ke,componentInputs:{entity:t,entityType:"device",ioType:"digital_input",iconType:"primeng",iconName:"pi pi-arrow-left",deviceType:e,ioTypes:i},category:"io",order:70},{id:"device-digital-outputs",title:"Digital Outputs",component:Ke,componentInputs:{entity:t,entityType:"device",ioType:"digital_output",iconType:"primeng",iconName:"pi pi-arrow-right",deviceType:e,ioTypes:i},category:"io",order:80},{id:"device-temperature-inputs",title:"Temperature Inputs",component:Ke,componentInputs:{entity:t,entityType:"device",ioType:"temperature_input",iconType:"svg",iconName:"temperature-half-solid",deviceType:e,ioTypes:i},category:"io",order:90},{id:"device-value-inputs",title:"Value Inputs",component:Ke,componentInputs:{entity:t,entityType:"device",ioType:"value_input",iconType:"primeng",iconName:"pi pi-list-check",deviceType:e,ioTypes:i},category:"io",order:100}]}createDeviceAccessoriesSection(t,e){if(!t)return[];let i=[];return Object.entries(e??{}).forEach(([o])=>{i.push({id:`device-accessory-${o}`,title:e?.[o]?.name??o,component:Fi,componentInputs:{entity:t,entityType:"device",dataPath:`accessories.${o}`,deviceTypeAccessory:e?.[o],accessoryId:o,sectionHeader:e?.[o]?.name??o},category:"accessories",order:10+Number(o)})}),i}createSettingsSection(t,e){let i=[];if(f(e?.settingsDefinition))try{i=JSON.parse(e.settingsDefinition).groups.map(r=>({id:r.id,title:r.title,component:mr,componentInputs:{entity:t,formConfig:r,entityType:"device",valuesKey:"settings"},category:"settings",order:10+Number(r.id)}))}catch(o){console.warn("Invalid device type settings definition",e.settingsDefinition),console.error(o)}return[{id:"device-parameters",title:"Device Config Parameters",component:Ti,componentInputs:{entity:t,entityType:"device",dataPath:"parameters",injectDataAtPath:!0,deviceType:e},category:"settings",order:10},...i]}createChangesSection(t){return[{id:"device-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllDeviceSections(t,e,i,o){let r=[...this.createDeviceInformationSection(t)];return f(t?.configProfile?.id)&&t?.configProfile?.id!==Oe||(r.push(...this.createSettingsSection(t,i)),r.push(...this.createDeviceIOSection(t,i,o)),i?.accessories&&Object.keys(i?.accessories)?.length>0&&r.push(...this.createDeviceAccessoriesSection(t,e))),r.push(...this.createChangesSection(t)),r}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var $g=n=>({"icon-primary":n});function Wg(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit geofence details"))}function Zg(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Kg(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.geofenceDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var pr=class n extends Bt{ownerId=E(null);entitiesService=c(P);assetGroupService=c(Pe);measurementUnitsService=c(pt);operationRegistry=c(Q);utilityService=c(he);geofenceDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Name",value:t.name},{key:"Type",value:this.utilityService.toTitleCase(t.zoneType??"")},{key:"Cost Centre",value:t.costCentre?.name??"None"},{key:"Group",value:t.group?.name??"None"},{key:"Speed Limit",value:f(t.speed)&&t.speed>0?this.measurementUnitsService.format(t.speed,"speed").format:"None"},{key:"Proximity Warning",value:f(t.radius)&&t.radius>0?this.measurementUnitsService.format(t.radius,"distance").format:"None"}]:[]});zoneGroups=[];costCenters=[];requestMapper;constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.entity();if(f(t)){let e=[],i=this.loadCostCentres(t.ownerId).catch(()=>{console.error("Failed to load cost centres")});e.push(i);let o=this.assetGroupService.getZoneGroupsAsTree(t.ownerId).then(r=>{this.zoneGroups=r}).catch(()=>{console.error("Failed to load zone groups")});e.push(o),Promise.all(e).then(()=>{this.initializeRequestMapper(),this.updateFormFields()}).catch(()=>{})}})}async loadCostCentres(t){let e=await this.assetGroupService.getCostCentresAsTree(t);this.costCenters=e}initializeRequestMapper(){this.requestMapper=new Rt({name:{requestProperty:"name",validate:t=>typeof t=="string"&&t.length>0},zoneType:{requestProperty:"zoneType",validate:t=>typeof t=="string"&&t.length>0},costCentre:{requestProperty:"costCentre",transform:t=>{let e=this.assetGroupService.findInTree(this.costCenters,`${t.id}`);return e?{id:e.id,name:e.name}:void 0}},group:{requestProperty:"group",transform:t=>{let e=this.assetGroupService.findInTree(this.zoneGroups,t.id);return e?{id:e.id,name:e.name}:void 0}},speed:{requestProperty:"speed",transform:t=>{if(typeof t=="number")return this.measurementUnitsService.toBackend("speed",t)}},radius:{requestProperty:"radius",transform:t=>{if(typeof t=="number")return this.measurementUnitsService.toBackend("distance",t)}}})}updateFormFields(){let t=this.entity();this.formFields=[k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),H("zoneType","Type",Tn(qs.ZoneTypeEnum).map(e=>(e.label==="Nogo"&&(e.label="No Go"),e.label==="Keepin"&&(e.label="Keep In"),e)),t?.zoneType,{name:"zoneType",validations:[{name:"required",validator:w.required,message:"Type is required"}],props:{appendTo:"body"}}),ti("costCentre","Cost Centre",t?.costCentre?{id:t.costCentre.id,label:t.costCentre.name,data:t.costCentre}:null,this.costCenters,{name:"costCentre",validations:[{name:"required",validator:w.required,message:"Cost centre is required"}],props:{appendTo:"body",placeholder:"Select Cost Centre",multiple:!1,showClear:!0,selectionMode:"single",filter:!0}}),ti("group","Group",t?.group?{id:t.group.id,label:t.group.name,data:t.group}:null,this.zoneGroups,{name:"group",validations:[{name:"required",validator:w.required,message:"Group is required"}],props:{appendTo:"body",placeholder:"Select Group",multiple:!1,showClear:!0,selectionMode:"single",filter:!0}}),ie("speed","Speed Limit",this.measurementUnitsService.fromBackend("speed",t?.speed??0),{name:"speed",props:{appendTo:"body",placeholder:"Enter Speed Limit",showClear:!0,suffix:this.measurementUnitsService.unitSymbol("speed")}}),ie("radius","Proximity Warning",this.measurementUnitsService.fromBackend("distance",t?.radius??0),{name:"radius",props:{appendTo:"body",placeholder:"Enter Proximity Warning",showClear:!0,suffix:this.measurementUnitsService.unitSymbol("distance")}})]}getUpdateMethod(){return this.operationRegistry.getOperation("zone","update")??((t,e)=>this.entitiesService.updateZone(t,e))}onFormValueChange(t){try{let e=this.transformFormData(t);this.formValueChange.emit(e)}catch(e){console.warn("Form data transformation failed:",e),this.formValueChange.emit(t)}}transformFormData(t){if(!this.requestMapper)return{};try{let e=Array.isArray(t)?t.reduce((r,u)=>M(M({},r),u),{}):t,i=this.requestMapper.transform(e),o={};return"name"in i&&(o.name=i.name),"zoneType"in i&&(o.zoneType=i.zoneType),"costCentre"in i&&(o.costCentre=i.costCentre),"group"in i&&(o.group=i.group),"speed"in i&&(o.speed=i.speed),"radius"in i&&(o.radius=i.radius),o}catch(e){throw console.error("Form data transformation failed:",e),e}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-geofence-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-map","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Geofence Details"),s(),h(7,Wg,2,1,"div",6),s(),l(8,"span"),D(9,"Configure various details about your Geofence."),s()()(),h(10,Zg,1,3,"app-dynamic-form",7),h(11,Kg,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(5,$g,i.isFormEditable())),I("aria-label","map icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,Te,V,q],encapsulation:2})};var ld=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=nn({type:n});static \u0275inj=tn({})}return n})();var ur=class n{apiKey="";librariesLoaded={};constructor(){}setApiKey(t){this.apiKey=t}loadGoogleMaps(t=[]){if(typeof google<"u"&&f(google?.maps)&&t.every(o=>this.librariesLoaded[o]))return Promise.resolve();if(window.googleMapsInitialized)return window.googleMapsInitialized;if(document.querySelector('script[src^="https://maps.googleapis.com/maps/api/js"]'))return window.googleMapsInitialized=window.googleMapsInitialized??new Promise(o=>{typeof google<"u"&&f(google.maps)?o():window.googleMapsCallback=()=>{o(),delete window.googleMapsCallback}}),window.googleMapsInitialized;let i=new Promise((o,r)=>{window.googleMapsCallback=()=>{t.forEach(u=>this.librariesLoaded[u]=!0),o(),delete window.googleMapsCallback};try{let u=document.createElement("script"),b=t.length?`&libraries=${t.join(",")}`:"";u.src=`https://maps.googleapis.com/maps/api/js?key=${this.apiKey}${b}&callback=googleMapsCallback&loading=async`,u.async=!0,u.defer=!0,u.onerror=()=>r(new Error("Failed to load Google Maps API")),document.head.appendChild(u)}catch(u){r(u instanceof Error?u:new Error(String(u)))}});return window.googleMapsInitialized=i,i}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Qg=["mapContainer"],fr=class n{ngZone=c(ps);googleMapsLoader=c(ur);mapContainer;apiKey=E(ks.googleMapsApiKey);center=E({lat:40.7128,lng:-74.006});zoom=E(12);mapTypeId=E("roadmap");markers=Ni([]);useAdvancedMarkers=E(!0);polygons=Ni([]);class=E("w-full h-[500px]");enableTrafficLayer=E(!1);clickableMarkers=E(!0);fitBoundsToMarkers=E(!1);mapClick=ct();markerClick=ct();mapLoaded=ct();boundsChanged=ct();centerChanged=ct();markerDragEnd=ct();polygonChanged=ct();map;legacyMarkers=[];advancedMarkers=[];googlePolygons=[];infoWindow=null;isMapInitialized=R(!1);trafficLayer;polygonEventListeners=[];boundsChangedTimeout=null;constructor(){U(()=>{this.isMapInitialized()&&(this.map.setCenter(this.center()),this.map.setZoom(this.zoom()))}),U(()=>{this.isMapInitialized()&&this.updateMarkers()}),U(()=>{this.isMapInitialized()&&this.updatePolygons()}),U(()=>{this.isMapInitialized()&&(this.toggleTrafficLayer(),this.map.setMapTypeId(this.mapTypeId()))})}ngAfterViewInit(){this.apiKey()&&this.googleMapsLoader.setApiKey(this.apiKey()),this.googleMapsLoader.loadGoogleMaps(["geometry"]).then(()=>{this.initializeMap()}).catch(t=>{console.error("Error loading Google Maps API:",t)})}ngOnDestroy(){for(let t of this.polygonEventListeners)google.maps.event.removeListener(t);this.polygonEventListeners=[],this.clearMarkers();for(let t of this.googlePolygons)t.setMap(null);this.googlePolygons=[],this.trafficLayer&&(this.trafficLayer.setMap(null),this.trafficLayer=void 0),this.infoWindow&&(this.infoWindow.close(),this.infoWindow=null),f(this.map)&&google.maps.event.clearInstanceListeners(this.map)}initializeMap(t=0){if(T(this.mapContainer)){t<5?setTimeout(()=>this.initializeMap(t+1),100):console.error("Map container not found after multiple attempts.");return}let e={center:this.center(),zoom:this.zoom(),mapTypeId:this.mapTypeId(),streetViewControl:!0,mapTypeControl:!0,fullscreenControl:!0,zoomControl:!0};this.map=new google.maps.Map(this.mapContainer.nativeElement,e),this.infoWindow=new google.maps.InfoWindow,this.isMapInitialized.set(!0),this.map.addListener("click",i=>{this.ngZone.run(()=>this.mapClick.emit(i))}),this.map.addListener("bounds_changed",()=>{this.boundsChangedTimeout!==null&&window.clearTimeout(this.boundsChangedTimeout),this.boundsChangedTimeout=window.setTimeout(()=>{this.ngZone.run(()=>{let i=this.map.getBounds();i&&this.boundsChanged.emit(i)})},100)}),this.enableTrafficLayer()&&this.toggleTrafficLayer(),this.updateMarkers(),this.updatePolygons(),this.ngZone.run(()=>this.mapLoaded.emit(this.map))}updateMarkers(){this.clearMarkers();let t=this.markers();if(f(t)&&t.length>0){let e=new google.maps.LatLngBounds;for(let i of t)e.extend(i.position),this.useAdvancedMarkers()&&f(google.maps.marker.AdvancedMarkerElement)?this.createAdvancedMarker(i,e):this.createLegacyMarker(i,e);this.fitBoundsToMarkers()&&t.length>0&&this.map.fitBounds(e)}}createAdvancedMarker(t,e){if(T(google.maps.marker)||T(google.maps.marker.AdvancedMarkerElement)){console.warn("Advanced Marker Element is not available. Falling back to legacy marker."),this.createLegacyMarker(t,e);return}let i;f(t.title)&&(i=new google.maps.marker.PinElement({glyph:t.title.charAt(0).toUpperCase(),glyphColor:"white",background:f(t.icon)&&typeof t.icon=="string"?t.icon:"#1E88E5"}));let o={map:this.map,position:t.position,title:t.title,content:i??void 0};f(t.draggable)&&(o.gmpDraggable=!0);let r=new google.maps.marker.AdvancedMarkerElement(o);this.advancedMarkers.push(r),this.clickableMarkers()&&r.addListener("click",()=>{this.ngZone.run(()=>{f(t.infoContent)&&this.infoWindow&&(this.infoWindow.setContent(t.infoContent),this.infoWindow.open(this.map,r)),this.markerClick.emit({marker:r,customData:t.customData})})}),f(t.draggable)&&r.addListener("dragend",()=>{this.ngZone.run(()=>{let u=r.position;f(u)&&this.markerDragEnd.emit({marker:r,position:{lat:u.lat,lng:u.lng},customData:t.customData})})})}createLegacyMarker(t,e){let i={position:t.position,map:this.map,title:t.title??"",icon:Ye(t.icon)?t.icon:void 0,draggable:t.draggable??!1},o=new google.maps.Marker(i);this.legacyMarkers.push(o),this.clickableMarkers()&&o.addListener("click",()=>{this.ngZone.run(()=>{f(t.infoContent)&&this.infoWindow&&(this.infoWindow.setContent(t.infoContent),this.infoWindow.open(this.map,o)),this.markerClick.emit({marker:o,customData:t.customData})})}),f(t.draggable)&&o.addListener("dragend",()=>{this.ngZone.run(()=>{let r=o.getPosition();r&&this.markerDragEnd.emit({marker:o,position:{lat:r.lat(),lng:r.lng()},customData:t.customData})})})}clearMarkers(){for(let t of this.legacyMarkers)t.setMap(null);this.legacyMarkers=[];for(let t of this.advancedMarkers)t.map=null;this.advancedMarkers=[]}updatePolygons(){this.clearPolygons();let t=this.polygons();if(f(t)&&t.length>0)for(let e of t){let i=new google.maps.Polygon({paths:e.paths,strokeColor:e.strokeColor??"#FF0000",strokeOpacity:e.strokeOpacity??.8,strokeWeight:e.strokeWeight??2,fillColor:e.fillColor??"#FF0000",fillOpacity:e.fillOpacity??.35,editable:e.editable??!1,draggable:e.draggable??!1,map:this.map});this.googlePolygons.push(i);let o=i.addListener("mouseup",()=>{this.ngZone.run(()=>{let r=i.getPath(),u=[];for(let b=0;b<r.getLength();b++){let x=r.getAt(b);u.push({lat:x.lat(),lng:x.lng()})}this.polygonChanged.emit({polygon:i,paths:u,customData:e.customData})})});this.polygonEventListeners.push(o)}}clearPolygons(){for(let t of this.polygonEventListeners)google.maps.event.removeListener(t);this.polygonEventListeners=[];for(let t of this.googlePolygons)t.setMap(null);this.googlePolygons=[]}toggleTrafficLayer(){this.enableTrafficLayer()?(this.trafficLayer??=new google.maps.TrafficLayer,this.trafficLayer.setMap(this.map)):this.trafficLayer&&this.trafficLayer.setMap(null)}resizeMap(){this.isMapInitialized()&&google.maps.event.trigger(this.map,"resize")}panTo(t){this.isMapInitialized()&&this.map.panTo(t)}setZoom(t,e=!0){if(!this.isMapInitialized())return;let i=t;e&&(i=Math.max(3,Math.min(19,t))),this.map.setZoom(i)}clearAllMarkers(){this.isMapInitialized()&&this.clearMarkers()}fitBounds(){if(!this.isMapInitialized()||this.legacyMarkers.length===0&&this.advancedMarkers.length===0)return;let t=new google.maps.LatLngBounds;for(let e of this.legacyMarkers){let i=e.getPosition();i&&t.extend(i)}for(let e of this.advancedMarkers){let i=e.position;i&&t.extend(i)}this.map.fitBounds(t)}updatePolygonPaths(t,e){this.isMapInitialized()&&f(this.polygons()[t])&&f(this.googlePolygons[t])&&this.googlePolygons[t].setPaths(e)}setPolygonEditable(t,e){this.isMapInitialized()&&f(this.polygons()[t])&&this.googlePolygons[t].setEditable(e)}setPolygonDraggable(t,e){this.isMapInitialized()&&f(this.polygons()[t])&&this.googlePolygons[t].setDraggable(e)}removePolygon(t){this.isMapInitialized()&&f(this.polygons()[t])&&(this.googlePolygons[t].setMap(null),this.googlePolygons.splice(t,1))}clearAllPolygons(){this.isMapInitialized()&&this.clearPolygons()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-google-map"]],viewQuery:function(e,i){if(e&1&&pe(Qg,5),e&2){let o;le(o=de())&&(i.mapContainer=o.first)}},inputs:{apiKey:[1,"apiKey"],center:[1,"center"],zoom:[1,"zoom"],mapTypeId:[1,"mapTypeId"],markers:[1,"markers"],useAdvancedMarkers:[1,"useAdvancedMarkers"],polygons:[1,"polygons"],class:[1,"class"],enableTrafficLayer:[1,"enableTrafficLayer"],clickableMarkers:[1,"clickableMarkers"],fitBoundsToMarkers:[1,"fitBoundsToMarkers"]},outputs:{markers:"markersChange",polygons:"polygonsChange",mapClick:"mapClick",markerClick:"markerClick",mapLoaded:"mapLoaded",boundsChanged:"boundsChanged",centerChanged:"centerChanged",markerDragEnd:"markerDragEnd",polygonChanged:"polygonChanged"},decls:3,vars:1,consts:[["mapContainer",""],[1,"google-map-container"],[1,"map-container",3,"ngClass"]],template:function(e,i){e&1&&(l(0,"div",1),C(1,"div",2,0),s()),e&2&&(d(),g("ngClass",i.class()))},dependencies:[L,z,ld],styles:[".google-map-container[_ngcontent-%COMP%]{display:block;width:100%}.google-map-container[_ngcontent-%COMP%]   .map-container[_ngcontent-%COMP%]{border-radius:.5rem;box-shadow:0 4px 6px #0000001a}"]})};var Yg=["map"];function Jg(n,t){if(n&1&&(l(0,"div",4),D(1),s()),n&2){let e=a();d(),ye(" ",e.errorMessage," ")}}function Xg(n,t){if(n&1){let e=S();l(0,"button",9),_("click",function(){m(e);let o=a(2);return p(o.startEditing())}),D(1," Edit Zone "),s()}}function eh(n,t){if(n&1){let e=S();l(0,"button",10),_("click",function(){m(e);let o=a(2);return p(o.saveZone())}),D(1," Save Changes "),s()}}function th(n,t){if(n&1){let e=S();l(0,"button",11),_("click",function(){m(e);let o=a(2);return p(o.stopEditing())}),D(1," Cancel "),s()}}function ih(n,t){if(n&1&&(l(0,"div",5),h(1,Xg,2,0,"button",6),h(2,eh,2,0,"button",7),h(3,th,2,0,"button",8),s()),n&2){let e=a();d(),y(e.editable()?-1:1),d(),y(e.editable()?2:-1),d(),y(e.editable()?3:-1)}}var gr=class n{entity=E.required();editable=Ni(!1);onEditing=ct();onSaving=ct();onSaved=ct();map;entitiesService=c(P);changeDetectorRef=c(Me);errorMessage=null;zonePolygon=null;routePolyline=null;polygonChangedCleanup;routeEventListeners=[];center=R({lat:40.7128,lng:-74.006});fitBoundsTimeout;constructor(){let t=R(!1);U(()=>{let e=this.entity(),i=t();if(f(e?.points)&&e.points.length>0){let o=e.points.reduce((u,b)=>u+b.x,0)/e.points.length,r=e.points.reduce((u,b)=>u+b.y,0)/e.points.length;this.center.set({lat:r,lng:o})}i&&f(e)&&setTimeout(()=>{if(this.entity()===e){if(this.loadZone(),f(e.points)&&e.points.length>0){let o=e.points.map(r=>({lat:r.y,lng:r.x}));clearTimeout(this.fitBoundsTimeout),this.fitBoundsTimeout=setTimeout(()=>{this.entity()===e&&this.fitZoneToViewport(o,e)},200)}this.setupPolygonChangeSubscription(e)}},100)}),gs(()=>{f(this.map)&&(this.map.isMapInitialized()&&t.set(!0),this.map.mapLoaded.subscribe(()=>{t.set(!0)}))}),U(()=>{let e=this.entity();f(this.map)&&f(e)&&(e.zoneType==="route"?this.updateRouteEditableStatus():this.zonePolygon&&this.updatePolygonEditableStatus())})}setupPolygonChangeSubscription(t){t?.zoneType!=="route"&&(this.polygonChangedCleanup&&(this.polygonChangedCleanup.unsubscribe(),this.polygonChangedCleanup=void 0),this.polygonChangedCleanup=this.map.polygonChanged.subscribe(e=>{if(f(t)&&e.customData?.id===t.id){let i=ee(M({},t),{points:e.paths.map(o=>({x:o.lng,y:o.lat}))});this.onSaved.emit(i)}}))}ngOnDestroy(){this.clearRouteListeners(),this.routePolyline&&(this.routePolyline.setMap(null),this.routePolyline=null),this.polygonChangedCleanup&&(this.polygonChangedCleanup.unsubscribe(),this.polygonChangedCleanup=void 0),f(this.fitBoundsTimeout)&&clearTimeout(this.fitBoundsTimeout)}loadZone(){let t=this.entity();if(T(this.map)||!this.map.isMapInitialized()||T(t))return;this.clearMapElements();let e=(t.points??[]).map(i=>({lat:i.y,lng:i.x}));if(t.zoneType==="route")this.displayRoute(e);else{let i="";switch(t.zoneType){case"nogo":i="#FF0000";break;case"keepin":i="#4CAF50";break;default:i="#1E88E5";break}this.zonePolygon={paths:e,editable:this.editable(),draggable:this.editable(),fillOpacity:.35,strokeWeight:2,customData:{entityType:"zone",entityId:t.id},fillColor:i,strokeColor:i},this.zonePolygon.paths.length>0?this.map.polygons.set([this.zonePolygon]):this.map.polygons.set([])}}fitZoneToViewport(t,e){if(!(T(this.map?.map)||typeof google>"u"||t.length===0))try{let i=new google.maps.LatLngBounds;t.forEach(b=>i.extend(b));let o=this.calculateArea(t),r=50;o<.01?r=100:o>10&&(r=10);let u=i.getCenter();f(u)&&this.center.set({lat:u.lat(),lng:u.lng()}),f(this.fitBoundsTimeout)&&clearTimeout(this.fitBoundsTimeout),this.fitBoundsTimeout=setTimeout(()=>{let b=new google.maps.LatLngBounds;t.forEach(x=>b.extend(x)),this.map.map.fitBounds(b,r),(t.length===1||o<1e-4)&&setTimeout(()=>{(this.map.map.getZoom()??0)>18&&this.map.setZoom(18)},150),o>1e3&&setTimeout(()=>{(this.map.map.getZoom()??0)<5&&this.map.setZoom(5)},150),this.changeDetectorRef.markForCheck()},50)}catch(i){console.error("Error fitting bounds:",i)}}calculateArea(t){if(t.length<3)return 0;try{if(typeof google<"u"){let e=t.map(i=>new google.maps.LatLng(i.lat,i.lng));return google.maps.geometry.spherical.computeArea(e)/1e6}else{let e=t[0].lat,i=t[0].lat,o=t[0].lng,r=t[0].lng;t.forEach(x=>{e=Math.min(e,x.lat),i=Math.max(i,x.lat),o=Math.min(o,x.lng),r=Math.max(r,x.lng)});let u=i-e,b=r-o;return u*b*111*111}}catch(e){return console.error("Error calculating area:",e),0}}clearMapElements(){if(this.zonePolygon)try{let e=(this.map.polygons()??[]).filter(i=>i.customData?.id!==this.entity()?.id);this.map.polygons.set(e),this.zonePolygon=null}catch(t){console.error("Error clearing polygon:",t)}if(this.routePolyline)try{this.routePolyline.setMap(null),this.routePolyline=null}catch(t){console.error("Error clearing polyline:",t)}}displayRoute(t){if(!(typeof google>"u")){this.clearRouteListeners();try{this.routePolyline=new google.maps.Polyline({path:t,geodesic:!0,strokeColor:"#4CAF50",strokeOpacity:1,strokeWeight:4,editable:this.editable(),map:this.map.map});let e=this.routePolyline.addListener("click",()=>{});if(this.routeEventListeners.push(e),this.editable()){let i=google.maps.event.addListener(this.routePolyline.getPath(),"set_at",()=>this.handleRoutePathChanged());this.routeEventListeners.push(i);let o=google.maps.event.addListener(this.routePolyline.getPath(),"insert_at",()=>this.handleRoutePathChanged());this.routeEventListeners.push(o);let r=google.maps.event.addListener(this.routePolyline.getPath(),"remove_at",()=>this.handleRoutePathChanged());this.routeEventListeners.push(r)}}catch(e){console.error("Failed to display route:",e),this.errorMessage=`Failed to display route: ${e instanceof Error?e.message:"Unknown error"}`}}}clearRouteListeners(){this.routeEventListeners.length>0&&(this.routeEventListeners.forEach(t=>google.maps.event.removeListener(t)),this.routeEventListeners=[])}handleRoutePathChanged(){if(!this.routePolyline)return;let t=this.routePolyline.getPath(),e=[];for(let o=0;o<t.getLength();o++){let r=t.getAt(o);e.push({x:r.lng(),y:r.lat()})}let i=ee(M({},this.entity()),{points:e});this.onSaving.emit(!0),this.onSaved.emit(i)}updateRouteEditableStatus(){if(T(this.map)||T(this.routePolyline))return;let t=this.editable();this.routePolyline.setEditable(t),this.routePolyline.setOptions({draggable:t,editable:t})}displayPolygon(t){let e="#1E88E5",i="#1E88E5",o=this.entity();o.zoneType==="nogo"?(e="#FF0000",i="#FF0000"):o.zoneType==="keepin"&&(e="#4CAF50",i="#4CAF50"),this.zonePolygon={paths:t,strokeColor:e,strokeOpacity:.8,strokeWeight:2,fillColor:i,fillOpacity:.35,editable:this.editable(),draggable:this.editable(),customData:{id:o.id,name:o.name??""}};let u=(this.map.polygons()??[]).filter(b=>b.customData?.id!==o.id);this.map.polygons.set([...u,this.zonePolygon]),setTimeout(()=>{this.changeDetectorRef.markForCheck()},0)}updatePolygonEditableStatus(){if(T(this.map)||T(this.zonePolygon))return;let t=this.map.polygons()??[],e=t.findIndex(i=>i.customData?.id===this.entity().id);if(e!==-1){let i=ee(M({},t[e]),{editable:this.editable(),draggable:this.editable()}),o=[...t];o[e]=i,this.map.polygons.set(o),this.zonePolygon=i,f(this.map.googlePolygons)&&this.map.googlePolygons.length>e&&(this.map.googlePolygons[e].setEditable(this.editable()),this.map.googlePolygons[e].setDraggable(this.editable()))}}async saveZone(){let t=this.entity();if(!T(t))try{this.onSaving.emit(!0);let e=[];if(t.zoneType==="route"&&this.routePolyline){let r=this.routePolyline.getPath();for(let u=0;u<r.getLength();u++){let b=r.getAt(u);e.push({x:b.lng(),y:b.lat()})}}else if(this.zonePolygon){let r=this.map.googlePolygons?.find((b,x)=>this.map.polygons()[x].customData?.id===this.entity().id);if(!r)throw new Error("Polygon not found");let u=r.getPath();for(let b=0;b<u.getLength();b++){let x=u.getAt(b);e.push({x:x.lng(),y:x.lat()})}}else throw new Error("No polygon or route data found");let i={points:e},o=await Ce(this.entitiesService.updateZone(t.id,i));this.onSaved.emit(o)}catch(e){this.showError(e)}}startEditing(){this.editable()||(this.editable.set(!0),this.entity()?.zoneType==="route"?this.updateRouteEditableStatus():this.updatePolygonEditableStatus(),this.onEditing.emit(!0))}stopEditing(){this.editable()&&(this.editable.set(!1),this.entity()?.zoneType==="route"?this.updateRouteEditableStatus():this.updatePolygonEditableStatus(),this.onEditing.emit(!1))}showError(t){this.errorMessage=t?.message??"An error occurred while saving the zone",this.changeDetectorRef.markForCheck()}onPolygonChanged(t){t.customData?.id===this.entity()?.id&&(this.zonePolygon=ee(M({},this.zonePolygon),{paths:t.paths}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-google-maps-zone"]],viewQuery:function(e,i){if(e&1&&pe(Yg,5),e&2){let o;le(o=de())&&(i.map=o.first)}},inputs:{entity:[1,"entity"],editable:[1,"editable"]},outputs:{editable:"editableChange",onEditing:"onEditing",onSaving:"onSaving",onSaved:"onSaved"},decls:6,vars:5,consts:[["map",""],[1,"google-maps-zone-container"],[1,"map-container"],[3,"polygonChanged","center"],[1,"error-message","mt-2","p-2","bg-red-100","text-red-700","rounded"],[1,"actions","mt-3"],[1,"edit-btn","bg-blue-600","hover:bg-blue-700","text-white","py-2","px-4","rounded"],[1,"save-btn","bg-green-600","hover:bg-green-700","text-white","py-2","px-4","rounded","mr-2"],[1,"cancel-btn","bg-gray-600","hover:bg-gray-700","text-white","py-2","px-4","rounded"],[1,"edit-btn","bg-blue-600","hover:bg-blue-700","text-white","py-2","px-4","rounded",3,"click"],[1,"save-btn","bg-green-600","hover:bg-green-700","text-white","py-2","px-4","rounded","mr-2",3,"click"],[1,"cancel-btn","bg-gray-600","hover:bg-gray-700","text-white","py-2","px-4","rounded",3,"click"]],template:function(e,i){if(e&1){let o=S();l(0,"div",1)(1,"div",2)(2,"app-google-map",3,0),_("polygonChanged",function(u){return m(o),p(i.onPolygonChanged(u))}),s()(),h(4,Jg,2,1,"div",4),h(5,ih,4,3,"div",5),s()}e&2&&(d(2),Le("h-[400px] w-full"),g("center",i.center()),d(2),y(i.errorMessage?4:-1),d(),y(i.entity()?5:-1))},dependencies:[fr],styles:[".google-maps-container[_ngcontent-%COMP%]{width:100%;height:100%;min-height:400px}[_nghost-%COMP%]{display:block;width:100%;height:100%}.google-maps-zone-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}.google-maps-zone-container[_ngcontent-%COMP%]   .map-container[_ngcontent-%COMP%]{width:100%;border:1px solid #e0e0e0;border-radius:4px;overflow:hidden}.google-maps-zone-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}.google-maps-zone-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:16px;display:flex}.google-maps-zone-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{transition:background-color .2s}.google-maps-zone-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(:last-child){margin-right:8px}"]})};var hr=class n extends B{entitiesService=c(P);updateFormFields(){}submitChanges(t){let e=this.entity();T(e)||this.entitiesService.updateZone(e.id,t).pipe(W(this.destroyRef)).subscribe({next:i=>{this.isFormEditable.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"geofence",operation:"update",entityId:e.id,data:i})},error:()=>{this.isFormEditable.set(!0)}})}static \u0275fac=(()=>{let t;return function(i){return(t||(t=He(n)))(i||n)}})();static \u0275cmp=F({type:n,selectors:[["app-geofence-map-section"]],features:[O],decls:1,vars:1,consts:[[3,"onSaved","entity"]],template:function(e,i){e&1&&(l(0,"app-google-maps-zone",0),_("onSaved",function(r){return i.submitChanges(r)}),s()),e&2&&g("entity",i.entity())},dependencies:[gr],encapsulation:2})};var po=class n{createGeofenceInformationSections(t){return[{id:"geofence-details",title:"Geofence Details",component:pr,componentInputs:{entity:t},category:"information",order:10},{id:"geofence-map",title:"Geofence Map",component:hr,componentInputs:{entity:t},category:"information",order:20}]}createChangesSection(t){return[{id:"geofence-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllGeofenceSections(t){return[...this.createGeofenceInformationSections(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var nh=n=>({"icon-primary":n});function oh(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit device provider details"))}function rh(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function ah(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.deviceProviderDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var yr=class n extends B{ownerId=E(null);entitiesService=c(P);operationRegistry=c(Q);cdr=c(Me);selectOptionsLoaded=R(!1);deviceProviderDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Type",value:t.deviceProviderType?.name??"None"},{key:"Name",value:t.name}]:[]});selectOptions={};faPlug=Ml;constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.selectOptionsLoaded()&&_e(()=>{this.updateFormFields(),this.cdr.detectChanges()})})}ngOnInit(){this.loadSelectOptions()}loadSelectOptions(){let t=this.entity(),e=this.ownerId(),i=t?.owner?.id??e;T(i)&&(this.selectOptions={},this.selectOptionsLoaded.set(!0),this.updateFormFields()),this.entitiesService.listDeviceProviderTypes(i).pipe(W(this.destroyRef)).subscribe(o=>{this.selectOptions={deviceProviderTypes:o.items.map(r=>({label:r?.name,value:r.id,data:r})).sort((r,u)=>r.label.localeCompare(u.label))},this.selectOptionsLoaded.set(!0)})}updateFormFields(){let t=this.entity();this.formFields=[H("deviceProviderType","Type",this.selectOptions?.deviceProviderTypes,t?.deviceProviderType?.id,{name:"deviceProviderType",validations:[{name:"required",validator:w.required,message:"Type is required"}],disabled:!this.createMode(),props:{appendTo:"body"}}),k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]})]}getUpdateMethod(){return this.operationRegistry.getOperation("device-provider","update")??((t,e)=>this.entitiesService.updateDeviceProvider(t,e))}onFormValueChange(t){let e=M({},t);if(f(e.deviceProviderType)){let i=e.deviceProviderType,o=this.selectOptions?.deviceProviderTypes?.find(r=>r.value===i);o&&(e.deviceProviderType={id:i,name:o.data?.name})}this.formValueChange.emit(e)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-provider-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Device Provider Details"),s(),h(7,oh,2,1,"div",6),s(),l(8,"span"),D(9,"The following information is required in order to configure your device provider."),s()()(),h(10,rh,1,3,"app-dynamic-form",7),h(11,ah,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faPlug)("ngClass",N(5,nh,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,Te,V,q,te,ne],encapsulation:2})};var sh=n=>({"icon-primary":n});function lh(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit device parameters details"))}function dh(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function ch(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.deviceProviderDeviceParameters())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var vr=class n extends B{ownerId=E(null);deviceProviderType=E(null);entitiesService=c(P);operationRegistry=c(Q);isLoadingDeviceType=R(!1);deviceType=R(null);customValues=R({});deviceProviderDeviceParameters=v(()=>{let t=this.entity()?.parameters,e=this.deviceProviderType();if(T(t)||T(e))return[];let i=JSON.parse(e.parameters),o=[];return i.groups.forEach(r=>{r.fields.forEach(u=>{o.push({key:u.title,value:typeof t?.[u.id]=="object"?JSON.stringify(t?.[u.id]):t?.[u.id]??"None"})})}),o});selectOptions={};constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.deviceProviderType()&&this.updateFormFields()})}updateFormFields(){let t=this.entity(),e=this.deviceProviderType();if(!e)return;let o=JSON.parse(e.parameters).groups.reduce((r,u)=>{let b=u.fields.map(x=>x.type==="memo"?Ge(x.id,x.title,t?.parameters?.[x.id],{name:x.id,validations:x.required??!1?[{name:"required",validator:w.required,message:`${x.title} is required`}]:[],hint:x.description}):x.type==="number"?ie(x.id,x.title,t?.parameters?.[x.id],{name:x.id,validations:x.required??!1?[{name:"required",validator:w.required,message:`${x.title} is required`}]:[],hint:x.description}):k(x.id,x.title,t?.parameters?.[x.id],{name:x.id,validations:x.required??!1?[{name:"required",validator:w.required,message:`${x.title} is required`}]:[],hint:x.description}));return[...r,...b]},[]);this.formFields=[{key:"parameters",name:"parameters",type:"group",fields:o}]}getUpdateMethod(){return this.operationRegistry.getOperation("device-providers","update")??((t,e)=>this.entitiesService.updateDeviceProvider(t,e))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-provider-parameters-section"]],inputs:{ownerId:[1,"ownerId"],deviceProviderType:[1,"deviceProviderType"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-wrench","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Parameters"),s(),h(7,lh,2,1,"div",6),s(),l(8,"span"),D(9,"Configure the following parameters that are required to communicate with the up-stream provider."),s()()(),h(10,dh,1,3,"app-dynamic-form",7),h(11,ch,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(5,sh,i.isFormEditable())),I("aria-label","wrench icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,Te,V,q],encapsulation:2})};var fo=class n{createDeviceProviderInformationSection(t,e){return[{id:"device-provider-details",title:"Device Config Details",component:yr,componentInputs:{entity:t},category:"information",order:10},{id:"device-provider-parameters",title:"Device Config Parameters",component:vr,componentInputs:{entity:t,entityType:"device-provider",dataPath:"parameters",injectDataAtPath:!0,deviceProviderType:e},category:"information",order:20}]}createChangesSection(t){return[{id:"device-provider-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllDeviceProviderSections(t,e){return[...this.createDeviceProviderInformationSection(t,e),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var mh=n=>({"icon-primary":n});function ph(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit sms gateway provider details"))}function uh(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function fh(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.smsGatewayProviderDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Cr=class n extends Bt{ownerId=E(null);entitiesService=c(P);operationRegistry=c(Q);apiSchemaService=c(bt);cdr=c(Me);selectOptionsLoaded=R(!1);entityName="smsgatewayprovider";selectOptions={};faComments=Il;smsGatewayProviderDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Type",value:this.apiSchemaService.getEntityType(t,this.entityName)?.name??"None"},{key:"Name",value:t.name}]:[]});requestMapper;constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.selectOptionsLoaded()&&(this.initializeRequestMapper(),_e(()=>{this.updateFormFields(),this.cdr.detectChanges()}))}),U(()=>{let t=this.entity();f(t)&&!this.createMode()&&_e(()=>{this.updateFormFields()})})}ngOnInit(){this.loadSelectOptions()}loadSelectOptions(){let t=this.entity(),e=this.ownerId(),i=t?.owner?.id??e;if(T(i)){this.selectOptions={},this.selectOptionsLoaded.set(!0),this.updateFormFields();return}this.entitiesService.listSmsGatewayProviderTypes(i).pipe(W(this.destroyRef)).subscribe(o=>{this.selectOptions={smsGatewayProviderTypes:o.items.map(r=>({label:r?.name,value:r.id,data:r})).sort((r,u)=>r.label.localeCompare(u.label))},this.selectOptionsLoaded.set(!0)})}initializeRequestMapper(){this.requestMapper=new Rt({name:{requestProperty:"name",transform:t=>t},[this.apiSchemaService.getTypePropertyKey(this.entityName)]:{requestProperty:this.apiSchemaService.getTypePropertyKey(this.entityName),transform:t=>{let e=this.selectOptions?.smsGatewayProviderTypes?.find(i=>i.value===t);return e?{id:e.value,name:e.label}:null}}})}updateFormFields(){let t=this.entity(),e=this.apiSchemaService.getEntityType(t,this.entityName);this.formFields=[H(this.apiSchemaService.getTypePropertyKey(this.entityName),"Type",this.selectOptions?.smsGatewayProviderTypes,e?.id??null,{name:this.apiSchemaService.getTypePropertyKey(this.entityName),validations:[{name:"required",validator:w.required,message:"Type is required"}],disabled:!this.createMode()&&!this.apiSchemaService.usesModernSchema()&&f(e)&&f(e?.id),props:{appendTo:"body"}}),k("name","Name",t?.name??"",{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]})]}getUpdateMethod(){return this.operationRegistry.getOperation("sms-gateway-provider","update")??((t,e)=>this.entitiesService.updateSmsGatewayProvider(t,e))}onFormValueChange(t){try{let e=this.transformFormData(t);this.formValueChange.emit(e)}catch(e){console.warn("Form data transformation failed:",e),this.formValueChange.emit(t)}}transformFormData(t){if(!this.requestMapper)return{};try{let e=Array.isArray(t)?t.reduce((r,u)=>M(M({},r),u),{}):t,i=this.requestMapper.transform(e),o={};for(let r in i)i[r]!==void 0&&(o[r]=i[r]);return o}catch(e){throw console.error("Error transforming form data:",e),e}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-sms-gateway-provider-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"SMS Gateway Provider Details"),s(),h(7,ph,2,1,"div",6),s(),l(8,"span"),D(9,"The following information is required in order to configure your SMS gateway provider."),s()()(),h(10,uh,1,3,"app-dynamic-form",7),h(11,fh,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faComments)("ngClass",N(5,mh,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,Te,V,q,te,ne],encapsulation:2})};var gh=n=>({"icon-primary":n});function hh(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit device parameters details"))}function yh(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function vh(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.smsGatewayProviderDeviceParameters())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var _r=class n extends B{ownerId=E(null);smsGatewayProviderType=E(null);entitiesService=c(P);operationRegistry=c(Q);smsGatewayProviderDeviceParameters=v(()=>{let t=this.entity()?.parameters,e=this.smsGatewayProviderType();if(T(t)||T(e))return[];let i=e.parameterDefinition??'{"groups":[]}',o=JSON.parse(i),r=[];return o.groups.forEach(u=>{u.fields.forEach(b=>{let x="None";if(b.type==="password")x="****";else{let G=t?.[b.id];typeof G=="object"?x=JSON.stringify(G):G!==void 0&&(x=G)}if(r.push({key:b.title,value:x}),b.type==="combo"&&b.values){let G=t?.[b.id],Z=b.values.find(ve=>ve.key===G);Z?.fields&&Z.fields.forEach(ve=>{if(t?.[ve.id]!==void 0){let qe="None",nt=t?.[ve.id];ve.type==="password"?qe="****":typeof nt=="object"?qe=JSON.stringify(nt):nt!==void 0&&(qe=nt),r.push({key:`${ve.title}`,value:qe})}})}})}),r});constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.smsGatewayProviderType()&&this.updateFormFields()})}updateFormFields(){let t=this.entity(),e=this.smsGatewayProviderType();if(!e)return;let i=e.parameterDefinition??'{"groups":[]}',r=JSON.parse(i).groups.reduce((u,b)=>{let x=b.fields.flatMap(G=>[this.createFormFieldConfig(G,t)]);return[...u,...x]},[]);this.formFields=r}createFormFieldConfig(t,e){if(t.type==="memo")return Ge(t.id,t.title,e?.parameters?.[t.id],{name:t.id,validations:t.required??!1?[{name:"required",validator:w.required,message:`${t.title} is required`}]:[],hint:t.description});if(t.type==="number")return ie(t.id,t.title,e?.parameters?.[t.id],{name:t.id,validations:t.required??!1?[{name:"required",validator:w.required,message:`${t.title} is required`}]:[],hint:t.description});if(t.type==="combo"&&t.values){let i=t.values.map(o=>({label:o.value,value:o.key}));return H(t.id,t.title,i,e?.parameters?.[t.id]||t.defaultValue,{name:t.id,validations:t.required??!1?[{name:"required",validator:w.required,message:`${t.title} is required`}]:[],hint:t.description,props:{appendTo:"body"},conditional:!0,conditions:i.reduce((o,r)=>ee(M({},o),{[r.value]:this.createConditionFields(t?.values?.find(u=>u.key===r.value)?.fields??[])}),{})})}return t.type==="password"?ei(t.id,t.title,{name:t.id,validations:t.required??!1?[{name:"required",validator:w.required,message:`${t.title} is required`}]:[],hint:t.description,props:{type:"password"}}):k(t.id,t.title,e?.parameters?.[t.id],{name:t.id,validations:t.required??!1?[{name:"required",validator:w.required,message:`${t.title} is required`}]:[],hint:t.description})}getUpdateMethod(){return this.operationRegistry.getOperation("sms-gateway-providers","update")??((t,e)=>this.entitiesService.updateSmsGatewayProvider(t,{parameters:e}))}createConditionFields(t){return t.map(e=>this.createFormFieldConfig(e,this.entity()))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-sms-gateway-provider-parameters-section"]],inputs:{ownerId:[1,"ownerId"],smsGatewayProviderType:[1,"smsGatewayProviderType"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-wrench","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Parameters"),s(),h(7,hh,2,1,"div",6),s(),l(8,"span"),D(9,"Configure the following parameters that are required to communicate with the up-stream provider."),s()()(),h(10,yh,1,3,"app-dynamic-form",7),h(11,vh,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(5,gh,i.isFormEditable())),I("aria-label","wrench icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,Te,V,q],encapsulation:2})};var ho=class n{createSmsGatewayProviderInformationSection(t,e){return[{id:"sms-gateway-provider-details",title:"Device Config Details",component:Cr,componentInputs:{entity:t},category:"information",order:10},{id:"sms-gateway-provider-parameters",title:"Device Config Parameters",component:_r,componentInputs:{entity:t,entityType:"sms-gateway-provider",dataPath:"parameters",injectDataAtPath:!0,smsGatewayProviderType:e},category:"information",order:20}]}createChangesSection(t){return[{id:"sms-gateway-provider-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllSmsGatewayProviderSections(t,e){return[...this.createSmsGatewayProviderInformationSection(t,e),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ch=n=>({"icon-primary":n});function _h(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit io type details"))}function bh(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Sh(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.ioTypeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var br=class n extends B{ownerId=E(null);entitiesService=c(P);utilityService=c(he);apiSchemaService=c(bt);typeOptions=[{key:"digital_input",label:"Digital Input"},{key:"digital_output",label:"Digital Output"},{key:"analog_input",label:"Analog Input"},{key:"temperature_input",label:"Temperature Input"},{key:"can_input",label:"CAN Input"},{key:"counter_input",label:"Counter Input"},{key:"camera_input",label:"Camera Input"},{key:"value_input",label:"Value Input"}];smoothingOptions=[{label:"None",value:"none"},{label:"Moving Average (5 samples)",value:"moving_average_5"},{label:"Moving Average (10 samples)",value:"moving_average_10"},{label:"Moving Average (20 samples)",value:"moving_average_20"}];rateTypeOptions=[{value:"none",label:"None"},{value:"val_per_km",label:"Value Per Kilometer"},{value:"km_per_val",label:"Kilometer Per Value"},{value:"val_per_mile",label:"Value Per Mile"},{value:"mile_per_val",label:"Miles Per Value"},{value:"val_per_hour",label:"Value Per Hour"},{value:"hour_per_val",label:"Hours Per Value"}];ioTypeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.apiSchemaService.getEntityType(t,"Iotype"),i={name:t.name,type:e,active:t.text?t.text.active??null:null,inactive:t.text?t.text.inactive??null:null,smoothingType:t.smoothingType,unit:t.unit,rateUnit:t.rate?.unit,rateMultiplier:t.rate?.multiplier,rateType:t.rate?.type,lookups:t.lookups};for(let o of Object.keys(i))(i[o]===void 0||i[o]===null)&&delete i[o];return Object.keys(i).map(o=>{if(o==="rateType")return{key:this.utilityService.decamelize(o),value:this.utilityService.decamelize(i[o])};if(o==="type")return{key:this.utilityService.decamelize(o),value:this.typeOptions.find(r=>r.key===i[o])?.label};if(o==="smoothingType"){let r=this.apiSchemaService.getEntityType(i,"IoTypeListItem");return r===gn.TypeEnum.AnalogInput||r===gn.TypeEnum.TemperatureInput||r===gn.TypeEnum.CanInput?{key:"Filter",value:this.smoothingOptions.find(u=>u.value===i[o])?.label}:void 0}return{key:this.utilityService.decamelize(o),value:i[o]}})});constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",transform:"capitalize"}],U(()=>{this.ioTypeDetails().length>0&&!this.createMode()&&this.updateFormFields()})}updateFormFields(){let t=this.entity(),e=t?this.apiSchemaService.getEntityType(t,"Iotype"):null;this.formFields=[k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),H("type","Type",this.typeOptions.map(i=>({label:i.label,value:i.key})),e,{name:"type",validations:[{name:"required",validator:w.required,message:"Type is required"}],conditional:!0,conditions:{digital_input:[k("active","Active Text",t?.text?.active,{name:"active",validations:[{name:"required",validator:w.required,message:"Active Text is required"}]}),k("inactive","Inactive Text",t?.text?.inactive,{name:"inactive",validations:[{name:"required",validator:w.required,message:"Inactive Text is required"}]})],digital_output:[k("active","Active Text",t?.text?.active,{name:"active",validations:[{name:"required",validator:w.required,message:"Active Text is required"}]}),k("inactive","Inactive Text",t?.text?.inactive,{name:"inactive",validations:[{name:"required",validator:w.required,message:"Inactive Text is required"}]})],analog_input:[k("unit","Unit",t?.unit,{name:"unit",validations:[{name:"required",validator:w.required,message:"Unit is required"}]}),H("smoothingType","Smoothing Type",this.smoothingOptions,t?.smoothingType,{name:"smoothingType",validations:[{name:"required",validator:w.required,message:"Smoothing Type is required"}],props:{appendTo:"body"}})],temperature_input:[H("smoothingType","Smoothing Type",this.smoothingOptions,t?.smoothingType,{name:"smoothingType",validations:[{name:"required",validator:w.required,message:"Smoothing Type is required"}],props:{appendTo:"body"}})],can_input:[k("active","Active Text",t?.text?.active,{name:"active",validations:[{name:"required",validator:w.required,message:"Active Text is required"}]}),k("inactive","Inactive Text",t?.text?.inactive,{name:"inactive",validations:[{name:"required",validator:w.required,message:"Inactive Text is required"}]}),k("unit","Unit",t?.unit,{name:"unit",validations:[{name:"required",validator:w.required,message:"Unit is required"}]}),H("smoothingType","Smoothing Type",this.smoothingOptions,t?.smoothingType,{name:"smoothingType",validations:[{name:"required",validator:w.required,message:"Smoothing Type is required"}],props:{appendTo:"body"}})],counter_input:[k("unit","Unit",t?.unit,{name:"unit",validations:[{name:"required",validator:w.required,message:"Unit is required"}]}),H("rateType","Rate Type",this.rateTypeOptions,t?.rate?.type,{name:"rateType",validations:[{name:"required",validator:w.required,message:"Rate Type is required"}],props:{appendTo:"body"}}),ie("rateMultiplier","Rate Multiplier",t?.rate?.multiplier??void 0,{name:"rateMultiplier",validations:[{name:"required",validator:w.required,message:"Rate Multiplier is required"}]}),k("rateUnit","Rate Unit",t?.rate?.unit,{name:"rateUnit",validations:[{name:"required",validator:w.required,message:"Unit is required"}]})],camera_input:[],value_input:[Ge("lookups","Lookups","",{name:"lookups",validations:[{name:"required",validator:w.required,message:"Lookups are required"}],hint:'Paste values in CSV format, i.e. "key","value"'})]},props:{appendTo:"body"},disabled:!this.createMode()})]}submitChanges(t){let e=this.entity();if(T(e))return;let i=this.transformFormData(t);this.entitiesService.updateIoType(e.id,i).pipe(W(this.destroyRef)).subscribe({next:o=>{this.isFormEditable.set(!1),this.isSubmitting.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"iotype",operation:"update",entityId:e.id,data:o})},error:()=>{this.isFormEditable.set(!0),this.isSubmitting.set(!1)}})}processTextProperty(t,e,i){f(t[e])&&(T(t.text)&&(t.text={}),typeof t[e]=="string"&&(t.text[i]=t[e].trim()),delete t[e])}processRateProperty(t,e,i,o=!1){if(!f(t[e]))return;if(T(t.rate)&&(t.rate={}),o?typeof t[e]=="number":typeof t[e]=="string"){let u=o?t[e]:t[e].trim();t.rate[i]=u}delete t[e]}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);return typeof e.type=="string"&&(this.apiSchemaService.setEntityType(e,"IoType",e.type),this.apiSchemaService.getTypePropertyKey("iotype")!=="type"&&"type"in e&&delete e.type),this.processTextProperty(e,"active","active"),this.processTextProperty(e,"inactive","inactive"),this.processRateProperty(e,"rateType","type"),this.processRateProperty(e,"rateMultiplier","multiplier",!0),this.processRateProperty(e,"rateUnit","unit"),e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-io-type-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-arrow-right-arrow-left","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"IO Type Details"),s(),h(7,_h,2,1,"div",6),s(),l(8,"span"),D(9,"The following information is required in order to configure your I/O type."),s()()(),h(10,bh,1,3,"app-dynamic-form",7),h(11,Sh,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(5,Ch,i.isFormEditable())),I("aria-label","arrow-right-arrow-left icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,Te,V,q,te],encapsulation:2})};var vo=class n{createIoTypeInformationSections(t){return[{id:"io-type-details",title:"IO Type Details",component:br,componentInputs:{entity:t},category:"information",order:10}]}createChangesSection(t){return[{id:"io-type-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllIoTypeSections(t){return[...this.createIoTypeInformationSections(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Dh=n=>({"icon-primary":n});function Th(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",8),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit overspeed profile details"))}function wh(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",9),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function xh(n,t){if(n&1&&(l(0,"div",10)(1,"p-message",12),C(2,"span",13),D(3),s()()),n&2){let e=a(2);d(3),ye(" ",e.warning())}}function Fh(n,t){if(n&1&&(h(0,xh,4,1,"div",10),C(1,"app-grid",11)),n&2){let e=a();y(e.warning()?0:-1),d(),g("data",e.overspeedProfileDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Sr=class n extends B{ownerId=E(null);entitiesService=c(P);measurementUnitsService=c(pt);overspeedProfileDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Name",value:t.name},{key:"Bands",value:t.items?.map(e=>e.name).join(", ")}]:[]});overspeedProfileBandsModalConfig;warning=R(null);constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.entity();T(t?.items)||t.items.length<1?this.warning.set("At least one overspeed band is required for the overspeed profile to be useful."):this.warning.set(null)}),U(()=>{let t=this.entity();f(t)&&!this.createMode()&&_e(()=>{this.updateFormFields()})})}updateFormFields(){let t=this.entity(),e=null,i=null;this.overspeedProfileBandsModalConfig={modalComponent:be,modalTitle:"Overspeed Band",defaultItemProvider:()=>({id:Xe(),name:"",min:void 0,offset:void 0}),listItemFormatter:o=>{let u=this.dynamicForm?.form?.get("items")?.value??[];if(u!==e||!i){let x=[...u].sort((G,Z)=>(G.min??0)-(Z.min??0));i=new Map;for(let G=0;G<x.length;G++){let Z=x[G],ve;if(G<x.length-1){let qe=x[G+1];ji(qe.min)&&(ve=qe.min)}i.set(Z,ve)}e=u}let b=i.get(o);return this.stateItemToListItem(o,b)},modalFields:o=>{let r=f(o?.min)?o.min-100:0;return[k("id","ID",o?.id,{name:"id",hidden:!0}),k("name","Name",o?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),ie("min","Min",r,{name:"min",validations:[{name:"required",validator:w.required,message:"Min is required"},{name:"min",validator:w.min(0),message:"Min must be 0 or greater"}],layout:"horizontal",labelWidth:"1/3",props:{suffix:"%",min:0}}),ie("offset","Offset",this.measurementUnitsService.fromBackend("speed",o?.offset??0,2),{name:"offset",validations:[{name:"required",validator:w.required,message:"Offset is required"},{name:"min",validator:w.min(-50),message:"Offset must be -50 or greater"},{name:"max",validator:w.max(50),message:"Offset must be 50 or less"}],props:{suffix:this.measurementUnitsService.unit("speed")}})]},subHeader:""},this.formFields=[k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]})],this.createMode()||this.formFields.push(De("items","Bands",t?.items??[],{layout:"horizontal",labelWidth:"1/3",name:"items",props:{modalConfig:this.overspeedProfileBandsModalConfig}}))}submitChanges(t){let e=this.entity();T(e)||this.entitiesService.updateOverspeedProfile(e.id,t).pipe(W(this.destroyRef)).subscribe({next:i=>{this.isFormEditable.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"overspeed-profile",operation:"update",entityId:e.id,data:i})},error:()=>{this.isFormEditable.set(!0)}})}stateItemToListItem(t,e){return{id:t.id,title:t.name,display:f(e)?`Overspeeding events ${t.min} - ${e} over the speed limit`:`Overspeeding events ${t.min} plus over the speed limit`,icon:"pi pi-gauge"}}stateItemsToListItems(t){return(t??[]).sort((e,i)=>e.min-i.min).map((e,i,o)=>{let u=(i<o.length-1?o[i+1]:null)?.min;return this.stateItemToListItem(e,u)})}onFormValueChange(t){let e=t.items;if(f(e)){let i=e.map(o=>ee(M({},o),{min:f(o.min)?o.min+100:void 0,offset:this.measurementUnitsService.toBackend("speed",o.offset??0)}));t.items=i}this.formValueChange.emit(t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-overspeed-profile-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-gauge","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"],[1,"mb-4"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],["severity","warn"],[1,"pi","pi-exclamation-triangle","mr-2"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Overspeed Profile Details"),s(),h(7,Th,2,1,"div",6),s(),l(8,"span"),D(9,"Configure the bands which will be used to grade the severity of overspeeding events."),s()()(),h(10,wh,1,3,"app-dynamic-form",7),h(11,Fh,2,5),s()),e&2&&(d(2),g("ngClass",N(5,Dh,i.isFormEditable())),I("aria-label","gauge icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q,X,se],encapsulation:2})};var _o=class n{createOverspeedProfileInformationSections(t){return[{id:"overspeed-profile-details",title:"Overspeed Profile Details",component:Sr,componentInputs:{entity:t},category:"information",order:10}]}createChangesSection(t){return[{id:"overspeed-profile-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllOverspeedProfileSections(t){return[...this.createOverspeedProfileInformationSections(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Dr=class n{STORAGE_KEY="alert-icons";localStorageService=c(Hs);getAlertIcon(t){try{return this.getAllAlertIcons()[t]??null}catch(e){return console.warn("Failed to get alert icon from storage:",e),null}}setAlertIcon(t,e){try{let i=this.getAllAlertIcons();e==null||e===""?delete i[t]:i[t]=e,this.localStorageService.setItem(this.STORAGE_KEY,i)}catch(i){console.warn("Failed to save alert icon to storage:",i)}}getAllAlertIcons(){try{return this.localStorageService.getItem(this.STORAGE_KEY)??{}}catch(t){return console.warn("Failed to parse alert icons from storage:",t),{}}}removeAlertIcon(t){this.setAlertIcon(t,null)}clearAllIcons(){try{this.localStorageService.removeItem(this.STORAGE_KEY)}catch(t){console.warn("Failed to clear alert icons from storage:",t)}}getDefaultIcon(){return"warning"}getAlertIconWithFallback(t){return this.getAlertIcon(t)??this.getDefaultIcon()}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var dd=n=>({"text-primary":n});function Ih(n,t){if(n&1&&(l(0,"span",2),D(1),s()),n&2){let e=t,i=a();g("ngClass",N(3,dd,i.isFormEditable())),I("aria-label","Alert icon: "+e),d(),ye(" ",e," ")}}function Eh(n,t){if(n&1&&C(0,"span",3),n&2){let e=a();g("ngClass",N(2,dd,e.isFormEditable())),I("aria-label","Alert notification icon")}}function Mh(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit alert details"))}function Rh(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Ah(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.alertDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Tr=class n extends B{ownerId=E(null);entitiesService=c(P);accountsService=c(me);authDataService=c(ke);alertIconStorageService=c(Dr);operationRegistry=c(Q);eventFilterService=c(zt);cdr=c(Me);selectOptionsLoaded=R(!1);alertDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=f(t.filter)?this.eventFilterService.getEventFilterText(t.filter):"None";return[{key:"Name",value:t.name},{key:"Icon",value:t.iconName??this.alertIconStorageService.getDefaultIcon()},{key:"Cost Centre",value:t.costCentre?.name??"None"},{key:"Priority",value:t.priority?t.priority.charAt(0).toUpperCase()+t.priority.slice(1):"None"},{key:"Event Filter",value:e??"None"},{key:"Notify",value:f(t.notify)&&t.notify.length>0?t.notify.map(i=>i.name).join(", "):"None"}]});alertIcon=v(()=>{let e=this.entity()?.iconName;return(T(e)||e.toLowerCase().trim()==="default")&&(e=this.alertIconStorageService.getDefaultIcon()),e});selectOptions={};notifyTree=R([]);constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.entity()&&!this.createMode()&&_e(()=>{this.updateFormFields(),this.cdr.detectChanges()})})}ngOnInit(){this.loadSelectOptions()}loadSelectOptions(){let t=this.entity(),e=this.ownerId(),i=t?.owner?.id??e;if(T(i)){this.selectOptions={},this.selectOptionsLoaded.set(!0),this.updateFormFields();return}Ft([this.accountsService.listUserRoles(i,0,100),this.accountsService.listUsers(i,0,100,void 0,"state=active"),this.entitiesService.listCostCentres(i)]).subscribe({next:([o,r,u])=>{this.selectOptions={userRoles:o.items.map(x=>({label:x.name??"",value:x.id})).sort((x,G)=>x.label.localeCompare(G.label)),users:r.items.map(x=>({label:x.name??"",value:x.id})).sort((x,G)=>x.label.localeCompare(G.label)),costCentres:u.items.map(x=>({label:x.name??"",value:x.id})).sort((x,G)=>x.label.localeCompare(G.label))},this.selectOptionsLoaded.set(!0);let b=this.authDataService.getUserProfile();this.notifyTree.set([{key:`user.${b?.id}`,label:"Me",selectable:!0,data:{id:b?.id,type:"user",name:"Me"}},{key:"roles",label:"User with specific roles",selectable:!1,children:o.items.map(x=>({key:x.id,label:x.name??"",selectable:!0,data:{id:x.id,type:"role",name:x.name??""}}))},{key:"users",label:"Specific Users",selectable:!1,children:r.items.map(x=>({key:x.id,label:x.name??"",selectable:!0,data:{id:x.id,type:"user",name:x.name??""}}))}]),this.updateFormFields()},error:()=>{this.selectOptionsLoaded.set(!0)}})}updateFormFields(){let t=this.entity(),e=[{label:"Low",value:"low"},{label:"Medium",value:"medium"},{label:"High",value:"high"}];this.formFields=[k("name","Name",t?.name??"",{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),...this.createMode()===!1?[Js("iconName","Icon",T(t?.iconName)||(t?.iconName).toLocaleLowerCase().trim()==="default"?this.alertIconStorageService.getDefaultIcon():t?.iconName,{name:"iconName",hint:"Select an icon to represent this alert"})]:[],H("costCentre","Cost Centre",this.selectOptions.costCentres,t?.costCentre?.id??"",{validations:[{name:"required",validator:w.required,message:"Cost centre is required"}],props:{appendTo:"body"}}),H("priority","Priority",e,t?.priority??"",{validations:[{name:"required",validator:w.required,message:"Priority is required"}],props:{appendTo:"body"}}),Lt("filter","Event Filter",t?.filter,["costcentres","groups","types"],{name:"filter",required:!0,validations:[{name:"required",validator:w.required,message:"Event filter is required"}]}),Ys("notify","Notify",t?.notify??[],this.notifyTree(),{name:"notify",props:{appendTo:"body"},transformTreeNodeToItem:i=>this.transformTreeNodeToItem(i),listItemFormatter:i=>({id:`${i.type}-${i.id}`,display:i.name||i.id,title:i.type?i.type.charAt(0).toUpperCase()+i.type.slice(1):"Item",icon:i.type==="user"?"pi-user":"pi-users"}),addButtonLabel:"Add"})]}getUpdateMethod(){return this.operationRegistry.getOperation("alert","update")??((t,e)=>this.entitiesService.updateAlert(t,e))}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);if(f(e.costCentre)){let i=this.selectOptions?.costCentres?.find(o=>o.value===e.costCentre);i&&(e.costCentre={id:i.value,name:i.label})}if(f(e.filter)){let i=e.filter;e.filter=ee(M({},i),{actor:i?.actor?.data,action:i?.action?.data,target:i?.target?.data,conditions:i?.conditions?.map(o=>{let b=o,{id:r}=b;return xt(b,["id"])})})}return e}notifyToTreeItem(t){let e=t.type,i=t.id;if(e==="user"){let o=this.authDataService.getUserProfile();return{key:`user.${o?.id}`,label:o?.name??""}}return{key:`notify.${i}`,label:t?.name??""}}transformTreeNodeToItem(t){if(f(t.data)&&typeof t.data=="object"&&"id"in t.data&&"type"in t.data)return t.data;if(t.label==="Me")return{id:this.authDataService.getUserProfile()?.id??"me",type:"user",name:"Me"};let e="user",i=t.key??"unknown_id",o=t.label??"Unknown Name";return(t.parent?.key==="roles"||(t.key?.startsWith("role_")??!1))&&(e="role"),{id:i,type:e,name:o}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-alert-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:13,vars:4,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"material-icons-outlined","!text-[2.5rem]","text-primary",3,"ngClass"],[1,"pi","pi-exclamation-triangle","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){if(e&1&&(l(0,"div",0)(1,"div",1),h(2,Ih,2,5,"span",2)(3,Eh,1,4,"span",3),l(4,"div",4)(5,"div",5)(6,"h2",6),D(7,"Alert Details"),s(),h(8,Mh,2,1,"div",7),s(),l(9,"span"),D(10,"Configure various details about your Alert."),s()()(),h(11,Rh,1,3,"app-dynamic-form",8),h(12,Ah,1,4,"app-grid",9),s()),e&2){let o;d(2),y((o=i.alertIcon())?2:3,o),d(6),y(!i.isFormEditable()&&!i.createMode()?8:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?11:-1),d(),y(!i.isFormEditable()&&!i.createMode()?12:-1)}},dependencies:[L,z,V,q,Sl,An],styles:[".custom-multi-select[_ngcontent-%COMP%]{border:1px solid #ccc;padding:8px;border-radius:4px;display:flex;flex-wrap:wrap;gap:8px;background-color:#f9f9f9}.selected-items[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.selected-item[_ngcontent-%COMP%]{background-color:#e0e0e0;padding:4px 8px;border-radius:4px;cursor:pointer;text-decoration:underline}.selected-item[_ngcontent-%COMP%]:hover{background-color:#d6d6d6}"]})};var So=class n{createAlertInformationSection(t){return[{id:"alert-details",title:"Alert Config Details",component:Tr,componentInputs:{entity:t},category:"information",order:10}]}createChangesSection(t){return[{id:"alert-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllAlertSections(t){return[...this.createAlertInformationSection(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var kh=n=>({"icon-primary":n});function Oh(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit user role details"))}function Ph(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Vh(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.userRoleDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var wr=class n extends B{accountsService=c(me);faUserLock=Nn;userRoleDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Name",value:t.name},{key:"Description",value:t.description}]:[]});constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}]}updateFormFields(){let t=this.entity();this.formFields=[k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),k("description","Description",t?.description,{name:"description",validations:[{name:"required",validator:w.required,message:"Description is required"}]})]}submitChanges(t){let e=this.entity();T(e)||this.accountsService.updateUserRole(e.id,t).pipe(W(this.destroyRef)).subscribe({next:i=>{this.isFormEditable.set(!1),this.isSubmitting.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"user-role",operation:"update",entityId:e.id,data:i})},error:()=>{this.isFormEditable.set(!0),this.isSubmitting.set(!1)}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-user-role-details-section"]],features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"User Role Details"),s(),h(7,Oh,2,1,"div",6),s(),l(8,"span"),D(9,"Describe this user role."),s()()(),h(10,Ph,1,3,"app-dynamic-form",7),h(11,Vh,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faUserLock)("ngClass",N(5,kh,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q,X,te,ne],encapsulation:2})};var Lh=n=>({"icon-primary":n});function Nh(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit access rights details"))}function Gh(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function qh(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.userRoleDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var xr=class n extends B{ownerId=E(null);accountsService=c(me);resolvedCompanyType=R(void 0);faKey=Vn;userRoleDetails=v(()=>{let t=this.entity(),e=this.resolvedCompanyType();if(!f(t)||!f(e))return[];let i=is[e],o=[];return f(i)&&i.forEach(r=>{o.push({key:r.title,value:t.legacyRights?.[r.name]?.join(", ")??"None"})}),o});constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",transform:"capitalize"}],U(()=>{let e=this.entity()?.owner?.id;f(e)?e===Oe?this.resolvedCompanyType.set("system"):(this.resolvedCompanyType.set(void 0),Ce(this.accountsService.getCompany(e)).then(i=>{i.type?(this.resolvedCompanyType.set(i.type),this.updateFormFields()):(console.warn("Company response or type is undefined for owner ID:",e),this.resolvedCompanyType.set(void 0))}).catch(i=>{console.error("Failed to fetch company type for owner ID:",e,i),this.resolvedCompanyType.set(void 0)})):this.resolvedCompanyType.set(void 0)})}updateFormFields(){let t=this.entity()?.legacyRights,e=this.resolvedCompanyType();if(!f(e)){this.formFields=[];return}let i=e?is[e]:[];this.formFields=i.map(o=>{let r=t?.[o.name]??[];return rt(o.name,o.title,r,o.rights.map(u=>({label:u.title,value:u.name})),{name:o.name,props:{checkmark:!0,multiple:!0}})})}submitChanges(t){let e=this.entity();T(e)||this.accountsService.updateUserRole(e.id,{legacyRights:t}).pipe(W(this.destroyRef)).subscribe({next:i=>{this.isFormEditable.set(!1),this.isSubmitting.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"user-role",operation:"update",entityId:e.id,data:i})},error:()=>{this.isFormEditable.set(!0),this.isSubmitting.set(!1)}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-user-role-rights-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Access Rights"),s(),h(7,Nh,2,1,"div",6),s(),l(8,"span"),D(9,"Select from the following access rights."),s()()(),h(10,Gh,1,3,"app-dynamic-form",7),h(11,qh,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faKey)("ngClass",N(5,Lh,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q,X,te,ne],encapsulation:2})};var Uh=n=>({"icon-primary":n});function zh(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit user role details"))}function jh(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Bh(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.userRoleDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Fr=class n extends B{ownerId=E(null);accountsService=c(me);faPassport=kl;userRoleDetails=v(()=>{let t=this.entity()?.inlinePolicies;return f(t)?[{key:"Policies",value:t.map(e=>e.name).join(", ")??"None"}]:[]});userRolesModalConfig;constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}]}updateFormFields(){let t=this.entity();this.userRolesModalConfig={modalComponent:be,modalTitle:"Inline Policy",defaultItemProvider:()=>({id:Xe(),name:"New Policy",statements:JSON.stringify([{id:"statement1",effect:"allow",actions:["entities:SomeMethod"],resources:["*"]}],null,2)}),listItemFormatter:e=>({id:e.id||"",title:e.name||"Unnamed Policy",display:Array.isArray(e.statements)?`${e.statements.length} statement(s)`:"No statements"}),modalFields:e=>{let i="[]";try{e?.statements&&(i=JSON.stringify(e.statements))}catch(o){console.error("Error handling statements:",o)}return[k("id","ID",e?.id,{name:"id",hidden:!0}),k("name","Name",e?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),Ge("statements","Statements",i,{name:"statements",validations:[{name:"required",validator:w.required,message:"Statements are required"},{name:"json",validator:o=>{try{return T(o.value)||JSON.parse(o.value),null}catch(r){return console.error("Invalid JSON format:",r),{json:!0}}},message:"Invalid JSON format"}]})]},subHeader:""},this.formFields=[De("inlinePolicies","Policies",t?.inlinePolicies??[],{layout:"horizontal",labelWidth:"1/3",name:"inlinePolicies",props:{modalConfig:this.userRolesModalConfig}})]}submitChanges(t){let e=this.entity();if(T(e))return;let i=this.transformFormData?this.transformFormData(t):t;this.accountsService.updateUserRole(e.id,i).pipe(W(this.destroyRef)).subscribe({next:o=>{this.isFormEditable.set(!1),this.isSubmitting.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"user-role",operation:"update",entityId:e.id,data:o})},error:()=>{this.isFormEditable.set(!0),this.isSubmitting.set(!1)}})}transformFormData(t){let e=t;return f(e.inlinePolicies)&&(e.inlinePolicies=e.inlinePolicies.map(i=>({id:i.id,name:i.name,statements:Ye(i.statements)?JSON.parse(i.statements):i.statements}))),e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-user-role-inline-policies-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"User Role Details"),s(),h(7,zh,2,1,"div",6),s(),l(8,"span"),D(9,"Describe this user role."),s()()(),h(10,jh,1,3,"app-dynamic-form",7),h(11,Bh,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faPassport)("ngClass",N(5,Uh,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q,X,te,ne],encapsulation:2})};var To=class n{createUserRoleInformationSections(t){return[{id:"user-role-details",title:"User Role Details",component:wr,componentInputs:{entity:t},category:"information",order:10},{id:"user-role-rights",title:"User Role Rights",component:xr,componentInputs:{entity:t},category:"information",order:20},{id:"user-role-inline-policies",title:"User Role Inline Policies",component:Fr,componentInputs:{entity:t},category:"information",order:30}]}createChangesSection(t){return[{id:"user-role-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllUserRoleSections(t){return[...this.createUserRoleInformationSections(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ir=class n{createUserFormFields(t){let{user:e,company:i,createMode:o,costCenters:r,timezones:u,clientsSearchResults:b,searchClient:x,isLoadingClients:G}=t;if(!f(e))return[];let Z=[];return Z.push(this.createNameField(e),this.createEmailField(e),this.createMobileField(e)),o||Z.push(this.createPasswordField()),f(i)&&i.type==="client"&&Z.push(this.createCostCentreField(e,r)),Z.push(this.createTimezoneField(e,u)),f(i)&&i.type!=="client"&&Z.push(this.createDefaultClientField(e,b,x,G)),o&&Z.push(this.createInviteField()),Z}createNameField(t){return k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]})}createEmailField(t){return k("emailAddress","Email Address",t?.emailAddress,{name:"emailAddress",validations:[{name:"required",validator:w.required,message:"Email Address is required"},{name:"email",validator:w.email,message:"Email Address is invalid"}]})}createMobileField(t){return k("mobile","Mobile Number",t?.mobile,{name:"mobile"})}createPasswordField(){return ei("password","Password",{name:"password"})}createCostCentreField(t,e){return ti("costCentre","Cost Centre",t?.costCentre?{id:t.costCentre.id,label:t.costCentre.name,data:t.costCentre}:null,e,{name:"costCentre",validations:[{name:"required",validator:w.required,message:"Cost Centre is required"}],props:{appendTo:"body",placeholder:"Select Cost Centre",multiple:!1,showClear:!0,selectionMode:"single",filter:!0}})}createTimezoneField(t,e){return H("timeZoneId","Time Zone",e,t?.timeZoneId,{layout:"horizontal",labelWidth:"1/3",placeholder:"Select timezone",name:"timeZoneId",props:{appendTo:"body"}})}createDefaultClientField(t,e,i,o){return mt("defaultClient","Default Client",t?.defaultClient,e,i,{layout:"horizontal",labelWidth:"1/3",name:"defaultClient",autocompleteLoading:o,validations:[{name:"required",validator:w.required,message:"Default Client is required"}],placeholder:"Enter client name...",props:{appendTo:"body",showClear:!0,multiple:!1,field:"name",completeOnFocus:!1,typeahead:!0,showEmptyMessage:!0,emptyMessage:"No clients found"}})}createInviteField(){return _t("invite","Send Invite",!0,{name:"invite",hint:"If enabled, the user will receive an email inviting them to activate their account.",props:{layout:"horizontal",labelWidth:"1/3"}})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Er=class n{accountsService=c(me);utilityService=c(he);destroyRef=c(Ne);searchSubject=new st;clientsSearchResults=R(void 0);isLoading=R(!1);ownerId=null;get searchResults(){return this.clientsSearchResults.asReadonly()}get isSearchLoading(){return this.isLoading.asReadonly()}initialize(t){this.ownerId=t,this.setupSearchStream()}search(t){if(!t||t.trim()===""||t.length<3){this.clientsSearchResults.set([]),this.isLoading.set(!1);return}this.clientsSearchResults.set(void 0),this.isLoading.set(!0),this.searchSubject.next(t)}clearResults(){this.clientsSearchResults.set(void 0)}setupSearchStream(){this.searchSubject.pipe(dt(mi),en(),W(this.destroyRef),Be(t=>this.performSearch(t))).subscribe({next:t=>this.handleSearchResults(t),error:()=>this.handleSearchError()})}performSearch(t){if(this.ownerId===null||this.ownerId===void 0)return re({items:[]});let e=t.trim();if(e.length===0)return re({items:[]});let i={state:{value:"active",operator:"="},name:{value:`*${e}*`,operator:"="}},o=this.utilityService.constructRqlFilter(i);return this.accountsService.listClients(this.ownerId,0,10,"name",o).pipe(lt(()=>re({items:[]})))}handleSearchResults(t){if(this.isLoading.set(!1),f(t)&&Yt(t,"items")){let e=T(t.items)?[]:t.items;this.clientsSearchResults.set(e)}}handleSearchError(){this.isLoading.set(!1),this.clientsSearchResults.set([])}destroy(){this.clientsSearchResults.set(void 0),this.ownerId=null}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Mr=class n{accountsService=c(me);assetGroupService=c(Pe);http=c(It);cacheService=c(Re);timezonesLoaded=R(!1);costCentersLoaded=R(!1);companyDataLoaded=R(!1);companyData=R(null);timezones=R([]);costCenters=R([]);get isDataLoaded(){return this.timezonesLoaded()&&this.costCentersLoaded()&&this.companyDataLoaded()}get timezonesData(){return this.timezones.asReadonly()}get costCentersData(){return this.costCenters.asReadonly()}get companyInfo(){return this.companyData.asReadonly()}get loadingStates(){return{timezones:this.timezonesLoaded.asReadonly(),costCenters:this.costCentersLoaded.asReadonly(),company:this.companyDataLoaded.asReadonly()}}async loadUserFormData(t){let e=this.loadTimezones(),i=Promise.resolve();f(t)?i=this.loadCompanyData(t):(this.companyData.set(null),this.companyDataLoaded.set(!0)),await i;let o=this.companyData(),r=Promise.resolve();f(t)&&f(o)&&o.type==="client"?r=this.loadCostCentres(t):(this.costCenters.set([]),this.costCentersLoaded.set(!0)),await Promise.all([e,r])}async loadTimezones(){try{this.timezonesLoaded.set(!1);let e=(await Ce(this.http.get("/assets/docs/timezones.json"))).map(i=>({label:i.id,value:i.id})).sort((i,o)=>i.label.localeCompare(o.label));this.timezones.set(e),this.timezonesLoaded.set(!0)}catch(t){throw console.error("Failed to load timezones:",t),this.timezones.set([]),this.timezonesLoaded.set(!0),t}}async loadCompanyData(t){try{this.companyDataLoaded.set(!1),this.companyData.set(null);let e=await this.cacheService.getOrFetchAsync(`company-${t}`,()=>Ce(this.accountsService.getCompany(t)),3e5);this.companyData.set(e),this.companyDataLoaded.set(!0)}catch(e){throw console.error("Failed to load company data:",e),this.companyData.set(null),this.companyDataLoaded.set(!0),e}}async loadCostCentres(t){try{this.costCentersLoaded.set(!1);let[e,i]=await Promise.all([this.assetGroupService.getCostCentres(t),this.assetGroupService.getCostCentresAsTree(t)]),o=e.find(u=>u.parent===Oe),r=this.assetGroupService.findCCInCCTree(i,o);this.costCenters.set(r),this.costCentersLoaded.set(!0)}catch(e){throw console.error("Failed to load cost centres:",e),this.costCenters.set([]),this.costCentersLoaded.set(!0),e}}reset(){this.timezonesLoaded.set(!1),this.costCentersLoaded.set(!1),this.companyDataLoaded.set(!1),this.companyData.set(null),this.timezones.set([]),this.costCenters.set([])}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Hh=n=>({"icon-primary":n});function $h(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit user details"))}function Wh(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Zh(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.userDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Rr=class n extends B{ownerId=E(null);accountsService=c(me);utilsService=c(wl);cdr=c(Me);userFormService=c(Ir);dataLoadingService=c(Mr);clientSearchService=c(Er);faUser=Al;userDetails=v(()=>{let t=this.entity(),e=this.dataLoadingService.companyInfo();if(!f(t))return[];let i=[{key:"Name",value:t.name},{key:"Email Address",value:t.emailAddress},{key:"Mobile Number",value:t.mobile},{key:"Password",value:"*********"}];return e?.type==="client"&&i.push({key:"Cost Center",value:t.costCentre?.name??"None"}),i.push({key:"Time Zone",value:t.timeZoneId??"None"}),i});constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.dataLoadingService.isDataLoaded&&_e(()=>{this.updateFormFields()})}),U(()=>{let t=this.clientSearchService.searchResults(),e=this.formFields.find(i=>i.key==="defaultClient");e?.props&&(e.props.suggestions=t,this.cdr.detectChanges())}),U(()=>{let t=this.entity();f(t)&&!this.createMode()&&_e(()=>{this.updateFormFields()})})}ngOnInit(){let t=this.ownerId()??this.entity()?.ownerId;this.clientSearchService.initialize(t),this.dataLoadingService.loadUserFormData(t).catch(e=>{console.error("Failed to load user form data:",e)}),setTimeout(()=>{this.trackFormChanges()})}updateFormFields(){let t=this.entity();f(t)&&(this.formFields=this.userFormService.createUserFormFields({user:t,company:this.dataLoadingService.companyInfo(),createMode:this.createMode(),costCenters:this.dataLoadingService.costCentersData(),timezones:this.dataLoadingService.timezonesData(),clientsSearchResults:this.clientSearchService.searchResults(),searchClient:e=>this.clientSearchService.search(e),isLoadingClients:()=>this.clientSearchService.isSearchLoading()}),this.cdr.detectChanges())}submitChanges(t){let e=this.entity();e!=null&&this.accountsService.updateUser(e.id,t).pipe(W(this.destroyRef)).subscribe({next:i=>{this.clearUnsavedChanges(),this.isFormEditable.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"user",operation:"update",entityId:e.id,data:i})},error:()=>{this.isFormEditable.set(!0)}})}onFormValueChange(t){let e=M({},t);if(f(e.defaultClient)){let i=e.defaultClient;e.defaultClient={id:i.id,name:i.name}}else e.defaultClient=null;if(f(e.costCentre)){let i=e.costCentre;e.costCentre={id:i.id,name:i.name}}else e.costCentre=null;this.formValueChange.emit(e),this.hasFormChanges=!0}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-user-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"User Details"),s(),h(7,$h,2,1,"div",6),s(),l(8,"span"),D(9,"Describe this user."),s()()(),h(10,Wh,1,3,"app-dynamic-form",7),h(11,Zh,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faUser)("ngClass",N(5,Hh,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q,X,te,ne],encapsulation:2})};var Kh=n=>({"icon-primary":n});function Qh(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit user roles details"))}function Yh(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Jh(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.userRoleDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Ar=class n extends B{ownerId=E(null);accountsService=c(me);cdr=c(Me);faUserLock=Nn;userRoleDetails=v(()=>{let t=this.entity()?.roles;return f(t)?[{key:"Roles",value:ce(t)?"None":t.map(e=>e.name).join(", ")}]:[]});selectOptionsLoaded=R(!1);selectOptions={};constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",transform:"capitalize"}],U(()=>{this.selectOptionsLoaded()&&_e(()=>{this.updateFormFields(),this.cdr.detectChanges()})}),U(()=>{let t=this.entity();f(t)&&!this.createMode()&&_e(()=>{this.updateFormFields()})})}ngOnInit(){this.loadSelectOptions()}loadSelectOptions(){let e=this.entity()?.owner?.id??this.ownerId();if(T(e)){this.selectOptions={},this.selectOptionsLoaded.set(!0),this.updateFormFields();return}this.accountsService.listUserRoles(e,0,100).subscribe({next:i=>{let o=i.items.some(u=>u.id===Oe),r=i.items.map(u=>({label:u.name??"",value:u.id})).sort((u,b)=>u.label.localeCompare(b.label));this.selectOptions={userRoles:o?r:[{value:Oe,label:"Administrator"},...r]},this.selectOptionsLoaded.set(!0)},error:()=>{this.selectOptionsLoaded.set(!0)}})}updateFormFields(){this.formFields=[rt("roles","Roles",this.entity()?.roles?.map(t=>t.id)??[],this.selectOptions.userRoles,{name:"userRoles",props:{checkbox:!0,multiple:!0}})]}submitChanges(t){let e=this.entity();T(e)||this.accountsService.updateUser(e.id,this.transformFormData(t)).pipe(W(this.destroyRef)).subscribe({next:i=>{this.isFormEditable.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"user-role",operation:"update",entityId:e.id,data:i})},error:()=>{this.isFormEditable.set(!0)}})}transformFormData(t){let e=M({},t);if(f(e)){let i=this.entity();if(T(i))return e;let o=e.roles;f(o)&&(e.roles=o.map(r=>({id:r,name:this.selectOptions.userRoles?.find(u=>u.value===r)?.label})))}return e}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-user-roles-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"User Roles"),s(),h(7,Qh,2,1,"div",6),s(),l(8,"span"),D(9,"Select from the following user roles."),s()()(),h(10,Yh,1,3,"app-dynamic-form",7),h(11,Jh,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faUserLock)("ngClass",N(5,Kh,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q,te,ne],encapsulation:2})};var Xh=n=>({"icon-primary":n});function ey(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit API keys details"))}function ty(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function iy(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.userApiKeyDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var kr=class n extends B{accountsService=c(me);dialogService=c(En);confirmationService=c(Ee);faKey=Vn;userProfileService=c(Dn);userApiKeyDetails=v(()=>{let t=this.entity()?.apiKeys;return f(t)?[{key:"Keys",value:ce(t)?"None":Object.values(t).map(e=>e.name).join(", ")}]:[]});userApiKeysModalConfig;constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}]}updateFormFields(){let t=this.entity();this.userApiKeysModalConfig={modalComponent:be,modalTitle:"New API Key",defaultItemProvider:()=>({name:"",policies:[]}),listItemFormatter:e=>({id:Object.keys(e)[0]??"",title:e[Object.keys(e)[0]].name??"",display:Object.keys(e)[0]??""}),modalFields:e=>[k("name","Key Name",e?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]})],subHeader:"Enter a descriptive name for your new API key.",onSubmit:async(e,i)=>{let o={name:e.name??"",policies:e.policies??[]},r=t?.id;if(T(r))return console.error("Owner ID is missing. Cannot create API key."),this._showErrorDialog("Error Creating API Key","Cannot create API key: User information is missing."),!1;try{let u=await Ce(this.accountsService.createApiKey(r,o).pipe(W(this.destroyRef)));i.close(u),this._showCreatedApiKeyDialog(u,t);return}catch(u){return console.error("Failed to create API key:",u),this._showErrorDialog("Error Creating API Key","An error occurred while creating the API key. Please try again or contact support."),!1}},onDeleteItem:async e=>{let i=Object.keys(e)[0],o=t?.id;return T(i)?(console.error("Missing apiKeyId for deletion."),!1):T(o)?(console.error("Owner ID is missing. Cannot delete API key."),this._showErrorDialog("Error Deleting API Key","Cannot delete API key: User information is missing."),!1):this.handleApiKeyRemoval(o,i)}},this.formFields=[De("apiKeys","Keys",f(t?.apiKeys)?Object.entries(t?.apiKeys).map(([e,i])=>({[e]:i})):[],{layout:"horizontal",labelWidth:"1/3",name:"apiKeys",props:{modalConfig:this.userApiKeysModalConfig}})]}handleApiKeyRemoval(t,e){return new Promise(i=>{this.confirmationService.confirm({message:"Are you sure you want to delete this API key? Anyone using this key will immediately lose access.",header:"Confirmation",icon:"pi pi-exclamation-triangle",acceptButtonProps:{label:"Delete"},rejectButtonProps:{label:"Cancel",severity:"secondary"},accept:async()=>{try{await Ce(this.accountsService.deleteApiKey(t,e).pipe(W(this.destroyRef))).then(()=>{this.broadcastService.broadcast("entity-updated",{entityType:"user",operation:"delete",entityId:t,data:{apiKeyId:e}}),i(!0)})}catch(o){console.error("Failed to delete API key via custom handler:",o);let r=`Failed to delete API key: ${o.message||"Unknown error"}`;this._showErrorDialog("Error Deleting API Key","An error occurred. Please try again or contact support.",[{type:"custom",key:"errorMessageDisplay",template:"errorDisplay",props:{message:r},name:"custom"}]),i(!1)}},reject:o=>{(o===za.REJECT||o===za.CANCEL)&&i(!1)}})})}_showCreatedApiKeyDialog(t,e){setTimeout(()=>{let i=this.dialogService.open(be,{header:"API Key Created Successfully",width:"500px",contentStyle:{"max-height":"500px",overflow:"auto"},data:{fields:[k("displayedKeyName","Key Name",t.name,{name:"displayedKeyName",disabled:!0}),Ge("apiTokenValue","API Key",t.key,{name:"apiTokenValue",readonly:!0})],actions:[{label:"Copy Key & Close",severity:"primary",icon:"pi pi-copy",action:()=>{f(t.key)&&navigator.clipboard.writeText(t.key).then(()=>this.broadcastService.broadcast("entity-updated",{entityType:"user",operation:"update",entityId:e?.id,data:e})).catch(o=>console.error("Failed to copy API Key: ",o)),i?.close()}}],modalTitle:"API Key Details",subHeader:"Your API key is displayed below. This will only be shown to you once and cannot be recovered. Make sure to copy and safely store the value before dismissing this message.",hideForm:!0,isDisplayMode:!0}})},300)}_showErrorDialog(t,e,i){let o,r={actions:[{label:"Close",severity:"secondary",action:()=>{o&&o.close()}}],subHeader:e,hideForm:!0,isDisplayMode:!0,fields:[]};i&&(r.fields=i),o=this.dialogService.open(be,{header:t,width:"400px",data:r})}submitChanges(t){let e=this.entity();T(e)||this.broadcastService.broadcast("entity-updated",{entityType:"user",operation:"update",entityId:e.id,data:e})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-user-api-keys-section"]],features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"API Keys"),s(),h(7,ey,2,1,"div",6),s(),l(8,"span"),D(9,"Generate API keys that can be used to link this user account to third party systems."),s()()(),h(10,ty,1,3,"app-dynamic-form",7),h(11,iy,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faKey)("ngClass",N(5,Xh,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q,te,ne],encapsulation:2})};var ny=n=>({"icon-primary":n});function oy(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit notification details"))}function ry(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function ay(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.userNotificationDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Or=class n extends B{accountsService=c(me);operationRegistry=c(Q);faBell=Ll;userNotificationDetails=v(()=>{let t=this.entity()?.notifySettings;return f(t)?[{key:"Allow SMS from",value:t.smsTime?.from},{key:"Allow SMS to",value:t.smsTime?.to},{key:"Low Priority",value:this.formatLabel(t.actions?.low)},{key:"Medium Priority",value:this.formatLabel(t.actions?.medium)},{key:"High Priority",value:this.formatLabel(t.actions?.high)}]:[]});constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",transform:"capitalize"}]}updateFormFields(){let t=this.entity();this.formFields=[{name:"smsTime",key:"smsTime",type:"group",fields:[tt("from","Allow SMS from",t?.notifySettings?.smsTime?.from,{name:"from",placeholder:"Select time",props:{timeOnly:!0,showSeconds:!0},style:{width:"100%"}}),tt("to","Allow SMS to",t?.notifySettings?.smsTime?.to,{name:"to",placeholder:"Select time",props:{timeOnly:!0,showSeconds:!0},style:{width:"100%"}})]},{key:"actions",type:"group",name:"actions",fields:[H("low","Low Priority",Object.values(hn.LowEnum).map(e=>({label:this.formatLabel(e),value:e})),t?.notifySettings?.actions?.low,{name:"low",props:{appendTo:"body"}}),H("medium","Medium Priority",Object.values(hn.MediumEnum).map(e=>({label:this.formatLabel(e),value:e})),t?.notifySettings?.actions?.medium,{name:"medium",props:{appendTo:"body"}}),H("high","High Priority",Object.values(hn.HighEnum).map(e=>({label:this.formatLabel(e),value:e})),t?.notifySettings?.actions?.high,{name:"high",props:{appendTo:"body"}})]}]}getUpdateMethod(){return this.operationRegistry.getOperation("users","update")??((t,e)=>this.accountsService.updateUser(t,{notifySettings:e}))}formatLabel(t){if(!Ye(t))return"";switch(t.toLowerCase()){case"emailsms":return"Email & SMS";case"sms":return"SMS";default:return t.charAt(0).toUpperCase()+t.slice(1)}}transformFormData(t){let e=t;if(f(e.smsTime)){let i=e.smsTime,o=i?.from,r=i?.to,u=/^\d{2}:\d{2}:\d{2}$/;u.test(o)||(i.from=this.convertToTimeOnly(o)),u.test(r)||(i.to=this.convertToTimeOnly(r))}return e}convertToTimeOnly(t){let e=new Date(t);if(isNaN(e.getTime()))return console.warn(`Could not parse '${t}' as a valid date. Returning original string.`),t;let i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),r=String(e.getSeconds()).padStart(2,"0");return`${i}:${o}:${r}`}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-user-notify-section"]],features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Notifications"),s(),h(7,oy,2,1,"div",6),s(),l(8,"span"),D(9,"Configure alert notification actions and allowed SMS times."),s()()(),h(10,ry,1,3,"app-dynamic-form",7),h(11,ay,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faBell)("ngClass",N(5,ny,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q,te,ne],encapsulation:2})};var sy=n=>({"icon-primary":n});function ly(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit client permissions"))}function dy(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function cy(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.userClientPermissions())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Pr=class n extends B{ownerId=E(null);accountsService=c(me);requestCache=c(Re);utilityService=c(he);clientsService=c(Ps);authDataService=c(ke);cdr=c(Me);faClipboardList=El;clientNames=R({});clientCacheKeys=[];userClientPermissions=v(()=>{let e=this.entity()?.permissions?.clients,i=this.clientNames();if(!f(e))return[];let o=Object.keys(e);return o.length===0?[{key:"Clients",value:"No Clients"}]:ce(i)?[{key:"Clients",value:"Loading client names..."}]:[{key:"Clients",value:o.map(u=>i[u]||u).join(", ")}]});clientPermissionsModalConfig;clientSearchResults=R([]);searchSubject=new st;isLoadingClients=R(!1);selectedClientId=R(void 0);modalRefreshTrigger=R(0);constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.selectedClientId(),this.clientPermissionsModalConfig&&this.rebuildModalFields()}),U(()=>{let t=this.entity();f(t)&&!this.createMode()&&_e(()=>{this.updateFormFields()})})}ngOnInit(){this.loadClientPermissions(),this.setupClientSearch()}ngOnDestroy(){super.ngOnDestroy();for(let t of this.clientCacheKeys)this.requestCache.clearCache(t);this.clientCacheKeys=[]}updateFormFields(){this.selectedClientId.set(void 0),this.modalRefreshTrigger.set(0);let t=this.entity()?.permissions?.clients??{},e=Object.entries(t).map(([i,o])=>({clientId:i,filter:o.assets}));this.clientPermissionsModalConfig={modalComponent:be,modalTitle:"Client Permissions",listItemFormatter:i=>{let o="clientId"in i?i.clientId:i.client.id,r="clientId"in i?this.clientNames()[i.clientId]??o:i.client.name;return{id:o,display:`${r}`,icon:"pi pi-building"}},modalFields:()=>this.createModalFields()},this.formFields=[De("permissions","Clients",e,{name:"permissions",validations:[{name:"required",validator:w.required,message:"Client permissions are required"}],props:{modalConfig:this.clientPermissionsModalConfig}})]}rebuildModalFields(){this.clientPermissionsModalConfig&&(this.clientPermissionsModalConfig=ee(M({},this.clientPermissionsModalConfig),{modalFields:()=>this.createModalFields()}),this.formFields=[...this.formFields],this.cdr.detectChanges())}createModalFields(){let t=this.selectedClientId(),e=mt("client","Client","",()=>this.clientSearchResults()??[],this.searchClient.bind(this),{name:"client",props:{forceSelection:!0,field:"name",placeholder:"Search for clients...",completeOnFocus:!0,typeahead:!0,showEmptyMessage:!0,appendTo:"body"},autocompleteLoading:()=>this.isLoadingClients(),hint:"Enter a client name.",events:{onChange:o=>{this.updateSelectedClientId(o),this.modalRefreshTrigger.update(r=>r+1),this.cdr.detectChanges()}}});e.readonly=t!==void 0;let i=Ks("filter","Asset Filter",void 0,["asset"],{name:"filter",required:!0,validations:[{name:"required",validator:w.required,message:"Asset filter is required"}],props:{multiSelect:!0,showGroupTabs:!0,ownerId:t},readonly:t===void 0});return[e,i]}updateSelectedClientId(t){let e;try{let i=JSON.parse(t);i!==null&&typeof i=="object"&&"id"in i&&(e=i.id)}catch{if(t&&t.trim()!==""){let o=this.clientSearchResults()?.find(r=>r.id===t||r.name===t);o&&(e=o.id)}}this.selectedClientId.set(e)}submitChanges(t){let e=this.entity();if(T(e))return;let i=e?.permissions?.clients??{},o=t.permissions,r={};for(let b of o){let x=b.clientId??b.client?.id;r[x]={assets:b.filter}}for(let b of Object.keys(i))b in r||(r[b]=null);let u={clients:r};this.accountsService.updateUser(e.id,{permissions:u}).pipe(W(this.destroyRef)).subscribe({next:b=>{this.loadClientPermissionsFromResponse(b).then(()=>{this.broadcastService.broadcast("entity-updated",{entityType:"user",operation:"update",entityId:e.id,data:b}),this.isFormEditable.set(!1),this.isSubmitting.set(!1)}).catch(x=>{console.error("Error loading client permissions after save:",x),this.isFormEditable.set(!1),this.isSubmitting.set(!1)})},error:()=>{this.isFormEditable.set(!0),this.isSubmitting.set(!1)}})}getUpdateMethod(){return(t,e)=>this.accountsService.updateUser(t,e)}async loadClientPermissions(){let t=this.entity();await this.loadClientPermissionsFromResponse(t)}async loadClientPermissionsFromResponse(t){let e=t?.permissions?.clients;if(!f(e))return;let o=Object.keys(e).map(async r=>{let u=await this.loadClientName(r);return{id:r,name:u}});try{let r=await Promise.all(o),u={};for(let{id:b,name:x}of r)u[b]=x;this.clientNames.set(u)}catch(r){console.error("Error loading client names:",r)}}async loadClientName(t){if(!t)return"Unknown Client";let e=`client-name/${t}`;this.clientCacheKeys.includes(e)||this.clientCacheKeys.push(e);try{return(await this.requestCache.getOrFetchAsync(e,()=>Ce(this.accountsService.getClient(t)))).name??t}catch{return"Unknown Client"}}setupClientSearch(){this.searchSubject.pipe(dt(mi),W(this.destroyRef),Be(t=>{this.isLoadingClients.set(!0);let e=this.authDataService.getUserProfile()?.owner;if(!f(e)||!Yt(e,"id"))throw new Error("Owner ID not found");if(t.trim().length===0)return re({items:[]});let o={state:{value:"active",operator:"="},name:{value:`*${t}*`,operator:"="}},r=this.utilityService.constructRqlFilter(o);return this.clientsService.listClients(e.id,0,js,"name",r)})).subscribe({next:t=>{this.isLoadingClients.set(!1),f(t)&&Yt(t,"items")&&(this.clientSearchResults.set(T(t.items)?[]:t.items),this.cdr.detectChanges())},error:t=>{this.isLoadingClients.set(!1),console.error("Error searching clients:",t),this.clientSearchResults.set([])}})}searchClient(t){!t||t.trim()===""||t.length<3?(this.clientSearchResults.set([]),this.isLoadingClients.set(!1)):this.searchSubject.next(t.trim())}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-user-client-permissions-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Client Permissions"),s(),h(7,ly,2,1,"div",6),s(),l(8,"span"),D(9,"You can restrict this user to only particular clients and assets by specifying them in the list below."),s()()(),h(10,dy,1,3,"app-dynamic-form",7),h(11,cy,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faClipboardList)("ngClass",N(5,sy,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,X,te,ne,q],encapsulation:2})};var xo=class n{createUserInformationSections(t,e){return[{id:"user-details",title:"User Details",component:Rr,componentInputs:{entity:t,ownerId:e},category:"information",order:10},{id:"user-roles",title:"User Roles",component:Ar,componentInputs:{entity:t},category:"information",order:20},{id:"user-client-permissions",title:"User Client Permissions",component:Pr,componentInputs:{entity:t},category:"information",order:30},{id:"user-api-keys",title:"User API Keys",component:kr,componentInputs:{entity:t},category:"information",order:70},{id:"user-notifications",title:"User Notifications",component:Or,componentInputs:{entity:t},category:"information",order:80}]}createChangesSection(t){return[{id:"user-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllUserSections(t,e){return[...this.createUserInformationSections(t,e),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var cd=class n{entitiesService=c(P);authDataService=c(ke);entityStateService=c(Y);dialogService=c(En);broadcastService=c(we);dialogRef=null;getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u}=t;return T(e)?re({items:[],count:0}):this.entitiesService.listAssets(e,o,i,r,u)}getById(t){return this.entitiesService.getAsset(t)}getStateOptions(){return[{label:"Active",value:Bi.StateEnum.Active},{label:"Inactive",value:Bi.StateEnum.Inactive},{label:"Suspended",value:Bi.StateEnum.Suspended},{label:"Deleted",value:Bi.StateEnum.Deleted}]}updateState(t,e){return this.entitiesService.updateAsset(t,{state:e})}getActionIcons(t){return this.authDataService.hasPermission("assets:create")?[{id:"move",icon:"assets/sprites/sprite.svg#share-from-square-regular",tooltip:"Move Asset",visible:!0,isSvg:!0,action:()=>{this.openMoveAssetDialog(t)}},{id:"changeState",icon:"pi pi-trash",tooltip:"Change Asset State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]:[]}openMoveAssetDialog(t){import("./chunk-TTJJ53EW.js").then(({AssetMoveFormComponent:e})=>{this.dialogRef=this.dialogService.open(e,{header:"Move Asset",contentStyle:{overflow:"auto","margin-top":"1rem"},baseZIndex:1e4,position:"top",modal:!0,width:"500px",data:{assetId:t,ownerId:this.authDataService.getUserProfile()?.owner.id}})})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var md=class n{entitiesService=c(P);authDataService=c(ke);entityStateService=c(Y);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u}=t;return T(e)?re({items:[],count:0}):this.entitiesService.listZones(e,o,i,r,u)}getById(t){return this.entitiesService.getZone(t)}getStateOptions(){return[{label:"Active",value:vn.StateEnum.Active},{label:"Inactive",value:vn.StateEnum.Inactive},{label:"Deleted",value:vn.StateEnum.Deleted}]}updateState(t,e){return this.entitiesService.updateZone(t,{state:e})}getActionIcons(t){return this.authDataService.hasPermission("zones:create")?[{id:"changeState",icon:"pi pi-trash",tooltip:"Change Geofence State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]:[]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var pd=class n{entitiesService=c(P);authDataService=c(ke);entityStateService=c(Y);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u}=t;return T(e)?re({items:[],count:0}):this.entitiesService.listAlerts(e,o,i,r,u)}getById(t){return this.entitiesService.getAlert(t)}getStateOptions(){return[{label:"Active",value:ja.StateEnum.Active},{label:"Deleted",value:ja.StateEnum.Deleted}]}updateState(t,e){return this.entitiesService.updateAlert(t,{state:e})}getActionIcons(t){return this.authDataService.hasPermission("alerts.create")?[{id:"changeState",icon:"pi pi-trash",tooltip:"Change Alert State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]:[]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var ud=class n{entitiesService=c(P);authDataService=c(ke);entityStateService=c(Y);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u}=t;return T(e)?re({items:[],count:0}):this.entitiesService.listDevices(e,o,i,r,u)}getById(t){return this.entitiesService.getDevice(t)}getStateOptions(){return[{label:"Active",value:Hi.StateEnum.Active},{label:"Inactive",value:Hi.StateEnum.Inactive},{label:"Suspended",value:Hi.StateEnum.Suspended},{label:"Deleted",value:Hi.StateEnum.Deleted}]}updateState(t,e){return this.entitiesService.updateDevice(t,{state:e})}getActionIcons(t){return this.authDataService.hasPermission("devices:create")?[{id:"changeState",icon:"pi pi-trash",tooltip:"Change Device State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]:[]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var fd=class n{entitiesService=c(P);entityStateService=c(Y);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u}=t;return T(e)?re({items:[],count:0}):this.entitiesService.listAssetTags(e,o,i,r,u)}getById(t){return this.entitiesService.getAssetTag(t)}getStateOptions(){return[{label:"Active",value:$a.StateEnum.Active},{label:"Deleted",value:$a.StateEnum.Deleted}]}updateState(t,e){return this.entitiesService.updateAssetTag(t,{state:e})}getActionIcons(t){return[{id:"changeState",icon:"pi pi-trash",tooltip:"Change Asset Tags State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var gd=class n{service=c(Vs);entityStateService=c(Y);getList(t){return this.service.listDeviceProviders(t.owner,t.recurse,t.offset,t.limit,t.sortField,t.filters)}getById(t){return this.service.getDeviceProvider(t)}getStateOptions(){return[{label:"Active",value:fn.StateEnum.Active},{label:"Suspended",value:fn.StateEnum.Suspended},{label:"Deleted",value:fn.StateEnum.Deleted}]}updateState(t,e){return this.service.updateDeviceProvider(t,{state:e})}getActionIcons(t){return[{id:"changeState",icon:"pi pi-trash",tooltip:"Change Device Provider State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var hd=class n{service=c(Ls);getList(t){return this.service.listEmailProviders(t.owner,t.offset,t.limit,t.sortField,t.filters)}getById(t){return this.service.getEmailProvider(t)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var yd=class n{entitiesService=c(P);authDataService=c(ke);entityStateService=c(Y);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u}=t;return T(e)?re({items:[],count:0}):this.entitiesService.listSimCards(e,o,i,r,u)}getById(t){return this.entitiesService.getSimCard(t)}getStateOptions(){return[{label:"Active",value:Wi.StateEnum.Active},{label:"Inactive",value:Wi.StateEnum.Inactive},{label:"Suspended",value:Wi.StateEnum.Suspended},{label:"Deleted",value:Wi.StateEnum.Deleted}]}updateState(t,e){return this.entitiesService.updateSimCard(t,{state:e})}getActionIcons(t){return this.authDataService.hasPermission("simcards:create")?[{id:"changeState",icon:"pi pi-trash",tooltip:"Change SIM Card State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]:[]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var vd=class n{entitiesService=c(P);authDataService=c(ke);entityStateService=c(Y);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u}=t;return T(e)?re({items:[],count:0}):this.entitiesService.listSmsGatewayProviders(e,o,i,r,u)}getById(t){return this.entitiesService.getSmsGatewayProvider(t)}getStateOptions(){return[{label:"Active",value:yn.StateEnum.Active},{label:"Suspended",value:yn.StateEnum.Suspended},{label:"Deleted",value:yn.StateEnum.Deleted}]}updateState(t,e){return this.entitiesService.updateSmsGatewayProvider(t,{state:e})}getActionIcons(t){return this.authDataService.hasPermission("sms-gateway-providers:create")?[{id:"changeState",icon:"pi pi-trash",tooltip:"Change SMS Gateway Provider State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]:[]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Cd=class n{entitiesService=c(P);entityStateService=c(Y);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u,recurse:b}=t;return T(e)?re({items:[],count:0}):this.entitiesService.listIoTypes(e,b,o,i,r,u)}getById(t){return this.entitiesService.getIoType(t)}getStateOptions(){return[{label:"Active",value:Qa.StateEnum.Active},{label:"Deleted",value:Qa.StateEnum.Deleted}]}updateState(t,e){return this.entitiesService.updateIoType(t,{state:e})}getActionIcons(t){return[{id:"changeState",icon:"pi pi-trash",tooltip:"Change IO Type State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var _d=class n{entitiesService=c(P);entityStateService=c(Y);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u,recurse:b}=t;return T(e)?re({items:[],count:0}):this.entitiesService.listDeviceConfigProfiles(e,b,o,i,r,u)}getById(t){return this.entitiesService.getDeviceConfigProfile(t)}getStateOptions(){return[{label:"Active",value:Wa.StateEnum.Active},{label:"Deleted",value:Wa.StateEnum.Deleted}]}updateState(t,e){return this.entitiesService.updateDeviceConfigProfile(t,{state:e})}getActionIcons(t){return[{id:"changeState",icon:"pi pi-trash",tooltip:"Change Device Config Profile State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var bd=class n{accountsService=c(me);entityStateService=c(Y);broadcastService=c(we);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u,counts:b}=t;return T(e)?re({items:[],count:0}):this.accountsService.listVendors(e,o,i,r,u,b)}getById(t){return this.accountsService.getVendor(t)}getStateOptions(){return[{label:"Active",value:Xt.StateEnum.Active},{label:"Inactive",value:Xt.StateEnum.Inactive},{label:"Suspended",value:Xt.StateEnum.Suspended},{label:"Deleted",value:Xt.StateEnum.Deleted}]}updateState(t,e){return this.accountsService.updateVendor(t,{state:e})}getActionIcons(t){return[{id:"viewInTree",icon:"pi pi-sitemap",tooltip:"View this vendor in the Navigation Tree",visible:!0,action:()=>{let e=this.entityStateService.selectedItem();e&&this.broadcastService.broadcast("view-entity-in-tree",{entity:e})}},{id:"changeState",icon:"pi pi-trash",tooltip:"Change Vendor State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Sd=class n{entitiesService=c(P);authDataService=c(ke);entityStateService=c(Y);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u}=t;return T(e)?re({items:[],count:0}):this.entitiesService.listAssetRatingProfiles(e,o,i,r,u)}getById(t){return this.entitiesService.getAssetRatingProfile(t)}getStateOptions(){return[{label:"Active",value:Ba.StateEnum.Active},{label:"Deleted",value:Ba.StateEnum.Deleted}]}updateState(t,e){return this.entitiesService.updateAssetRatingProfile(t,{state:e})}getActionIcons(t){return this.authDataService.hasPermission("asset-rating-profiles.create")?[{id:"changeState",icon:"pi pi-trash",tooltip:"Change Asset Rating Profile State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]:[]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Dd=class n{entitiesService=c(P);entityStateService=c(Y);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u}=t;return T(e)?re({items:[],count:0}):this.entitiesService.listAssetStateProfiles(e,o,i,r,u)}getById(t){return this.entitiesService.getAssetStateProfile(t)}getStateOptions(){return[{label:"Active",value:Ha.StateEnum.Active},{label:"Deleted",value:Ha.StateEnum.Deleted}]}updateState(t,e){return this.entitiesService.updateAssetStateProfile(t,{state:e})}getActionIcons(t){return[{id:"changeState",icon:"pi pi-trash",tooltip:"Change Asset State Profile State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Td=class n{entitiesService=c(P);entityStateService=c(Y);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u,recurse:b}=t;return T(e)?re({items:[],count:0}):this.entitiesService.listOverspeedProfiles(e,b,o,i,r,u)}getById(t){return this.entitiesService.getOverspeedProfile(t)}getStateOptions(){return[{label:"Active",value:Ya.StateEnum.Active},{label:"Deleted",value:Ya.StateEnum.Deleted}]}updateState(t,e){return this.entitiesService.updateOverspeedProfile(t,{state:e})}getActionIcons(t){return[{id:"changeState",icon:"pi pi-trash",tooltip:"Change Overspeed Profile State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var wd=class n{entitiesService=c(P);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u,recurse:b}=t;return T(e)?re({items:[],count:0}):this.entitiesService.listRoadProfiles(e,b,o,i,r,u)}getById(t){return this.entitiesService.getRoadProfile(t)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var xd=class n{entitiesService=c(P);entityStateService=c(Y);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u,recurse:b}=t;return T(e)?re({items:[],count:0}):this.entitiesService.listGeoLockProfiles(e,b,o,i,r,u)}getById(t){return this.entitiesService.getGeoLockProfile(t)}getStateOptions(){return[{label:"Active",value:Ka.StateEnum.Active},{label:"Deleted",value:Ka.StateEnum.Deleted}]}updateState(t,e){return this.entitiesService.updateGeoLockProfile(t,{state:e})}getActionIcons(t){return[{id:"changeState",icon:"pi pi-trash",tooltip:"Change Geo Lock Profile State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Vr=class n{entitiesService=c(P);accountsService=c(me);cacheService=c(Re);utilityService=c(he);confirmationService=c(Ee);broadcastService=c(we);assetTypes=R([]);types=R([]);getList(t){let{owner:e,limit:i,offset:o,filters:r}=t;return T(e)?re({items:[],count:0,title:"",type:"",limit:i,offset:o}):Ft([this.accountsService.getCompany(e),this.getCachedAssetTypes(e),this.getTypes()]).pipe(Ve(([u,b,x])=>{let G=[];return Object.keys(u.customFields??{}).forEach(Z=>{(u.customFields?.[Z]??[]).filter(ve=>ve.owner===u.type).forEach(ve=>{G.push(this.customFieldDefinitionToCustomFieldResponse(b.items,x,e,Z,ve))})}),this.assetTypes.set(b.items),this.types.set(x),{title:"Custom Fields",type:"custom-field",count:G.length,limit:i,offset:o,items:this.filter(r??"",G)}}))}getById(t){let[e]=t.split(".");if(!e)return Dt;let i={owner:e,limit:0,offset:0};return this.getList(i).pipe(Ve(o=>o.items.find(r=>r.id===t)),Ve(o=>o||{}))}delete(t){if(T(t))return ri(()=>new Error("Entity ID is required for custom field deletion."));let[e,i,o]=t.split(".");return!e||!i||!o?ri(()=>new Error("Invalid custom field entity ID format. Expected: companyId.entityType.fieldId")):this.accountsService.getCompany(e).pipe(Be(r=>{if(!r.customFields)return ri(()=>new Error("Company has no custom fields to delete."));let u=structuredClone(r.customFields),b=u[i];if(!Array.isArray(b)||b.length===0)return ri(()=>new Error(`No custom fields found for entity type: ${i}`));let x=b.filter(G=>G.id!==o);switch(u[i]=x,r.type){case"client":return this.accountsService.updateClientDetails(e,{customFields:u});case"vendor":return this.accountsService.updateVendorDetails(e,{customFields:u});case"distributor":return this.accountsService.updateDistributorDetails(e,{customFields:u});default:return ri(()=>new Error(`Unsupported company type ('${r.type}') for custom field deletion.`))}}))}getActionIcons(t){return[{id:"delete",icon:"pi pi-trash",tooltip:"Delete Custom Field",visible:!0,action:()=>{this.confirmDelete(t)}}]}confirmDelete(t){this.confirmationService.confirm({message:"Are you sure you want to delete this custom field?",header:"Confirm Delete",icon:"pi pi-exclamation-triangle",accept:()=>{this.delete(t).subscribe({next:i=>{this.broadcastService.broadcast("entity-deleted",{entityType:"custom-field",operation:"delete",entityId:t,data:i})},error:i=>{console.error("Delete failed",i)}})},acceptButtonProps:{label:"Delete"},rejectButtonProps:{label:"Cancel",severity:"secondary"}})}customFieldDefinitionToCustomFieldResponse(t,e,i,o,r){return{id:`${i}.${o}.${r.id}`,tag:r.id,name:r.title,required:r.required,_entityType:t.find(u=>u.id===o),type:e.find(u=>u.id===r.type),values:(r.values??[]).map(u=>u.key).join(`
`)}}getTypes(){return re(dl.map(t=>({id:t,name:cl[t]})))}getCachedAssetTypes(t){let e=`assetTypes-${t}`;return this.cacheService.getOrFetch(e,()=>this.entitiesService.listAssetTypes(t))}filter(t,e){let i=(r,u)=>{let[b,x]=r.split("=");if(!x)return!0;let G=this.getNestedValue(u,b)??"";return x.includes("*")?this.utilityService.escapeRqlValue(G).toLowerCase().includes(x.replace(/\*/g,"").toLowerCase()):G.toLowerCase()===x.toLowerCase()};return(t||"").split(",").filter(r=>r).map(r=>r.includes("|")?r.slice(1,r.length-1).split("|"):[r]).reduce((r,u)=>r.filter(b=>u.some(x=>i(x,b))),e).sort((r,u)=>{let b=r.name.toLowerCase(),x=u.name.toLowerCase();return b<x?-1:b>x?1:0})}getCustomFieldResponseFromCompany(t,e){let i=t.items.find(o=>o.id===e);if(i)return i}getNestedValue(t,e){return e.split(".").reduce((i,o)=>{if(f(i)&&i!==null&&typeof i=="object"&&o in i)return i[o]},t)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var ft=class{getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u}=t;return T(e)?re({nodes:[],items:[],count:0,limit:0}):this.fetchEntities(e,o,i,r,u).pipe(Ve(b=>({nodes:this.buildEntityTree(b.items),items:b.items,count:b.count,limit:i||0})))}buildEntityTree(t){if(!t?.length)return[];let e=new Map,i=new Map,o=new Map,r=new Set;t.forEach(x=>{f(x.owner?.id)&&x.id===x.owner.id&&i.set(x.owner.id,x.id),x.parent?.id===x.id&&(r.add(x.id),console.warn(`Self-reference detected for entity ${x.id} (${x.name})`))}),t.forEach(x=>{e.set(x.id,{key:x.id,data:x,children:[],leaf:!0})});let u=[],b=new Set;return t.forEach(x=>this.processTreeNode(x,e,i,o,r,u,b)),this.sortNodesByName(u),u}processTreeNode(t,e,i,o,r,u,b){let x=e.get(t.id);if(x){if(r.has(t.id)){this.attachToOwnerOrRoot(t,x,i,e,u,b);return}if(t.owner?.id===t.id&&!b.has(t.id)){u.push(x),b.add(t.id);return}if(f(t.parent?.id)&&!r.has(t.id)){this.attachToParent(t,x,e,o,i,u,b);return}this.attachToOwnerOrRoot(t,x,i,e,u,b)}}attachToParent(t,e,i,o,r,u,b){let x=f(t.parent)?i.get(t.parent.id):void 0;x??=this.createMissingParentNode(t,o,r,i,u,b),!b.has(t.id)&&f(x.children)&&(x.children.push(e),x.leaf=!1,b.add(t.id))}createMissingParentNode(t,e,i,o,r,u){let b=f(t.parent)?e.get(t.parent.id):void 0;if(!b){let x=t?.parent?.id,G=`missing-${x}`,Z=this.createMissingEntityData(x,t?.parent?.name,t.owner);b={key:G,data:Z,children:[],leaf:!1,styleClass:"missing-parent-node"},e.set(x??"",b),this.attachNodeToOwnerOrRoot(G,b,t.owner?.id,i,o,r,u)}return b}attachToOwnerOrRoot(t,e,i,o,r,u){this.attachNodeToOwnerOrRoot(t.id,e,t.owner?.id,i,o,r,u)}attachNodeToOwnerOrRoot(t,e,i,o,r,u,b){if(b.has(t))return!1;if(f(i)&&o.has(i)&&t!==i){let x=o.get(i),G=f(x)?r.get(x):null;if(f(G?.children))return G.children.push(e),G.leaf=!1,b.add(t),!0}return u.push(e),b.add(t),!0}createMissingEntityData(t,e,i){return{id:t,name:e??"Unknown",owner:i,parent:null}}sortNodesByName(t){t.sort((e,i)=>{let o=e.data?.name?.toLowerCase()??"",r=i.data?.name?.toLowerCase()??"";return o.localeCompare(r)}),t.forEach(e=>{f(e.children)&&!ce(e.children)&&this.sortNodesByName(e.children)})}};var Fd=class n extends ft{entitiesService=c(P);confirmationService=c(Ee);broadcastService=c(we);fetchEntities(t,e,i,o,r){return this.entitiesService.listCostCentres(t,e,i,o,r)}getById(t){return this.entitiesService.getCostCentre(t)}delete(t){return this.entitiesService.deleteCostCentre(t)}getActionIcons(t){return[{id:"delete",icon:"pi pi-trash",tooltip:"Delete Cost Centre",visible:!0,action:()=>{this.confirmDelete(t)}}]}confirmDelete(t){this.confirmationService.confirm({message:"Are you sure you want to delete this cost centre?",header:"Confirm Delete",icon:"pi pi-exclamation-triangle",accept:()=>{this.delete(t).subscribe({next:i=>{this.broadcastService.broadcast("entity-deleted",{entityType:"cost-centre",operation:"delete",entityId:t,data:i})},error:i=>{console.error("Delete failed",i)}})},acceptButtonProps:{label:"Delete"},rejectButtonProps:{label:"Cancel",severity:"secondary"}})}static \u0275fac=(()=>{let t;return function(i){return(t||(t=He(n)))(i||n)}})();static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Id=class n extends ft{entitiesService=c(P);confirmationService=c(Ee);broadcastService=c(we);fetchEntities(t,e,i,o,r){return this.entitiesService.listAssetGroups(t,e,i,o,r)}getById(t){return this.entitiesService.getAssetGroup(t)}delete(t){return this.entitiesService.deleteAssetGroup(t)}getActionIcons(t){return[{id:"delete",icon:"pi pi-trash",tooltip:"Delete Asset Group",visible:!0,action:()=>{this.confirmDelete(t)}}]}confirmDelete(t){this.confirmationService.confirm({message:"Are you sure you want to delete this asset group?",header:"Confirm Delete",icon:"pi pi-exclamation-triangle",accept:()=>{this.delete(t).subscribe({next:i=>{this.broadcastService.broadcast("entity-deleted",{entityType:"asset-group",operation:"delete",entityId:t,data:i})},error:i=>{console.error("Delete failed",i)}})},acceptButtonProps:{label:"Delete"},rejectButtonProps:{label:"Cancel",severity:"secondary"}})}static \u0275fac=(()=>{let t;return function(i){return(t||(t=He(n)))(i||n)}})();static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ed=class n extends ft{entitiesService=c(P);confirmationService=c(Ee);broadcastService=c(we);fetchEntities(t,e,i,o,r){return this.entitiesService.listAssetCategories(t,e,i,o,r)}getById(t){return this.entitiesService.getAssetCategory(t)}delete(t){return this.entitiesService.deleteAssetCategory(t)}getActionIcons(t){return[{id:"delete",icon:"pi pi-trash",tooltip:"Delete Asset Category",visible:!0,action:()=>{this.confirmDelete(t)}}]}confirmDelete(t){this.confirmationService.confirm({message:"Are you sure you want to delete this asset category?",header:"Confirm Delete",icon:"pi pi-exclamation-triangle",accept:()=>{this.delete(t).subscribe({next:i=>{this.broadcastService.broadcast("entity-deleted",{entityType:"asset-category",operation:"delete",entityId:t,data:i})},error:i=>{console.error("Delete failed",i)}})},acceptButtonProps:{label:"Delete"},rejectButtonProps:{label:"Cancel",severity:"secondary"}})}static \u0275fac=(()=>{let t;return function(i){return(t||(t=He(n)))(i||n)}})();static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Md=class n extends ft{entitiesService=c(P);confirmationService=c(Ee);broadcastService=c(we);fetchEntities(t,e,i,o,r){return this.entitiesService.listZoneGroups(t,e,i,o,r)}getById(t){return this.entitiesService.getZoneGroup(t)}delete(t){return this.entitiesService.deleteZoneGroup(t)}getActionIcons(t){return[{id:"delete",icon:"pi pi-trash",tooltip:"Delete Geofence Group",visible:!0,action:()=>{this.confirmDelete(t)}}]}confirmDelete(t){this.confirmationService.confirm({message:"Are you sure you want to delete this geofence group?",header:"Confirm Delete",icon:"pi pi-exclamation-triangle",accept:()=>{this.delete(t).subscribe({next:i=>{this.broadcastService.broadcast("entity-deleted",{entityType:"geofence-group",operation:"delete",entityId:t,data:i})},error:i=>{console.error("Delete failed",i)}})},acceptButtonProps:{label:"Delete"},rejectButtonProps:{label:"Cancel",severity:"secondary"}})}static \u0275fac=(()=>{let t;return function(i){return(t||(t=He(n)))(i||n)}})();static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Rd=class n{accountsService=c(me);authDataService=c(ke);entityStateService=c(Y);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u}=t;return T(e)?re({items:[],count:0}):this.accountsService.listUsers(e,o,i,r,u)}getById(t){return this.accountsService.getUser(t)}getStateOptions(){return[{label:"Active",value:Zi.StateEnum.Active},{label:"Inactive",value:Zi.StateEnum.Inactive},{label:"Suspended",value:Zi.StateEnum.Suspended},{label:"Deleted",value:Zi.StateEnum.Deleted}]}updateState(t,e){return this.accountsService.updateUser(t,{state:e})}getActionIcons(t){return this.authDataService.hasPermission("users.create")?[{id:"changeState",icon:"pi pi-trash",tooltip:"Change User State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]:[]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ad=class n{accountsService=c(me);confirmationService=c(Ee);broadcastService=c(we);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u}=t;return T(e)?re({items:[],count:0}):this.accountsService.listUserRoles(e,o,i,r,u)}getById(t){return this.accountsService.getUserRole(t)}delete(t){return this.accountsService.deleteUserRole(t)}getActionIcons(t){return[{id:"delete",icon:"pi pi-trash",tooltip:"Delete User Role",visible:!0,action:()=>{this.confirmDelete(t)}}]}confirmDelete(t){this.confirmationService.confirm({message:"Are you sure you want to delete this user role?",header:"Confirm Delete",icon:"pi pi-exclamation-triangle",accept:()=>{this.delete(t).subscribe({next:i=>{this.broadcastService.broadcast("entity-deleted",{entityType:"user-role",operation:"delete",entityId:t,data:i})},error:i=>{console.error("Delete failed",i)}})},acceptButtonProps:{label:"Delete"},rejectButtonProps:{label:"Cancel",severity:"secondary"}})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var kd=class n{entitiesService=c(P);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u,recurse:b}=t;return T(e)?re({items:[],count:0}):this.entitiesService.listThemes(e,b,o,i,r,u)}getById(t){return this.entitiesService.getTheme(t)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Od=class n extends ft{accountsService=c(me);confirmationService=c(Ee);broadcastService=c(we);fetchEntities(t,e,i,o,r){return this.accountsService.listCompanyGroups(t,e,i,o,r)}getById(t){return this.accountsService.getCompanyGroup(t)}delete(t){return this.accountsService.deleteCompanyGroup(t)}getActionIcons(t){return[{id:"delete",icon:"pi pi-trash",tooltip:"Delete Company Group",visible:!0,action:()=>{this.confirmDelete(t)}}]}confirmDelete(t){this.confirmationService.confirm({message:"Are you sure you want to delete this company group?",header:"Confirm Delete",icon:"pi pi-exclamation-triangle",accept:()=>{this.delete(t).subscribe({next:i=>{this.broadcastService.broadcast("entity-deleted",{entityType:"company-group",operation:"delete",entityId:t,data:i})},error:i=>{console.error("Delete failed",i)}})},acceptButtonProps:{label:"Delete"},rejectButtonProps:{label:"Cancel",severity:"secondary"}})}static \u0275fac=(()=>{let t;return function(i){return(t||(t=He(n)))(i||n)}})();static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Pd=class n{accountsService=c(me);entityStateService=c(Y);broadcastService=c(we);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u,counts:b}=t;return T(e)?re({items:[],count:0}):this.accountsService.listClients(e,o,i,r,u,b)}getById(t){return this.accountsService.getClient(t)}getStateOptions(){return[{label:"Active",value:Jt.StateEnum.Active},{label:"Inactive",value:Jt.StateEnum.Inactive},{label:"Suspended",value:Jt.StateEnum.Suspended},{label:"Deleted",value:Jt.StateEnum.Deleted}]}updateState(t,e){return this.accountsService.updateClient(t,{state:e})}getActionIcons(t){return[{id:"viewInTree",icon:"pi pi-sitemap",tooltip:"View this client in the Navigation Tree",visible:!0,action:()=>{let e=this.entityStateService.selectedItem();e&&this.broadcastService.broadcast("view-entity-in-tree",{entity:e})}},{id:"changeState",icon:"pi pi-trash",tooltip:"Change Client State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Vd=class n{accountsService=c(me);entityStateService=c(Y);broadcastService=c(we);getList(t){let{owner:e,limit:i,offset:o,sortField:r,filters:u,counts:b}=t;return T(e)?re({items:[],count:0}):this.accountsService.listDistributors(e,o,i,r,u,b)}getById(t){return this.accountsService.getDistributor(t)}getStateOptions(){return[{label:"Active",value:$i.StateEnum.Active},{label:"Deleted",value:$i.StateEnum.Deleted}]}updateState(t,e){return this.accountsService.updateDistributor(t,{state:e})}getActionIcons(t){return[{id:"viewInTree",icon:"pi pi-sitemap",tooltip:"View this distributor in the Navigation Tree",visible:!0,action:()=>{let e=this.entityStateService.selectedItem();e&&this.broadcastService.broadcast("view-entity-in-tree",{entity:e})}},{id:"changeState",icon:"pi pi-trash",tooltip:"Change Distributor State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ld=class n extends ft{deviceTypesService=c($e);authDataService=c(ke);entityStateService=c(Y);fetchEntities(t,e,i,o,r){return this.deviceTypesService.listDeviceTypes(t,!0,e,i,o,r)}getList(t){let{owner:e,limit:i,sortField:o,filters:r}=t,u=i||100;if(T(e))return re({nodes:[],items:[],count:0,limit:u});let b=0;return this.fetchEntities(e,b,u,o,r).pipe(Be(x=>{let G=x.count;if(x.items.length>=G)return re(x);let Z=G-x.items.length,ve=Math.ceil(Z/u),qe=[];for(let nt=1;nt<=ve;nt++){let ss=b+nt*u;qe.push(this.fetchEntities(e,ss,u,o,r))}return ai(qe).pipe(Ve(nt=>({items:[...x.items,...nt.flatMap(Gd=>Gd.items)],count:G})))}),Ve(x=>({nodes:this.buildEntityTree(x.items),items:x.items,count:x.count,limit:u})))}getById(t){return this.deviceTypesService.getDeviceType(t)}getStateOptions(){return[{label:"Active",value:Za.StateEnum.Active},{label:"Deleted",value:Za.StateEnum.Deleted}]}updateState(t,e){return this.deviceTypesService.updateDeviceType(t,{state:e})}getActionIcons(t){return this.authDataService.hasPermission("device-types:create")?[{id:"changeState",icon:"pi pi-trash",tooltip:"Change Device Type State",visible:!0,showPopover:!0,popoverType:"state",action:()=>{this.entityStateService.togglePopover("changeState")}}]:[]}static \u0275fac=(()=>{let t;return function(i){return(t||(t=He(n)))(i||n)}})();static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var my=n=>({"icon-primary":n});function py(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit custom field details"))}function uy(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function fy(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.customFieldDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Lr=class n extends B{dialogConfig=c(al,{optional:!0});accountsService=c(me);utilityService=c(he);customFieldsAdapter=c(Vr);customFieldDetails=v(()=>{let t=this.entity();if(!f(t))return[];if(!("id"in t))return[];let[e,i,o]=t.id.split(".");return[{key:"Id",value:o??"None"},{key:"Name",value:t.name??"None"},{key:"Applies To",value:t?._entityType?.name??"None"},{key:"Required",value:t.required===!0?"Yes":"No"},{key:"Type",value:t.type?.name??"None"}]});selectOptionsLoaded=R(!1);selectOptions={};constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.selectOptionsLoaded()&&_e(()=>{this.updateFormFields()})})}ngOnInit(){this.loadSelectOptions()}loadSelectOptions(){let t=this.entity(),e;if(f(this.dialogConfig?.data?.ownerId))e=this.dialogConfig?.data?.ownerId;else if(t?.id&&typeof t.id=="string"){let i=t.id.split(".");i.length>0&&(e=i[0])}if(T(e)){this.selectOptions={},this.selectOptionsLoaded.set(!0),this.updateFormFields();return}this.customFieldsAdapter.getCachedAssetTypes(e).subscribe({next:i=>{let o=["simcard","assettag","device","asset","event"];this.selectOptions={entityTypes:[...i.items,...o.map(r=>({name:this.getDisplayName(r),id:r}))].map(r=>({label:r.name??"",value:r.id})).sort((r,u)=>r.label.localeCompare(u.label)),required:[{label:"Yes",value:!0},{label:"No",value:!1}],types:[{label:"Text",value:"text"},{label:"Memo",value:"memo"},{label:"Selection",value:"combo"},{label:"Yes/No",value:"checkbox"},{label:"Date",value:"date"},{label:"DateTime",value:"datetime"},{label:"URL",value:"url"}]},this.selectOptionsLoaded.set(!0)},error:()=>{this.selectOptionsLoaded.set(!0)}})}updateFormFields(){let t=this.entity(),e="",i="",o="",r="",u=!1,b="";if(f(t)&&f(t.id)){let[x,G,Z]=t.id.split(".");e=x||"",i=Z||"",o=t.name||"",r=t._entityType?.id||"",u=t.required||!1,b=t.type?.id||""}else f(this.dialogConfig?.data?.ownerId)&&(e=String(this.dialogConfig?.data?.ownerId??""));this.formFields=[k("ownerId","OwnerId",e,{name:"ownerId",hidden:!0}),k("tag","Id",i,{name:"tag",validations:[{name:"required",validator:w.required,message:"Id is required"}]}),k("title","Name",o,{name:"title",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),H("entityType","Applies To",this.selectOptions.entityTypes??[],r,{name:"entityType",validations:[{name:"required",validator:w.required,message:"Type is required"}],disabled:!this.createMode(),props:{appendTo:"body"}}),H("required","Required",this.selectOptions.required??[],u,{name:"required",validations:[{name:"required",validator:w.required,message:"Required is required"}],props:{appendTo:"body"}}),H("type","Type",this.selectOptions.types??[],b,{name:"type",validations:[{name:"required",validator:w.required,message:"Type is required"}],props:{appendTo:"body"},conditional:!0,conditions:{combo:[Ge("values","Values",f(t)?t.values:"",{name:"values",validations:[{name:"required",validator:w.required,message:"Values are required for Selection type"}],hint:"Enter each value on a new line",props:{rows:5,autoResize:!0}})]}})]}submitChanges(t){let e=this.entity();if(T(e))return;let i=this.transformFormData(t),o=Object.fromEntries(Object.entries({id:i.tag,title:i.title,type:i.type,required:i.required,values:i.values}).filter(([x,G])=>f(G))),[r,u,b]=e.id.split(".");Ce(this.accountsService.getCompany(r)).then(x=>{let G=JSON.parse(JSON.stringify(x.customFields)),Z=G[u]??[],ve=Z.findIndex(nt=>nt.id===b);ve>-1&&(Z[ve]=M(M({},Z[ve]),o)),G[u]=Z;let qe;if(x.type==="client")qe=this.accountsService.updateClientDetails(x.id,{customFields:G});else if(x.type==="vendor")qe=this.accountsService.updateVendorDetails(x.id,{customFields:G});else{console.error("Neither clientId nor vendorId found in route parameters");return}qe.pipe(W(this.destroyRef)).subscribe({next:nt=>{this.isFormEditable.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"custom-field",operation:"update",entityId:e.id,data:nt})},error:nt=>{this.isFormEditable.set(!0),this.isSubmitting.set(!1)}})}).catch(()=>{})}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);if(f(e.entityType)&&typeof e.entityType=="string"){let i=this.selectOptions?.entityTypes?.find(o=>o.value===e.entityType);i&&(e.entityType={id:i.value,name:i.label})}if(f(e.values)&&typeof e.values=="string"){let i=e.values;e.values=i.split(`
`).filter(o=>o.trim()!=="").map(o=>({key:o.trim(),value:o.trim()}))}return e}getDisplayName(t){return{assettag:"Asset Tag",simcard:"SIM Card"}[t]||this.utilityService.toTitleCase(t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-custom-field-details-section"]],features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-mobile","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Custom Field Details"),s(),h(7,py,2,1,"div",6),s(),l(8,"span"),D(9,"Configure various details about your Custom Field."),s()()(),h(10,uy,1,3,"app-dynamic-form",7),h(11,fy,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(5,my,i.isFormEditable())),I("aria-label","mobile icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q],encapsulation:2})};var Io=class n{createCustomFieldInformationSections(t){return[{id:"custom-field-details",title:"CustomField Details",component:Lr,componentInputs:{entity:t},category:"information",order:10}]}createAllCustomFieldSections(t){return[...this.createCustomFieldInformationSections(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var gy=n=>({"icon-primary":n});function hy(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit email provider details"))}function yy(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function vy(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.emailProviderDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Nr=class n extends B{ownerId=E(null);entitiesService=c(P);operationRegistry=c(Q);cdr=c(Me);selectOptionsLoaded=R(!1);emailProviderDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Type",value:t.type?.name??"None"},{key:"Name",value:t.name}]:[]});selectOptions={};faAt=Fl;constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{this.selectOptionsLoaded()&&_e(()=>{this.updateFormFields(),this.cdr.detectChanges()})}),U(()=>{let t=this.entity();f(t)&&!this.createMode()&&_e(()=>{this.updateFormFields()})})}ngOnInit(){this.loadSelectOptions()}loadSelectOptions(){let t=this.entity(),e=this.ownerId(),i=t?.owner?.id??e;T(i)&&(this.selectOptions={},this.selectOptionsLoaded.set(!0),this.updateFormFields()),this.entitiesService.listEmailProviderTypes(i).pipe(W(this.destroyRef)).subscribe(o=>{this.selectOptions={emailProviderTypes:o.items.map(r=>({label:r?.name,value:r.id,data:r})).sort((r,u)=>r.label.localeCompare(u.label))},this.selectOptionsLoaded.set(!0)})}updateFormFields(){let t=this.entity();this.formFields=[H("type","Type",this.selectOptions?.emailProviderTypes,t?.type?.id,{name:"type",validations:[{name:"required",validator:w.required,message:"Type is required"}],disabled:!this.createMode(),props:{appendTo:"body"}}),k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]})]}getUpdateMethod(){return this.operationRegistry.getOperation("email-provider","update")??((t,e)=>this.entitiesService.updateEmailProvider(t,e))}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);if(f(e.type)){let i=e.type,o=this.selectOptions?.emailProviderTypes?.find(r=>r.value===i);o&&(e.type={id:i,name:o.data?.name})}return e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-email-provider-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Email Provider Details"),s(),h(7,hy,2,1,"div",6),s(),l(8,"span"),D(9,"The following information is required in order to configure your email provider."),s()()(),h(10,yy,1,3,"app-dynamic-form",7),h(11,vy,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faAt)("ngClass",N(5,gy,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,Te,V,q,te,ne],encapsulation:2})};var Cy=n=>({"icon-primary":n});function _y(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit email parameters details"))}function by(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Sy(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.emailProviderParameters())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Gr=class n extends B{ownerId=E(null);emailProviderType=E(null);entitiesService=c(P);operationRegistry=c(Q);isLoadingEmailType=R(!1);customValues=R({});emailProviderParameters=v(()=>{let t=this.entity()?.parameters,e=this.emailProviderType();if(T(t)||T(e))return[];let i=JSON.parse(e?.parameterDefinition??""),o=[];return i.groups.forEach(r=>{r.fields.forEach(u=>{let b="None";if(u.type==="password")b="****";else{let x=t?.[u.id];typeof x=="object"?b=JSON.stringify(x):x!==void 0&&(b=x)}if(o.push({key:u.title,value:b}),u.type==="combo"&&u.values){let x=t?.[u.id],G=u.values.find(Z=>Z.key===x);G?.fields&&G.fields.forEach(Z=>{if(t?.[Z.id]!==void 0){let ve="None",qe=t?.[Z.id];Z.type==="password"?ve="****":typeof qe=="object"?ve=JSON.stringify(qe):qe!==void 0&&(ve=qe),o.push({key:`${Z.title}`,value:ve})}})}})}),o});selectOptions={};constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.emailProviderType();f(t)&&this.updateFormFields()})}updateFormFields(){let t=this.entity(),e=this.emailProviderType();if(!e)return;let i=JSON.parse(e?.parameterDefinition??"{}");this.formFields=i.groups.reduce((o,r)=>{let u=r.fields.map(b=>this.createFormFieldConfig(b,t));return[...o,...u]},[])}createFormField(t,e){let i={name:t.id,validations:this.createValidations(t),hint:t.description},o=e?.parameters?.[t.id];switch(t.type){case"memo":return Ge(t.id,t.title,o,i);case"number":return ie(t.id,t.title,o,ee(M({},i),{props:{min:t.min,max:t.max}}));case"combo":return H(t.id,t.title,t.values?.map(r=>({label:r.value,value:r.key}))??[],o,ee(M({},i),{props:{appendTo:"body"},conditional:(t?.values?.length??0)>0,conditions:this.createConditionalFields(t,e)}));case"password":return ei(t.id,t.title,ee(M({},i),{props:{type:"password"}}));case"url":return k(t.id,t.title,o,ee(M({},i),{validations:[...i.validations,{name:"pattern",validator:w.pattern(/^https?:\/\/.+/),message:`${t.title} must be a valid URL`}]}));case"text":default:return k(t.id,t.title,o,i)}}createValidations(t){let e=[];return(t.required??!1)&&e.push({name:"required",validator:w.required,message:`${t.title} is required`}),t.type==="number"&&(t.min!==void 0||t.max!==void 0)&&(t.min!==void 0&&e.push({name:"min",validator:w.min(t.min),message:`${t.title} must be at least ${t.min}`}),t.max!==void 0&&e.push({name:"max",validator:w.max(t.max),message:`${t.title} must be at most ${t.max}`})),e}createConditionalFields(t,e){return f(t.values)?t.values.reduce((i,o)=>f(o.fields)?ee(M({},i),{[o.key]:o.fields.map(r=>this.createFormField(r,e))}):{},{}):{}}getUpdateMethod(){return this.operationRegistry.getOperation("email-providers","update")??((t,e)=>this.entitiesService.updateEmailProvider(t,e))}onFormValueChange(t){let e=M({},t);this.formValueChange.emit({parameters:e})}createConditionFields(t){return t.map(e=>this.createFormFieldConfig(e,this.entity()))}createFormFieldConfig(t,e){if(t.type==="memo")return Ge(t.id,t.title,e?.parameters?.[t.id],{name:t.id,validations:t.required??!1?[{name:"required",validator:w.required,message:`${t.title} is required`}]:[],hint:t.description});if(t.type==="number")return ie(t.id,t.title,e?.parameters?.[t.id],{name:t.id,validations:t.required??!1?[{name:"required",validator:w.required,message:`${t.title} is required`}]:[],hint:t.description});if(t.type==="combo"&&t.values){let i=t.values.map(o=>({label:o.value,value:o.key}));return H(t.id,t.title,i,e?.parameters?.[t.id]||t.defaultValue,{name:t.id,validations:t.required??!1?[{name:"required",validator:w.required,message:`${t.title} is required`}]:[],hint:t.description,props:{appendTo:"body"},conditional:!0,conditions:i.reduce((o,r)=>ee(M({},o),{[r.value]:this.createConditionFields(t?.values?.find(u=>u.key===r.value)?.fields??[])}),{})})}return t.type==="password"?ei(t.id,t.title,{name:t.id,validations:t.required??!1?[{name:"required",validator:w.required,message:`${t.title} is required`}]:[],hint:t.description,props:{type:"password"}}):k(t.id,t.title,e?.parameters?.[t.id],{name:t.id,validations:t.required??!1?[{name:"required",validator:w.required,message:`${t.title} is required`}]:[],hint:t.description})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-email-provider-parameters-section"]],inputs:{ownerId:[1,"ownerId"],emailProviderType:[1,"emailProviderType"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-wrench","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Parameters"),s(),h(7,_y,2,1,"div",6),s(),l(8,"span"),D(9,"Configure the following parameters that are required to communicate with the email provider."),s()()(),h(10,by,1,3,"app-dynamic-form",7),h(11,Sy,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(5,Cy,i.isFormEditable())),I("aria-label","wrench icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,Te,V,q],encapsulation:2})};var Mo=class n{createEmailProviderInformationSection(t,e){return[{id:"email-provider-details",title:"Email Config Details",component:Nr,componentInputs:{entity:t},category:"information",order:10},{id:"email-provider-parameters",title:"Email Config Parameters",component:Gr,componentInputs:{entity:t,entityType:"email-provider",dataPath:"parameters",injectDataAtPath:!0,emailProviderType:e},category:"information",order:20}]}createChangesSection(t){return[{id:"email-provider-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllEmailProviderSections(t,e){return[...this.createEmailProviderInformationSection(t,e),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Dy=["customTemplate"],Ty=n=>({"icon-primary":n});function wy(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme details"))}function xy(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Fy(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function Iy(n,t){if(n&1&&C(0,"img",12),n&2){let e=a().$implicit;g("src",e.imageUrl,li)("alt",e.key||"image")}}function Ey(n,t){if(n&1&&D(0),n&2){let e=a().$implicit;ye(" ",e==null?null:e.value," ")}}function My(n,t){if(n&1&&h(0,Iy,1,2,"img",12)(1,Ey,1,1),n&2){let e=t.$implicit;y(e!=null&&e.imageUrl?0:1)}}var qr=class n extends B{logoTemplate;ownerId=E(null);entitiesService=c(P);operationRegistry=c(Q);apiUrlService=c(Fn);themeDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Name",value:t.name},{key:"Description",value:t.description??"None"},{key:"Custom CSS Link",value:ce(t?.settings?.cssSrc)?"None":t.settings.cssSrc},{key:"Custom Tags",value:(t?.customTags?.length??0)>0?t.customTags.map(e=>e.name).join(", "):"None"},{key:"Web Logo",value:"",imageUrl:`${this.apiUrlService.getCurrentApiUrl()}/entities/themes/${t.id}/logo?size=small`}]:[]});faPalette=Ol;customHtmlTagModalConfig;constructor(){super(),U(()=>{this.logoTemplate&&(this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.logoTemplate}])})}updateFormFields(){let t=this.entity();this.customHtmlTagModalConfig={modalComponent:be,modalTitle:"Custom HTML Tags",subHeader:"Enter the details for an HTML tag that will be injected into the page at your chosen location.",defaultItemProvider:()=>({id:Xe(),name:"",tag:"script",location:"head",attributes:"",contents:""}),listItemFormatter:e=>this.stateItemToListItem(e),modalFields:e=>[k("name","Name",e?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),H("location","Location",[{label:"Header",value:"head"},{label:"Body",value:"body"}],e?.location,{name:"location",validations:[{name:"required",validator:w.required,message:"Location is required"}]}),k("tag","Tag Type",e?.tag,{name:"tag",validations:[{name:"required",validator:w.required,message:"Tag Type is required"}]}),Ge("attributes","Tag Attributes",e?.attributes,{name:"attributes",validations:[],props:{rows:5},hint:'A list of tag attributes, one per line, in the format: attr="value"'}),Ge("contents","Tag Contents",e?.contents,{name:"contents",validations:[],props:{rows:5}})]},this.formFields=[k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),k("description","Description",t?.description,{name:"description",validations:[{name:"required",validator:w.required,message:"Description is required"}]}),{name:"settings",key:"settings",type:"group",fields:[k("cssSrc","Custom CSS Link",t?.settings?.cssSrc,{name:"cssSrc",validations:[]})]},...this.createMode()?[]:[De("customTags","Custom Tags",t?.customTags??[],{name:"customTags",validations:[],props:{modalConfig:this.customHtmlTagModalConfig}})]]}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??((t,e)=>this.entitiesService.updateTheme(t,e))}stateItemToListItem(t){return{id:t.id,title:t.name,icon:"code",display:""}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-details-section"]],viewQuery:function(e,i){if(e&1&&pe(Dy,7),e&2){let o;le(o=de())&&(i.logoTemplate=o.first)}},inputs:{ownerId:[1,"ownerId"]},features:[O],decls:14,vars:7,consts:[["customTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"],[1,"max-w-[150px]",3,"src","alt"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Theme Details"),s(),h(7,wy,2,1,"div",7),s(),l(8,"span"),D(9,"Give your theme a unique name and description."),s()()(),h(10,xy,1,3,"app-dynamic-form",8),h(11,Fy,1,4,"app-grid",9),s(),ae(12,My,2,1,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faPalette)("ngClass",N(5,Ty,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,Te,V,q,te,ne],encapsulation:2})};var Ii=class n{utilityService=c(he);createPreset(t,e,i,o){return{[i??`${this.utilityService.toTitleCase(e.replaceAll("-"," "))} ${this.utilityService.toTitleCase(t.replaceAll("-"," "))}`]:o(`var(--${e}-${t})`)}}createPresets(t,e,i){return e.reduce((o,r)=>M(M({},o),this.createPreset(t,r,void 0,i)),{})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Qe=class n{themeEngine=c(bn);utilityService=c(he);themeUtilityService=c(Ii);computeColor(t){return this.themeEngine.resolveFormula(t)}getFontColorPresets(t,e){return ee(M({},this.themeUtilityService.createPresets("font-color",[...e??[]],this.computeColor.bind(this))),{Auto:this.computeColor(`var(--${t}-background-color).inverse("${Cn}", "${_n}")`),"Primary Color":this.computeColor("var(--color-primary-color)"),"Primary Contrast":this.computeColor("var(--color-primary-contrast)"),"Secondary Color":this.computeColor("var(--color-secondary-color)"),"Secondary Contrast":this.computeColor("var(--color-secondary-contrast)"),"Off Black":this.computeColor(_n),"Off White":this.computeColor(Cn),Black:this.computeColor("#000000"),White:this.computeColor("#ffffff")})}getBackgroundColorPresets(t,e){let o=[...t??[]].reduce((r,u)=>M(M(M(M({},r),this.themeUtilityService.createPreset("background-color",u,`${this.utilityService.toTitleCase(u)} Background`,this.computeColor.bind(this))),this.createShadeValues("lighten",u,"background")),this.createShadeValues("darken",u,"background")),{});return M(M({},e),o)}getBorderColorPresets(t,e,i,o){let u=[t,...i??[]].reduce((b,x)=>M(M(M(M({},b),this.themeUtilityService.createPreset("background-color",x,`${this.utilityService.toTitleCase(x)} Background`,this.computeColor.bind(this))),this.createShadeValues("lighten",x,"background")),this.createShadeValues("darken",x,"background")),{});return M(ee(M(M({},this.themeUtilityService.createPresets("border-color",[...e??[]],this.computeColor.bind(this))),u),{"Primary Color":this.computeColor("var(--color-primary-color)"),"Secondary Color":this.computeColor("var(--color-secondary-color)")}),o)}createShadeValues(t,e,i,o=ul){return o.reduce((r,u)=>{let b=`${this.utilityService.toTitleCase(t)} ${this.utilityService.toTitleCase(e)} ${this.utilityService.toTitleCase(i)} ${u*100}%`;return r[b]=this.computeColor(`var(--${e}-${i}-color).${t}(${u})`),r},{})}getAllColorPresets(t,e=[],i={}){let o=[t,...e],r=[...new Set(o)],u={"Primary Color":this.computeColor("var(--color-primary-color)"),"Primary Contrast":this.computeColor("var(--color-primary-contrast)"),"Secondary Color":this.computeColor("var(--color-secondary-color)"),"Secondary Contrast":this.computeColor("var(--color-secondary-contrast)"),"Success Color":this.computeColor("var(--color-success-color)"),"Success Contrast":this.computeColor("var(--color-success-contrast)"),"Info Color":this.computeColor("var(--color-info-color)"),"Info Contrast":this.computeColor("var(--color-info-contrast)"),"Warning Color":this.computeColor("var(--color-warning-color)"),"Warning Contrast":this.computeColor("var(--color-warning-contrast)"),"Danger Color":this.computeColor("var(--color-danger-color)"),"Danger Contrast":this.computeColor("var(--color-danger-contrast)"),"Notify Color":this.computeColor("var(--color-notify-color)"),"Notify Contrast":this.computeColor("var(--color-notify-contrast)"),White:this.computeColor("#ffffff"),Black:this.computeColor("#000000"),"Off White":this.computeColor(Cn),"Off Black":this.computeColor(_n),Transparent:this.computeColor("transparent")};return M(M(M(M(M({},this.getFontColorPresets(t,r)),this.getBackgroundColorPresets(r,M(M({},u),i))),this.getBorderColorPresets(t,r,r,M(M({},u),i))),u),i)}isColorValue(t,e){if(!t)return!1;let i=t.trim();return e!=null&&e.trim()!==""&&this.isColorByKeyName(e)?!0:this.isColorByValueFormat(i)}isColorByKeyName(t){let e=t.toLowerCase();return["color","background","contrast"].some(u=>e.includes(u))?!0:e.includes("border")?e.includes("color")||e==="border"||e.endsWith(" border"):!!(e.includes("font")&&e.includes("color")||["primary","secondary","success","info","notify","warning","danger"].some(u=>{let b=e.includes(u),x=e.includes("color"),G=e===u||e===`${u} color`;return b&&(x||G)})||["active","subnav","logo","client"].some(u=>{let b=e.includes(u),x=e.includes("color")||e.includes("background")||e.includes("border")&&e.includes("color");return b&&x}))}isColorByValueFormat(t){if([/^#[0-9a-fA-F]{3,8}$/,/^rgb\s*\(/,/^rgba\s*\(/,/^hsl\s*\(/,/^hsla\s*\(/,/^(red|blue|green|yellow|purple|orange|pink|brown|black|white|gray|grey|transparent)$/i].some(i=>i.test(t)))return!0;if(t.startsWith("var(--")&&t.endsWith(")")){let i=t.slice(6,-1).toLowerCase();return[/.*color.*/,/.*background.*/,/.*border.*/,/.*contrast.*/].some(r=>r.test(i))}return!1}getContextualColorPresets(t,e,i=[]){let o=t.toLowerCase(),r=[e,...i];return o.includes("font")||o.includes("text")?this.getFontColorPresets(e,r):o.includes("background")||o.includes("bg")?this.getBackgroundColorPresets(r):o.includes("border")?this.getBorderColorPresets(e,r,r):this.getAllColorPresets(e,i)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ur=class n{colorService=c(Qe);themeUtilityService=c(Ii);createFontFamilyField(t,e,i){let o=Object.entries(M({},this.themeUtilityService.createPresets("font-family",i??[],r=>r))).map(([r,u])=>({label:r,value:u}))??[];return this.createDropdownWithGrouping({id:t,label:"Font Family",options:[...o,...Mn.map(r=>({label:r,value:r}))],value:e,props:{appendTo:"body",filter:!0}})}createFontWeightField(t,e){return this.createDropdownWithGrouping({id:t,label:"Font Weight",options:ml.map(i=>({label:i,value:i})),value:e,props:{appendTo:"body",filter:!0}})}createFontTransformField(t,e){return this.createDropdownWithGrouping({id:t,label:"Font Transform",options:pl,value:e,props:{appendTo:"body"}})}createFontColorField(t,e,i,o,r="Font Color",u){let b=this.colorService.getFontColorPresets(i,o);return this.createColorComboField(t,e,M(M({},b),u),r)}createBackgroundColorField(t,e,i,o="Background Color",r){let u=this.colorService.getBackgroundColorPresets(i,r);return this.createColorComboField(t,e,u,o)}createBorderColorField(t,e,i,o,r,u){let b=this.colorService.getBorderColorPresets(i,o,r,u);return this.createColorComboField(t,e,b,"Border Color")}createDropShadowField(t,e,i){return this.createDropdownWithGrouping({id:t,label:i,options:ut,value:e,props:{appendTo:"body"}})}createColorComboField(t,e,i,o){let r=Object.entries(i).map(([u,b])=>({label:u,value:b}));return this.createFieldWithGrouping(t,u=>Sn(u,o,this.colorService.computeColor(e),{name:u,props:{appendTo:"body",colorOptions:r}}))}createSizeNumberField(t,e,i,o="rem"){return this.createFieldWithGrouping(t,r=>ie(r,i,e,{name:r,props:{appendTo:"body",suffix:o}}))}createDropdownWithGrouping(t){return this.createFieldWithGrouping(t.id,e=>H(e,t.label,t.options,t.value,{name:e,validations:[],props:t.props}))}createFieldWithGrouping(t,e){if(t.includes(".")){let[i,o]=t.split(".",2);return{key:i,name:i,type:"group",fields:[e(o)]}}return e(t)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var zr=class n{merge(t,e){if(!t?.length)return this.consolidateByKey(e);let i=this.consolidateByKey(t),o=this.consolidateByKey(e);return this.mergeConsolidatedFields(i,o)}consolidateByKey(t){let e=new Map,i=[];for(let o of t){let r=o.key||o.name;if(!r){i.push(o);continue}if(e.has(r)){let u=e.get(r);e.set(r,this.mergeFields(u,o))}else e.set(r,o)}return[...i,...Array.from(e.values())]}mergeFields(t,e){if(this.isGroupField(t)&&this.isGroupField(e)){let i=[...t.fields??[],...e.fields??[]];return ee(M(M({},t),e),{fields:this.consolidateByKey(i)})}return e}isGroupField(t){return t.type==="group"&&Array.isArray(t.fields)}mergeConsolidatedFields(t,e){let i=new Map(t.map(o=>[o.key||o.name,o]));return e.map(o=>{let r=o.key||o.name,u=r?i.get(r):void 0;return u?this.mergeFields(u,o):o})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var xe=class extends B{constructor(e){super();this.group=e}faFill=Gl;title="Theme Settings";description="Customize your theme by tweaking the following settings.";themeEngine=c(bn);formFieldFactory=c(Ur);formFieldMerger=c(zr);entitiesService=c(P);operationRegistry=c(Q);colorService=c(Qe);formChanges={};updateFormFields(){let e=this.entity();if(!e)return;let i=this.getFields(e);this.formFields=this.formFieldMerger.merge(this.formFields,i)}onEntityLoaded(e){super.onEntityLoaded(e),e?.settings&&this.themeEngine.settingsToVariables(e.settings)}isColorRow(e){return["Font Color","Background Color","Border Color"].includes(e.key)}getColorLabelAndValue(e){let i=M(M(M({},this.colorService.getFontColorPresets(this.group)),this.colorService.getBackgroundColorPresets([])),this.colorService.getBorderColorPresets(this.group)),o=this.colorService.computeColor(e),r=Object.keys(i).find(u=>i[u]===o);return f(r)?{label:r,value:o}:{label:o,value:o}}onFieldValueChange(e){let i=e.fieldKey.split("."),o=this.formChanges;for(let r=0;r<i.length-1;r++)(T(o[i[r]])||typeof o[i[r]]!="object")&&(o[i[r]]={}),o=o[i[r]];o[i[i.length-1]]=e.value}getThemeValue(e,i){return i.reduce((o,r)=>{if(o!=null&&typeof o=="object"&&r in o)return o[r]},e)}formatThemeValue(e,i){let o=this.getThemeValue(e,i.path);if(o==null)return"None";if(i.transform)return i.transform(o);if(i.options)return i.options.find(b=>b.value===o)?.label??"None";if(typeof o!="string"&&typeof o!="number"&&typeof o!="boolean")return"None";let r=String(o);if(r.startsWith("var(")){let u=this.themeEngine.resolveFormula(r);return this.formatResolvedValue(u,i.path)}return this.formatResolvedValue(r,i.path)}formatResolvedValue(e,i){if(!e)return"None";let o=i.join(".");return o.includes("font.family")?this.formatFontFamily(e):o.includes("font.weight")?this.formatFontWeight(e):o.includes("font.transform")?this.formatFontTransform(e):o.includes("icon.pack")?this.formatIconPack(e):o.includes("shadow")||o.includes("border.shadow")?this.formatDropShadow(e):o.includes("size")||o.includes("width")||o.includes("radius")?this.formatSize(e):e}formatFontFamily(e){let i=e.replace(/['"]/g,""),o=Mn.find(r=>r===i);return o||i||"Default"}formatFontWeight(e){return{300:"Light",400:"Normal",500:"Medium",600:"Semi Bold",700:"Bold"}[e]??e??"Normal"}formatFontTransform(e){return{unset:"None",none:"None",capitalize:"Title Case",uppercase:"Upper Case",lowercase:"Lower Case"}[e]??e??"None"}formatIconPack(e){return Rn.find(o=>o.value===e)?.label??e??"Default"}formatDropShadow(e){return ut.find(o=>o.value===e)?.label??(e==="none"?"None":e)??"None"}formatSize(e){return!e||e==="0"||e==="none"?"None":e==="auto"?"Auto":e==="hidden"?"Hidden":/\d+(px|rem|em|%|pt)/.test(e)?e:/^\d+(\.\d+)?$/.test(e)?`${e}px`:e??"Unknown"}parseFloatSafely(e){if(typeof e=="number")return e;if(typeof e=="string"){let i=parseFloat(e);return isNaN(i)?0:i}return 0}createFormFieldsFromConfig(e,i){let o=this.themeEngine.themeSettingsMergedWithDefault(e?.settings??{});return i.map(r=>{let u=this.getThemeValue(o,r.path);return this.createFormFieldFromConfig(r,u)})}createFormFieldFromConfig(e,i){switch(e.type){case"dropdown":return this.formFieldFactory.createDropdownWithGrouping({id:e.id,label:e.label,options:e.options??[],value:i,props:e.props});case"font-family":return this.formFieldFactory.createFontFamilyField(e.id,i,e.presets);case"font-weight":return this.formFieldFactory.createFontWeightField(e.id,i);case"font-transform":return this.formFieldFactory.createFontTransformField(e.id,i);case"color":return this.createColorFieldFromConfig(e,i);case"size":case"number":return this.formFieldFactory.createSizeNumberField(e.id,this.parseFloatSafely(i),e.label,e.props?.unit||"rem");case"text":default:return k(e.id,e.label,i,{name:e.id,props:M({},e.props)})}}createColorFieldFromConfig(e,i){let o=e.group??this.group??"";switch(this.determineColorFieldType(e.label,e.id)){case"font":return this.formFieldFactory.createFontColorField(e.id,i,o,e.presets,e.label,e.customColors);case"background":return this.formFieldFactory.createBackgroundColorField(e.id,i,e.presets,e.label,e.customColors);case"border":return this.formFieldFactory.createBorderColorField(e.id,i,o,e.presets,void 0,e.customColors);default:{let u=this.colorService.getContextualColorPresets(e.id,o??"default",["main","content","header","footer","navigation","sidebar"]);return this.formFieldFactory.createColorComboField(e.id,i,u,e.label)}}}determineColorFieldType(e,i){let o=e.toLowerCase(),r=i.toLowerCase();return o.includes("font")||o.includes("text")||r.includes("font")||r.includes("text")?"font":o.includes("background")||r.includes("background")?"background":o.includes("border")||r.includes("border")?"border":"generic"}createThemeDetailsFromConfig(e){return e.filter(i=>i.includeInDetails!==!1).map(i=>({key:i.label,path:i.path,transform:i.transform,options:i.options}))}async mapEntityToEditor(e){return this.themeEngine.themeSettingsMergedWithDefault(e.settings)[this.group]}async mapEditorToEntity(e,i){return e.settings=ee(M({},e.settings),{[this.group]:M(M({},e.settings?.[this.group]),i)}),e}};function Ry(n,t){if(n&1&&(on(0,"div",0),Pa(1,"div",1),on(2,"span"),D(3),Oa()()),n&2){let e=a();d(),Oi("background-color: "+e.getColorLabelAndValue().value+"; border: 1px solid "+e.getBorderColor()),d(2),J(e.getColorLabelAndValue().label)}}function Ay(n,t){if(n&1&&(on(0,"span"),D(1),Oa()),n&2){let e=a();d(),J(e.rowData.value)}}var Fe=class n{rowData;group;colorService=c(Qe);isColorRow(){return this.colorService.isColorValue(this.rowData.value,this.rowData.key)}getColorLabelAndValue(){let t=this.colorService.getContextualColorPresets(this.rowData.key,this.group,["main","content","header","footer","navigation","sidebar"]),e=this.getAllColorPresets(),i=this.colorService.computeColor(this.rowData.value),o=Object.keys(t).find(r=>t[r]===i);return o!==void 0?{label:o,value:i}:(o=Object.keys(e).find(r=>e[r]===i),o!==void 0?{label:o,value:i}:{label:i,value:i})}getAllColorPresets(){let t=["main","content","header","footer","navigation","sidebar"];return this.colorService.getAllColorPresets(this.group,t)}getBorderColor(){let t=this.getColorLabelAndValue().value;return new $s(t).darken(.2).hex()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-value-display"]],inputs:{rowData:"rowData",group:"group"},decls:2,vars:1,consts:[[1,"flex","items-center","gap-2"],[1,"color-swatch"]],template:function(e,i){e&1&&h(0,Ry,4,3,"div",0)(1,Ay,2,1,"span"),e&2&&y(i.isColorRow()?0:1)},dependencies:[L],styles:[".color-swatch[_ngcontent-%COMP%]{width:1rem;height:1rem;border-radius:var(--border-radius);border:1px solid var(--surface-border);flex-shrink:0}"]})};var ky=["valueTemplate"],Oy=n=>({"icon-primary":n});function Py(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme details"))}function Vy(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Ly(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function Ny(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var kt={FONT_FAMILY:["main","font","family"],FONT_SIZE:["main","font","size"],FONT_WEIGHT:["main","font","weight"],FONT_COLOR:["main","font","color"],BACKGROUND_COLOR:["main","background","color"],BORDER_COLOR:["main","border","color"],GUTTER_WIDTH:["main","gutter","width"],SHADOW:["main","shadow"],ICON_PACK:["main","icon","pack"]},jr=class n extends xe{valueTemplate;themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("main")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"font.family",label:"Font Family",path:kt.FONT_FAMILY,type:"font-family"},{id:"font.size",label:"Font Size",path:kt.FONT_SIZE,type:"size"},{id:"font.weight",label:"Font Weight",path:kt.FONT_WEIGHT,type:"font-weight"},{id:"font.color",label:"Font Color",path:kt.FONT_COLOR,type:"color",group:"main"},{id:"background.color",label:"Background Color",path:kt.BACKGROUND_COLOR,type:"color",group:"main"},{id:"border.color",label:"Border Color",path:kt.BORDER_COLOR,type:"color",group:"main"},{id:"gutter.width",label:"Gutter Size",path:kt.GUTTER_WIDTH,type:"size"},{id:"shadow",label:"Shadow",path:kt.SHADOW,type:"dropdown",options:ut},{id:"icon.pack",label:"Icon Pack",path:kt.ICON_PACK,type:"dropdown",options:Rn,props:{appendTo:"body"}}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{main:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-main-section"]],viewQuery:function(e,i){if(e&1&&pe(ky,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Main"),s(),h(7,Py,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,Vy,1,3,"app-dynamic-form",8),h(11,Ly,1,4,"app-grid",9),s(),ae(12,Ny,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,Oy,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var Gy=["valueTemplate"],qy=n=>({"icon-primary":n});function Uy(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme details"))}function zy(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function jy(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function By(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var ni={PRIMARY:["color","primary","color"],SECONDARY:["color","secondary","color"],SUCCESS:["color","success","color"],INFO:["color","info","color"],NOTIFY:["color","notify","color"],WARNING:["color","warning","color"],DANGER:["color","danger","color"]},Br=class n extends xe{valueTemplate;themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("color")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"primary.color",label:"Primary Color",path:ni.PRIMARY,type:"color",group:"color"},{id:"secondary.color",label:"Secondary Color",path:ni.SECONDARY,type:"color",group:"color"},{id:"success.color",label:"Success Color",path:ni.SUCCESS,type:"color",group:"color"},{id:"info.color",label:"Info Color",path:ni.INFO,type:"color",group:"color"},{id:"notify.color",label:"Notify Color",path:ni.NOTIFY,type:"color",group:"color"},{id:"warning.color",label:"Warning Color",path:ni.WARNING,type:"color",group:"color"},{id:"danger.color",label:"Danger Color",path:ni.DANGER,type:"color",group:"color"}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>{if(ce(this.formChanges))throw new Error("No form changes to save");return this.entitiesService.updateTheme(t,{settings:{color:this.formChanges}})})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-color-section"]],viewQuery:function(e,i){if(e&1&&pe(Gy,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Color"),s(),h(7,Uy,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,zy,1,3,"app-dynamic-form",8),h(11,jy,1,4,"app-grid",9),s(),ae(12,By,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,qy,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var Hy=["valueTemplate"],$y=n=>({"icon-primary":n});function Wy(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme details"))}function Zy(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Ky(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function Qy(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var Hr={FONT_COLOR:["content","font","color"],BACKGROUND_COLOR:["content","background","color"],BORDER_COLOR:["content","border","color"],SHADOW:["content","shadow"]},$r=class n extends xe{valueTemplate;themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("content")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"font.color",label:"Font Color",path:Hr.FONT_COLOR,type:"color",group:"content",presets:["main","header"]},{id:"background.color",label:"Background Color",path:Hr.BACKGROUND_COLOR,type:"color",group:"content",presets:["main"]},{id:"border.color",label:"Border Color",path:Hr.BORDER_COLOR,type:"color",group:"content",presets:["main"]},{id:"shadow",label:"Shadow",path:Hr.SHADOW,type:"dropdown",options:ut}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{content:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-content-section"]],viewQuery:function(e,i){if(e&1&&pe(Hy,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Content"),s(),h(7,Wy,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,Zy,1,3,"app-dynamic-form",8),h(11,Ky,1,4,"app-grid",9),s(),ae(12,Qy,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,$y,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var Yy=["valueTemplate"],Jy=n=>({"icon-primary":n});function Xy(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme navigation details"))}function ev(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function tv(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function iv(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var et={SIZE:["navigation","size"],POSITION:["navigation","position"],FONT_FAMILY:["navigation","font","family"],FONT_SIZE:["navigation","font","size"],FONT_WEIGHT:["navigation","font","weight"],FONT_COLOR:["navigation","font","color"],FONT_TRANSFORM:["navigation","font","transform"],BACKGROUND_COLOR:["navigation","background","color"],BORDER_COLOR:["navigation","border","color"],BORDER_WIDTH:["navigation","border","width"],SUB_NAV_FONT_COLOR:["navigation","subnav","font","color"],SUB_NAV_BACKGROUND_COLOR:["navigation","subnav","background","color"],ACTIVE_STYLE:["navigation","active","style"],ACTIVE_FONT_COLOR:["navigation","active","font","color"],ACTIVE_BACKGROUND_COLOR:["navigation","active","background","color"],SEPARATOR_WIDTH:["navigation","separator","width"],LOGO_BACKGROUND_COLOR:["navigation","logo","background","color"]},Wr=class n extends xe{valueTemplate;themeColorService=c(Qe);themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("navigation")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"size",label:"Size",path:et.SIZE,type:"dropdown",options:fl},{id:"position",label:"Position",path:et.POSITION,type:"dropdown",options:gl},{id:"font.family",label:"Font Family",path:et.FONT_FAMILY,type:"font-family",presets:["main","content","header"]},{id:"font.size",label:"Font Size",path:et.FONT_SIZE,type:"size"},{id:"font.weight",label:"Font Weight",path:et.FONT_WEIGHT,type:"font-weight"},{id:"font.color",label:"Font Color",path:et.FONT_COLOR,type:"color",group:"navigation",presets:["main","content","header"]},{id:"font.transform",label:"Font Case",path:et.FONT_TRANSFORM,type:"font-transform"},{id:"background.color",label:"Background Color",path:et.BACKGROUND_COLOR,type:"color",group:"navigation",presets:["main","content"]},{id:"border.color",label:"Border Color",path:et.BORDER_COLOR,type:"color",group:"navigation"},{id:"border.width",label:"Border Width",path:et.BORDER_WIDTH,type:"size",props:{unit:"px"}},{id:"subnav.font.color",label:"Subnav Font Color",path:et.SUB_NAV_FONT_COLOR,type:"color",group:"navigation",presets:["main","content","header"]},{id:"subnav.background.color",label:"Subnav Background",path:et.SUB_NAV_BACKGROUND_COLOR,type:"color",group:"navigation",presets:["main","content"]},{id:"active.style",label:"Active Style",path:et.ACTIVE_STYLE,type:"dropdown",options:[{value:"background",label:"Background"},{value:"left-border",label:"Left"},{value:"right-border",label:"Right"}]},{id:"active.font.color",label:"Active Font Color",path:et.ACTIVE_FONT_COLOR,type:"color",group:"navigation",presets:["main","content","header"],customColors:{"Primary Contrast":"var(--color-primary-contrast)"}},{id:"active.background.color",label:"Active Background",path:et.ACTIVE_BACKGROUND_COLOR,type:"color",group:"navigation",presets:["main","content"],customColors:{Primary:this.themeColorService.computeColor("var(--color-primary-color)")}},{id:"separator.width",label:"Separator Width",path:et.SEPARATOR_WIDTH,type:"size",props:{unit:"px"}},{id:"logo.background.color",label:"Logo Background",path:et.LOGO_BACKGROUND_COLOR,type:"color",group:"navigation",presets:["navigation","main","content"]}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{navigation:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-navigation-section"]],viewQuery:function(e,i){if(e&1&&pe(Yy,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Navigation"),s(),h(7,Xy,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,ev,1,3,"app-dynamic-form",8),h(11,tv,1,4,"app-grid",9),s(),ae(12,iv,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,Jy,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var nv=["valueTemplate"],ov=n=>({"icon-primary":n});function rv(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme details"))}function av(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function sv(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function lv(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var Ct={FONT_FAMILY:["topnavigation","font","family"],FONT_SIZE:["topnavigation","font","size"],FONT_WEIGHT:["topnavigation","font","weight"],FONT_COLOR:["topnavigation","font","color"],BACKGROUND_COLOR:["topnavigation","background","color"],BORDER_COLOR:["topnavigation","border","color"],BORDER_WIDTH:["topnavigation","border","width"],ACTIVE_STYLE:["topnavigation","active","style"],ACTIVE_FONT_COLOR:["topnavigation","active","font","color"],ACTIVE_BACKGROUND_COLOR:["topnavigation","active","background","color"],ACTIVE_TAB_FONT_COLOR:["topnavigation","active","tab","font","color"],ACTIVE_TAB_BACKGROUND_COLOR:["topnavigation","active","tab","background","color"],ACTIVE_INDICATOR_COLOR:["topnavigation","active","indicator","color"],LOGO_STYLE:["topnavigation","logo","style"]},Zr=class n extends xe{valueTemplate;themeColorService=c(Qe);themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("topnavigation")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"font.family",label:"Font Family",path:Ct.FONT_FAMILY,type:"font-family",presets:["main","content","header"]},{id:"font.size",label:"Font Size",path:Ct.FONT_SIZE,type:"size"},{id:"font.weight",label:"Font Weight",path:Ct.FONT_WEIGHT,type:"font-weight",presets:["main","content"]},{id:"font.color",label:"Font Color",path:Ct.FONT_COLOR,type:"color",group:"topnavigation",presets:["main","content","header"]},{id:"background.color",label:"Background Color",path:Ct.BACKGROUND_COLOR,type:"color",group:"topnavigation",presets:["header","main","content"]},{id:"border.color",label:"Border Color",path:Ct.BORDER_COLOR,type:"color",group:"topnavigation"},{id:"border.width",label:"Border Width",path:Ct.BORDER_WIDTH,type:"size",props:{unit:"px"}},{id:"active.font.color",label:"Active Font Color",path:Ct.ACTIVE_FONT_COLOR,type:"color",group:"topnavigation",presets:["topnavigation","main","content","header"],customColors:{"Primary Contrast":"var(--color-primary-contrast)"}},{id:"active.background.color",label:"Active Background",path:Ct.ACTIVE_BACKGROUND_COLOR,type:"color",group:"topnavigation",presets:["topnavigation","tab","content"],customColors:{Primary:this.themeColorService.computeColor("var(--color-primary-color)")}},{id:"active.tab.font.color",label:"Active Tab Font Color",path:Ct.ACTIVE_TAB_FONT_COLOR,type:"color",group:"topnavigation",presets:["topnavigation","main","content","header"],customColors:{Primary:this.themeColorService.computeColor("var(--color-primary-color)")}},{id:"active.tab.background.color",label:"Active Tab Background",path:Ct.ACTIVE_TAB_BACKGROUND_COLOR,type:"color",group:"topnavigation",presets:["topnavigation","tab","content"],customColors:{Primary:this.themeColorService.computeColor("var(--color-primary-color)")}},{id:"active.indicator.color",label:"Active Indicator Color",path:Ct.ACTIVE_INDICATOR_COLOR,type:"color",group:"topnavigation",customColors:{Primary:this.themeColorService.computeColor("var(--color-primary-color)")}},{id:"logo.style",label:"Logo Style",path:Ct.LOGO_STYLE,type:"dropdown",group:"topnavigation",options:[{value:"none",label:"None"},{value:"left",label:"Left"},{value:"right",label:"Right"}]}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{topnavigation:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-top-navigation-section"]],viewQuery:function(e,i){if(e&1&&pe(nv,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Top Navigation"),s(),h(7,rv,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,av,1,3,"app-dynamic-form",8),h(11,sv,1,4,"app-grid",9),s(),ae(12,lv,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,ov,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var dv=["valueTemplate"],cv=n=>({"icon-primary":n});function mv(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme details"))}function pv(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function uv(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function fv(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var $t={FONT_FAMILY:["header","font","family"],FONT_SIZE:["header","font","size"],FONT_WEIGHT:["header","font","weight"],FONT_COLOR:["header","font","color"],FONT_TRANSFORM:["header","font","transform"],BACKGROUND_COLOR:["header","background","color"],BORDER_COLOR:["header","border","color"],BORDER_WIDTH:["header","border","width"]},Kr=class n extends xe{valueTemplate;themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("header")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"font.family",label:"Font Family",path:$t.FONT_FAMILY,type:"font-family",presets:["main","content"]},{id:"font.size",label:"Font Size",path:$t.FONT_SIZE,type:"size"},{id:"font.weight",label:"Font Weight",path:$t.FONT_WEIGHT,type:"font-weight",presets:["main","content"]},{id:"font.color",label:"Font Color",path:$t.FONT_COLOR,type:"color",group:"header",presets:["main","content","header"]},{id:"font.transform",label:"Font Case",path:$t.FONT_TRANSFORM,type:"font-transform"},{id:"background.color",label:"Background Color",path:$t.BACKGROUND_COLOR,type:"color",group:"header",presets:["main","content"]},{id:"border.color",label:"Border Color",path:$t.BORDER_COLOR,type:"color",group:"header",presets:["main","content"]},{id:"border.width",label:"Border Width",path:$t.BORDER_WIDTH,type:"size",props:{unit:"px"}}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{header:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-header-section"]],viewQuery:function(e,i){if(e&1&&pe(dv,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Header"),s(),h(7,mv,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,pv,1,3,"app-dynamic-form",8),h(11,uv,1,4,"app-grid",9),s(),ae(12,fv,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,cv,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var gv=["valueTemplate"],hv=n=>({"icon-primary":n});function yv(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme details"))}function vv(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Cv(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function _v(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var Xi={FONT_FAMILY:["footer","font","family"],FONT_SIZE:["footer","font","size"],FONT_COLOR:["footer","font","color"],BACKGROUND_COLOR:["footer","background","color"],BORDER_COLOR:["footer","border","color"]},Qr=class n extends xe{valueTemplate;themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("footer")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"font.family",label:"Font Family",path:Xi.FONT_FAMILY,type:"font-family",presets:["main","content","header"]},{id:"font.size",label:"Font Size",path:Xi.FONT_SIZE,type:"size"},{id:"font.color",label:"Font Color",path:Xi.FONT_COLOR,type:"color",group:"footer",presets:["main","content","header"]},{id:"background.color",label:"Background Color",path:Xi.BACKGROUND_COLOR,type:"color",group:"footer",presets:["main","content"]},{id:"border.color",label:"Border Color",path:Xi.BORDER_COLOR,type:"color",group:"footer"}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{footer:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-footer-section"]],viewQuery:function(e,i){if(e&1&&pe(gv,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Footer"),s(),h(7,yv,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,vv,1,3,"app-dynamic-form",8),h(11,Cv,1,4,"app-grid",9),s(),ae(12,_v,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,hv,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var bv=["valueTemplate"],Sv=n=>({"icon-primary":n});function Dv(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme details"))}function Tv(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function wv(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function xv(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var gt={FONT_SIZE:["modal","font","size"],FONT_COLOR:["modal","font","color"],BACKGROUND_COLOR:["modal","background","color"],BORDER_COLOR:["modal","border","color"],BORDER_WIDTH:["modal","border","width"],HEADER_FONT_SIZE:["modal","header","font","size"],HEADER_FONT_WEIGHT:["modal","header","font","weight"],HEADER_FONT_TRANSFORM:["modal","header","font","transform"],HEADER_FONT_COLOR:["modal","header","font","color"],HEADER_BACKGROUND_COLOR:["modal","header","background","color"],FOOTER_FONT_SIZE:["modal","footer","font","size"],FOOTER_FONT_COLOR:["modal","footer","font","color"],FOOTER_BACKGROUND_COLOR:["modal","footer","background","color"],FOOTER_BORDER_COLOR:["modal","footer","border","color"]},Yr=class n extends xe{valueTemplate;themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("modal")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"font.size",label:"Font Size",path:gt.FONT_SIZE,type:"size"},{id:"font.color",label:"Font Color",path:gt.FONT_COLOR,type:"color",group:"modal",presets:["main","content","header"]},{id:"background.color",label:"Background Color",path:gt.BACKGROUND_COLOR,type:"color",group:"modal",presets:["main","content"]},{id:"border.color",label:"Border Color",path:gt.BORDER_COLOR,type:"color",group:"modal"},{id:"border.width",label:"Border Width",path:gt.BORDER_WIDTH,type:"size",props:{unit:"px"}},{id:"header.font.size",label:"Header Font Size",path:gt.HEADER_FONT_SIZE,type:"size",props:{unit:"px"}},{id:"header.font.weight",label:"Header Font Weight",path:gt.HEADER_FONT_WEIGHT,type:"font-weight"},{id:"header.font.transform",label:"Header Font Case",path:gt.HEADER_FONT_TRANSFORM,type:"font-transform"},{id:"header.font.color",label:"Header Font Color",path:gt.HEADER_FONT_COLOR,type:"color",group:"modal",presets:["main","content","header"]},{id:"header.background.color",label:"Header Background",path:gt.HEADER_BACKGROUND_COLOR,type:"color",group:"modal",presets:["main","content"]},{id:"footer.font.size",label:"Footer Font Size",path:gt.FOOTER_FONT_SIZE,type:"size",props:{unit:"px"}},{id:"footer.font.color",label:"Footer Font Color",path:gt.FOOTER_FONT_COLOR,type:"color",group:"modal",presets:["main","content","header"]},{id:"footer.background.color",label:"Footer Background",path:gt.FOOTER_BACKGROUND_COLOR,type:"color",group:"modal",presets:["main","content"]},{id:"footer.border.color",label:"Footer Border Color",path:gt.FOOTER_BORDER_COLOR,type:"color",group:"modal"}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{modal:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-modal-section"]],viewQuery:function(e,i){if(e&1&&pe(bv,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Modal"),s(),h(7,Dv,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,Tv,1,3,"app-dynamic-form",8),h(11,wv,1,4,"app-grid",9),s(),ae(12,xv,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,Sv,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var Fv=["valueTemplate"],Iv=n=>({"icon-primary":n});function Ev(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme details"))}function Mv(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Rv(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function Av(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var Jr={FONT_COLOR:["sidebar","font","color"],BACKGROUND_COLOR:["sidebar","background","color"],BORDER_COLOR:["sidebar","border","color"],SHADOW:["sidebar","shadow"]},Xr=class n extends xe{valueTemplate;themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("sidebar")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"font.color",label:"Font Color",path:Jr.FONT_COLOR,type:"color",group:"sidebar",presets:["main","content","header"]},{id:"background.color",label:"Background Color",path:Jr.BACKGROUND_COLOR,type:"color",group:"sidebar",presets:["main","content"]},{id:"border.color",label:"Border Color",path:Jr.BORDER_COLOR,type:"color",group:"sidebar",presets:["main","content"]},{id:"shadow",label:"Shadow",path:Jr.SHADOW,type:"dropdown",options:ut}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{sidebar:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-sidebar-section"]],viewQuery:function(e,i){if(e&1&&pe(Fv,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Sidebar"),s(),h(7,Ev,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,Mv,1,3,"app-dynamic-form",8),h(11,Rv,1,4,"app-grid",9),s(),ae(12,Av,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,Iv,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var kv=["valueTemplate"],Ov=n=>({"icon-primary":n});function Pv(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme details"))}function Vv(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Lv(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function Nv(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var oi={FONT_FAMILY:["button","font","family"],FONT_SIZE:["button","font","size"],FONT_WEIGHT:["button","font","weight"],FONT_TRANSFORM:["button","font","transform"],BORDER_RADIUS:["button","border","radius"],BORDER_SHADOW:["button","border","shadow"],HOVER_BORDER_SHADOW:["button","hover","border","shadow"],ACTIVE_BORDER_SHADOW:["button","active","border","shadow"]},ea=class n extends xe{valueTemplate;themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("button")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"font.family",label:"Font Family",path:oi.FONT_FAMILY,type:"font-family"},{id:"font.size",label:"Font Size",path:oi.FONT_SIZE,type:"size"},{id:"font.weight",label:"Font Weight",path:oi.FONT_WEIGHT,type:"font-weight"},{id:"border.radius",label:"Border Radius",path:oi.BORDER_RADIUS,type:"size",props:{unit:"px"}},{id:"border.shadow",label:"Shadow",path:oi.BORDER_SHADOW,type:"dropdown",options:ut},{id:"hover.border.shadow",label:"Hover Shadow",path:oi.HOVER_BORDER_SHADOW,type:"dropdown",options:ut},{id:"active.border.shadow",label:"Active Shadow",path:oi.ACTIVE_BORDER_SHADOW,type:"dropdown",options:ut}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{button:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-button-section"]],viewQuery:function(e,i){if(e&1&&pe(kv,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Button"),s(),h(7,Pv,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,Vv,1,3,"app-dynamic-form",8),h(11,Lv,1,4,"app-grid",9),s(),ae(12,Nv,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,Ov,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var Gv=["valueTemplate"],qv=n=>({"icon-primary":n});function Uv(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme details"))}function zv(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function jv(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function Bv(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var Ei={FONT_FAMILY:["input","font","family"],FONT_SIZE:["input","font","size"],FONT_WEIGHT:["input","font","weight"],FONT_COLOR:["input","font","color"],BACKGROUND_COLOR:["input","background","color"],BORDER_COLOR:["input","border","color"]},ta=class n extends xe{valueTemplate;themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("input")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"font.family",label:"Font Family",path:Ei.FONT_FAMILY,type:"font-family"},{id:"font.size",label:"Font Size",path:Ei.FONT_SIZE,type:"size"},{id:"font.weight",label:"Font Weight",path:Ei.FONT_WEIGHT,type:"font-weight"},{id:"font.color",label:"Font Color",path:Ei.FONT_COLOR,type:"color",group:"input"},{id:"background.color",label:"Background Color",path:Ei.BACKGROUND_COLOR,type:"color",group:"input"},{id:"border.color",label:"Border Color",path:Ei.BORDER_COLOR,type:"color",group:"input"}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{input:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-input-section"]],viewQuery:function(e,i){if(e&1&&pe(Gv,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Input"),s(),h(7,Uv,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,zv,1,3,"app-dynamic-form",8),h(11,jv,1,4,"app-grid",9),s(),ae(12,Bv,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,qv,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var Hv=["valueTemplate"],$v=n=>({"icon-primary":n});function Wv(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme tab details"))}function Zv(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function Kv(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function Qv(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var wt={FONT_FAMILY:["tab","font","family"],FONT_SIZE:["tab","font","size"],FONT_WEIGHT:["tab","font","weight"],FONT_TRANSFORM:["tab","font","transform"],FONT_COLOR:["tab","font","color"],BACKGROUND_COLOR:["tab","background","color"],BORDER_COLOR:["tab","border","color"],ACTIVE_FONT_COLOR:["tab","active","font","color"],ACTIVE_BACKGROUND_COLOR:["tab","active","background","color"],ACTIVE_INDICATOR_STYLE:["tab","active","style"],ACTIVE_INDICATOR_COLOR:["tab","active","indicator","color"]},ia=class n extends xe{valueTemplate;themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("tab")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"font.family",label:"Font Family",path:wt.FONT_FAMILY,type:"font-family",presets:["main","content"]},{id:"font.size",label:"Font Size",path:wt.FONT_SIZE,type:"size"},{id:"font.weight",label:"Font Weight",path:wt.FONT_WEIGHT,type:"font-weight",presets:["main","content"]},{id:"font.transform",label:"Font Case",path:wt.FONT_TRANSFORM,type:"font-transform"},{id:"font.color",label:"Font Color",path:wt.FONT_COLOR,type:"color",group:"tab",presets:["main","content","header"]},{id:"background.color",label:"Background Color",path:wt.BACKGROUND_COLOR,type:"color",group:"tab",presets:["content","header"]},{id:"border.color",label:"Border Color",path:wt.BORDER_COLOR,type:"color",group:"tab",presets:["tab","header","main","content"]},{id:"active.font.color",label:"Active Font",path:wt.ACTIVE_FONT_COLOR,type:"color",group:"tab",presets:["main","content","header"]},{id:"active.background.color",label:"Active Background",path:wt.ACTIVE_BACKGROUND_COLOR,type:"color",group:"tab",presets:["tab","content"]},{id:"active.style",label:"Active Style",path:wt.ACTIVE_INDICATOR_STYLE,type:"dropdown",options:[{value:"none",label:"None"},{value:"bottom",label:"Bottom"}]},{id:"active.indicator.color",label:"Active Indicator Color",path:wt.ACTIVE_INDICATOR_COLOR,type:"color",group:"tab",presets:["tab","header"]}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{tab:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-tab-section"]],viewQuery:function(e,i){if(e&1&&pe(Hv,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Tab"),s(),h(7,Wv,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,Zv,1,3,"app-dynamic-form",8),h(11,Kv,1,4,"app-grid",9),s(),ae(12,Qv,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,$v,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var Yv=["valueTemplate"],Jv=n=>({"icon-primary":n});function Xv(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme accordion details"))}function eC(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function tC(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function iC(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var At={FONT_FAMILY:["accordion","font","family"],FONT_SIZE:["accordion","font","size"],FONT_WEIGHT:["accordion","font","weight"],FONT_COLOR:["accordion","font","color"],FONT_TRANSFORM:["accordion","font","transform"],BACKGROUND_COLOR:["accordion","background","color"],BORDER_COLOR:["accordion","border","color"],BORDER_WIDTH:["accordion","border","width"],ACTIVE_FONT_COLOR:["accordion","active","font","color"],ACTIVE_BACKGROUND_COLOR:["accordion","active","background","color"]},na=class n extends xe{valueTemplate;themeColorService=c(Qe);themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("accordion")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"font.family",label:"Font Family",path:At.FONT_FAMILY,type:"font-family",presets:["main","content","header"]},{id:"font.size",label:"Font Size",path:At.FONT_SIZE,type:"size"},{id:"font.weight",label:"Font Weight",path:At.FONT_WEIGHT,type:"font-weight"},{id:"font.color",label:"Font Color",path:At.FONT_COLOR,type:"color",group:"accordion",presets:["main","content","header"]},{id:"font.transform",label:"Font Case",path:At.FONT_TRANSFORM,type:"font-transform"},{id:"background.color",label:"Background Color",path:At.BACKGROUND_COLOR,type:"color",group:"accordion",presets:["main","content"]},{id:"border.color",label:"Border Color",path:At.BORDER_COLOR,type:"color",group:"accordion"},{id:"border.width",label:"Border Width",path:At.BORDER_WIDTH,type:"size",props:{unit:"px"}},{id:"active.font.color",label:"Active Font Color",path:At.ACTIVE_FONT_COLOR,type:"color",group:"accordion",presets:["main","content","header"],customColors:{"Primary Contrast":"var(--color-primary-contrast)"}},{id:"active.background.color",label:"Active Background",path:At.ACTIVE_BACKGROUND_COLOR,type:"color",group:"accordion",presets:["main","content"],customColors:{Primary:this.themeColorService.computeColor("var(--color-primary-color)")}}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{accordion:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-accordion-section"]],viewQuery:function(e,i){if(e&1&&pe(Yv,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Accordion"),s(),h(7,Xv,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,eC,1,3,"app-dynamic-form",8),h(11,tC,1,4,"app-grid",9),s(),ae(12,iC,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,Jv,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var nC=["valueTemplate"],oC=n=>({"icon-primary":n});function rC(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme table details"))}function aC(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function sC(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function lC(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var Ot={BACKGROUND_COLOR:["table","background","color"],BORDER_COLOR:["table","border","color"],HEADER_FONT_SIZE:["table","header","font","size"],HEADER_FONT_WEIGHT:["table","header","font","weight"],HEADER_FONT_TRANSFORM:["table","header","font","transform"],HEADER_FONT_COLOR:["table","header","font","color"],HEADER_BACKGROUND_COLOR:["table","header","background","color"],ACTIVE_FONT_COLOR:["table","active","font","color"],ACTIVE_BACKGROUND_COLOR:["table","active","background","color"]},oa=class n extends xe{valueTemplate;themeColorService=c(Qe);themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("table")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"background.color",label:"Background Color",path:Ot.BACKGROUND_COLOR,type:"color",group:"table",presets:["main","content"]},{id:"border.color",label:"Border Color",path:Ot.BORDER_COLOR,type:"color",group:"table"},{id:"header.font.size",label:"Header Font Size",path:Ot.HEADER_FONT_SIZE,type:"size"},{id:"header.font.weight",label:"Header Font Weight",path:Ot.HEADER_FONT_WEIGHT,type:"font-weight"},{id:"header.font.transform",label:"Header Font Case",path:Ot.HEADER_FONT_TRANSFORM,type:"font-transform"},{id:"header.font.color",label:"Header Font Color",path:Ot.HEADER_FONT_COLOR,type:"color",group:"table",presets:["main","content","header"]},{id:"header.background.color",label:"Header Background",path:Ot.HEADER_BACKGROUND_COLOR,type:"color",group:"table",presets:["main","content"]},{id:"active.font.color",label:"Active Font Color",path:Ot.ACTIVE_FONT_COLOR,type:"color",group:"table",presets:["main","content","header"],customColors:{"Primary Contrast":"var(--color-primary-contrast)"}},{id:"active.background.color",label:"Active Background",path:Ot.ACTIVE_BACKGROUND_COLOR,type:"color",group:"table",presets:["main","content"],customColors:{Primary:this.themeColorService.computeColor("var(--color-primary-color)")}}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{table:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-table-section"]],viewQuery:function(e,i){if(e&1&&pe(nC,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Table"),s(),h(7,rC,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,aC,1,3,"app-dynamic-form",8),h(11,sC,1,4,"app-grid",9),s(),ae(12,lC,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,oC,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var dC=["valueTemplate"],cC=n=>({"icon-primary":n});function mC(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme tree details"))}function pC(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function uC(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function fC(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var as={BACKGROUND_COLOR:["tree","background","color"],ACTIVE_FONT_COLOR:["tree","active","font","color"],ACTIVE_BACKGROUND_COLOR:["tree","active","background","color"]},ra=class n extends xe{valueTemplate;themeColorService=c(Qe);themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("tree")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"background.color",label:"Background Color",path:as.BACKGROUND_COLOR,type:"color",group:"tree",presets:["main","content"]},{id:"active.font.color",label:"Active Font Color",path:as.ACTIVE_FONT_COLOR,type:"color",group:"tree",presets:["main","content","header"],customColors:{"Primary Contrast":"var(--color-primary-contrast)"}},{id:"active.background.color",label:"Active Background",path:as.ACTIVE_BACKGROUND_COLOR,type:"color",group:"tree",presets:["main","content"],customColors:{Primary:this.themeColorService.computeColor("var(--color-primary-color)")}}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{tree:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-tree-section"]],viewQuery:function(e,i){if(e&1&&pe(dC,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Tree"),s(),h(7,mC,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,pC,1,3,"app-dynamic-form",8),h(11,uC,1,4,"app-grid",9),s(),ae(12,fC,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,cC,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var gC=["valueTemplate"],hC=n=>({"icon-primary":n});function yC(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme list details"))}function vC(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function CC(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function _C(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var aa={BACKGROUND_COLOR:["list","background","color"],BORDER_COLOR:["list","border","color"],ACTIVE_FONT_COLOR:["list","active","font","color"],ACTIVE_BACKGROUND_COLOR:["list","active","background","color"]},sa=class n extends xe{valueTemplate;themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("list")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"background.color",label:"Background Color",path:aa.BACKGROUND_COLOR,type:"color",group:"list",presets:["content"]},{id:"border.color",label:"Border Color",path:aa.BORDER_COLOR,type:"color",group:"list",presets:["main","content"]},{id:"active.font.color",label:"Active Font Color",path:aa.ACTIVE_FONT_COLOR,type:"color",group:"list",presets:["main","content","header"]},{id:"active.background.color",label:"Active Background",path:aa.ACTIVE_BACKGROUND_COLOR,type:"color",group:"list",presets:["list","content"]}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{list:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-list-section"]],viewQuery:function(e,i){if(e&1&&pe(gC,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"List"),s(),h(7,yC,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,vC,1,3,"app-dynamic-form",8),h(11,CC,1,4,"app-grid",9),s(),ae(12,_C,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,hC,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var bC=["valueTemplate"],SC=n=>({"icon-primary":n});function DC(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme feed details"))}function TC(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function wC(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function xC(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var la={BACKGROUND_COLOR:["feed","background","color"],BORDER_COLOR:["feed","border","color"],ACTIVE_FONT_COLOR:["feed","active","font","color"],ACTIVE_BACKGROUND_COLOR:["feed","active","background","color"]},da=class n extends xe{valueTemplate;themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("feed")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"background.color",label:"Background Color",path:la.BACKGROUND_COLOR,type:"color",group:"feed",presets:["content"]},{id:"border.color",label:"Border Color",path:la.BORDER_COLOR,type:"color",group:"feed",presets:["main","content"]},{id:"active.font.color",label:"Active Font Color",path:la.ACTIVE_FONT_COLOR,type:"color",group:"feed",presets:["main","content","header"]},{id:"active.background.color",label:"Active Background",path:la.ACTIVE_BACKGROUND_COLOR,type:"color",group:"feed",presets:["feed","content"]}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{feed:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-feed-section"]],viewQuery:function(e,i){if(e&1&&pe(bC,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Feed"),s(),h(7,DC,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,TC,1,3,"app-dynamic-form",8),h(11,wC,1,4,"app-grid",9),s(),ae(12,xC,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,SC,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var FC=["valueTemplate"],IC=n=>({"icon-primary":n});function EC(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme graph details"))}function MC(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function RC(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function AC(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var ca={LABEL_FONT_FAMILY:["graph","label","font","family"],LABEL_FONT_SIZE:["graph","label","font","size"],LABEL_FONT_COLOR:["graph","label","font","color"],PALETTE:["graph","palette"]},ma=class n extends xe{valueTemplate;themeColorService=c(Qe);themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("graph")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"label.font.family",label:"Label Font Family",path:ca.LABEL_FONT_FAMILY,type:"font-family",presets:["main","content","header"]},{id:"label.font.size",label:"Label Font Size",path:ca.LABEL_FONT_SIZE,type:"size"},{id:"label.font.color",label:"Label Font Color",path:ca.LABEL_FONT_COLOR,type:"color",group:"graph",presets:["main","content","header"]},{id:"palette",label:"Palette",path:ca.PALETTE,type:"dropdown",group:"graph",options:[{label:"Default",value:"default"},{label:"Dark Theme",value:"nightrider"}]}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{graph:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-graph-section"]],viewQuery:function(e,i){if(e&1&&pe(FC,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Graph"),s(),h(7,EC,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,MC,1,3,"app-dynamic-form",8),h(11,RC,1,4,"app-grid",9),s(),ae(12,AC,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,IC,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var kC=["valueTemplate"],OC=n=>({"icon-primary":n});function PC(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit theme loader details"))}function VC(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("fieldValueChange",function(o){m(e);let r=a();return p(r.onFieldValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function LC(n,t){if(n&1&&C(0,"app-grid",9),n&2){let e=a();g("data",e.themeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function NC(n,t){if(n&1&&C(0,"app-theme-value-display",12),n&2){let e=t.$implicit,i=a();g("rowData",e)("group",i.group)}}var Nd={STYLE:["loader","style"],FONT_COLOR:["loader","font","color"]},pa=class n extends xe{valueTemplate;themeDetails=v(()=>{let t=this.entity();if(!f(t))return[];let e=this.themeEngine.themeSettingsMergedWithDefault(t?.settings??{});return this.createThemeDetailsFromConfig(this.getFieldConfigurations()).map(o=>({key:o.key,value:this.formatThemeValue(e,o)}))});constructor(){super("loader")}ngOnInit(){this.initializeColumns()}initializeColumns(){this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",cellTemplate:this.valueTemplate}]}getFieldConfigurations(){return[{id:"style",label:"Loader Style",path:Nd.STYLE,type:"dropdown",options:[{label:"Pulse",value:"pulse"},{label:"Rainbow",value:"rainbow"},{label:"Uneven Lines",value:"uneven-lines"},{label:"Spinner",value:"spinner"}]},{id:"font.color",label:"Font Color",path:Nd.FONT_COLOR,type:"color",group:"loader"}]}getFields(t){return this.createFormFieldsFromConfig(t,this.getFieldConfigurations())}getUpdateMethod(){return this.operationRegistry.getOperation("theme","update")??(t=>this.entitiesService.updateTheme(t,{settings:{loader:this.formChanges}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-theme-settings-loader-section"]],viewQuery:function(e,i){if(e&1&&pe(kC,7),e&2){let o;le(o=de())&&(i.valueTemplate=o.first)}},features:[O],decls:14,vars:8,consts:[["valueTemplate",""],[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","fieldValueChange","fields","actions","hideActions"],[3,"rowData","group"]],template:function(e,i){e&1&&(l(0,"div",1)(1,"div",2),C(2,"fa-icon",3),l(3,"div",4)(4,"div",5)(5,"h2",6),D(6,"Loader"),s(),h(7,PC,2,1,"div",7),s(),l(8,"span"),D(9),s()()(),h(10,VC,1,3,"app-dynamic-form",8),h(11,LC,1,4,"app-grid",9),s(),ae(12,NC,1,2,"ng-template",null,0,Se)),e&2&&(d(2),g("icon",i.faFill)("ngClass",N(6,OC,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,te,ne,L,z,V,Fe],encapsulation:2})};var Ao=class n{createThemeInformationSections(t){return[{id:"theme-details",title:"Theme Details",component:qr,componentInputs:{entity:t},category:"information",order:10},{id:"theme-main-settings",title:"Main Settings",component:jr,componentInputs:{entity:t},category:"information",order:20},{id:"theme-colors",title:"Theme Colors",component:Br,componentInputs:{entity:t},category:"information",order:30},{id:"theme-content",title:"Theme Content",component:$r,componentInputs:{entity:t},category:"information",order:40},{id:"theme-navigation",title:"Theme Navigation",component:Wr,componentInputs:{entity:t},category:"information",order:50},{id:"theme-top-navigation",title:"Theme Top Navigation",component:Zr,componentInputs:{entity:t},category:"information",order:60},{id:"theme-header",title:"Theme Header",component:Kr,componentInputs:{entity:t},category:"information",order:70},{id:"theme-footer",title:"Theme Footer",component:Qr,componentInputs:{entity:t},category:"information",order:80},{id:"theme-modal",title:"Theme Modal",component:Yr,componentInputs:{entity:t},category:"information",order:90},{id:"theme-sidebar",title:"Theme Sidebar",component:Xr,componentInputs:{entity:t},category:"information",order:100}]}createChangesSection(t){return[{id:"theme-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createControlsSection(t){return[{id:"theme-buttons",title:"Buttons",component:ea,componentInputs:{entity:t},category:"controls",order:10},{id:"theme-inputs",title:"Inputs",component:ta,componentInputs:{entity:t},category:"controls",order:20},{id:"theme-tabs",title:"Tabs",component:ia,componentInputs:{entity:t},category:"controls",order:30},{id:"theme-accordion",title:"Accordion",component:na,componentInputs:{entity:t},category:"controls",order:40},{id:"theme-tables",title:"Tables",component:oa,componentInputs:{entity:t},category:"controls",order:50},{id:"theme-trees",title:"Trees",component:ra,componentInputs:{entity:t},category:"controls",order:60},{id:"theme-lists",title:"Lists",component:sa,componentInputs:{entity:t},category:"controls",order:70},{id:"theme-feed",title:"Feed",component:da,componentInputs:{entity:t},category:"controls",order:80},{id:"theme-graphs",title:"Graphs",component:ma,componentInputs:{entity:t},category:"controls",order:90},{id:"theme-loaders",title:"Loaders",component:pa,componentInputs:{entity:t},category:"controls",order:100}]}createAllThemeSections(t){return[...this.createThemeInformationSections(t),...this.createControlsSection(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var GC=n=>({"icon-primary":n});function qC(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit cost centre details"))}function UC(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function zC(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.costCentreDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var ua=class n extends B{ownerId=E(null);entitiesService=c(P);operationRegistry=c(Q);assetGroupingService=c(Pe);costCentreDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Name",value:t.name}]:[]});faSitemap=Pn;costCentreGroups=[];constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.entity()?.owner?.id??this.ownerId();f(t)&&this.fetchCostCentres(t).then(e=>{this.costCentreGroups=e,this.updateFormFields()}).catch(()=>{})})}fetchCostCentres(t){return this.assetGroupingService.getCostCentres(t)}updateFormFields(){let t=this.entity(),e=this.costCentreGroups.map(i=>({label:i.name,value:i.id}));this.formFields=[k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]})],this.createMode()&&this.formFields.unshift(H("parent","Parent",e,t?.parent?.id,{placeholder:"Select Parent Group",validations:[{name:"required",validator:w.required,message:"Parent group is required"}],props:{appendTo:"body"}}))}getUpdateMethod(){return this.operationRegistry.getOperation("cost-centre","update")??((t,e)=>this.entitiesService.updateCostCentre(t,e))}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);if(f(e.parent)){let i=e.parent,o=this.costCentreGroups?.find(r=>r.id===i);o?e.parent={id:o.id,name:o.name}:i==="root"&&(e.parent=null)}return e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-cost-centre-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Cost Centre Details"),s(),h(7,qC,2,1,"div",6),s(),l(8,"span"),D(9,"The following information is required in order to identify your cost centre."),s()()(),h(10,UC,1,3,"app-dynamic-form",7),h(11,zC,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faSitemap)("ngClass",N(5,GC,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,Te,V,q,te,ne],encapsulation:2})};var jC=["iconTemplate"],BC=n=>({"icon-primary":n});function HC(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit contact details"))}function $C(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function WC(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.contactDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Mi=class n extends B{entityId=E.required();iconTemplate;entitiesService=c(P);utilityService=c(he);selectOptionsLoaded=R(!1);contactDetails=v(()=>{let t=this.entity()?.contacts;return f(t)?t.flatMap(e=>{let i=[];return f(e.name)&&i.push(`Name: ${e.name}`),f(e.emailAddress)&&i.push(`Email: ${e.emailAddress}`),f(e.phoneMobile)&&i.push(`Mobile: ${e.phoneMobile}`),f(e.phoneOffice)&&i.push(`Office: ${e.phoneOffice}`),f(e.notes)&&i.push(`Notes: ${e.notes}`),[{key:"",value:i.length>0?`
${i.join(`
`)}`:""}]}):[]});contacts=[];showModal=!1;contactTypes=["owner","emergency","administrative","technical","operational","management"];constructor(){super(),U(()=>{let t=this.entity()?.contacts;t&&(this.contacts=t,this.updateFormFields())})}ngAfterViewInit(){super.ngAfterViewInit(),this.columns=[{field:"key",header:"",transform:"uppercase",cellTemplate:this.iconTemplate},{field:"value",header:"",transform:"whitespace-pre-line"}]}updateFormFields(){let t={modalComponent:be,modalTitle:"Contact Details",defaultItemProvider:()=>({id:Xe(),name:"",type:"owner",emailAddress:"",phoneMobile:"",phoneOffice:"",notes:""}),listItemFormatter:e=>{let i=[];f(e.name)&&i.push(`Name: ${e.name}`),f(e.emailAddress)&&i.push(`Email: ${e.emailAddress}`),f(e.phoneMobile)&&i.push(`Mobile: ${e.phoneMobile}`),f(e.phoneOffice)&&i.push(`Office: ${e.phoneOffice}`),f(e.notes)&&i.push(`Notes: ${e.notes}`);let o=i.length>0?`
${i.join(`
`)}`:"";return{id:e.id,display:`${this.utilityService.toTitleCase(e.type)}: ${e.name}${o}`,icon:"pi pi-id-card"}},modalFields:e=>[k("id","ID",e?.id,{name:"id",hidden:!0}),k("name","Name","",{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),H("type","Type",this.contactTypes.map(i=>({label:this.utilityService.toTitleCase(i),value:i})),"",{name:"type",props:{appendTo:"body"}}),k("emailAddress","Email","",{name:"emailAddress",validations:[{name:"email",validator:w.email,message:"Invalid email format"}]}),k("phoneMobile","Mobile","",{name:"phoneMobile",validations:[{name:"mobile",validator:xn(),message:"Invalid mobile number (10-15 digits required)"}]}),k("phoneOffice","Phone","",{name:"phoneOffice",validations:[{name:"phone",validator:wn(),message:"Invalid phone number (7-15 digits required)"}]}),k("notes","Notes","",{name:"notes"})],subHeader:"Complete the following fields describing the contact."};this.formFields=[De("contacts","Contacts",this.contacts,{name:"contacts",props:{modalConfig:t}})]}getUpdateMethod(){if(this.entityType()==="cost-centre")return(t,e)=>this.entitiesService.updateCostCentre(t,e);throw new Error(`Update for '${this.entityType()}' not yet supported`)}onFormValueChange(t){this.formValueChange.emit({contacts:t})}onClose(){this.showModal=!1}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-contacts-section"]],viewQuery:function(e,i){if(e&1&&pe(jC,7),e&2){let o;le(o=de())&&(i.iconTemplate=o.first)}},inputs:{entityId:[1,"entityId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-id-card","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Contact Details"),s(),h(7,HC,2,1,"div",6),s(),l(8,"span"),D(9,"Specify contact information"),s()()(),h(10,$C,1,3,"app-dynamic-form",7),h(11,WC,1,4,"app-grid",8),s()),e&2&&(d(2),g("ngClass",N(5,BC,i.isFormEditable())),I("aria-label","id card icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,V,q],encapsulation:2})};var Wt=class n extends B{entity=E(null);groupId=E(null);groupingEntityType=E("Group");assetLinkField=E.required();index=E(null);formatter=E(null);getGroupingEntitiesFn=E.required();getAvailableAssetsFn=E.required();entitiesService=c(P);utilityService=c(he);cdr=c(Me);cacheService=c(Re);arrayLinkFields=["categories","groups"];confirmationService=c(Ee);handleFormSubmit(t){switch(this.modalType){case"move":this.handleAssetMove(t);break;case"add":this.handleAssetAdd(t);break;case"delete":this.selectedAsset&&this.handleAssetDelete(this.selectedAsset)}}handleAssetMove(t){if(T(this.selectedAsset)||T(t))return;let e=this.assetLinkField(),i=this.selectedAsset.id,o=t.get("group")?.value;if(T(o)||ce(o))return;let r=this.groupingOptions.find(u=>u.id===o);if(r)if(this.arrayLinkFields.includes(e))this.entitiesService.getAsset(i).subscribe(u=>{let b=u[e]??[],x=this.entity()?.id,G=b.filter(Z=>Z.id!==x);G.some(Z=>Z?.id===r.id)||G.push(r),this.updateAsset(i,{[e]:G})});else{let u={[e]:r};this.updateAsset(i,u)}else console.error("Selected group not found in grouping options list.")}handleAssetAdd(t){if(T(t))return;let e=this.assetLinkField(),i=t.get("asset")?.value,o=this.entity(),r=o?{id:o.id,name:o.name}:null;if(!(!r||T(r.id)||ce(r.id)||T(i)||ce(i)))if(this.arrayLinkFields.includes(e))this.entitiesService.getAsset(i).subscribe(u=>{let b=r,x=u[e]??[],G=this.index()??0,Z=[...x];for(;Z.length<=G;)Z.push(null);Z[G]=b,this.updateAsset(i,{[e]:Z})});else{let u={[e]:r};this.updateAsset(i,u)}}handleAssetDelete(t){if(T(t)||ce(t.id))return;let e=this.assetLinkField(),i=this.entity()?.id,o=this.index();T(i)||ce(i)||(this.arrayLinkFields.includes(e)?this.entitiesService.getAsset(t.id).subscribe(r=>{let u=r[e]??[],b=u.map(x=>x?.id===i?null:x);if(o!==null&&o>=0&&!u.some(G=>G?.id===i)){for(;b.length<=o;)b.push(null);b[o]=null}this.updateAsset(t.id,{[e]:b})}):this.updateAsset(t.id,{[e]:null}))}actions=[{label:"Cancel",action:()=>{this.onClose()},severity:"secondary"},{label:"Ok",action:t=>{this.handleFormSubmit(t)},severity:"primary",disabled:t=>T(t)||t.pristine}];assetList=[];selectedAsset=null;groupingOptions=[];availableAssetsForLinking=[];modalType=null;get isModalVisible(){return this.modalType!==null}get modalHeader(){switch(this.modalType){case"move":return`Move To Different ${this.groupingEntityType()}`;case"add":return"Add Asset";case"delete":return"Delete Asset";default:return""}}constructor(){super(),U(()=>{let t=this.entity()?.owner?.id,e=this.groupId(),i=this.entity()?.id;if(T(t)||T(e)||T(i)){this.assetList=[],this.cdr.markForCheck();return}let o={state:{value:"deleted",operator:"!=",wrap:!0},[e]:{value:i,operator:"="}},r=this.utilityService.constructRqlFilter(o);return this.cacheService.getOrFetch(`assets-${t}-${r}`,()=>this.fetchAssets(t,`${r}/*`),3e3).subscribe(u=>{this.assetList=u,this.cdr.markForCheck()})})}ngOnInit(){let t=this.entity()?.owner?.id,e=this.entity()?.id;this.columns=[{field:"name",header:"Name",filter:!0,filterType:"text",filterMatchMode:"contains",transform:"text-ellipsis"},{field:this.assetLinkField(),header:this.groupingEntityType()??"Group",valueGetter:i=>{let o=this.formatter();if(o)return o(i);let r=this.assetLinkField(),u=i,b=this.index();if(f(u)&&typeof u=="object"&&Object.hasOwn(u,r)){let x=u[r];if(this.arrayLinkFields.includes(r)&&Array.isArray(x)&&b!==null)return x[b]?.name??"";if(!this.arrayLinkFields.includes(r))return x?.name??""}return""},filter:!0,filterType:"multiselect",filterMatchMode:"in",filterConfig:{type:"multiselect",options:[]}}],typeof t=="string"&&t?(this.getGroupingEntitiesFn()(t).then(r=>{this.groupingOptions=r,this.modalType==="move"&&this.updateFormFields(),this.cdr.markForCheck()}).catch(r=>{console.error(`Failed to load ${this.groupingEntityType()} groups:`,r),this.groupingOptions=[],this.cdr.markForCheck()}),this.getAvailableAssetsFn()(t,e).then(r=>{this.availableAssetsForLinking=r,this.modalType==="add"&&this.updateFormFields(),this.cdr.markForCheck()}).catch(r=>{console.error("Failed to load available assets for linking:",r),this.availableAssetsForLinking=[],this.cdr.markForCheck()})):(console.warn("Owner ID is not available or invalid, cannot fetch grouping entities or available assets."),this.groupingOptions=[],this.availableAssetsForLinking=[],this.cdr.markForCheck())}fetchAssets(t,e){return this.entitiesService.listAssets(t,0,yt,"name",e).pipe(Ve(i=>i.items))}updateFormFields(){let t=(this.groupingOptions??[]).map(i=>({label:i.name,value:i.id})),e=(this.availableAssetsForLinking??[]).map(i=>({label:i.name,value:i.id}));switch(this.modalType){case"move":this.formFields=[H("group",`${this.groupingEntityType()}`,t,"",{layout:"horizontal",labelWidth:"1/3",name:"group",props:{appendTo:"body"}})];break;case"add":this.formFields=[H("asset","Asset",e,"",{layout:"horizontal",labelWidth:"1/3",name:"asset",props:{appendTo:"body"}})];break;default:this.formFields=[];break}this.cdr.markForCheck()}updateAsset(t,e){this.entitiesService.updateAsset(t,e).subscribe({next:()=>{this.broadcastService.broadcast("entity-updated",{id:t,changes:e,entityType:"asset",parentId:this.entity()?.id,groupingType:this.groupingEntityType()}),this.modalType=null;let i=this.entity()?.owner?.id,o=this.groupId(),r=this.entity()?.id;if(typeof i=="string"&&i&&typeof o=="string"&&o&&typeof r=="string"&&r){let b={state:{value:"deleted",operator:"!=",wrap:!0},[o]:{value:r,operator:"="}},x=this.utilityService.constructRqlFilter(b);this.fetchAssets(i,`${x}/*`).subscribe(G=>{this.assetList=G,this.cdr.markForCheck()})}let u=this.getAvailableAssetsFn();typeof i=="string"&&i&&u(i,r).then(b=>{this.availableAssetsForLinking=b,this.cdr.markForCheck()}).catch(b=>{console.error("Error refreshing available assets after update:",b)}),this.cdr.markForCheck()},error:i=>{console.error("Failed to update asset:",i)}})}confirmAssetMove(){this.modalType="move",this.updateFormFields()}confirmAssetAdd(){this.modalType="add",this.updateFormFields()}confirmAssetDelete(){this.confirmationService.confirm({message:`Are you sure you want to delete the asset "${this.selectedAsset?.name}"?`,header:"Confirm Delete",rejectButtonProps:{label:"No",severity:"secondary"},accept:()=>{this.handleAssetDelete(this.selectedAsset)}})}onClose(){this.modalType=null,this.selectedAsset=null,this.updateFormFields()}handleRowSelect(t){ce(t)||ce(t.data)||(this.selectedAsset=t.data)}handleRowUnselect(){this.selectedAsset=null}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-list-section"]],inputs:{entity:[1,"entity"],groupId:[1,"groupId"],groupingEntityType:[1,"groupingEntityType"],assetLinkField:[1,"assetLinkField"],index:[1,"index"],formatter:[1,"formatter"],getGroupingEntitiesFn:[1,"getGroupingEntitiesFn"],getAvailableAssetsFn:[1,"getAvailableAssetsFn"]},features:[O],decls:9,vars:16,consts:[[1,"flex","flex-col","h-full","w-full","overflow-hidden"],[1,"p-4","content-header","flex-none","w-full"],[1,"flex","justify-end","items-center"],[1,"flex-none","flex","space-x-4"],["type","button","pTooltip","Add","tooltipPosition","bottom","aria-label","Add new item",1,"pi","pi-plus","action",3,"click"],["type","button","pTooltip","Delete Asset","tooltipPosition","bottom","aria-label","Delete selected item",1,"pi","pi-trash","action",3,"click","disabled"],[1,"flex-1","min-h-0","w-full","overflow-hidden"],[3,"rowSelect","rowUnselect","data","columns","pagination","selectionMode"],[3,"modalClose","formSubmit","visible","header","fields","actions","styleClass"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),_("click",function(){return i.confirmAssetAdd()}),s(),l(5,"button",5),_("click",function(){return i.confirmAssetDelete()}),s()()()(),l(6,"div",6)(7,"app-grid",7),_("rowSelect",function(r){return i.handleRowSelect(r)})("rowUnselect",function(){return i.handleRowUnselect()}),s()()(),l(8,"app-dynamic-form-modal",8),_("modalClose",function(){return i.onClose()})("formSubmit",function(r){return i.onSubmit(r)}),s()),e&2&&(d(4),ki("hover",!0),d(),ki("hover",!!i.selectedAsset)("disabled",!i.selectedAsset),g("disabled",!i.selectedAsset),d(2),g("data",i.assetList)("columns",i.columns)("pagination",!0)("selectionMode","single"),d(),g("visible",i.isModalVisible)("header",i.modalHeader)("fields",i.formFields)("actions",i.actions)("styleClass","w-[40rem]"))},dependencies:[V,it,vt,gi],styles:[".action.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed;pointer-events:none}.action.hover[_ngcontent-%COMP%]:not(.disabled){cursor:pointer}.action.hover[_ngcontent-%COMP%]:not(.disabled):hover{color:var(--color-primary-color)}"]})};var fa=class n extends B{entity=E(null);groupId=E(null);groupingEntityType=E("Group");userLinkField=E.required();getGroupingEntitiesFn=E.required();getAvailableUsersFn=E.required();entitiesService=c(P);accountsService=c(me);utilityService=c(he);cdr=c(Me);cacheService=c(Re);handleFormSubmit(t){switch(this.modalType){case"move":this.handleUserMove(t);break;case"add":this.handleUserAdd(t);break}}handleUserMove(t){if(T(this.selectedUser)||T(t))return;let e=this.userLinkField(),i=this.selectedUser.id,o=t.get("group")?.value;if(T(o)||ce(o))return;let r=this.groupingOptions.find(u=>u.id===o);if(r){let u={[e]:r};this.updateUser(i,u)}else console.error("Selected group not found in grouping options list.")}handleUserAdd(t){if(T(t))return;let e=this.userLinkField(),i=t.get("user")?.value,o=this.entity(),r=o?{id:o.id,name:o.name}:null;if(!r||T(r.id)||ce(r.id)||T(i)||ce(i))return;let u={[e]:r};this.updateUser(i,u)}actions=[{label:"Cancel",action:()=>{this.onClose()},severity:"secondary"},{label:"Ok",action:t=>{this.handleFormSubmit(t)},severity:"primary",disabled:t=>T(t)||t.pristine}];userList=[];selectedUser=null;groupingOptions=[];availableUsersForLinking=[];modalType=null;get isModalVisible(){return this.modalType!==null}get modalHeader(){switch(this.modalType){case"move":return"Move To Different Cost Centre";case"add":return"Add User";default:return""}}constructor(){super(),U(()=>{let t=this.entity()?.owner?.id,e=this.groupId(),i=this.entity()?.id;if(T(t)||T(e)||T(i)){this.userList=[],this.cdr.markForCheck();return}let o={state:{value:"deleted",operator:"!="},[e]:{value:i,operator:"="}},r=this.utilityService.constructRqlFilter(o);return this.cacheService.getOrFetch(`users-${t}-${r}`,()=>this.fetchUsers(t,r),3e3).subscribe(u=>{this.userList=u,this.cdr.markForCheck()})})}ngOnInit(){let t=this.entity()?.owner?.id,e=this.entity()?.id;this.columns=[{field:"name",header:"Name",filter:!0,filterType:"text",filterMatchMode:"contains",transform:"text-ellipsis"},{field:this.userLinkField(),header:this.groupingEntityType()??"Group",valueGetter:i=>{let o=this.userLinkField(),r=i;return f(r)&&typeof r=="object"&&Object.hasOwn(r,o)?r[o]?.name??"":""},filter:!0,filterType:"multiselect",filterMatchMode:"in",filterConfig:{type:"multiselect",options:[]}}],typeof t=="string"&&t?(this.getGroupingEntitiesFn()(t).then(r=>{this.groupingOptions=r,this.modalType==="move"&&this.updateFormFields(),this.cdr.markForCheck()}).catch(r=>{console.error(`Failed to load ${this.groupingEntityType()} groups:`,r),this.groupingOptions=[],this.cdr.markForCheck()}),this.getAvailableUsersFn()(t,e).then(r=>{this.availableUsersForLinking=r,this.modalType==="add"&&this.updateFormFields(),this.cdr.markForCheck()}).catch(r=>{console.error("Failed to load available users for linking:",r),this.availableUsersForLinking=[],this.cdr.markForCheck()})):(console.warn("Owner ID is not available or invalid, cannot fetch grouping entities or available users."),this.groupingOptions=[],this.availableUsersForLinking=[],this.cdr.markForCheck())}fetchUsers(t,e){return this.accountsService.listUsers(t,0,yt,"name",e).pipe(Ve(i=>i.items))}updateFormFields(){let t=(this.groupingOptions??[]).map(i=>({label:i.name,value:i.id})),e=(this.availableUsersForLinking??[]).map(i=>({label:i.name,value:i.id}));switch(this.modalType){case"move":this.formFields=[H("group",`${this.groupingEntityType()}`,t,"",{layout:"horizontal",labelWidth:"1/3",name:"group",props:{appendTo:"body"}})];break;case"add":this.formFields=[H("user","User",e,"",{layout:"horizontal",labelWidth:"1/3",name:"user",props:{appendTo:"body"}})];break;default:this.formFields=[];break}this.cdr.markForCheck()}updateUser(t,e){this.accountsService.updateUser(t,e).subscribe({next:()=>{this.broadcastService.broadcast("entity-updated",{id:t,changes:e,entityType:"user",parentId:this.entity()?.id,groupingType:this.groupingEntityType()}),this.modalType=null;let i=this.entity()?.owner?.id,o=this.groupId(),r=this.entity()?.id;if(typeof i=="string"&&i&&typeof o=="string"&&o&&typeof r=="string"&&r){let b={state:{value:"deleted",operator:"!="},[o]:{value:r,operator:"="}},x=this.utilityService.constructRqlFilter(b);this.fetchUsers(i,x).subscribe(G=>{this.userList=G,this.cdr.markForCheck()})}let u=this.getAvailableUsersFn();typeof i=="string"&&i&&u(i,r).then(b=>{this.availableUsersForLinking=b,this.cdr.markForCheck()}).catch(b=>{console.error("Error refreshing available users after update:",b)}),this.cdr.markForCheck()},error:i=>{console.error("Failed to update user:",i)}})}confirmUserMove(){this.modalType="move",this.updateFormFields()}confirmUserAdd(){this.modalType="add",this.updateFormFields()}onClose(){this.modalType=null,this.selectedUser=null,this.updateFormFields()}handleRowSelect(t){ce(t)||ce(t.data)||(this.selectedUser=t.data)}handleRowUnselect(){this.selectedUser=null}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-user-list-section"]],inputs:{entity:[1,"entity"],groupId:[1,"groupId"],groupingEntityType:[1,"groupingEntityType"],userLinkField:[1,"userLinkField"],getGroupingEntitiesFn:[1,"getGroupingEntitiesFn"],getAvailableUsersFn:[1,"getAvailableUsersFn"]},features:[O],decls:9,vars:10,consts:[[1,"flex","flex-col","h-full","w-full","overflow-hidden"],[1,"p-4","content-header","flex-none","w-full"],[1,"flex","justify-end","items-center"],[1,"flex-none","flex","space-x-4"],["type","button","pTooltip","Add","tooltipPosition","bottom","aria-label","Add new item",1,"pi","pi-plus","action","hover",3,"click"],["type","button","pTooltip","Move User","tooltipPosition","bottom","aria-label","Move selected item",1,"pi","pi-trash","action","hover",3,"click","disabled"],[1,"flex-1","min-h-0","w-full","overflow-hidden"],[3,"rowSelect","rowUnselect","data","columns","pagination","selectionMode"],[3,"modalClose","formSubmit","visible","header","fields","actions","styleClass"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),_("click",function(){return i.confirmUserAdd()}),s(),l(5,"button",5),_("click",function(){return i.confirmUserMove()}),s()()()(),l(6,"div",6)(7,"app-grid",7),_("rowSelect",function(r){return i.handleRowSelect(r)})("rowUnselect",function(){return i.handleRowUnselect()}),s()()(),l(8,"app-dynamic-form-modal",8),_("modalClose",function(){return i.onClose()})("formSubmit",function(r){return i.onSubmit(r)}),s()),e&2&&(d(5),g("disabled",!i.selectedUser),d(2),g("data",i.userList)("columns",i.columns)("pagination",!0)("selectionMode","single"),d(),g("visible",i.isModalVisible)("header",i.modalHeader)("fields",i.formFields)("actions",i.actions)("styleClass","w-[40rem]"))},dependencies:[V,it,vt,gi],encapsulation:2})};var Oo=class n{assetGroupingService=c(Pe);entitiesService=c(P);accountsService=c(me);utilityService=c(he);cacheService=c(Re);createCostCentreInformationSection(t){return[{id:"cost-centre-details",title:"Cost Centre Details",component:ua,componentInputs:{entity:t},category:"information",order:10},{id:"cost-centre-contacts",title:"Contacts",component:Mi,componentInputs:{entity:t,entityType:"cost-centre"},category:"information",order:20}]}createChangesSection(t){return[{id:"cost-centre-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAssetsSection(t){return[{id:"cost-centre-assets",title:"Assets",component:Wt,componentInputs:{entity:t,groupId:"costCentre.id",groupingEntityType:"Cost Centre",assetLinkField:"costCentre",getGroupingEntitiesFn:e=>this.assetGroupingService.getCostCentresAsTree(e),getAvailableAssetsFn:(e,i)=>this.getAvailableAssets(e)},category:"assets",order:10}]}getAvailableAssets(t){let e={state:{value:"active",operator:"="}},i=this.utilityService.constructRqlFilter(e);return this.cacheService.getOrFetchAsync(`assets-list-${t}-${i}`,()=>Ce(this.entitiesService.listAssets(t,0,100,"name",i).pipe(Ve(o=>o.items.map(r=>({id:r.id,name:r.name}))))),3e5)}createUsersSection(t){return[{id:"cost-centre-users",title:"Users",component:fa,componentInputs:{entity:t,groupId:"costCentre.id",groupingEntityType:"Cost Centre",userLinkField:"costCentre",getGroupingEntitiesFn:e=>this.assetGroupingService.getCostCentresAsTree(e),getAvailableUsersFn:e=>Ce(this.accountsService.listUsers(e,0,100,"name").pipe(Ve(i=>i.items.map(o=>({id:o.id,name:o.name})))))},category:"users",order:20}]}createAllCostCentreSections(t){return[...this.createCostCentreInformationSection(t),...this.createAssetsSection(t),...this.createUsersSection(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var ZC=n=>({"icon-primary":n});function KC(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit geofence group details"))}function QC(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function YC(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.geofenceGroupDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var ga=class n extends B{ownerId=E(null);entitiesService=c(P);operationRegistry=c(Q);assetGroupingService=c(Pe);geofenceGroupDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Parent",value:t.parent?.name??"Root"},{key:"Name",value:t.name}]:[]});faAtlas=Ln;zoneGroups=[];constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.entity()?.owner?.id??this.ownerId();f(t)&&this.fetchZoneGroups(t).then(e=>{this.zoneGroups=e,this.updateFormFields()}).catch(()=>{})})}fetchZoneGroups(t){return this.assetGroupingService.getZoneGroups(t)}updateFormFields(){let t=this.entity(),e=[{label:"Root",value:"root"},...this.zoneGroups.map(i=>({label:i.name,value:i.id}))];this.formFields=[H("parent","Parent",e,t?.parent?.id??"root",{placeholder:"Select Parent Group",validations:[{name:"required",validator:w.required,message:"Parent group is required"}],props:{appendTo:"body"}}),k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]})]}getUpdateMethod(){return this.operationRegistry.getOperation("geofence-group","update")??((t,e)=>this.entitiesService.updateZoneGroup(t,e))}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);if(f(e.parent)){let i=e.parent,o=this.zoneGroups?.find(r=>r.id===i);o?e.parent={id:o.id,name:o.name}:i==="root"&&(e.parent=null)}return e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-geofence-group-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Geofence Group Details"),s(),h(7,KC,2,1,"div",6),s(),l(8,"span"),D(9,"The following information is required in order to identify your geofence group."),s()()(),h(10,QC,1,3,"app-dynamic-form",7),h(11,YC,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faAtlas)("ngClass",N(5,ZC,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,Te,V,q,te,ne],encapsulation:2})};var Vo=class n{createGeofenceGroupInformationSection(t){return[{id:"geofence-group-details",title:"Geofence Group Details",component:ga,componentInputs:{entity:t},category:"information",order:10}]}createChangesSection(t){return[{id:"geofence-group-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllGeofenceGroupSections(t){return[...this.createGeofenceGroupInformationSection(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var JC=n=>({"icon-primary":n});function XC(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit asset group details"))}function e0(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function t0(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.assetGroupDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var ha=class n extends B{ownerId=E(null);entitiesService=c(P);operationRegistry=c(Q);assetGroupingService=c(Pe);assetGroupDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Parent",value:t.parent?.name??"Root"},{key:"Name",value:t.name}]:[]});faAtlas=Ln;assetGroups=[];constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.entity()?.owner?.id??this.ownerId();f(t)&&this.fetchAssetGroups(t).then(e=>{this.assetGroups=e,this.updateFormFields()}).catch(()=>{})})}fetchAssetGroups(t){return this.assetGroupingService.getAssetGroups(t)}updateFormFields(){let t=this.entity(),e=[{label:"Root",value:"root"},...this.assetGroups.map(i=>({label:i.name,value:i.id}))];this.formFields=[H("parent","Parent",e,t?.parent?.id??"root",{placeholder:"Select Parent Group",validations:[{name:"required",validator:w.required,message:"Parent group is required"}],props:{appendTo:"body"}}),k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]})]}getUpdateMethod(){return this.operationRegistry.getOperation("asset-group","update")??((t,e)=>this.entitiesService.updateAssetGroup(t,e))}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);if(f(e.parent)){let i=e.parent,o=this.assetGroups?.find(r=>r.id===i);o?e.parent={id:o.id,name:o.name}:i==="root"&&(e.parent=null)}return e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-group-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Asset Group Details"),s(),h(7,XC,2,1,"div",6),s(),l(8,"span"),D(9,"The following information is required in order to identify your asset group."),s()()(),h(10,e0,1,3,"app-dynamic-form",7),h(11,t0,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faAtlas)("ngClass",N(5,JC,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,V,q,te,ne],encapsulation:2})};var No=class n{assetGroupingService=c(Pe);entitiesService=c(P);utilityService=c(he);cacheService=c(Re);createAssetGroupInformationSection(t){return[{id:"asset-group-details",title:"Asset Group Details",component:ha,componentInputs:{entity:t},category:"information",order:10}]}createChangesSection(t){return[{id:"asset-group-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAssetsSection(t){return[{id:"asset-group-assets",title:"Assets",component:Wt,componentInputs:{entity:t,groupId:"groups.id",groupingEntityType:"Asset Group",assetLinkField:"groups",getGroupingEntitiesFn:e=>this.assetGroupingService.getAssetGroupsAsTree(e),getAvailableAssetsFn:(e,i)=>this.getAvailableAssets(e)},category:"assets",order:10}]}getAvailableAssets(t){let e={state:{value:"active",operator:"="}},i=this.utilityService.constructRqlFilter(e);return this.cacheService.getOrFetchAsync(`assets-list-${t}-${i}`,()=>Ce(this.entitiesService.listAssets(t,0,100,"name",i).pipe(Ve(o=>o.items.map(r=>({id:r.id,name:r.name}))))),3e5)}createAllAssetGroupSections(t){return[...this.createAssetGroupInformationSection(t),...this.createAssetsSection(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var i0=n=>({"icon-primary":n});function n0(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit asset category details"))}function o0(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function r0(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.assetCategoryDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var ya=class n extends B{ownerId=E(null);entitiesService=c(P);operationRegistry=c(Q);assetGroupingService=c(Pe);cacheService=c(Re);assetCategoryDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Name",value:t.name}]:[]});faSitemap=Pn;assetCategoryGroups=[];constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.entity()?.owner?.id??this.ownerId(),e=this.entity()?.id;f(t)&&this.fetchAssetCategories(t).then(i=>{let o=Pe.createRootNode(t);this.assetCategoryGroups=[o,...i.filter(r=>r.id!==e)],this.updateFormFields()}).catch(()=>{})})}fetchAssetCategories(t){return this.assetGroupingService.getAssetCategories(t)}updateFormFields(){let t=this.entity(),e=this.assetCategoryGroups.map(i=>({label:i.name,value:i.id}));this.formFields=[k("name","Name",t?.name??"",{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]})],this.createMode()&&this.formFields.unshift(H("parent","Parent",e,t?.parent?.id??"",{placeholder:"Select Parent Group",validations:[{name:"required",validator:w.required,message:"Parent group is required"}],props:{appendTo:"body"}}))}getUpdateMethod(){return this.operationRegistry.getOperation("asset-category","update")??((t,e)=>this.entitiesService.updateAssetCategory(t,this.transformFormData(e)).pipe(Je(()=>{this.cacheService.clearCacheByPattern("asset-categories-")})))}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);if(f(e.parent)){let i=e.parent,o=this.assetCategoryGroups?.find(r=>r.id===i);o?e.parent={id:o.id,name:o.name}:i==="root"&&(e.parent=null)}return e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-category-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Asset Category Details"),s(),h(7,n0,2,1,"div",6),s(),l(8,"span"),D(9,"The following information is required in order to identify your cost centre."),s()()(),h(10,o0,1,3,"app-dynamic-form",7),h(11,r0,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faSitemap)("ngClass",N(5,i0,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,V,q,te,ne],encapsulation:2})};var qo=class n{assetGroupingService=c(Pe);entitiesService=c(P);accountsService=c(me);utilityService=c(he);cacheService=c(Re);createAssetCategoryInformationSection(t){return[{id:"asset-category-details",title:"Asset Category Details",component:ya,componentInputs:{entity:t},category:"information",order:10},{id:"asset-category-contacts",title:"Contacts",component:Mi,componentInputs:{entity:t,entityType:"asset-category"},category:"information",order:20}]}createChangesSection(t){return[{id:"asset-category-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAssetsSection(t){return[{id:"asset-category-assets",title:"Assets",component:Wt,componentInputs:{entity:t,groupId:"categories.id",groupingEntityType:"Asset category",assetLinkField:"categories",index:t?.index??0,getGroupingEntitiesFn:e=>this.assetGroupingService.getAssetCategoriesAsTree(e),getAvailableAssetsFn:(e,i)=>this.getAvailableAssets(e)},category:"assets",order:10}]}getAvailableAssets(t){let e={state:{value:"active",operator:"="}},i=this.utilityService.constructRqlFilter(e);return this.cacheService.getOrFetchAsync(`assets-list-${t}-${i}`,()=>Ce(this.entitiesService.listAssets(t,0,100,"name",i).pipe(Ve(o=>o.items.map(r=>({id:r.id,name:r.name}))))),3e5)}createAllAssetCategorySections(t){return[...this.createAssetCategoryInformationSection(t),...this.createAssetsSection(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var zo=class n{createAllClientSections(t,e){let i=e.flatMap(o=>at.forClient(t).addSection(o,"Features",Mt,{category:"features"},{feature:Tt[o],entityType:"client"}).build());return[...at.createClientInformationSections(t),...at.createClientSettingsSections(t),...i,...at.createClientChangesSections(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Bo=class n{createAllVendorSections(t,e){let i=e.flatMap(o=>at.forVendor(t).addSection(o,"Features",Mt,{category:"features"},{feature:Tt[o],entityType:"vendor"}).build());return[...at.createVendorInformationSections(t),...at.createVendorSettingsSections(t),...i,{id:"vendor-changes",title:"Changes",component:ge,componentInputs:{entity:t,entityType:"vendor"},category:"feed",order:10}]}createFlexibleVendorConfiguration(t,e){let i=at.createVendorInformationSections(t),o=at.createVendorSettingsSections(t),r=e.flatMap(u=>at.forVendor(t).addSection(u,"Features",Mt,{category:"features"},{feature:Tt[u],entityType:"vendor"}).build());return _i.forEntity(t).withSections(i).withSections(o).withSections(r).withSection("vendor-changes","Changes",ge,"feed",10,{entityType:"vendor"}).withCategory("information","Vendor Information",10).withCategory("settings","Vendor Settings",20).withCategory("features","Features",30).withCategory("feed","Recent Changes",40).withDefaultExpanded("information").withMultipleExpansion(!1).build()}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ko=class n{createAllDistributorSections(t){return[...at.createDistributorInformationSections(t),...at.createDistributorSettingsSections(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var a0=n=>({"icon-primary":n});function s0(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",8),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit asset state profile details"))}function l0(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",9),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function d0(n,t){if(n&1&&(l(0,"div",10)(1,"p-message",12),C(2,"span",13),D(3),s()()),n&2){let e=a(2);d(3),ye(" ",e.warning())}}function c0(n,t){if(n&1&&(h(0,d0,4,1,"div",10),C(1,"app-grid",11)),n&2){let e=a();y(e.warning()?0:-1),d(),g("data",e.assetStateProfileDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var va=class n extends B{ownerId=E(null);entitiesService=c(P);eventFilterService=c(zt);assetStateProfileDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Name",value:t.name},{key:"States",value:ce(t.items)?"None":t.items?.map(e=>e.state).join(", ")}]:[]});assetStateProfileItemModalConfig;warning=R(null);constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.entity();T(t?.items)||t.items.length<2?this.warning.set("At least two states are required for the asset state profile to be useful."):this.warning.set(null)})}updateFormFields(){let t=this.entity();this.assetStateProfileItemModalConfig={modalComponent:be,modalTitle:"State Change Trigger",defaultItemProvider:()=>({id:Xe(),state:"",color:"#0000ff",radius:0,filter:void 0}),listItemFormatter:e=>this.stateItemToListItem(e),modalFields:e=>[k("id","ID",e?.id,{name:"id",hidden:!0}),k("state","State Name",e?.name,{name:"state",validations:[{name:"required",validator:w.required,message:"State Name is required"}]}),Sn("color","State Color",void 0,{name:"color",validations:[{name:"required",validator:w.required,message:"Color is required"}],layout:"horizontal",labelWidth:"1/3"}),ie("radius","Radius",void 0,{name:"radius",validations:[{name:"required",validator:w.required,message:"Max is required"},{name:"min",validator:w.min(0),message:"Min must be 0 or greater"},{name:"max",validator:w.max(1e3),message:"Max must be 1000 or less"}],layout:"horizontal",labelWidth:"1/3",hint:"Defines the thickness of the trip line drawn on the map for applications where coverage is important.",props:{suffix:"meters"}}),Lt("filter","Event Filter",void 0,["costcentres","groups","types","categories"],{name:"filter",required:!0,validations:[{name:"required",validator:w.required,message:"Event filter is required"}]})],subHeader:"Choose a state name and color, and configure the event filter to trigger this state."},this.formFields=[k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]})],this.createMode()||this.formFields.push(De("items","States",t?.items??[],{layout:"horizontal",labelWidth:"1/3",name:"items",props:{modalConfig:this.assetStateProfileItemModalConfig}}))}submitChanges(t){let e=this.entity();if(T(e))return;let i=this.transformFormData(t);this.entitiesService.updateAssetStateProfile(e.id,i).pipe(W(this.destroyRef)).subscribe({next:o=>{this.isFormEditable.set(!1),this.isSubmitting.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"asset-state-profile",operation:"update",entityId:e.id,data:o})},error:()=>{this.isFormEditable.set(!0),this.isSubmitting.set(!1)}})}stateItemToListItem(t){return{id:t.id,title:t.state,display:t.name,icon:"tag",iconStyle:{color:t.color}}}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);return Array.isArray(e.items)&&(e.items=e.items.map(i=>{let o=M({},i);if(f(o.radius)){let r=o.radius;o.radius=typeof r=="string"?Number(r):r}if(f(o.filter)){let r=o.filter;o.filter=ee(M({},r),{actor:r?.actor?.data,action:r?.action?.data,target:r?.target?.data,conditions:r?.conditions?.map(x=>{var G=x,{id:u}=G,b=xt(G,["id"]);return b})??[]})}return f(o.state)&&!f(o.name)&&(o.name=this.eventFilterService.getEventFilterText(o.filter)),o})),e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-asset-state-profile-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-lightbulb","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"],[1,"mb-4"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],["severity","warn"],[1,"pi","pi-exclamation-triangle","mr-2"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Asset State Profile Details"),s(),h(7,s0,2,1,"div",6),s(),l(8,"span"),D(9,"Configure the state change triggers for your asset state profile."),s()()(),h(10,l0,1,3,"app-dynamic-form",7),h(11,c0,2,5),s()),e&2&&(d(2),g("ngClass",N(5,a0,i.isFormEditable())),I("aria-label","lightbulb icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q,X,se],encapsulation:2})};var Yo=class n{createAssetStateProfileInformationSections(t){return[{id:"asset-state-profile-details",title:"Asset State Profile Details",component:va,componentInputs:{entity:t},category:"information",order:10}]}createChangesSection(t){return[{id:"asset-state-profile-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllAssetStateProfileSections(t){return[...this.createAssetStateProfileInformationSections(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var m0=n=>({"icon-primary":n});function p0(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit company group details"))}function u0(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function f0(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.companyGroupDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Ca=class n extends B{ownerId=E(null);entitiesService=c(P);operationRegistry=c(Q);accountsService=c(me);companyGroupDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Parent",value:t.parent?.name??"Root"},{key:"Name",value:t.name}]:[]});faFolder=Rl;companyGroupGroups=[];constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.entity()?.owner?.id??this.ownerId();f(t)&&this.fetchCompanyGroups(t).then(e=>{this.companyGroupGroups=Pe.toAssetGroupingItems(e.items),this.updateFormFields()}).catch(()=>{})})}fetchCompanyGroups(t){return Ce(this.accountsService.listCompanyGroups(t))}updateFormFields(){let t=this.entity(),e=[{label:"Root",value:Oe},...this.companyGroupGroups.map(i=>({label:i.name,value:i.id}))];this.formFields=[H("parent","Parent",e,t?.parent?.id??Oe,{placeholder:"Select Parent Group",validations:[{name:"required",validator:w.required,message:"Parent group is required"}],props:{appendTo:"body"}}),k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]})]}getUpdateMethod(){return this.operationRegistry.getOperation("company-group","update")??((t,e)=>this.accountsService.updateCompanyGroup(t,e))}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);if(f(e.parent)){let i=e.parent,o=this.companyGroupGroups?.find(r=>r.id===i);o?e.parent={id:o.id,name:o.name}:i===Oe&&(e.parent=null)}return e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-company-group-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Company Group Details"),s(),h(7,p0,2,1,"div",6),s(),l(8,"span"),D(9,"The following information is required in order to identify your company group."),s()()(),h(10,u0,1,3,"app-dynamic-form",7),h(11,f0,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faFolder)("ngClass",N(5,m0,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,Te,V,q,te,ne],encapsulation:2})};var g0=n=>({"icon-primary":n});function h0(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit company group details"))}function y0(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function v0(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.companyGroupDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Ri=class n extends B{ownerId=E(null);emailType=E.required();operationRegistry=c(Q);accountsService=c(me);defaults={user_invite:{title:"User Invite Email",description:"Customize the text that will be sent in the new user invitation email.",template:{id:Oe,name:"Default"},subject:"Account creation at {{siteUrl}}",body:`You're receiving this email because an account was created for you at {{siteUrl}}.

To complete your profile and set a password, open the following link in your browser: {{resetUrl}}

You can safely ignore this message if you do not wish to complete the account creation process.`},forgot_password:{title:"Forgot Password Email",description:"Customize the text that will be sent when a user resets their own password with the forgot password action.",template:{id:Oe,name:"Default"},subject:"Password reset at {{siteUrl}}",body:`You're receiving this email because you entered your email address and clicked the forgot password link at {{siteUrl}}.

To reset your password, open the following link in your browser: {{resetUrl}}

You can safely ignore this message if you do not wish to reset your password.`},user_reset:{title:"User Account Reset Email",description:"Customize the text that will be sent when an admin resets a user account.",template:{id:Oe,name:"Default"},subject:"Account recovery at {{siteUrl}}",body:`You're receiving this email because your account was reset by an administrator at {{siteUrl}}.

To recover your account and set a new password, open the following link in your browser: {{resetUrl}}

You can safely ignore this message if you do not wish to recover your account.`}};companyGroupDetails=v(()=>{let t=this.entity(),e=this.defaults[this.emailType()];return f(t)?[{key:"Subject",value:t?.email?.templates?.[this.emailType()]?.subject??e.subject},{key:"Body",value:t?.email?.templates?.[this.emailType()]?.body??e.body}]:[]});title=R("");description=R("");faEnvelopeOpenText=Nl;companyGroupGroups=[];constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",transform:"whitespace-pre-wrap break-words"}],U(()=>{this.title.set(this.defaults[this.emailType()].title),this.description.set(this.defaults[this.emailType()].description)})}updateFormFields(){let t=this.entity();this.formFields=[k("subject","Subject",t?.email?.templates?.[this.emailType()]?.subject??this.defaults[this.emailType()].subject,{name:"subject",validations:[{name:"required",validator:w.required,message:"Subject is required"}]}),Ge("body","Body",t?.email?.templates?.[this.emailType()]?.body??this.defaults[this.emailType()].body,{name:"body",validations:[{name:"required",validator:w.required,message:"Body is required"}]})]}getUpdateMethod(){return this.operationRegistry.getOperation("company-group","update")??((t,e)=>this.accountsService.updateCompanyGroup(t,e))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-company-group-email-template-section"]],inputs:{ownerId:[1,"ownerId"],emailType:[1,"emailType"]},features:[O],decls:12,vars:9,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6),s(),h(7,h0,2,1,"div",6),s(),l(8,"span"),D(9),s()()(),h(10,y0,1,3,"app-dynamic-form",7),h(11,v0,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faEnvelopeOpenText)("ngClass",N(7,g0,i.isFormEditable())),d(4),J(i.title()),d(),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),J(i.description()),d(),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,Te,V,q,te,ne],encapsulation:2})};var Xo=class n{createCompanyGroupInformationSection(t){return[{id:"company-group-details",title:"Company Group Details",component:Ca,componentInputs:{entity:t},category:"information",order:10}]}createCompanyGroupEmailCustomizationSection(t){return[{id:"company-group-email-customization-user-invite",title:"User Invite Email",component:Ri,componentInputs:{entity:t,emailType:"user_invite"},category:"customization",order:10},{id:"company-group-email-customization-user-reset",title:"User Reset Email",component:Ri,componentInputs:{entity:t,emailType:"user_reset"},category:"customization",order:20},{id:"company-group-email-customization-forgot-password",title:"Forgot Password Email",component:Ri,componentInputs:{entity:t,emailType:"forgot_password"},category:"customization",order:30}]}createChangesSection(t){return[{id:"company-group-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createFeaturesSection(t,e){return e.map(o=>({id:`company-group-feature-${o}`,title:o,component:Mt,componentInputs:{entity:t,feature:Tt[o],entityType:"company-group"},category:"features",order:10}))}createBackendSection(t,e){return[...Object.keys(e.sections).map(i=>({id:`company-group-backend-${i}`,title:i,component:Mt,componentInputs:{entity:t,feature:e.sections[i],entityType:"company-group"},category:"backend",order:10}))]}createAllCompanyGroupSections(t,e,i){return[...this.createCompanyGroupInformationSection(t),...this.createFeaturesSection(t,e),...this.createBackendSection(t,i),...this.createCompanyGroupEmailCustomizationSection(t),...this.createChangesSection(t)]}createFlexibleCompanyGroupConfiguration(t,e,i){return _i.forEntity(t).withSections(this.createCompanyGroupInformationSection(t)).withSections(this.createFeaturesSection(t,e).map(o=>ee(M({},o),{category:"applications"}))).withSections(this.createBackendSection(t,i)).withSections(this.createCompanyGroupEmailCustomizationSection(t)).withSections(this.createChangesSection(t)).withCategory("information","Information",10).withCategory("applications","Applications",20).withCategory("backend","Backend",30).withCategory("customization","Email Customization",40).withCategory("feed","Changes",50).withDefaultExpanded("information").withMultipleExpansion(!1).build()}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var _a=class n extends zt{ACTION_EVENTS={geocoding:["speed"]};ACTION_TARGETS={zoneevent:"zones",assetstatechangeevent:"state"};EVENT_CONDITIONS={speedlimit:{mode:{type:"dropdown",values:["greater","less","equals"]},speed:{type:"speed"}},routenumber:{mode:{type:"dropdown",values:["equals","starts","contains","ends","not_equals","not_starts","not_contains","not_ends"]},value:{type:"value"}},roadname:{mode:{type:"dropdown",values:["equals","starts","contains","ends","not_equals","not_starts","not_contains","not_ends"]},value:{type:"value"}},carriageway:{mode:{type:"dropdown",values:["single","dual"]}},boundary:{boundary:{type:"dropdown",values:["suburb","town","state","country"]},mode:{type:"dropdown",values:["equals","starts","contains","ends","not_equals","not_starts","not_contains","not_ends"]},value:{type:"value"}},time:{mode:{type:"dropdown",values:["inside","outside"]},time1:{type:"time"},time2:{type:"time"},dow:{type:"checklist",values:["0","1","2","3","4","5","6"]}},zone:{mode:{type:"dropdown",values:["inside","outside"]},zone:{type:"dropdown",values:this.getZoneSelectionTree}},digital:{input:{type:"dropdown",values:()=>this.getIoTargetList(["digital_input"]),linkedTo:"state"},state:{type:"dropdown",values:this.getIoValues}},state:{profile:{type:"dropdown",values:this.getStateTargetList,linkedTo:"state"},state:{type:"dropdown",values:this.getStateValues}}};static \u0275fac=(()=>{let t;return function(i){return(t||(t=He(n)))(i||n)}})();static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var C0=n=>({"icon-primary":n});function _0(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit road profile details"))}function b0(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function S0(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.roadProfileDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var ba=class n extends B{ownerId=E(null);entitiesService=c(P);measurementUnitsService=c(pt);filterService=c(_a);operationRegistry=c(Q);roadProfileDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Name",value:t.name},{key:"Speed Modifiers",value:t.speedModifiers&&t.speedModifiers.length>0?t.speedModifiers?.map(e=>`${e.name} (${e.speed}${e.unit})`).join(", "):"None"}]:[]});roadProfileSpeedModifiersModalConfig;faIconRoad=Pl;constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}],U(()=>{let t=this.entity();f(t)&&!this.createMode()&&_e(()=>{this.updateFormFields()})})}updateFormFields(){let t=this.entity();this.roadProfileSpeedModifiersModalConfig={modalComponent:be,modalTitle:"Road Speed Modifier",subHeader:"Create a filter to match certain geographic conditions, and specify a new speed limit for your assets.",defaultItemProvider:()=>({id:Xe(),name:"",filter:void 0,speed:0,unit:Gs.UnitEnum.Kmh}),listItemFormatter:e=>this.stateItemToListItem(e),modalFields:e=>[k("id","ID",e?.id,{name:"id",hidden:!0}),k("name","Name",e?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),Lt("filter","Filter",e?.filter,[],{name:"filter",required:!0,validations:[{name:"required",validator:w.required,message:"filter is required"}],props:{filterService:this.filterService,requireActorBeforeAction:!1}}),ie("speed","Speed",e?.speed,{name:"speed",validations:[{name:"required",validator:w.required,message:"Speed is required"},{name:"min",validator:w.min(0),message:"Min must be 0 or greater"},{name:"max",validator:w.max(1e3),message:"Max must be 1000 or less"}],layout:"horizontal",labelWidth:"1/3",props:{suffix:this.measurementUnitsService.unit("speed")}}),H("unit","Unit",[{value:"kmh",label:"km/h"},{value:"mph",label:"mph"}],e?.unit,{name:"unit",validations:[{name:"required",validator:w.required,message:"Unit is required"}]})]},this.formFields=[k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]})],this.createMode()||this.formFields.push(De("speedModifiers","Speed Modifiers",t?.speedModifiers??[],{layout:"horizontal",labelWidth:"1/3",name:"speedModifiers",props:{modalConfig:this.roadProfileSpeedModifiersModalConfig}}))}getUpdateMethod(){return this.operationRegistry.getOperation("road-profile","update")??((t,e)=>this.entitiesService.updateRoadProfile(t,e))}stateItemToListItem(t){return{id:t.id,title:`${t.name} (${t.speed}${t.unit})`,display:this.filterService.getEventFilterText(t.filter),icon:"pi pi-gauge"}}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);return f(e?.speedModifiers)&&Array.isArray(e.speedModifiers)&&e.speedModifiers.forEach(i=>{let o=i.filter;i.filter=ee(M({},o),{actor:o?.actor?.data??o?.actor,action:o?.action?.data??o?.action,target:o?.target?.data??o?.target,conditions:o?.conditions?.map(r=>{let x=r,{id:u}=x;return xt(x,["id"])})})}),e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-road-profile-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"!text-[2.5rem]",3,"icon","ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"fa-icon",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Road Profile Details"),s(),h(7,_0,2,1,"div",6),s(),l(8,"span"),D(9,"Configure the road modifiers that you want to apply to this profile below."),s()()(),h(10,b0,1,3,"app-dynamic-form",7),h(11,S0,1,4,"app-grid",8),s()),e&2&&(d(2),g("icon",i.faIconRoad)("ngClass",N(5,C0,i.isFormEditable())),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q,X,te,ne],encapsulation:2})};var tr=class n{createRoadProfileInformationSections(t){return[{id:"road-profile-details",title:"Road Profile Details",component:ba,componentInputs:{entity:t},category:"information",order:10}]}createChangesSection(t){return[{id:"road-profile-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllRoadProfileSections(t){return[...this.createRoadProfileInformationSections(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};var D0=n=>({"icon-primary":n});function T0(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",8),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit geo lock profile details"))}function w0(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",9),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function x0(n,t){if(n&1&&(l(0,"div",10)(1,"p-message",12),C(2,"span",13),D(3),s()()),n&2){let e=a(2);d(3),ye(" ",e.warning())}}function F0(n,t){if(n&1&&(h(0,x0,4,1,"div",10),C(1,"app-grid",11)),n&2){let e=a();y(e.warning()?0:-1),d(),g("data",e.geoLockProfileDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Sa=class n extends B{ownerId=E(null);entitiesService=c(P);measurementUnitsService=c(pt);http=c(It);authDataService=c(ke);geoLockProfileDetails=v(()=>{let t=this.entity();return f(t)?[{key:"Name",value:t.name},{key:"Radius",value:f(t.radiusKm)?`${this.measurementUnitsService.fromBackend("distance",t.radiusKm,2)} ${this.measurementUnitsService.getUnitConfig("distance")}`:"None"},{key:"Times",value:ce(t.times)?"None":(t.times??[]).map(e=>{let i=this.stateItemToListItem(e);return`${i?.title} - (${i?.display})`}).join(`
`)}]:[]});geoLockProfileItemModalConfig;warning=R(null);timezones=R([]);constructor(){super(),this.columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",transform:"whitespace-pre-line"}],U(()=>{let t=this.entity();T(t?.times)||t.times.length<1?this.warning.set("At least one time entry is required for the geo lock profile to be useful."):this.warning.set(null)}),U(()=>{let t=this.entity();this.timezones(),f(t)&&!this.createMode()&&_e(()=>{this.updateFormFields()})})}ngOnInit(){this.loadTimezones()}loadTimezones(){this.http.get("/assets/docs/timezones.json").pipe(W(this.destroyRef)).subscribe(t=>{this.timezones.set(t.map(e=>({label:e.id,value:e.id})).sort((e,i)=>e.label.localeCompare(i.label)))})}updateFormFields(){let t=this.entity();this.geoLockProfileItemModalConfig={modalComponent:be,modalTitle:"Geo lock Times",defaultItemProvider:()=>({id:Xe(),from:"00:00",to:"23:59",timeZoneId:this.authDataService.getUserProfile()?.timeZoneId??"",days:["0","1","2","3","4","5","6"]}),listItemFormatter:e=>this.stateItemToListItem(e),modalFields:e=>[k("id","ID",e?.id,{name:"id",hidden:!0}),tt("from","From",e?.from??"00:00",{name:"from",placeholder:"Select time",props:{timeOnly:!0,showSeconds:!0},style:{width:"100%"}}),tt("to","To",e?.to??"23:59",{name:"to",placeholder:"Select time",props:{timeOnly:!0,showSeconds:!0},style:{width:"100%"}}),H("timeZoneId","Time Zone",this.timezones(),"",{layout:"horizontal",labelWidth:"1/3",placeholder:"Select timezone",name:"timeZone",props:{appendTo:"body"}}),rt("days","Days",[],Nt,{name:"days",validations:[{name:"required",validator:w.required,message:"Weekdays is required"}],props:{checkmark:!0,multiple:!0}})],subHeader:"Configure the days of the week and times in which the lock is active."},this.formFields=[k("name","Name",t?.name,{name:"name",validations:[{name:"required",validator:w.required,message:"Name is required"}]}),ie("radiusKm","Radius",f(t?.radiusKm)?this.measurementUnitsService.fromBackend("distance",t?.radiusKm??0,2):void 0,{name:"radiusKm",validations:[{name:"required",validator:w.required,message:"Radius is required"}],props:{suffix:this.measurementUnitsService.getUnitConfig("distance")}})],this.createMode()||this.formFields.push(De("times","Geo Lock Times",t?.times??[],{layout:"horizontal",labelWidth:"1/3",name:"times",props:{modalConfig:this.geoLockProfileItemModalConfig}}))}submitChanges(t){let e=this.entity();if(T(e))return;let i=this.transformFormData(t);this.entitiesService.updateGeoLockProfile(e.id,i).pipe(W(this.destroyRef)).subscribe({next:o=>{this.isFormEditable.set(!1),this.isSubmitting.set(!1),this.broadcastService.broadcast("entity-updated",{entityType:"geo-lock-profile",operation:"update",entityId:e.id,data:o})},error:()=>{this.isFormEditable.set(!0),this.isSubmitting.set(!1)}})}stateItemToListItem(t){return{id:t.id,title:t.from&&t.to?`${t.from} to ${t.to}`:"",display:f(t.days)?t.days?.map(e=>Nt.find(i=>i.value===String(e))?.label??e).join(", "):"",icon:"clock"}}onFormValueChange(t){let e=this.transformFormData(t);this.formValueChange.emit(e)}transformFormData(t){let e=M({},t);return Array.isArray(e.times)&&(e.times=e.times.map(i=>({id:i.id,from:i.from&&typeof i.from=="string"&&i.from.split(":").length===2?`${i.from}:00`:i.from,to:i.to&&typeof i.to=="string"&&i.to.split(":").length===2?`${i.to}:00`:i.to,timeZoneId:i.timeZoneId,days:Array.isArray(i.days)?i.days.map(Number):i.days}))),f(t.radiusKm)&&t.radiusKm!==""&&(e.radiusKm=this.measurementUnitsService.toBackend("distance",Number(t.radiusKm))),e}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-geo-lock-profile-details-section"]],inputs:{ownerId:[1,"ownerId"]},features:[O],decls:12,vars:7,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-lock","!text-[2.5rem]",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions","hideActions"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"],[1,"mb-4"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],["severity","warn"],[1,"pi","pi-exclamation-triangle","mr-2"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Geo Lock Profile Details"),s(),h(7,T0,2,1,"div",6),s(),l(8,"span"),D(9,"Configure the state change triggers for your geo lock profile."),s()()(),h(10,w0,1,3,"app-dynamic-form",7),h(11,F0,2,5),s()),e&2&&(d(2),g("ngClass",N(5,D0,i.isFormEditable())),I("aria-label","lock icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[L,z,K,V,q,X,se],encapsulation:2})};var nr=class n{createGeoLockProfileInformationSections(t){return[{id:"geo-lock-profile-details",title:"Geo Lock Profile Details",component:Sa,componentInputs:{entity:t},category:"information",order:10}]}createChangesSection(t){return[{id:"geo-lock-profile-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createAllGeoLockProfileSections(t){return[...this.createGeoLockProfileInformationSections(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};function I0(n,t){if(n&1&&(ht(),l(0,"svg",2),C(1,"use"),s()),n&2){let e=a();I("aria-label",e.displayTitle()+" icon"),d(),I("href","assets/sprites/sprite.svg#"+e.icon())}}function E0(n,t){if(n&1&&C(0,"span"),n&2){let e=a();Le(e.icon()+" !text-[2.5rem]"),I("aria-label",e.displayTitle()+" icon")}}function M0(n,t){if(n&1){let e=S();l(0,"div",7)(1,"span",10),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}if(n&2){let e=a();d(),I("aria-label","Edit "+e.displayTitle().toLowerCase())}}function R0(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",11),_("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)}}function A0(n,t){if(n&1&&C(0,"app-grid",12),n&2){let e=a(2);g("data",e.ioTypeDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!1)}}function k0(n,t){if(n&1&&(l(0,"div",13),C(1,"i",14),l(2,"p"),D(3),s()()),n&2){let e=a(2);d(3),ye(" No ",e.displayTitle().toLowerCase()," are currently configured for this device type. ")}}function O0(n,t){if(n&1&&(l(0,"div",9),h(1,A0,1,4,"app-grid",12)(2,k0,4,1,"div",13),s()),n&2){let e=a();d(),y(e.hasData()?1:2)}}var Da=class n extends B{ioTypeConfigs={digital_output:{additionalFields:["canPulse","canToggle","maxPulseSeconds","minPulseSeconds"],getDefaultValues:()=>({canPulse:!1,canToggle:!0,maxPulseSeconds:0,minPulseSeconds:0}),getModalFields:t=>[_t("canToggle","Can Toggle",t?.canToggle??!0,{hint:"When enabled, this output can be toggled on/off.",props:{layout:"horizontal",labelWidth:"1/3",onLabel:"Yes",offLabel:"No"}}),_t("canPulse","Can Pulse",t?.canPulse??!1,{hint:"When enabled, this output can pulse for a specified duration.",props:{layout:"horizontal",labelWidth:"1/3",onLabel:"Yes",offLabel:"No"}}),ie("minPulseSeconds","Min Pulse Seconds",t?.minPulseSeconds??0,{hint:"Minimum pulse duration in seconds.",validations:[{name:"min",validator:w.min(0),message:"Min pulse seconds must be 0 or greater"},{name:"max",validator:w.max(86400),message:"Min pulse seconds must be 86400 or less"}],props:{layout:"horizontal",labelWidth:"1/3",min:0,step:1}}),ie("maxPulseSeconds","Max Pulse Seconds",t?.maxPulseSeconds??0,{hint:"Maximum pulse duration in seconds.",validations:[{name:"min",validator:w.min(0),message:"Max pulse seconds must be 0 or greater"},{name:"max",validator:w.max(86400),message:"Max pulse seconds must be 86400 or less"}],props:{layout:"horizontal",labelWidth:"1/3",min:0,step:1}})],addPropertiesToDisplayText:(t,e)=>{this.addToggleProperty(t,e),this.addPulseProperty(t,e),this.addPulseDurationProperty(t,e)},addPropertiesToSaveObject:(t,e)=>{t.canPulse!==void 0&&(e.canPulse=t.canPulse),t.canToggle!==void 0&&(e.canToggle=t.canToggle),t.maxPulseSeconds!==void 0&&(e.maxPulseSeconds=t.maxPulseSeconds),t.minPulseSeconds!==void 0&&(e.minPulseSeconds=t.minPulseSeconds)},addPropertiesToItem:(t,e)=>{t.canPulse!==void 0&&(e.canPulse=!!t.canPulse),t.canToggle!==void 0&&(e.canToggle=!!t.canToggle),t.maxPulseSeconds!==void 0&&(e.maxPulseSeconds=Number(t.maxPulseSeconds)),t.minPulseSeconds!==void 0&&(e.minPulseSeconds=Number(t.minPulseSeconds))}}};constructor(){super(),U(()=>{this.columns=this.dynamicColumns()}),U(()=>{this.entity()&&!this.createMode()&&this.updateFormFields()})}operationRegistry=c(Q);deviceTypesService=c($e);confirmationService=c(Ee);entity=E(null);ioTypeKey=E.required();displayTitle=E.required();description=E.required();icon=E("pi pi-microchip");iconType=E("primeng");ioInputModalConfig;defaultIOConfig={additionalFields:[],getDefaultValues:()=>({}),getModalFields:()=>[],addPropertiesToDisplayText:()=>{},addPropertiesToSaveObject:()=>{},addPropertiesToItem:()=>{}};getCurrentIOConfig(){return this.ioTypeConfigs[this.ioTypeKey()]??this.defaultIOConfig}ioTypeDetails=v(()=>{let i=this.entity()?.ioCapabilities?.[this.ioTypeKey()];return T(i)||!Os(i)?[]:Object.entries(i).map(([o,r])=>{let u=r,b=f(u?.optional)?!!u.optional:!1,x={name:o,status:b?"Optional":"Required"};if(f(u))for(let[G,Z]of Object.entries(u))G!=="optional"&&(x[G]=Z);return x})});hasData=v(()=>this.ioTypeDetails().length>0);ioInputItems=v(()=>this.ioTypeDetails().map(t=>{let e={name:t.name,optional:t.status==="Optional"};return this.getCurrentIOConfig().addPropertiesToItem(t,e),e}));dynamicColumns=v(()=>{let t=this.ioTypeDetails();if(t.length===0)return[];let e=[{field:"name",header:"Name"},{field:"status",header:"Required/Optional"}],i=new Set;for(let o of t)for(let r of Object.keys(o))r!=="name"&&r!=="status"&&i.add(r);for(let o of Array.from(i).sort((r,u)=>r.localeCompare(u)))e.push({field:o,header:this.formatColumnHeader(o)});return e});formatColumnHeader(t){return t.replaceAll(/([A-Z])/g," $1").replaceAll("_"," ").toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}updateFormFields(){this.ioInputModalConfig={modalComponent:be,modalTitle:`Add ${this.displayTitle().toLowerCase().slice(0,-1)}`,defaultItemProvider:()=>this.getDefaultItem(),listItemFormatter:t=>({id:t.name,title:t.name,display:this.formatDisplayText(t),icon:this.icon()}),modalFields:t=>this.getModalFields(t),onSubmit:async t=>!!t.name?.trim(),onDeleteItem:async t=>new Promise(e=>{this.confirmationService.confirm({header:"Confirmation",message:`Are you sure you want to delete "${t.name}"?`,closable:!0,closeOnEscape:!0,icon:"pi pi-exclamation-triangle",rejectButtonProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptButtonProps:{label:"Delete",severity:"danger"},accept:async()=>{e(!0)},reject:()=>{e(!1)}})}),subHeader:"",showEditButton:!0},this.formFields=[De("ioInputs",this.displayTitle(),this.ioInputItems(),{layout:"horizontal",labelWidth:"1/3",name:"ioInputs",props:{modalConfig:this.ioInputModalConfig}})]}transformFormData(t){if(f(t.ioInputs)&&Array.isArray(t.ioInputs)){let e=t.ioInputs,i=this.entity(),o=this.ioTypeKey(),r=f(i?.ioCapabilities)?M({},i.ioCapabilities):{};f(r[o])||(r[o]={});let u={};for(let b of e)if(f(b.name)){let x={optional:b.optional};this.getCurrentIOConfig().addPropertiesToSaveObject(b,x),u[b.name]=x}return r[o]=u,{ioCapabilities:r}}return t}formatDisplayText(t){let e=[];return e.push(t.optional?"Optional":"Required"),this.getCurrentIOConfig().addPropertiesToDisplayText(t,e),e.join(", ")}addToggleProperty(t,e){t.canToggle!==void 0&&e.push(`Toggle: ${t.canToggle?"Yes":"No"}`)}addPulseProperty(t,e){t.canPulse!==void 0&&e.push(`Pulse: ${t.canPulse?"Yes":"No"}`)}addPulseDurationProperty(t,e){if(!this.shouldShowPulseDuration(t))return;let i=t.minPulseSeconds??0,o=t.maxPulseSeconds??0;i===o?e.push(`Duration: ${i}s`):e.push(`Duration: ${i}-${o}s`)}shouldShowPulseDuration(t){return t.canPulse===!0&&(f(t.minPulseSeconds)||f(t.maxPulseSeconds))}getDefaultItem(){let t={name:"",optional:!1},e=this.getCurrentIOConfig().getDefaultValues();return M(M({},t),e)}getModalFields(t){let e=[k("name","Input Name",t?.name??"",{placeholder:"Enter input name...",validations:[{name:"required",validator:w.required,message:"Input name is required"}]}),_t("optional","Optional",t?.optional??!1,{hint:"When enabled, this input is optional. When disabled, this input is required.",props:{layout:"horizontal",labelWidth:"1/3",onLabel:"Optional",offLabel:"Required"}})];return e.push(...this.getCurrentIOConfig().getModalFields(t)),e}getUpdateMethod(){return this.operationRegistry.getOperation("device-types","update")??((t,e)=>this.deviceTypesService.updateDeviceType(t,e).pipe(Je(i=>{this.entityChange.emit(i),this.broadcastService.broadcast("entity-updated",{entityType:"device-types",operation:"update",entityId:i.id,data:i})})))}ngOnInit(){this.updateFormFields()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-types-io-section"]],inputs:{entity:[1,"entity"],ioTypeKey:[1,"ioTypeKey"],displayTitle:[1,"displayTitle"],description:[1,"description"],icon:[1,"icon"],iconType:[1,"iconType"]},features:[O],decls:13,vars:6,consts:[[1,"pt-2","card"],[1,"flex","justify-start","items-center","p-2","mb-4"],[1,"custom-icon-svg","w-[2.5rem]","h-[2.5rem]"],[3,"class"],[1,"flex-1","pl-6"],[1,"flex","justify-between","items-center"],[1,"m-0","text-xl","font-semibold"],[1,"icon-light"],[3,"fields","actions"],[1,"io-capabilities-container"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formValueChange","formValidityChange","fields","actions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"flex","gap-4","items-center","no-io-message"],[1,"pi","pi-info-circle"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),h(2,I0,2,2,":svg:svg",2)(3,E0,1,3,"span",3),l(4,"div",4)(5,"div",5)(6,"h2",6),D(7),s(),h(8,M0,2,1,"div",7),s(),l(9,"span"),D(10),s()()(),h(11,R0,1,2,"app-dynamic-form",8),h(12,O0,3,1,"div",9),s()),e&2&&(d(2),y(i.iconType()==="svg"?2:3),d(5),J(i.displayTitle()),d(),y(!i.isFormEditable()&&!i.createMode()?8:-1),d(2),J(i.description()),d(),y(i.isFormEditable()?11:-1),d(),y(!i.isFormEditable()&&!i.createMode()?12:-1))},dependencies:[q,V],encapsulation:2})};function P0(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit features"))}function V0(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function L0(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.featuresDisplay())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Ta=class n extends B{operationRegistry=c(Q);deviceTypesService=c($e);toastService=c(Ze);confirmationService=c(Ee);constructor(){super(),this.columns=[{field:"key",header:"Property"},{field:"value",header:"Value"}],U(()=>{this.entity()&&!this.createMode()&&this.updateFormFields()})}entity=E(null);featureModalConfig;availableFeatures=["poll","toggle_outputs","upload_settings","garmin_fmi","voice_dialback","camera_take_still","device_console"];featuresDisplay=v(()=>{let e=this.entity()?.features;return T(e)?[{key:"Features",value:"No features configured"}]:[{key:"Features",value:Object.keys(e).filter(o=>f(e[o])).map(o=>this.getFeatureDisplayName(o)).join(", ")||"No features configured"}]});getFeatureDisplayName(t){return t.replaceAll("_"," ").replaceAll(/\b\w/g,e=>e.toUpperCase())}currentFeaturesList=v(()=>{let t=this.entity()?.features??{};return Object.keys(t).filter(e=>f(t[e])).map(e=>({key:e,enabled:!0}))});updateFormFields(){this.featureModalConfig={modalComponent:be,modalTitle:"Add Feature",defaultItemProvider:()=>this.getDefaultItem(),listItemFormatter:t=>({id:t.key,title:this.getFeatureDisplayName(t.key),display:t.key,icon:"pi pi-cog"}),modalFields:t=>this.getModalFields(t),onSubmit:async t=>t.key?.trim()?this.currentFeaturesList().find(i=>i.key===t.key)?(this.toastService.showError("Duplicate Feature","This feature is already enabled."),!1):!0:!1,onDeleteItem:async t=>new Promise(e=>{this.confirmationService.confirm({header:"Confirmation",message:`Are you sure you want to disable "${this.getFeatureDisplayName(t.key)}"?`,closable:!0,closeOnEscape:!0,icon:"pi pi-exclamation-triangle",rejectButtonProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptButtonProps:{label:"Disable",severity:"danger"},accept:()=>{e(!0)},reject:()=>{e(!1)}})}),subHeader:"",showEditButton:!1},this.formFields=[De("features","Features",this.currentFeaturesList(),{layout:"horizontal",labelWidth:"1/3",name:"features",props:{modalConfig:this.featureModalConfig}})]}getDefaultItem(){return{key:"",enabled:!0}}getModalFields(t){let e=new Set(this.currentFeaturesList().map(o=>o.key)),i=this.availableFeatures.filter(o=>!e.has(o)||o===t?.key).map(o=>({label:this.getFeatureDisplayName(o),value:o}));return[H("key","Feature",i,t?.key??"",{placeholder:"Select a feature...",validations:[{name:"required",validator:w.required,message:"Feature selection is required"}],props:{layout:"horizontal",labelWidth:"1/3"}})]}transformFormData(t){if(f(t.features)&&ci(t.features)){let e=t.features,i=this.entity(),o=f(i?.features)?M({},i.features):{};return this.updateFeaturesObjectFromFormArray(e,o),{features:o}}return t}updateFeaturesObjectFromFormArray(t,e){let i=new Set(t.map(o=>o.key));for(let o of Object.keys(e))i.has(o)||(e[o]=null);for(let o of t)f(o.key)&&(f(e[o.key])||(e[o.key]={settings:{},webhooks:null}))}getUpdateMethod(){return this.operationRegistry.getOperation("device-types","update")??((t,e)=>this.deviceTypesService.updateDeviceType(t,e).pipe(Je(i=>{this.entityChange.emit(i),this.broadcastService.broadcast("entity-updated",{entityType:"device-types",operation:"update",entityId:i.id,data:i})})))}ngOnInit(){this.updateFormFields()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-types-features-section"]],inputs:{entity:[1,"entity"]},features:[O],decls:12,vars:4,consts:[[1,"pt-2","card"],[1,"flex","justify-start","items-center","p-2","mb-4"],[1,"pi","pi-cog","!text-[2.5rem]"],[1,"flex-1","pl-6"],[1,"flex","justify-between","items-center"],[1,"m-0","text-xl","font-semibold"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Features"),s(),h(7,P0,2,1,"div",6),s(),l(8,"span"),D(9,"Enable/disable device features like remote control, voice calls, camera support, etc."),s()()(),h(10,V0,1,3,"app-dynamic-form",7),h(11,L0,1,4,"app-grid",8),s()),e&2&&(d(2),I("aria-label","Features icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,V],encapsulation:2})};var N0=["actionsTemplate"];function G0(n,t){if(n&1){let e=S();l(0,"div",6)(1,"button",8),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())})("keydown.space",function(o){return m(e),a().onEdit(),p(o.preventDefault())}),s()()}if(n&2){let e=a();d(),I("aria-label","Edit "+e.displayTitle().toLowerCase())}}function q0(n,t){if(n&1){let e=S();l(0,"div",7)(1,"app-dynamic-form",9),_("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))}),s()()}if(n&2){let e=a();d(),g("fields",e.formFields)("actions",e.actions)}}function U0(n,t){if(n&1&&(l(0,"p-accordion-panel",13)(1,"p-accordion-header"),D(2,"Settings"),s(),l(3,"p-accordion-content"),C(4,"app-grid",15),s()()),n&2){let e=a(4);d(4),g("data",e.settingsGridData())("columns",e.settingsColumns)("showGridLines",!1)("hideHeader",!1)}}function z0(n,t){if(n&1&&(l(0,"p-accordion-panel",14)(1,"p-accordion-header"),D(2,"Webhooks"),s(),l(3,"p-accordion-content"),C(4,"app-grid",15),s()()),n&2){let e=a(4);d(4),g("data",e.webhookGridData())("columns",e.webhookColumns)("showGridLines",!1)("hideHeader",!1)}}function j0(n,t){if(n&1&&(l(0,"p-accordion",11),h(1,U0,5,4,"p-accordion-panel",13),h(2,z0,5,4,"p-accordion-panel",14),s()),n&2){let e=a(3);g("multiple",!0)("value",e.getActiveValues()),d(),y(e.hasSettings()?1:-1),d(),y(e.hasWebhook()?2:-1)}}function B0(n,t){if(n&1&&(l(0,"div",12),C(1,"i",16),l(2,"p"),D(3),s()()),n&2){let e=a(3);d(3),ye(" No settings or webhooks have been configured for this ",e.displayTitle()," feature. ")}}function H0(n,t){if(n&1&&h(0,j0,3,4,"p-accordion",11)(1,B0,4,1,"div",12),n&2){let e=a(2);y(e.hasSettings()||e.hasWebhook()?0:1)}}function $0(n,t){if(n&1&&(l(0,"div",10),C(1,"i",16),l(2,"p"),D(3),s()()),n&2){let e=a(2);d(3),ye("No data available for ",e.displayTitle().toLowerCase(),".")}}function W0(n,t){if(n&1&&(l(0,"div",7),h(1,H0,2,1)(2,$0,4,1,"div",10),s()),n&2){let e=a();d(),y(e.hasData()?1:2)}}var wa=class n extends B{constructor(){super(),this.columns=[{field:"key",header:"Property"},{field:"value",header:"Value"}],this.settingsColumns=[{field:"setting",header:"Setting"},{field:"value",header:"Value"}],this.webhookColumns=[{field:"setting",header:"Setting"},{field:"value",header:"Value"}],U(()=>{this.entity()&&!this.createMode()&&this.updateFormFields()})}operationRegistry=c(Q);deviceTypesService=c($e);confirmationService=c(Ee);actionsTemplate;entity=E(null);settingsColumns=[];webhookColumns=[];settingsModalConfig;webhookModalConfig;featureKey=E.required();displayTitle=E.required();featureData=v(()=>{let e=this.entity()?.features,i=this.featureKey();return T(e)||!i?null:e[i]??null});featureDetails=v(()=>{let t=this.featureData();if(T(t))return[];let e=[{key:"Feature",value:this.displayTitle()}];if(f(t.settings)){let i=Object.keys(t.settings).length;e.push({key:"Settings",value:i>0?`${i} configured`:"None configured"})}else e.push({key:"Settings",value:"None configured"});if(f(t.webhook)&&t.webhook!==null){let i=Object.keys(t.webhook).length;e.push({key:"Webhook",value:i>0?`${i} properties configured`:"None configured"})}else e.push({key:"Webhook",value:"None configured"});return e});hasData=v(()=>this.featureData()!==null);settingsGridData=v(()=>{let t=this.featureData();return T(t?.settings)?[]:Object.entries(t.settings).map(([e,i])=>({setting:e,value:typeof i=="object"&&i!==null?JSON.stringify(i):String(i)}))});hasSettings=v(()=>this.settingsGridData().length>0);webhookGridData=v(()=>{let t=this.featureData();return T(t?.webhook)||t.webhook===null?[]:Object.entries(t.webhook).map(([e,i])=>({setting:e,value:typeof i=="object"&&i!==null?JSON.stringify(i):String(i)}))});hasWebhook=v(()=>this.webhookGridData().length>0);settingsItems=v(()=>{let t=this.featureData();return T(t?.settings)?[]:Object.entries(t.settings).map(([e,i])=>({key:e,value:typeof i=="object"&&i!==null?JSON.stringify(i):String(i)}))});webhookItems=v(()=>{let t=this.featureData();return T(t?.webhook)||t.webhook===null?[]:Object.entries(t.webhook).map(([e,i])=>({key:e,value:typeof i=="object"&&i!==null?JSON.stringify(i):String(i)}))});updateFormFields(){this.settingsModalConfig={modalComponent:be,modalTitle:"Manage Settings",defaultItemProvider:()=>({key:"",value:""}),listItemFormatter:t=>({id:t.key,title:t.key,display:`${t.key}: ${t.value}`,icon:"pi pi-cog"}),modalFields:t=>[k("key","Setting Key",t?.key??"",{placeholder:"Enter setting key...",validations:[{name:"required",validator:w.required,message:"Setting key is required"}]}),H("value","Setting Value",[{label:"True",value:"true"},{label:"False",value:"false"}],t?.value??"true",{placeholder:"Select a value...",validations:[{name:"required",validator:w.required,message:"Setting value is required"}]})],onSubmit:async t=>!(!t.key?.trim()||!t.value?.trim()),onDeleteItem:async t=>new Promise(e=>{this.confirmationService.confirm({header:"Confirmation",message:`Are you sure you want to delete setting "${t.key}"?`,closable:!0,closeOnEscape:!0,icon:"pi pi-exclamation-triangle",rejectButtonProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptButtonProps:{label:"Delete",severity:"danger"},accept:()=>e(!0),reject:()=>e(!1)})}),subHeader:"Configure feature settings",showEditButton:!0},this.webhookModalConfig={modalComponent:be,modalTitle:"Manage Webhooks",defaultItemProvider:()=>({key:"",value:""}),listItemFormatter:t=>({id:t.key,title:t.key,display:`${t.key}: ${t.value}`,icon:"pi pi-send"}),modalFields:t=>[k("key","Webhook Key",t?.key??"",{placeholder:"Enter webhook key...",validations:[{name:"required",validator:w.required,message:"Webhook key is required"}]}),k("value","Webhook Value",t?.value??"",{placeholder:"Enter webhook value...",validations:[{name:"required",validator:w.required,message:"Webhook value is required"}]})],onSubmit:async t=>!(!t.key?.trim()||!t.value?.trim()),onDeleteItem:async t=>new Promise(e=>{this.confirmationService.confirm({header:"Confirmation",message:`Are you sure you want to delete webhook "${t.key}"?`,closable:!0,closeOnEscape:!0,icon:"pi pi-exclamation-triangle",rejectButtonProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptButtonProps:{label:"Delete",severity:"danger"},accept:()=>e(!0),reject:()=>e(!1)})}),subHeader:"Configure feature webhooks",showEditButton:!0},this.formFields=[],this.formFields.push(De("settings","Settings",this.settingsItems(),{layout:"horizontal",labelWidth:"1/3",name:"settings",props:{modalConfig:this.settingsModalConfig}}),De("webhooks","Webhooks",this.webhookItems(),{layout:"horizontal",labelWidth:"1/3",name:"webhooks",props:{modalConfig:this.webhookModalConfig}}))}transformFormData(t){let e=this.entity(),i=this.featureKey(),o=f(e)&&f(e.features)?e.features[i]:void 0,r=e?.features?M({},e.features):{},u=this.formatSettings(t),b=this.formatWebhooks(t);return r[i]={settings:ce(u)?o?.settings??{}:u,webhook:f(b)?b:o?.webhook??void 0},{features:r}}formatSettings(t){let e={};if(f(t.settings)&&Array.isArray(t.settings)){let i=t.settings;for(let o of i)if(f(o.key)){let r;try{r=JSON.parse(o.value)}catch{r=o.value}e[o.key]=r}}return e}formatWebhooks(t){let e={};if(f(t.webhooks)&&Array.isArray(t.webhooks)){let i=t.webhooks;if(i.length===0)return null;for(let o of i)if(f(o.key)){let r;try{r=JSON.parse(o.value)}catch{r=o.value}e[o.key]=r}}return Object.keys(e).length>0?e:null}getUpdateMethod(){return this.operationRegistry.getOperation("device-types","update")??((t,e)=>this.deviceTypesService.updateDeviceType(t,e).pipe(Je(i=>{this.entityChange.emit(i),this.broadcastService.broadcast("entity-updated",{entityType:"device-types",operation:"update",entityId:i.id,data:i})})))}ngOnInit(){this.updateFormFields()}onCancel(){this.cancelEdit()}onSave(){let t=this.getFormGroup();t&&this.onSubmit(t)}getActiveValues=v(()=>{let t=[];return this.hasSettings()&&t.push("settings"),this.hasWebhook()&&t.push("webhooks"),t});static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-types-feature"]],viewQuery:function(e,i){if(e&1&&pe(N0,7),e&2){let o;le(o=de())&&(i.actionsTemplate=o.first)}},inputs:{entity:[1,"entity"],featureKey:[1,"featureKey"],displayTitle:[1,"displayTitle"]},features:[O],decls:12,vars:6,consts:[[1,"pt-2","card"],[1,"flex","justify-start","items-center","p-2","mb-4"],[1,"pi","pi-cog","!text-[2.5rem]"],[1,"flex-1","pl-6"],[1,"flex","justify-between","items-center"],[1,"m-0","text-xl","font-semibold"],[1,"icon-light"],[1,"ml-16"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter","keydown.space"],[3,"formValueChange","formValidityChange","fields","actions"],[1,"no-accessory-message"],[3,"multiple","value"],[1,"flex","gap-2","items-center","no-accessory-content-message"],["value","settings"],["value","webhooks"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-info-circle"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6),s(),h(7,G0,2,1,"div",6),s(),l(8,"span"),D(9),s()()(),h(10,q0,2,2,"div",7),h(11,W0,3,1,"div",7),s()),e&2&&(d(2),I("aria-label",i.displayTitle()+" icon"),d(4),J(i.displayTitle()),d(),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),ye("Configure ",i.displayTitle().toLowerCase()," feature settings and webhooks."),d(),y(i.isFormEditable()?10:-1),d(),y(i.isFormEditable()?-1:11))},dependencies:[V,q,Ut,qt,Gt,hi,yi],encapsulation:2})};function Z0(n,t){if(n&1){let e=S();l(0,"div",6)(1,"button",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())})("keydown.space",function(o){return m(e),a().onEdit(),p(o.preventDefault())}),s()()}if(n&2){let e=a();d(),I("aria-label","Edit "+e.displayTitle().toLowerCase())}}function K0(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)}}function Q0(n,t){if(n&1&&C(0,"app-grid",11),n&2){let e=a(2);g("data",e.fieldDetails())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}function Y0(n,t){if(n&1&&(l(0,"div",12),C(1,"i",13),l(2,"p"),D(3),s()()),n&2){let e=a(2);d(3),ye("No data available for ",e.displayTitle().toLowerCase(),".")}}function J0(n,t){if(n&1&&(l(0,"div",8),h(1,Q0,1,4,"app-grid",11)(2,Y0,4,1,"div",12),s()),n&2){let e=a();d(),y(e.hasData()?1:2)}}var xa=class n extends B{constructor(){super(),this.columns=[{field:"key",header:"Property"},{field:"value",header:"Value"}],U(()=>{this.entity()&&!this.createMode()&&this.updateFormFields()})}operationRegistry=c(Q);deviceTypesService=c($e);entity=E(null);fieldId=E.required();displayTitle=E.required();parsedDefinition=v(()=>{let e=this.entity()?.settingsDefinition;if(T(e)||e.trim()==="")return null;try{return JSON.parse(e)}catch{return null}});fieldData=v(()=>{let t=this.parsedDefinition(),e=this.fieldId();if(T(t)||!e)return null;if(f(t.groups)&&Array.isArray(t.groups)){for(let i of t.groups)if(f(i.fields)&&Array.isArray(i.fields)){let o=i.fields.find(r=>r.id===e);if(f(o))return o}}return null});fieldDetails=v(()=>{let t=this.fieldData();if(T(t))return[];let e=[{key:"ID",value:t.id??"Unknown"},{key:"Title",value:t.title??"Untitled Field"},{key:"Type",value:t.type??"text"}];return f(t.unit)&&typeof t.unit=="string"&&t.unit.trim()!==""&&e.push({key:"Unit",value:t.unit}),f(t.min)&&e.push({key:"Minimum Value",value:t.min.toString()}),f(t.max)&&e.push({key:"Maximum Value",value:t.max.toString()}),f(t.width)&&e.push({key:"Width",value:t.width.toString()}),f(t.defaultValue)&&e.push({key:"Default Value",value:t.defaultValue.toString()}),f(t.placeholder)&&typeof t.placeholder=="string"&&t.placeholder.trim()!==""&&e.push({key:"Placeholder",value:t.placeholder}),f(t.description)&&typeof t.description=="string"&&t.description.trim()!==""&&e.push({key:"Description",value:t.description}),f(t.required)&&e.push({key:"Required",value:t.required===!0?"Yes":"No"}),e});hasData=v(()=>this.fieldData()!==null);updateFormFields(){let t=this.fieldData();if(T(t)){this.formFields=[];return}this.formFields=[],f(t.title)&&this.formFields.push(k("title","Title",t.title?.toString()??"",{validations:[{name:"required",validator:w.required,message:"Title is required"}]})),f(t.type)&&this.formFields.push(k("type","Type",t.type?.toString()??"",{validations:[{name:"required",validator:w.required,message:"Type is required"}]})),f(t.unit)&&this.formFields.push(k("unit","Unit",t.unit?.toString()??"")),f(t.min)&&this.formFields.push(k("min","Minimum Value",t.min?.toString()??"",{validations:[{name:"pattern",validator:w.pattern(/^-?\d+(\.\d+)?$/),message:"Minimum value must be a valid number"}]})),f(t.max)&&this.formFields.push(k("max","Maximum Value",t.max?.toString()??"",{validations:[{name:"pattern",validator:w.pattern(/^-?\d+(\.\d+)?$/),message:"Maximum value must be a valid number"}]})),f(t.width)&&this.formFields.push(k("width","Width",t.width?.toString()??"",{validations:[{name:"pattern",validator:w.pattern(/^\d+$/),message:"Width must be a positive integer"}]})),f(t.defaultValue)&&this.formFields.push(k("defaultValue","Default Value",t.defaultValue?.toString()??"")),f(t.placeholder)&&this.formFields.push(k("placeholder","Placeholder",t.placeholder?.toString()??"")),f(t.description)&&this.formFields.push(k("description","Description",t.description?.toString()??"")),f(t.required)&&this.formFields.push(_t("required","Required",t.required===!0))}transformFormData(t){let e=this.entity(),i=this.fieldId();if(T(e))return{};let o=this.parseSettingsDefinition(e);return T(o)?{}:(this.updateFieldInDefinition(o,i,t),{settingsDefinition:JSON.stringify(this.parseSettingsDefinition(e))})}parseSettingsDefinition(t){try{let e=t.settingsDefinition;return T(e)||e.trim()===""?{}:JSON.parse(e)}catch{return console.error("Failed to parse settings definition"),null}}updateFieldInDefinition(t,e,i){if(!this.hasValidGroups(t))return!1;let o=t.groups;for(let r of o)if(this.updateFieldInGroup(r,e,i))return!0;return!1}hasValidGroups(t){return f(t.groups)&&Array.isArray(t.groups)}updateFieldInGroup(t,e,i){if(!this.isValidGroup(t))return!1;let o=t.fields,r=o.findIndex(b=>b.id===e);if(r===-1)return!1;let u=this.applyFormDataToField(o[r],i);return o[r]=u,!0}isValidGroup(t){return f(t)&&typeof t=="object"&&f(t.fields)&&Array.isArray(t.fields)}applyFormDataToField(t,e){let i=M({},t);for(let[o,r]of Object.entries(e))o!=="id"&&(i[o]=this.convertFormValue(o,r));return i}convertFormValue(t,e){if(this.isNumericField(t)){let i=Number(e);return Number.isNaN(i)?e:i}return t==="required"?e==="true"||e===!0:e}isNumericField(t){return["min","max","width","defaultValue"].includes(t)}getUpdateMethod(){return this.operationRegistry.getOperation("device-types","update")??((t,e)=>this.deviceTypesService.updateDeviceType(t,e).pipe(Je(i=>{this.entityChange.emit(i),this.broadcastService.broadcast("entity-updated",{entityType:"device-types",operation:"update",entityId:i.id,data:i})})))}ngOnInit(){this.updateFormFields()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-types-setting"]],inputs:{entity:[1,"entity"],fieldId:[1,"fieldId"],displayTitle:[1,"displayTitle"]},features:[O],decls:12,vars:6,consts:[[1,"pt-2","card"],[1,"flex","justify-start","items-center","p-2","mb-4"],[1,"pi","pi-cog","!text-[2.5rem]"],[1,"flex-1","pl-6"],[1,"flex","justify-between","items-center"],[1,"m-0","text-xl","font-semibold"],[1,"icon-light"],[3,"fields","actions"],[1,"settings-field-container"],["tabIndex","0",1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter","keydown.space"],[3,"formValueChange","formValidityChange","fields","actions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"no-field-message"],[1,"pi","pi-info-circle"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6),s(),h(7,Z0,2,1,"div",6),s(),l(8,"span"),D(9),s()()(),h(10,K0,1,2,"app-dynamic-form",7),h(11,J0,3,1,"div",8),s()),e&2&&(d(2),I("aria-label",i.displayTitle()+" icon"),d(4),J(i.displayTitle()),d(),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),ye("Configure ",i.displayTitle().toLowerCase()," field settings and properties."),d(),y(i.isFormEditable()?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[V,q],encapsulation:2})};function X0(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit settings"))}function e_(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function t_(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.settingsDisplay())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Fa=class n extends B{operationRegistry=c(Q);deviceTypesService=c($e);toastService=c(Ze);confirmationService=c(Ee);constructor(){super(),this.columns=[{field:"key",header:"Property"},{field:"value",header:"Value"}],U(()=>{this.entity()&&!this.createMode()&&this.updateFormFields()})}entity=E(null);settingFieldModalConfig;settingsDisplay=v(()=>{let e=this.entity()?.settingsDefinition;if(T(e)||e.trim()==="")return[{key:"Settings",value:"No settings configured"}];try{let i=JSON.parse(e),o=this.extractFieldsFromDefinition(i);if(o.length===0)return[{key:"Settings",value:"No settings configured"}];let r=o.map(u=>u.title||u.id).join(", ");return[{key:"Settings",value:`${o.length} field(s): ${r}`}]}catch{return[{key:"Settings",value:"Invalid settings definition"}]}});currentSettingsList=v(()=>{let e=this.entity()?.settingsDefinition;if(T(e)||e.trim()==="")return[];try{let i=JSON.parse(e);return this.extractFieldsFromDefinition(i)}catch{return[]}});extractFieldsFromDefinition(t){let e=[];if(f(t.groups)&&Array.isArray(t.groups)){for(let i of t.groups)if(f(i.fields)&&Array.isArray(i.fields))for(let o of i.fields)e.push(o)}return e}updateFormFields(){this.settingFieldModalConfig={modalComponent:be,modalTitle:"Add Setting Field",defaultItemProvider:()=>this.getDefaultItem(),listItemFormatter:t=>({id:t.id,title:t.title||t.id,display:`${t.title} (${t.type})`,icon:"pi pi-sliders-h"}),modalFields:t=>this.getModalFields(t),onSubmit:async t=>!t.id?.trim()||!t.title?.trim()?!1:this.currentSettingsList().find(i=>i.id===t.id)?(this.toastService.showError("Duplicate Setting","This setting ID is already in use."),!1):!0,onDeleteItem:async t=>new Promise(e=>{this.confirmationService.confirm({header:"Confirmation",message:`Are you sure you want to remove "${t.title}"?`,closable:!0,closeOnEscape:!0,icon:"pi pi-exclamation-triangle",rejectButtonProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptButtonProps:{label:"Remove",severity:"danger"},accept:()=>{e(!0)},reject:()=>{e(!1)}})}),subHeader:"",showEditButton:!1},this.formFields=[De("settings","Settings",this.currentSettingsList(),{layout:"horizontal",labelWidth:"1/3",name:"settings",props:{modalConfig:this.settingFieldModalConfig}})]}getDefaultItem(){return{id:"",title:"",type:"text",values:[],unit:"",min:void 0,max:void 0,width:void 0,defaultValue:"",placeholder:"",description:"",required:!1}}getModalFields(t){return[k("id","Field ID",t?.id??"",{placeholder:"Enter field ID...",hint:"Unique identifier for this field",validations:[{name:"required",validator:w.required,message:"Field ID is required"},{name:"pattern",validator:w.pattern(/^[a-zA-Z0-9_]+$/),message:"ID must be letters, numbers, and underscores only"}],props:{layout:"horizontal",labelWidth:"1/3"}}),k("title","Field Title",t?.title??"",{placeholder:"Enter field title...",hint:"Display name for this field",validations:[{name:"required",validator:w.required,message:"Field Title is required"}],props:{layout:"horizontal",labelWidth:"1/3"}}),H("type","Field Type",[{label:"Text",value:"text"},{label:"Number",value:"number"},{label:"Combo/Dropdown",value:"combo"},{label:"Boolean",value:"boolean"}],t?.type??"text",{hint:"Select the input type for this field",validations:[{name:"required",validator:w.required,message:"Field Type is required"}],props:{layout:"horizontal",labelWidth:"1/3"}}),k("unit","Unit",t?.unit??"",{placeholder:"e.g., millimeters, seconds, etc.",hint:"Unit of measurement for number fields",props:{layout:"horizontal",labelWidth:"1/3"}}),ie("min","Minimum Value",t?.min,{placeholder:"Enter minimum value...",hint:"Minimum allowed value for number fields",props:{layout:"horizontal",labelWidth:"1/3"}}),ie("max","Maximum Value",t?.max,{placeholder:"Enter maximum value...",hint:"Maximum allowed value for number fields",props:{layout:"horizontal",labelWidth:"1/3"}}),ie("width","Field Width",t?.width,{placeholder:"Enter field width...",hint:"Display width for the input field",props:{layout:"horizontal",labelWidth:"1/3"}}),k("defaultValue","Default Value",f(t?.defaultValue)?String(t?.defaultValue):"",{placeholder:"Enter default value...",hint:"Default value when field is empty",props:{layout:"horizontal",labelWidth:"1/3"}}),k("placeholder","Placeholder",t?.placeholder??"",{placeholder:"Enter placeholder text...",hint:"Placeholder text shown in the field",props:{layout:"horizontal",labelWidth:"1/3"}}),k("description","Description",t?.description??"",{placeholder:"Enter description...",hint:"Additional description for the field",props:{layout:"horizontal",labelWidth:"1/3"}})]}transformFormData(t){if(f(t.settings)&&ci(t.settings)){let i={groups:[{fields:t.settings}]};return{settingsDefinition:JSON.stringify(i)}}return t}getUpdateMethod(){return this.operationRegistry.getOperation("device-types","update")??((t,e)=>this.deviceTypesService.updateDeviceType(t,e).pipe(Je(i=>{this.entityChange.emit(i),this.broadcastService.broadcast("entity-updated",{entityType:"device-types",operation:"update",entityId:i.id,data:i})})))}ngOnInit(){this.updateFormFields()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-types-settings-section"]],inputs:{entity:[1,"entity"]},features:[O],decls:12,vars:4,consts:[[1,"pt-2","card"],[1,"flex","justify-start","items-center","p-2","mb-4"],[1,"pi","pi-sliders-h","!text-[2.5rem]"],[1,"flex-1","pl-6"],[1,"flex","justify-between","items-center"],[1,"m-0","text-xl","font-semibold"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Settings"),s(),h(7,X0,2,1,"div",6),s(),l(8,"span"),D(9,"Configure custom settings fields for this device type."),s()()(),h(10,e_,1,3,"app-dynamic-form",7),h(11,t_,1,4,"app-grid",8),s()),e&2&&(d(2),I("aria-label","Settings icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,V],encapsulation:2})};function i_(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}n&2&&(d(),I("aria-label","Edit accessories"))}function n_(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formSubmit",function(o){m(e);let r=a();return p(r.onSubmit(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))})("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)("hideActions",e.createMode())}}function o_(n,t){if(n&1&&C(0,"app-grid",8),n&2){let e=a();g("data",e.accessoriesDisplay())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Ia=class n extends B{operationRegistry=c(Q);deviceTypesService=c($e);toastService=c(Ze);confirmationService=c(Ee);constructor(){super(),this.columns=[{field:"key",header:"Property"},{field:"value",header:"Value"}],U(()=>{this.entity()&&!this.createMode()&&this.updateFormFields()})}entity=E(null);accessoryModalConfig;accessoriesDisplay=v(()=>{let e=this.entity()?.accessories;return T(e)?[{key:"Accessories",value:"No accessories configured"}]:[{key:"Accessories",value:Object.entries(e).filter(([o])=>f(e[o])).map(([o,r])=>r.name??o).join(", ")||"No accessories configured"}]});getAccessoryDisplayName(t,e){return f(e)&&e.trim()!==""?e:t}currentAccessoriesList=v(()=>{let t=this.entity()?.accessories??{};return Object.entries(t).filter(([e])=>f(t[e])).map(([e,i])=>({key:e,name:i.name??""}))});updateFormFields(){this.accessoryModalConfig={modalComponent:be,modalTitle:"Add Accessory",defaultItemProvider:()=>this.getDefaultItem(),listItemFormatter:t=>({id:t.key,title:this.getAccessoryDisplayName(t.key,t.name),display:t.key,icon:"pi pi-th-large"}),modalFields:t=>this.getModalFields(t),onSubmit:async t=>t.key?.trim()?this.currentAccessoriesList().find(i=>i.key===t.key)?(this.toastService.showError("Duplicate Accessory","This accessory key is already in use."),!1):!0:!1,onDeleteItem:async t=>new Promise(e=>{this.confirmationService.confirm({header:"Confirmation",message:`Are you sure you want to remove "${this.getAccessoryDisplayName(t.key,t.name)}"?`,closable:!0,closeOnEscape:!0,icon:"pi pi-exclamation-triangle",rejectButtonProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptButtonProps:{label:"Remove",severity:"danger"},accept:()=>{e(!0)},reject:()=>{e(!1)}})}),subHeader:"",showEditButton:!0},this.formFields=[De("accessories","Accessories",this.currentAccessoriesList(),{layout:"horizontal",labelWidth:"1/3",name:"accessories",props:{modalConfig:this.accessoryModalConfig}})]}getDefaultItem(){return{key:"",name:""}}getModalFields(t){return[k("key","Accessory Key",t?.key??"",{placeholder:"Enter accessory key...",hint:'Unique identifier for this accessory (e.g., "mritagreader")',validations:[{name:"required",validator:w.required,message:"Accessory key is required"},{name:"pattern",validator:w.pattern(/^[a-z0-9_]+$/),message:"Key must be lowercase letters, numbers, and underscores only"}],props:{layout:"horizontal",labelWidth:"1/3"}}),k("name","Display Name",t?.name??"",{placeholder:"Enter display name...",hint:"Human-readable name for this accessory",validations:[{name:"required",validator:w.required,message:"Display name is required"}],props:{layout:"horizontal",labelWidth:"1/3"}})]}transformFormData(t){if(f(t.accessories)&&ci(t.accessories)){let e=t.accessories,i=this.entity(),o=f(i?.accessories)?M({},i.accessories):{};return this.syncAccessoriesToFormResponse(e,o),{accessories:o}}return t}syncAccessoriesToFormResponse(t,e){let i=new Set(t.map(o=>o.key));for(let o of Object.keys(e))i.has(o)||(e[o]=null);for(let o of t)f(o.key)&&(f(e[o.key])?e[o.key]=ee(M({},e[o.key]),{name:o.name}):e[o.key]={name:o.name,ioCapabilities:{},settingsDefinition:null,features:{}})}getUpdateMethod(){return this.operationRegistry.getOperation("device-types","update")??((t,e)=>this.deviceTypesService.updateDeviceType(t,e).pipe(Je(i=>{this.entityChange.emit(i),this.broadcastService.broadcast("entity-updated",{entityType:"device-types",operation:"update",entityId:i.id,data:i})})))}ngOnInit(){this.updateFormFields()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-types-accessories-section"]],inputs:{entity:[1,"entity"]},features:[O],decls:12,vars:4,consts:[[1,"pt-2","card"],[1,"flex","justify-start","items-center","p-2","mb-4"],[1,"pi","pi-th-large","!text-[2.5rem]"],[1,"flex-1","pl-6"],[1,"flex","justify-between","items-center"],[1,"m-0","text-xl","font-semibold"],[1,"icon-light"],[3,"fields","actions","hideActions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formSubmit","formValidityChange","formValueChange","fields","actions","hideActions"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Accessories"),s(),h(7,i_,2,1,"div",6),s(),l(8,"span"),D(9,"Configure device accessories like tag readers, sensors, and other peripheral devices."),s()()(),h(10,n_,1,3,"app-dynamic-form",7),h(11,o_,1,4,"app-grid",8),s()),e&2&&(d(2),I("aria-label","Accessories icon"),d(5),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()||i.createMode()&&i.formFields.length?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,V],encapsulation:2})};var r_=()=>[],a_=(n,t)=>t.fieldKey;function s_(n,t){if(n&1){let e=S();l(0,"div",6)(1,"button",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())})("keydown.space",function(o){return m(e),a().onEdit(),p(o.preventDefault())}),s()()}if(n&2){let e=a();d(),I("aria-label","Edit "+e.displayTitle().toLowerCase())}}function l_(n,t){if(n&1){let e=S();l(0,"div",7)(1,"app-dynamic-form",10),_("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))}),s()()}if(n&2){let e=a();d(),g("fields",e.formFields)("actions",e.actions)}}function d_(n,t){if(n&1&&(l(0,"p-accordion-panel",14)(1,"p-accordion-header"),D(2,"IO Capabilities"),s(),l(3,"p-accordion-content"),C(4,"app-grid",17),s()()),n&2){let e=a(4);d(4),g("data",e.ioCapabilitiesGridData())("columns",e.ioCapabilitiesColumns)("showGridLines",!1)("hideHeader",!1)}}function c_(n,t){if(n&1&&(l(0,"div",19)(1,"h4",20),D(2),s(),C(3,"app-grid",21),s()),n&2){let e=t.$implicit,i=a(5);d(2),ye(" ",e.fieldTitle," "),d(),g("data",e.gridData)("columns",i.fieldGridColumns)("showGridLines",!1)("hideHeader",!1)}}function m_(n,t){if(n&1&&(l(0,"p-accordion-panel",15)(1,"p-accordion-header"),D(2,"Settings Definition"),s(),l(3,"p-accordion-content",18),Ue(4,c_,4,5,"div",19,a_),s()()),n&2){let e=a(4);d(4),ze(e.settingsFieldsGridData())}}function p_(n,t){if(n&1&&(l(0,"p-accordion-panel",16)(1,"p-accordion-header"),D(2,"Features"),s(),l(3,"p-accordion-content"),C(4,"app-grid",17),s()()),n&2){let e=a(4);d(4),g("data",e.featuresGridData())("columns",e.featuresColumns)("showGridLines",!1)("hideHeader",!1)}}function u_(n,t){if(n&1&&(l(0,"p-accordion",12),h(1,d_,5,4,"p-accordion-panel",14),h(2,m_,6,0,"p-accordion-panel",15),h(3,p_,5,4,"p-accordion-panel",16),s()),n&2){let e=a(3);g("multiple",e.isFormEditable())("value",e.isFormEditable()?e.getActiveValues():sn(5,r_)),d(),y(e.hasIoCapabilities()?1:-1),d(),y(e.hasSettingsDefinition()?2:-1),d(),y(e.hasFeatures()?3:-1)}}function f_(n,t){if(n&1&&(l(0,"div",13),C(1,"i",22),l(2,"p"),D(3),s()()),n&2){let e=a(3);d(3),ye(" No IO capabilities, features, or settings have been configured for this ",e.displayTitle()," accessory. ")}}function g_(n,t){if(n&1&&h(0,u_,4,6,"p-accordion",12)(1,f_,4,1,"div",13),n&2){let e=a(2);y(e.hasIoCapabilities()||e.hasSettingsDefinition()||e.hasFeatures()?0:1)}}function h_(n,t){if(n&1&&(l(0,"div",11),C(1,"i",23),l(2,"p"),D(3),s()()),n&2){let e=a(2);d(3),ye("No data available for ",e.displayTitle().toLowerCase(),".")}}function y_(n,t){if(n&1&&(l(0,"div",8),h(1,g_,2,1)(2,h_,4,1,"div",11),s()),n&2){let e=a();d(),y(e.hasData()?1:2)}}var Ea=class n extends B{constructor(){super(),this.columns=[{field:"key",header:"Property"},{field:"value",header:"Value"}],this.ioCapabilitiesColumns=[{field:"type",header:"Type"},{field:"details",header:"Available Inputs"}],this.settingsDefinitionColumns=[{field:"setting",header:"Setting"},{field:"value",header:"Value"}],this.featuresColumns=[{field:"feature",header:"Feature"},{field:"value",header:"Value"},{field:"type",header:"Type"},{field:"enabled",header:"Enabled"}],U(()=>{this.entity()&&!this.createMode()&&this.updateFormFields()})}operationRegistry=c(Q);deviceTypesService=c($e);confirmationService=c(Ee);entity=E(null);ioCapabilitiesColumns=[];settingsDefinitionColumns=[];featuresColumns=[];ioTypeModalConfig;ioCapabilityModalConfig;settingsModalConfig;featuresModalConfig;accessoryKey=E.required();displayTitle=E.required();accessoryData=v(()=>{let e=this.entity()?.accessories,i=this.accessoryKey();return T(e)||!i?null:e[i]??null});accessoryDetails=v(()=>{let t=this.accessoryData();if(T(t))return[];let e=[{key:"Name",value:f(t.name)&&t.name.trim()!==""?t.name:"Unnamed Accessory"}];if(f(t.settingsDefinition)?e.push({key:"Settings Definition",value:f(t.settingsDefinition)&&t.settingsDefinition.trim()!==""?"Configured":"Not configured"}):e.push({key:"Settings Definition",value:"None"}),f(t.ioCapabilities)){let i=this.getIOCapabilitiesSummary(t.ioCapabilities);e.push({key:"I/O Capabilities",value:i||"None configured"})}else e.push({key:"I/O Capabilities",value:"None"});if(f(t.features)){let i=Object.keys(t.features).length,o=Object.keys(t.features).join(", ");e.push({key:"Features",value:i>0?`${i} features: ${o}`:"None"})}else e.push({key:"Features",value:"None"});return e});hasData=v(()=>this.accessoryData()!==null);ioCapabilitiesGridData=v(()=>{let t=this.accessoryData();if(T(t?.ioCapabilities))return[];let e=t.ioCapabilities,i=[],o=[{key:"digital_input",label:"Digital Input"},{key:"digital_output",label:"Digital Output"},{key:"analog_input",label:"Analog Input"},{key:"temperature_input",label:"Temperature Input"},{key:"can_input",label:"CAN Input"},{key:"counter_input",label:"Counter Input"},{key:"camera_input",label:"Camera Input"},{key:"value_input",label:"Value Input"}];for(let r of o){let u=e[r.key];if(f(u)&&Object.keys(u).length>0){let x=Object.keys(u).join(", ");i.push({type:r.label,details:x})}}return i});ioTypeItems=v(()=>{let t=this.accessoryData();if(T(t?.ioCapabilities))return[];let e=t.ioCapabilities,i=[],o=[{key:"digital_input",label:"Digital Input"},{key:"digital_output",label:"Digital Output"},{key:"analog_input",label:"Analog Input"},{key:"temperature_input",label:"Temperature Input"},{key:"can_input",label:"CAN Input"},{key:"counter_input",label:"Counter Input"},{key:"camera_input",label:"Camera Input"},{key:"value_input",label:"Value Input"}];for(let r of o){let u=e[r.key];if(f(u)){let b=[];for(let[x,G]of Object.entries(u))b.push({key:x,optional:G?.optional??!1});i.push({type:r.key,label:r.label,instances:b})}}return i});hasIoCapabilities=v(()=>this.ioCapabilitiesGridData().length>0);settingsDefinitionGridData=v(()=>{let t=this.accessoryData();if(T(t?.settingsDefinition))return[];try{let e=JSON.parse(String(t.settingsDefinition));return Object.entries(e).map(([i,o])=>({setting:i,value:typeof o=="object"&&o!==null?(()=>{try{return JSON.stringify(o)}catch{return"[object Object]"}})():String(o)}))}catch{return[{setting:"Raw Definition",value:String(t.settingsDefinition),type:"string"}]}});settingsItems=v(()=>{let t=this.accessoryData();if(T(t?.settingsDefinition))return[];try{let e=JSON.parse(String(t.settingsDefinition)),i=[];for(let o of e.fields)i.push(o);return i}catch{return[]}});settingsFieldsGridData=v(()=>{let t=this.accessoryData();if(T(t?.settingsDefinition))return[];try{let i=JSON.parse(String(t.settingsDefinition)).fields;return!f(i)||typeof i!="object"?[]:Object.entries(i).map(([o,r])=>({fieldKey:o,fieldTitle:f(r?.id)&&f(r?.title)?`${r?.title}(${r?.id})`:o.charAt(0).toUpperCase()+o.slice(1).replaceAll(/([A-Z])/g," $1"),gridData:typeof r=="object"&&r!==null?Object.entries(r).map(([u,b])=>({property:u,value:typeof b=="object"&&b!==null?JSON.stringify(b):String(b)})):[{property:"Value",value:String(r)}]}))}catch{return[]}});fieldGridColumns=[{field:"property",header:"Property"},{field:"value",header:"Value"}];hasSettingsDefinition=v(()=>this.settingsDefinitionGridData().length>0);featuresGridData=v(()=>{let t=this.accessoryData();if(T(t?.features))return[];let e=t.features;return Object.entries(e).map(([i,o])=>({feature:i,value:typeof o=="object"&&o!==null?JSON.stringify(o,null,2):String(o),type:typeof o,enabled:!!o}))});featureItems=v(()=>{let t=this.accessoryData();if(T(t?.features))return[];let e=t.features;return Object.entries(e).map(([i,o])=>({key:i,value:typeof o=="object"&&o!==null?JSON.stringify(o):String(o)}))});hasFeatures=v(()=>this.featuresGridData().length>0);getIOCapabilitiesSummary(t){if(!f(t))return"";let e=[{key:"digital_input",label:"Digital In"},{key:"digital_output",label:"Digital Out"},{key:"analog_input",label:"Analog In"},{key:"temperature_input",label:"Temp In"},{key:"can_input",label:"CAN In"},{key:"counter_input",label:"Counter In"},{key:"camera_input",label:"Camera In"},{key:"value_input",label:"Value In"}],i=[];for(let o of e){let r=Object.keys(t[o.key]??{}).length;r>0&&i.push(`${r} ${o.label}`)}return i.join(", ")}updateFormFields(){let t=this.accessoryData();this.ioCapabilityModalConfig={modalComponent:be,modalTitle:"Manage IO Capability",defaultItemProvider:()=>({key:"",optional:!1}),listItemFormatter:e=>({id:e.key,title:e.key,display:`${e.key} (${e.optional?"Optional":"Required"})`,icon:"pi pi-microchip"}),modalFields:e=>[k("key","IO Key",e?.key??"",{placeholder:"Enter IO key...",validations:[{name:"required",validator:w.required,message:"IO Key is required"}]}),_t("optional","Optional",e?.optional??!1,{hint:"When enabled, this IO is optional. When disabled, this IO is required.",props:{layout:"horizontal",labelWidth:"1/3",onLabel:"Optional",offLabel:"Required"}})],onSubmit:async e=>!!e.key?.trim(),onDeleteItem:async e=>new Promise(i=>{this.confirmationService.confirm({header:"Confirmation",message:`Are you sure you want to delete IO capability "${e.key}"?`,closable:!0,closeOnEscape:!0,icon:"pi pi-exclamation-triangle",rejectButtonProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptButtonProps:{label:"Delete",severity:"danger"},accept:()=>i(!0),reject:()=>i(!1)})}),subHeader:"Configure individual IO capabilities for this IO type",showEditButton:!0},this.ioTypeModalConfig={modalComponent:be,modalTitle:"IO Capabilities",defaultItemProvider:()=>({type:"digital_input",label:"Digital Input",instances:[]}),listItemFormatter:e=>{let i=f(e.instances)?e.instances.length:0;return{id:e.type,title:e.label,display:`${i} ${e.label}(s)`,icon:"pi pi-microchip"}},modalFields:e=>[ee(M({},k("type","Type",e?.type??"")),{hidden:!0}),ee(M({},k("label","Label",e?.label??"")),{hidden:!0}),De("instances","IO Capability",e?.instances??[],{layout:"horizontal",labelWidth:"1/3",props:{modalConfig:this.ioCapabilityModalConfig}})],onSubmit:async e=>!!e.type?.trim(),onDeleteItem:async e=>new Promise(i=>{this.confirmationService.confirm({header:"Confirmation",message:`Are you sure you want to delete IO "${e.type}"?`,accept:()=>i(!0),reject:()=>i(!1)})}),subHeader:"Configure accessory IO capabilities",showEditButton:!0,showAddButton:!1,showDeleteButton:!1},this.settingsModalConfig={modalComponent:be,modalTitle:"Manage Settings",defaultItemProvider:()=>({id:"",title:"",type:"text",values:[],unit:"",min:0,max:100,width:50,defaultValue:""}),listItemFormatter:e=>{let i=f(e.unit)?` - ${e.unit}`:"",o=e.values&&e.values.length>0?` - ${e.values.length} options`:"",r=`${e.title} (${e.type})${i}${o}`;return{id:e.id,title:e.title,display:r,icon:"pi pi-cog"}},modalFields:e=>[k("id","Field ID",e?.id??"",{placeholder:"Enter field ID...",hint:"Unique identifier for this field",validations:[{name:"required",validator:w.required,message:"Field ID is required"}]}),k("title","Field Title",e?.title??"",{placeholder:"Enter field title...",hint:"Display name for this field",validations:[{name:"required",validator:w.required,message:"Field Title is required"}]}),H("type","Field Type",[{label:"Text",value:"text"},{label:"Number",value:"number"},{label:"Combo/Dropdown",value:"combo"},{label:"Boolean",value:"boolean"}],e?.type??"text",{hint:"Select the input type for this field",validations:[{name:"required",validator:w.required,message:"Field Type is required"}]}),...e?.type==="combo"?[De("values","Combo Options",e?.values??[],{layout:"horizontal",labelWidth:"1/3",name:"values",hint:"Define the available options for combo/dropdown fields",props:{modalConfig:{modalComponent:be,modalTitle:"Manage Combo Option",defaultItemProvider:()=>({key:"",value:""}),listItemFormatter:i=>({id:i.key,title:i.key,display:`${i.key}: ${i.value}`,icon:"pi pi-circle"}),modalFields:[k("key","Option Key","",{placeholder:"Enter option key...",validations:[{name:"required",validator:w.required,message:"Option Key is required"}]}),k("value","Option Value","",{placeholder:"Enter option value...",validations:[{name:"required",validator:w.required,message:"Option Value is required"}]})],onSubmit:async i=>!!(i.key?.trim()&&i.value?.trim()),subHeader:"Configure individual combo options",showEditButton:!0}}})]:[],k("unit","Unit",e?.unit??"",{placeholder:"e.g., millimeters, seconds, etc.",hint:"Unit of measurement for number fields"}),ie("min","Minimum Value",e?.min,{placeholder:"Enter minimum value...",hint:"Minimum allowed value for number fields",validations:[{name:"min",validator:w.min(-999999),message:"Minimum value must be -999999 or greater"}]}),ie("max","Maximum Value",e?.max,{placeholder:"Enter maximum value...",hint:"Maximum allowed value for number fields",validations:[{name:"max",validator:w.max(999999),message:"Maximum value must be 999999 or less"}]}),ie("width","Field Width",e?.width,{placeholder:"Enter field width...",hint:"Display width for the input field",validations:[{name:"min",validator:w.min(1),message:"Field width must be 1 or greater"},{name:"max",validator:w.max(1e3),message:"Field width must be 1000 or less"}]}),k("defaultValue","Default Value",f(e?.defaultValue)?String(e?.defaultValue):"",{placeholder:"Enter default value...",hint:"Default value when field is empty"})],onSubmit:async e=>!(!e.id?.trim()||!e.title?.trim()),onDeleteItem:async e=>new Promise(i=>{this.confirmationService.confirm({header:"Confirmation",message:`Are you sure you want to delete setting "${e.title}"?`,closable:!0,closeOnEscape:!0,icon:"pi pi-exclamation-triangle",rejectButtonProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptButtonProps:{label:"Delete",severity:"danger"},accept:()=>i(!0),reject:()=>i(!1)})}),subHeader:"Configure accessory settings with various field types",showEditButton:!0},this.featuresModalConfig={modalComponent:be,modalTitle:"Manage Features",defaultItemProvider:()=>({key:"",value:""}),listItemFormatter:e=>({id:e.key,title:e.key,display:`${e.key}: ${e.value}`,icon:"pi pi-star"}),modalFields:e=>[k("key","Feature Key",e?.key??"",{placeholder:"Enter feature key...",validations:[{name:"required",validator:w.required,message:"Feature Key is required"}]}),k("value","Feature Value",e?.value??"",{placeholder:"Enter feature value...",validations:[{name:"required",validator:w.required,message:"Feature Value is required"}]})],onSubmit:async e=>!(!e.key?.trim()||!e.value?.trim()),onDeleteItem:async e=>new Promise(i=>{this.confirmationService.confirm({header:"Confirmation",message:`Are you sure you want to delete feature "${e.key}"?`,accept:()=>i(!0),reject:()=>i(!1)})}),subHeader:"Configure accessory features",showEditButton:!0},this.formFields=[k("name","Accessory Name",t?.name??"",{validations:[{name:"required",validator:w.required,message:"Accessory Name is required"}]}),De("ioCapabilities","IO Capabilities",this.ioTypeItems(),{layout:"horizontal",labelWidth:"1/3",name:"ioCapabilities",props:{modalConfig:this.ioTypeModalConfig}}),De("settings","Settings",this.settingsItems(),{layout:"horizontal",labelWidth:"1/3",name:"settings",props:{modalConfig:this.settingsModalConfig}}),De("features","Features",this.featureItems(),{layout:"horizontal",labelWidth:"1/3",name:"features",props:{modalConfig:this.featuresModalConfig}})]}transformFormData(t){let e=this.entity(),i=this.accessoryKey(),o=f(e)&&f(e.accessories)?e.accessories[i]:void 0,r=t.name,u=e?.accessories?M({},e.accessories):{},b=this.transformIoCapabilities(t),x=this.formatSettings(t),G=this.formatFeatures(t);return u[i]={name:r===o?.name||T(r)?o?.name:r,ioCapabilities:ce(b)?o?.ioCapabilities??{}:b,settingsDefinition:T(x)?o?.settingsDefinition:x,features:ce(G)?o?.features??{}:G},{accessories:u}}formatSettings(t){let e=null;if(f(t.settings)&&Array.isArray(t.settings)){let i=t.settings;i.length>0&&(e=JSON.stringify({fields:i}))}return e}formatFeatures(t){let e={};if(f(t.features)&&Array.isArray(t.features)){let i=t.features;for(let o of i)if(f(o.key)){let r;try{r=JSON.parse(o.value)}catch{r=o.value}this.parseFeatures(r,e,o)}}return e}parseFeatures(t,e,i){typeof t=="object"&&t!==null?e[i.key]=t:e[i.key]={settings:{value:t}}}transformIoCapabilities(t){let e={};if(f(t.ioCapabilities)&&Array.isArray(t.ioCapabilities)){let i=t.ioCapabilities;for(let o of i)if(f(o.type)&&f(o.instances)){let r={};for(let u of o.instances)r[u.key]={optional:u.optional??null};e[o.type]=r}}return e}getUpdateMethod(){return this.operationRegistry.getOperation("device-types","update")??((t,e)=>this.deviceTypesService.updateDeviceType(t,e).pipe(Je(i=>{this.entityChange.emit(i),this.broadcastService.broadcast("entity-updated",{entityType:"device-types",operation:"update",entityId:i.id,data:i})})))}ngOnInit(){this.updateFormFields()}onCancel(){this.cancelEdit()}onSave(){let t=this.getFormGroup();t&&this.onSubmit(t)}getActiveValues=v(()=>{let t=[];return this.hasIoCapabilities()&&t.push("io-capabilities"),this.hasSettingsDefinition()&&t.push("settings-definition"),this.hasFeatures()&&t.push("features"),t});static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-types-accessory"]],inputs:{entity:[1,"entity"],accessoryKey:[1,"accessoryKey"],displayTitle:[1,"displayTitle"]},features:[O],decls:12,vars:5,consts:[[1,"pt-2","card"],[1,"flex","justify-start","items-center","p-2","mb-4"],[1,"pi","pi-cog","!text-[2.5rem]"],[1,"flex-1","pl-6"],[1,"flex","justify-between","items-center"],[1,"m-0","text-xl","font-semibold"],[1,"icon-light"],[1,"ml-16"],[1,"ml-16","accessory-container"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter","keydown.space"],[3,"formValueChange","formValidityChange","fields","actions"],[1,"p-8","text-center","no-accessory-message"],[3,"multiple","value"],[1,"flex","gap-2","items-center","no-accessory-content-message"],["value","io-capabilities"],["value","settings-definition"],["value","features"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"ml-8"],[1,"mb-4","field-section"],[1,"mb-2","font-medium","field-title"],["tableStyleClass","info-display !w-auto field-grid",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-info-circle"],[1,"block","mb-2","text-2xl","pi","pi-info-circle"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6),s(),h(7,s_,2,1,"div",6),s(),l(8,"span"),D(9),s()()(),h(10,l_,2,2,"div",7)(11,y_,3,1,"div",8),s()),e&2&&(d(2),I("aria-label",i.displayTitle()+" icon"),d(4),J(i.displayTitle()),d(),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(2),ye("Configure ",i.displayTitle().toLowerCase()," accessory settings and capabilities."),d(),y(i.isFormEditable()?10:11))},dependencies:[V,Ut,qt,Gt,hi,yi,q],encapsulation:2})};function v_(n,t){if(n&1){let e=S();l(0,"div",6)(1,"span",9),_("click",function(){m(e);let o=a();return p(o.onEdit())})("keydown.enter",function(){m(e);let o=a();return p(o.onEdit())}),s()()}}function C_(n,t){if(n&1){let e=S();l(0,"app-dynamic-form",10),_("formValueChange",function(o){m(e);let r=a();return p(r.onFormValueChange(o))})("formValidityChange",function(o){m(e);let r=a();return p(r.onFormValidityChange(o))}),s()}if(n&2){let e=a();g("fields",e.formFields)("actions",e.actions)}}function __(n,t){if(n&1&&(l(0,"div",8),C(1,"app-grid",11),s()),n&2){let e=a();d(),g("data",e.cachedFieldsDisplay())("columns",e.columns)("showGridLines",!1)("hideHeader",!0)}}var Ma=class n extends B{constructor(){super(),U(()=>{this.entity()&&!this.createMode()&&this.updateFormFields()})}operationRegistry=c(Q);deviceTypesService=c($e);confirmationService=c(Ee);entity=E(null);cachedFieldModalConfig;cachedFieldItems=v(()=>{let i=this.entity()?.ioCapabilities?.cached_fields;return!f(i)||!Array.isArray(i)?[]:i.map(o=>({name:typeof o=="string"?o:String(o)}))});hasData=v(()=>this.cachedFieldItems().length>0);columns=[{field:"key",header:"Property"},{field:"value",header:"Value"}];cachedFieldsDisplay=v(()=>{let t=this.cachedFieldItems();return t.length===0?[{key:"Cached Fields",value:"No cached fields configured"}]:[{key:"Cached Fields",value:t.map(i=>i.name).join(", ")||"No cached fields configured"}]});updateFormFields(){this.cachedFieldModalConfig={modalComponent:be,modalTitle:"Add Cached Field",defaultItemProvider:()=>({name:""}),listItemFormatter:t=>({id:t.name,title:t.name,display:t.name,icon:"pi pi-database"}),modalFields:t=>[k("name","Field Name",t?.name??"",{placeholder:"Enter field name...",validations:[{name:"required",validator:w.required,message:"Field name is required"}]})],onSubmit:async t=>!!t.name?.trim(),onDeleteItem:async t=>new Promise(e=>{this.confirmationService.confirm({header:"Confirmation",message:`Are you sure you want to delete "${t.name}"?`,closable:!0,closeOnEscape:!0,icon:"pi pi-exclamation-triangle",rejectButtonProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptButtonProps:{label:"Delete",severity:"danger"},accept:async()=>{e(!0)},reject:()=>{e(!1)}})}),subHeader:"",showEditButton:!1},this.formFields=[De("cached_fields","Cached Fields",this.cachedFieldItems(),{layout:"horizontal",labelWidth:"1/3",name:"cached_fields",props:{modalConfig:this.cachedFieldModalConfig}})]}transformFormData(t){if(f(t.cached_fields)&&Array.isArray(t.cached_fields)){let e=t.cached_fields,i=this.entity(),o=f(i?.ioCapabilities)?M({},i.ioCapabilities):{},r=e.filter(u=>f(u.name)&&u.name.trim()!=="").map(u=>u.name);return o.cached_fields=r,{ioCapabilities:o}}return t}getUpdateMethod(){return this.operationRegistry.getOperation("device-types","update")??((t,e)=>this.deviceTypesService.updateDeviceType(t,e).pipe(Je(i=>{this.entityChange.emit(i),this.broadcastService.broadcast("entity-updated",{entityType:"device-types",operation:"update",entityId:i.id,data:i})})))}ngOnInit(){this.updateFormFields()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-device-types-cached-field"]],inputs:{entity:[1,"entity"]},features:[O],decls:12,vars:3,consts:[[1,"pt-2","card"],[1,"flex","justify-start","items-center","p-2","mb-4"],["aria-label","Cached Fields icon",1,"pi","pi-database","!text-[2.5rem]"],[1,"flex-1","pl-6"],[1,"flex","justify-between","items-center"],[1,"m-0","text-xl","font-semibold"],[1,"icon-light"],[3,"fields","actions"],[1,"cached-fields-container"],["aria-label","Edit cached fields",1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click","keydown.enter"],[3,"formValueChange","formValidityChange","fields","actions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1),C(2,"span",2),l(3,"div",3)(4,"div",4)(5,"h2",5),D(6,"Cached Fields"),s(),h(7,v_,2,0,"div",6),s(),l(8,"span"),D(9,"Manage cached fields for this device type"),s()()(),h(10,C_,1,2,"app-dynamic-form",7),h(11,__,2,4,"div",8),s()),e&2&&(d(7),y(!i.isFormEditable()&&!i.createMode()?7:-1),d(3),y(i.isFormEditable()?10:-1),d(),y(!i.isFormEditable()&&!i.createMode()?11:-1))},dependencies:[q,V],encapsulation:2})};var rr=class n{createDeviceTypeInformationSections(t){return[{id:"device-type-details",title:"Device Type Details",component:jl,componentInputs:{entity:t},category:"information",order:10}]}createDeviceTypeFeaturesSection(t){return t?.features?[{id:"device-type-features",title:"Features",component:Mt,componentInputs:{entity:t,entityType:"device-types",features:Object.entries(t.features).map(([e,i])=>ee(M({},i),{key:e}))},category:"features",order:10}]:[]}createChangesSection(t){return[{id:"device-type-changes",title:"Changes",component:ge,componentInputs:{entity:t},category:"feed",order:10}]}createIOCapabilitiesSections(t){let e=[{key:"digital_input",title:"Digital Inputs",description:"Configure digital input capabilities for this device type.",icon:"pi pi-arrow-left",iconType:"primeng"},{key:"digital_output",title:"Digital Outputs",description:"Configure digital output capabilities for this device type.",icon:"pi pi-arrow-right",iconType:"primeng"},{key:"analog_input",title:"Analog Inputs",description:"Configure analog input capabilities for this device type.",icon:"gauge-simple-high-solid",iconType:"svg"},{key:"temperature_input",title:"Temperature Sensors",description:"Configure temperature sensor capabilities for this device type.",icon:"temperature-half-solid",iconType:"svg"},{key:"can_input",title:"CAN Inputs",description:"Configure CAN input capabilities for this device type.",icon:"oil-can-solid",iconType:"svg"},{key:"counter_input",title:"Counter Inputs",description:"Configure counter input capabilities for this device type.",icon:"pi pi-clock",iconType:"primeng"},{key:"camera_input",title:"Camera Inputs",description:"Configure camera input capabilities for this device type.",icon:"pi pi-camera",iconType:"primeng"},{key:"value_input",title:"Value Inputs",description:"Configure value input capabilities for this device type.",icon:"pi pi-list-check",iconType:"primeng"}],i=[];for(let[o,r]of e.entries())i.push({id:`io-${r.key}`,title:r.title,component:Da,componentInputs:{entity:t,entityType:"device-types",ioTypeKey:r.key,displayTitle:r.title,description:r.description,icon:r.icon,iconType:r.iconType},category:"io",order:(o+1)*10+20});return i.push({id:"io-cached-fields",title:"Cached Fields",component:Ma,componentInputs:{entity:t,entityType:"device-types"},category:"io",order:110}),i}createAccessoriesSection(t){let e=[];if(e.push({id:"device-type-accessories",title:"Accessories",component:Ia,componentInputs:{entity:t,entityType:"device-types"},category:"accessories",order:20}),t?.accessories){let i=Object.entries(t.accessories);for(let[o,[r,u]]of i.entries()){if(T(u))continue;let b=f(u.name)&&u.name.trim()!==""?u.name:r.replaceAll("_"," ").replaceAll(/\b\w/g,x=>x.toUpperCase());e.push({id:`accessory-${r}`,title:b,component:Ea,componentInputs:{entity:t,entityType:"device-types",accessoryKey:r,displayTitle:b},category:"accessories",order:(o+1)*10+30})}}return e}createFeaturesSection(t){return[{id:"device-type-features",title:"Features",component:Ta,componentInputs:{entity:t,entityType:"device-types"},category:"features",order:25}]}createIndividualFeaturesSection(t){if(!t?.features)return[];let e=[],i=Object.entries(t.features);for(let[o,[r,u]]of i.entries()){if(T(u))continue;let b=f(u.name)&&u.name.trim()!==""?u.name:r.replaceAll("_"," ").replaceAll(/\b\w/g,x=>x.toUpperCase());e.push({id:`individual-feature-${r}`,title:b,component:wa,componentInputs:{entity:t,entityType:"device-types",featureKey:r,displayTitle:b},category:"features",order:(o+1)*10+30})}return e}createSettingsSection(t){let e=[];e.push({id:"device-type-settings",title:"Settings",component:Fa,componentInputs:{entity:t,entityType:"device-types"},category:"settings",order:20});let i=this.parseSettingsDefinition(t);if(i){let o=this.extractGroupsFromDefinition(i),r=this.buildSectionsFromGroups(o,t);e.push(...r)}return e}parseSettingsDefinition(t){if(T(t?.settingsDefinition)||t.settingsDefinition.trim()==="")return null;try{return JSON.parse(t.settingsDefinition)}catch{return null}}extractGroupsFromDefinition(t){return!f(t.groups)||!Array.isArray(t.groups)?[]:t.groups}buildSectionsFromGroups(t,e){let i=[];for(let o of t){let r=this.buildSectionsFromGroup(o,e,i.length);i.push(...r)}return i}buildSectionsFromGroup(t,e,i){return this.isValidGroup(t)?t.fields.map((r,u)=>this.createFieldSection(r,e,i+u)):[]}isValidGroup(t){return f(t)&&typeof t=="object"&&f(t.fields)&&Array.isArray(t.fields)}createFieldSection(t,e,i){let o=this.extractFieldId(t),u=this.extractFieldTitle(t)||o||"Unknown Field";return{id:`settings-field-${o}`,title:u,component:xa,componentInputs:{entity:e,entityType:"device-types",fieldId:o,displayTitle:u},category:"settings",order:(i+1)*10+30}}extractFieldId(t){return f(t.id)&&typeof t.id=="string"?t.id:"unknown"}extractFieldTitle(t){return f(t.title)&&typeof t.title=="string"?t.title:this.extractFieldId(t)}createAllDeviceTypeSections(t){return[...this.createDeviceTypeInformationSections(t),...this.createSettingsSection(t),...this.createIOCapabilitiesSections(t),...this.createAccessoriesSection(t),...this.createFeaturesSection(t),...this.createIndividualFeaturesSection(t),...this.createChangesSection(t)]}static \u0275fac=function(e){return new(e||n)};static \u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"})};export{Xl as a,ed as b,qn as c,Un as d,zn as e,Di as f,ar as g,sr as h,lr as i,dr as j,pr as k,yr as l,vr as m,Cr as n,_r as o,br as p,Sr as q,Dr as r,Tr as s,wr as t,Rr as u,Ar as v,cd as w,md as x,pd as y,ud as z,fd as A,gd as B,hd as C,yd as D,vd as E,Cd as F,_d as G,bd as H,Sd as I,Dd as J,Td as K,wd as L,xd as M,Vr as N,Fd as O,Id as P,Ed as Q,Md as R,Rd as S,Ad as T,kd as U,Od as V,Pd as W,Vd as X,Ld as Y,Lr as Z,Nr as _,Gr as $,qr as aa,ua as ba,ga as ca,ha as da,ya as ea,va as fa,Ca as ga,ba as ha,Sa as ia,Y as ja,Ho as ka,bi as la,Qi as ma};
