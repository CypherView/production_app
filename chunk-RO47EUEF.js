import{a as He}from"./chunk-2OM6GPLI.js";import"./chunk-QJYXX6WB.js";import{a as je,b as Le}from"./chunk-JJVUWK2A.js";import"./chunk-FVFSV3SV.js";import{q as Me}from"./chunk-UUBV4PLA.js";import{a as Be,b as We,e as qe,f as Ge}from"./chunk-T2ASJLBG.js";import"./chunk-K3QSXHYQ.js";import{c as $e,d as Ke}from"./chunk-53JQ5NAG.js";import"./chunk-GV42Z4ED.js";import"./chunk-SDMJKPKX.js";import{O as Ne,P as Ve,j as Oe,n as Fe,r as Ie,z as Pe}from"./chunk-HBFOC76W.js";import{a as Ue,b as ze}from"./chunk-MI5GPO5K.js";import"./chunk-PH5YALHE.js";import{l as Ee,m as ke}from"./chunk-6C6CC4KT.js";import"./chunk-JAXNIEKX.js";import{E as Re,S as F,T as f,_c as De,ea as we,ga as Se,ha as Ae,p as be,pa as X,r as _e,u as xe,y as ie}from"./chunk-FEC2V4R3.js";import{Ac as J,F as A,Jb as U,Kb as z,Nb as ge,Ob as ye,Pb as I,Qb as m,Rb as d,Rc as K,S as B,Sb as Q,Tc as j,Vc as Te,Y as N,Ya as y,Zb as W,Zc as V,ba as w,bc as M,cc as v,ha as x,ia as R,j as b,mb as pe,mc as fe,oc as ce,qc as re,r as S,rc as g,sb as ue,sc as O,ta as _,tc as oe,uc as me,vc as he,wc as ve,x as $,xc as Ce,yc as G,zc as H}from"./chunk-EG5ORV3B.js";import{a as L,b as Y}from"./chunk-VB56BUGO.js";var q=class p{http=w(Re);config={cypherViewUrl:"https://v1-test-api.cypherview.net",keyApiUrl:"https://api.us1.kt1.io/fleet/v2",cypherViewAuth:{username:"",password:""},keyApiAuth:{username:"",password:""}};cypherViewToken=null;keyApiToken=null;authenticateCypherView(){let t=`${this.config.cypherViewUrl}/auth/signin`;return this.http.post(t,{username:this.config.cypherViewAuth.username,password:this.config.cypherViewAuth.password}).pipe(S(e=>{let i=e.accessToken??e.idToken;if(F(i))throw new Error("No access token received from CypherView");return this.cypherViewToken=i,i}),A(e=>{throw e}))}authenticateKeyApi(){let t=`${this.config.keyApiUrl}/auth/signin`;return this.http.post(t,{username:this.config.keyApiAuth.username,password:this.config.keyApiAuth.password}).pipe(S(e=>{let i=e.accessToken??e.idToken;if(F(i))throw new Error("No access token received from Key API");return this.keyApiToken=i,i}),A(e=>{throw console.error("\u{1F510} Auth error details:",{status:e.status,statusText:e.statusText,url:t,username:this.config.keyApiAuth.username,message:e.message}),e.status===401?console.error("\u{1F6AB} Invalid credentials for Key API - check username/password"):e.status===404&&console.error("\u{1F6AB} Key API authentication endpoint not found"),e}))}getCypherViewTelemetry(t,e,i,n){let o=`/api/v2/history/telemetry/${t}`,r={start:e,end:i};return f(n)&&(r.limit=n.toString()),this.http.get(o,{params:r}).pipe(S(l=>l.items??[]),A(l=>(console.error("\u274C Error details:",{status:l.status,statusText:l.statusText,message:l.message,url:l.url}),b([]))))}searchKeyApiVehicleByDeviceName(t){return(f(this.keyApiToken)?b(this.keyApiToken):this.authenticateKeyApi()).pipe(B(i=>{let n=`${this.config.keyApiUrl}/entities/assets`,o={limit:"100",search:t},r=new ie({"x-access-token":i,"Content-Type":"application/json"});return this.http.get(n,{headers:r,params:o})}),S(i=>{if(F(i.items)||!Array.isArray(i.items))return null;let n=i.items.find(o=>(o.device?.name??o.name??"")===t);return f(n)?n.id??null:(console.warn("\u26A0\uFE0F No matching vehicle found for device name:",t),null)}),A(i=>(console.error("\u{1F4CD} Search error details:",{status:i.status,statusText:i.statusText,message:i.message,url:i.url,deviceName:t}),(i.status===401||i.status===403)&&(this.keyApiToken=null),b(null))))}getKeyApiTelemetry(t,e,i,n,o){return this.fetchKeyApiTelemetryData(t,e,i,n).pipe(A(r=>(r.status===404||r.status===401)&&f(o)?(console.warn("\u26A0\uFE0F CypherView vehicle ID failed on Key API, trying device name mapping..."),this.searchKeyApiVehicleByDeviceName(o).pipe(B(l=>F(l)?(console.error("\u274C Could not find matching vehicle in Key API for device:",o),b([])):this.fetchKeyApiTelemetryData(l,e,i,n)),A(()=>b([])))):(console.error("\u274C Key API telemetry failed and no device name available for mapping"),b([]))))}fetchKeyApiTelemetryData(t,e,i,n){return(f(this.keyApiToken)?b(this.keyApiToken):this.authenticateKeyApi()).pipe(B(r=>{let l=`${this.config.keyApiUrl}/data/history/telemetry/${t}`,s={start:e,end:i};f(n)&&(s.limit=n.toString());let a=new ie({"x-access-token":r,"Content-Type":"application/json"});return this.http.get(l,{headers:a,params:s})}),S(r=>r.items??[]),A(r=>(console.error("\u{1F4CD} Error details:",{status:r.status,statusText:r.statusText,message:r.message,url:r.url,vehicleId:t}),r.status===404&&console.warn("\u26A0\uFE0F Vehicle ID not found in Key API:",t),(r.status===401||r.status===403)&&(this.keyApiToken=null),b([]))))}setCredentials(t,e){this.config.cypherViewAuth=t,this.config.keyApiAuth=e,this.cypherViewToken=null,this.keyApiToken=null}getKeyApiEvents(t,e,i,n,o){return this.fetchKeyApiEventsData(t,e,i,n).pipe(A(r=>(r.status===404||r.status===401)&&f(o)?(console.warn("\u26A0\uFE0F CypherView vehicle ID failed on Key API events, trying device name mapping..."),this.searchKeyApiVehicleByDeviceName(o).pipe(B(l=>F(l)?(console.error("\u274C Could not find matching vehicle in Key API for events device:",o),b([])):this.fetchKeyApiEventsData(l,e,i,n)),A(l=>(console.error("\u274C Device name mapping for events also failed:",l),b([]))))):(console.error("\u274C Key API events failed and no device name available for mapping"),b([]))))}fetchKeyApiEventsData(t,e,i,n){return(f(this.keyApiToken)?b(this.keyApiToken):this.authenticateKeyApi()).pipe(B(r=>{let l=`${this.config.keyApiUrl}/data/history/events/${t}`,s={start:e,end:i};f(n)&&(s.limit=n.toString());let a=new ie({"x-access-token":r,"Content-Type":"application/json"});return this.http.get(l,{headers:a,params:s})}),S(r=>r.items??[]),A(r=>(console.error("\u{1F4CD} Events error details:",{status:r.status,statusText:r.statusText,message:r.message,url:r.url,vehicleId:t}),r.status===404&&console.warn("\u26A0\uFE0F Vehicle ID not found in Key API events:",t),(r.status===401||r.status===403)&&(this.keyApiToken=null),b([]))))}getKeyApiTrips(t,e,i,n,o){return this.fetchKeyApiTripsData(t,e,i,n).pipe(A(r=>(r.status===404||r.status===401)&&f(o)?(console.warn("\u26A0\uFE0F CypherView vehicle ID failed on Key API trips, trying device name mapping..."),this.searchKeyApiVehicleByDeviceName(o).pipe(B(l=>F(l)?(console.error("\u274C Could not find matching vehicle in Key API for trips device:",o),b([])):this.fetchKeyApiTripsData(l,e,i,n)),A(l=>(console.error("\u274C Device name mapping for trips also failed:",l),b([]))))):(console.error("\u274C Key API trips failed and no device name available for mapping"),b([]))))}fetchKeyApiTripsData(t,e,i,n){return(f(this.keyApiToken)?b(this.keyApiToken):this.authenticateKeyApi()).pipe(B(r=>{let l=`${this.config.keyApiUrl}/data/history/trips/${t}`,s={start:e,end:i};f(n)&&(s.limit=n.toString());let a=new ie({"x-access-token":r,"Content-Type":"application/json"});return this.http.get(l,{headers:a,params:s})}),S(r=>r.items??[]),A(r=>(console.error("\u{1F4CD} Trips error details:",{status:r.status,statusText:r.statusText,message:r.message,url:r.url,vehicleId:t}),r.status===404&&console.warn("\u26A0\uFE0F Vehicle ID not found in Key API trips:",t),(r.status===401||r.status===403)&&(this.keyApiToken=null),b([]))))}testAuthentication(){let t=f(this.cypherViewToken)?b(!0):this.authenticateCypherView().pipe(S(()=>!0),A(()=>b(!1))),e=this.authenticateKeyApi().pipe(S(()=>!0),A(()=>b(!1)));return $({cypherView:t,keyApi:e})}static \u0275fac=function(e){return new(e||p)};static \u0275prov=N({token:p,factory:p.\u0275fac,providedIn:"root"})};var ee=class p{historyService=w(X);dataService=w(Ae);dualApiService=w(q);getTelemetryComparison(t,e,i,n,o){let r=this.historyService.getTelemetryHistory(t,e.toISOString(),i.toISOString(),n).pipe(S(s=>s.items??[]),A(s=>(console.error("\u274C CypherView telemetry error:",s),b([])))),l=this.dualApiService.getKeyApiTelemetry(t,e.toISOString(),i.toISOString(),n,o);return $({testData:r.pipe(S(s=>this.mapToTelemetryRecords(s))),prodData:l.pipe(S(s=>this.mapToTelemetryRecords(s)))}).pipe(S(({testData:s,prodData:a})=>{let c=this.alignRecordsByTimestamp(s,a),u=this.calculateSummary(c);return{alignedRecords:c,summary:u,testRecords:s,prodRecords:a}}),A(s=>(console.error("Error fetching telemetry comparison:",s),b({alignedRecords:[],summary:this.getEmptySummary(),testRecords:[],prodRecords:[]}))))}mapToTelemetryRecords(t){return t.map(e=>Y(L({},e),{timestamp:e.date??e.timestamp??e.received}))}setKeyApiCredentials(t,e){this.dualApiService.setCredentials({username:"",password:""},{username:t,password:e})}simulateEnvironmentDifferences(t,e){return e==="test"?t:t.map(i=>{let n=L({},i);if(n.telemetry){let o=L({},n.telemetry);Object.keys(o).forEach(r=>{if(r.toLowerCase().includes("speed")&&typeof o[r]=="object"){let l=o[r];l.value!==void 0&&(l.value=l.value+Math.floor(Math.random()*3))}}),n.telemetry=o}return Math.random()>.8&&(n.zones=[]),n})}generateMockData(t,e,i,n,o){let r=[],l=n.getTime()-i.getTime(),s=Math.min(o??20,20);for(let a=0;a<s;a++){let c=new Date(i.getTime()+l*a/s),u={timestamp:c.toISOString(),received:c.toISOString(),active:!0,location:{lat:-26.2041+(Math.random()-.5)*.01,lon:28.0473+(Math.random()-.5)*.01,accuracy:t==="test"?0:Math.floor(Math.random()*50),gc:{country:"South Africa",city:"Johannesburg"}},zones:[{id:"123",name:"Test Zone"}],telemetry:{speed:Math.floor(Math.random()*120),ignition:!0,fuel_level:80+Math.floor(Math.random()*20),battery_voltage:12.5+Math.random()*2},origin:{id:e,name:`Vehicle ${e}`}};t==="prod"&&u.telemetry&&(u.telemetry.speed=(Number(u.telemetry.speed)||0)+Math.floor(Math.random()*5),Math.random()>.8&&delete u.zones),r.push(u)}return r}alignRecordsByTimestamp(t,e,i=2){let n=[],o=new Set,r=a=>{if(!a)return null;let c=a.timestamp??a.received;if(F(c))return null;try{return new Date(c.replace("Z","+00:00"))}catch{return null}},l=[...t].sort((a,c)=>{let u=r(a),h=r(c);return!u||!h?0:u.getTime()-h.getTime()}),s=[...e].map((a,c)=>({record:a,originalIndex:c})).sort((a,c)=>{let u=r(a.record),h=r(c.record);return!u||!h?0:u.getTime()-h.getTime()});return l.forEach((a,c)=>{let u=r(a),h=null,T=1/0,D=null;u&&s.forEach(({record:E,originalIndex:k})=>{if(o.has(k))return;let C=r(E);if(C){let P=Math.abs((u.getTime()-C.getTime())/1e3);P<=i&&P<T&&(h=E,T=P,D=k)}}),f(h)&&D!==null?(o.add(D),n.push({testRecord:a,prodRecord:h,index:c,timestampDiff:T})):n.push({testRecord:a,prodRecord:null,index:c,timestampDiff:void 0})}),s.forEach(({record:a,originalIndex:c})=>{o.has(c)||n.push({testRecord:null,prodRecord:a,index:n.length,timestampDiff:void 0})}),n}calculateSummary(t){let e=t.filter(s=>s.testRecord&&s.prodRecord).length,i=t.filter(s=>f(s.testRecord)&&!s.prodRecord).length,n=t.filter(s=>F(s.testRecord)&&f(s.prodRecord)).length,o=t.length,r=o>0?e/o*100:0,l="\u{1F534} Poor";return r>=95?l="\u{1F7E2} Excellent":r>=85?l="\u{1F7E1} Good":r>=70&&(l="\u{1F7E0} Fair"),{totalAligned:o,bothPresent:e,testOnly:i,prodOnly:n,matchRate:r,qualityStatus:l}}getEmptySummary(){return{totalAligned:0,bothPresent:0,testOnly:0,prodOnly:0,matchRate:0,qualityStatus:"\u274C No Data"}}formatTimestampForDisplay(t){if(!t)return"";try{return new Date(t).toLocaleString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return t}}extractAllFields(t){if(!t)return{};let e={};e.timestamp=this.formatTimestampForDisplay(t.timestamp??t.received??""),e.active=String(t.active??"");let i=t.zones??[];if(Array.isArray(i)){let r=i.map(s=>s.name).filter(Boolean),l=i.map(s=>s.id).filter(Boolean);e["zones.names"]=r.join(", "),e["zones.ids"]=l.join(", "),e["zones.count"]=String(i.length)}let n=t.location??{};Object.entries(n).forEach(([r,l])=>{if(r==="gc"&&typeof l=="object")Object.entries(l).forEach(([s,a])=>{e[`location.gc.${s}`]=String(a??"")});else if(["lat","latitude","lon","longitude"].includes(r)&&l!=null)try{e[`location.${r}`]=Number(l).toFixed(6)}catch{e[`location.${r}`]=String(l??"")}else e[`location.${r}`]=String(l??"")});let o=t.telemetry??{};return Object.entries(o).forEach(([r,l])=>{let s=r;r.startsWith("cvc_")||r.startsWith("cve_")?s=r.substring(4):r.startsWith("cv_")&&(s=r.substring(3)),e[`telemetry.${s}`]=String(l??"")}),t.telemetry||["ignition","priority","eventId","moving","fuel_level","engine_temp","battery_voltage","satellites","hdop","pdop","gsm_signal","total_mileage","vehicle_speed","accelerator_pedal_position","driver_id","fuel_consumed","output_01","output_02","digital_01","digital_02","speed","heading","direction"].forEach(l=>{l in t&&(e[l]=String(t[l]??""))}),e}compareFields(t,e){let i=this.extractAllFields(t),n=this.extractAllFields(e),o=new Set([...Object.keys(i),...Object.keys(n)]),r=["timestamp","active","zones.count","zones.names","zones.ids"];return[...r.filter(s=>o.has(s)),...Array.from(o).filter(s=>!r.includes(s)).sort((s,a)=>s.localeCompare(a))].map(s=>{let a=i[s]||"",c=n[s]||"",u,h=a,T=c,D=C=>{if(!C)return"";try{return String(parseFloat(C))}catch{return C.trim()}},E=D(a),k=D(c);return!a&&c?(u="missing_test",h="\u274C MISSING"):a&&!c?(u="missing_prod",T="\u274C MISSING"):E!==k&&a&&c?(u="different",h=`\u{1F539} ${a}`,T=`\u{1F538} ${c}`):E===k&&a?(u="identical",h=`\u2705 ${a}`,T=`\u2705 ${c}`):u="identical",{field:s,testValue:a,prodValue:c,status:u,displayTest:h,displayProd:T}})}static \u0275fac=function(e){return new(e||p)};static \u0275prov=N({token:p,factory:p.\u0275fac,providedIn:"root"})};var se=class p{historyService=w(X);getEvents(t,e,i,n){return this.historyService.getEventHistory(t,e,i,n)}static \u0275fac=function(e){return new(e||p)};static \u0275prov=N({token:p,factory:p.\u0275fac,providedIn:"root"})};var te=class p{eventsService=w(se);dualApiService=w(q);getEventsComparison(t,e,i,n,o){let r=this.eventsService.getEvents(t,e.toISOString(),i.toISOString(),n).pipe(S(s=>s.items??[]),A(s=>(console.error("\u274C CypherView events error:",s),b([])))),l=this.dualApiService.getKeyApiEvents(t,e.toISOString(),i.toISOString(),n,o);return $({testData:r.pipe(S(s=>this.mapToEventRecords(s))),prodData:l.pipe(S(s=>this.mapToEventRecords(s)))}).pipe(S(({testData:s,prodData:a})=>{let c=this.alignRecordsByTimestamp(s,a),u=this.calculateSummary(c);return{alignedRecords:c,summary:u,testRecords:s,prodRecords:a}}),A(s=>(console.error("Error fetching events comparison:",s),b({alignedRecords:[],summary:this.getEmptySummary(),testRecords:[],prodRecords:[]}))))}mapToEventRecords(t){return t.map(e=>Y(L({},e),{timestamp:e.eventDate??e.eventTime??e.timestamp??e.received??e.date}))}setKeyApiCredentials(t,e){this.dualApiService.setCredentials({username:"",password:""},{username:t,password:e})}alignRecordsByTimestamp(t,e,i=2){let n=[],o=new Set,r=a=>{if(!a)return null;let c=a.timestamp??a.eventDate??a.eventTime??a.received;if(F(c))return null;try{return new Date(String(c).replace("Z","+00:00"))}catch{return null}},l=[...t].sort((a,c)=>{let u=r(a),h=r(c);return!u||!h?0:u.getTime()-h.getTime()}),s=[...e].map((a,c)=>({record:a,originalIndex:c})).sort((a,c)=>{let u=r(a.record),h=r(c.record);return!u||!h?0:u.getTime()-h.getTime()});return l.forEach((a,c)=>{let u=r(a),h=null,T=1/0,D=null;u&&s.forEach(({record:E,originalIndex:k})=>{if(o.has(k))return;let C=r(E);if(C){let P=Math.abs((u.getTime()-C.getTime())/1e3);P<=i&&P<T&&(h=E,T=P,D=k)}}),f(h)&&D!==null?(o.add(D),n.push({testRecord:a,prodRecord:h,index:c,timestampDiff:T})):n.push({testRecord:a,prodRecord:null,index:c,timestampDiff:void 0})}),s.forEach(({record:a,originalIndex:c})=>{o.has(c)||n.push({testRecord:null,prodRecord:a,index:n.length,timestampDiff:void 0})}),n}calculateSummary(t){let e=t.filter(s=>f(s.testRecord)&&f(s.prodRecord)).length,i=t.filter(s=>f(s.testRecord)&&!f(s.prodRecord)).length,n=t.filter(s=>!f(s.testRecord)&&f(s.prodRecord)).length,o=t.length,r=o>0?e/o*100:0,l="\u{1F534} Poor";return r>=95?l="\u{1F7E2} Excellent":r>=85?l="\u{1F7E1} Good":r>=70&&(l="\u{1F7E0} Fair"),{totalAligned:o,bothPresent:e,testOnly:i,prodOnly:n,matchRate:r,qualityStatus:l}}getEmptySummary(){return{totalAligned:0,bothPresent:0,testOnly:0,prodOnly:0,matchRate:0,qualityStatus:"\u274C No Data"}}formatTimestampForDisplay(t){if(!t)return"";try{return new Date(t).toLocaleString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return t}}isTimestamp(t){if(!t)return!1;try{let e=new Date(t);return!isNaN(e.getTime())&&(t.includes("T")||t.includes("Z")||!!RegExp(/\d{4}-\d{2}-\d{2}/).exec(t))}catch{return!1}}setDateField(t,e,i){let n;i==null?n="":typeof i=="object"?n=JSON.stringify(i):typeof i=="string"||typeof i=="number"||typeof i=="boolean"?n=String(i):n=JSON.stringify(i),t[e]=this.isTimestamp(n)?this.formatTimestampForDisplay(n):n}setIdNameField(t,e,i){t[e]=f(i)?i.name??i.id??JSON.stringify(i):""}setCountField(t,e,i){let n=i??[];t[e]=Array.isArray(n)?String(n.length):"0"}extractLocationFields(t,e){if(!f(e)||typeof e!="object")return;let i=o=>{let r=e?.[o];return r==null?"":typeof r=="object"?JSON.stringify(r):typeof r=="string"||typeof r=="number"||typeof r=="boolean"?String(r):JSON.stringify(r)};if(e.lat!=null)try{t["location.latitude"]=Number(e.lat).toFixed(6)}catch{t["location.latitude"]=String(i("lat"))}if(e.lon!=null)try{t["location.longitude"]=Number(e.lon).toFixed(6)}catch{t["location.longitude"]=String(i("lon"))}["speed","heading","altitude","accuracy","age","address"].forEach(o=>{e[o]!=null&&(t[`location.${o}`]=String(i(o)))});let n=e.gc??{};if(f(n)&&typeof n=="object"){let o=n;t["location.gc.ct"]=String(o.ct??""),t["location.gc.pr"]=String(o.pr??""),t["location.gc.tw"]=String(o.tw??"")}}extractTelemetryFields(t,e){if(!f(e)||typeof e!="object")return;let i=e.telemetry??{};f(i)&&typeof i=="object"&&Object.entries(i).forEach(([r,l])=>{if(l==null)return;let s=typeof l=="object"?JSON.stringify(l):String(l);t[`telemetry.${r}`]=r==="tco_timestamp"&&this.isTimestamp(s)?this.formatTimestampForDisplay(s):s});let n=e.zones??[];if(Array.isArray(n)){let r=n.map(s=>s.name).filter(Boolean),l=n.map(s=>s.id).filter(Boolean);t["zones.names"]=r.join(", "),t["zones.ids"]=l.join(", "),t["zones.count"]=String(n.length)}else t["zones.names"]="",t["zones.ids"]="",t["zones.count"]="0";e.active!=null&&(t.active=String(e.active??""));let o=e.date??e.received??"";f(o)&&this.setDateField(t,"timestamp",o)}extractAllFields(t){if(!t)return{};let e={};e.id=String(t.id??t.eventId??""),e.type=String(t.type??t.eventType??""),e.eventClass=String(t.eventClass??""),e.eventType=String(t.eventType??"");let i=t.eventDate??t.eventTime??t.timestamp??"";this.setDateField(e,"eventDate",i),this.setDateField(e,"creationDate",t.creationDate),this.setDateField(e,"modifiedDate",t.modifiedDate),this.setIdNameField(e,"owner",t.owner),this.setIdNameField(e,"origin",t.origin),this.setCountField(e,"linked.count",t.linked),this.setCountField(e,"alerts.count",t.alerts),this.setCountField(e,"notify.count",t.notify);let n=t.details??{},o=n.telemetry??{},r=o.location??t.location??{};this.extractLocationFields(e,r),this.extractTelemetryFields(e,o);let l=n.asset??t.asset;return f(l)&&(e["asset.name"]=l.name??"",e["asset.id"]=l.id??""),e.priority=String(t.priority??""),e}compareFields(t,e){let i=this.extractAllFields(t),n=this.extractAllFields(e),o=new Set([...Object.keys(i),...Object.keys(n)]),r=["id","type","eventClass","eventType","eventDate","creationDate","owner","origin","linked.count","alerts.count","notify.count"];return[...r.filter(s=>o.has(s)),...Array.from(o).filter(s=>!r.includes(s)).sort((s,a)=>s.localeCompare(a))].map(s=>{let a=i[s]||"",c=n[s]||"",u,h=a,T=c,D=C=>{if(!C)return"";try{return String(parseFloat(C))}catch{return C.trim()}},E=D(a),k=D(c);return!a&&c?(u="missing_test",h="\u274C MISSING"):a&&!c?(u="missing_prod",T="\u274C MISSING"):E!==k&&a&&c?(u="different",h=`\u{1F539} ${a}`,T=`\u{1F538} ${c}`):E===k&&a?(u="identical",h=`\u2705 ${a}`,T=`\u2705 ${c}`):u="identical",{field:s,testValue:a,prodValue:c,status:u,displayTest:h,displayProd:T}})}static \u0275fac=function(e){return new(e||p)};static \u0275prov=N({token:p,factory:p.\u0275fac,providedIn:"root"})};var ae=class p{historyService=w(X);getTrips(t,e,i,n){return this.historyService.getTripHistory(t,e,i,void 0,n)}static \u0275fac=function(e){return new(e||p)};static \u0275prov=N({token:p,factory:p.\u0275fac,providedIn:"root"})};var ne=class p{tripsService=w(ae);dualApiService=w(q);getTripsComparison(t,e,i,n,o){let r=this.tripsService.getTrips(t,e.toISOString(),i.toISOString(),n).pipe(S(s=>s.items??[]),A(s=>(console.error("\u274C CypherView trips error:",s),b([])))),l=this.dualApiService.getKeyApiTrips(t,e.toISOString(),i.toISOString(),n,o);return $({testData:r.pipe(S(s=>this.mapToTripRecords(s))),prodData:l.pipe(S(s=>this.mapToTripRecords(s)))}).pipe(S(({testData:s,prodData:a})=>{let c=this.alignRecordsByTimestamp(s,a),u=this.calculateSummary(c);return{alignedRecords:c,summary:u,testRecords:s,prodRecords:a}}),A(s=>(console.error("Error fetching trips comparison:",s),b({alignedRecords:[],summary:this.getEmptySummary(),testRecords:[],prodRecords:[]}))))}mapToTripRecords(t){return t.map(e=>Y(L({},e),{timestamp:e.startTime??e.timestamp??e.received??e.date,startTime:e.startTime??e.start?.date??e.dateStart,endTime:e.endTime??e.end?.date??e.dateEnd}))}setKeyApiCredentials(t,e){this.dualApiService.setCredentials({username:"",password:""},{username:t,password:e})}alignRecordsByTimestamp(t,e,i=30){let n=[],o=new Set,r=a=>{if(!a)return null;let c=a.timestamp??a.startTime??a.start?.date??a.received;if(F(c))return null;try{return new Date(c.replace("Z","+00:00"))}catch{return null}},l=[...t].sort((a,c)=>{let u=r(a),h=r(c);return!u||!h?0:u.getTime()-h.getTime()}),s=[...e].map((a,c)=>({record:a,originalIndex:c})).sort((a,c)=>{let u=r(a.record),h=r(c.record);return!u||!h?0:u.getTime()-h.getTime()});return l.forEach((a,c)=>{let u=r(a),h=null,T=1/0,D=null;u&&s.forEach(({record:E,originalIndex:k})=>{if(o.has(k))return;let C=r(E);if(C){let P=Math.abs((u.getTime()-C.getTime())/1e3);P<=i&&P<T&&(h=E,T=P,D=k)}}),f(h)&&D!==null?(o.add(D),n.push({testRecord:a,prodRecord:h,index:c,timestampDiff:T})):n.push({testRecord:a,prodRecord:null,index:c,timestampDiff:void 0})}),s.forEach(({record:a,originalIndex:c})=>{o.has(c)||n.push({testRecord:null,prodRecord:a,index:n.length,timestampDiff:void 0})}),n}calculateSummary(t){let e=t.filter(s=>f(s.testRecord)&&f(s.prodRecord)).length,i=t.filter(s=>f(s.testRecord)&&!f(s.prodRecord)).length,n=t.filter(s=>!f(s.testRecord)&&f(s.prodRecord)).length,o=t.length,r=o>0?e/o*100:0,l="\u{1F534} Poor";return r>=95?l="\u{1F7E2} Excellent":r>=85?l="\u{1F7E1} Good":r>=70&&(l="\u{1F7E0} Fair"),{totalAligned:o,bothPresent:e,testOnly:i,prodOnly:n,matchRate:r,qualityStatus:l}}getEmptySummary(){return{totalAligned:0,bothPresent:0,testOnly:0,prodOnly:0,matchRate:0,qualityStatus:"\u274C No Data"}}formatTimestampForDisplay(t){if(!t)return"";try{return new Date(t).toLocaleString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return t}}isTimestamp(t){if(!t)return!1;try{let e=new Date(t);return!isNaN(e.getTime())&&(t.includes("T")||t.includes("Z")||!!RegExp(/\d{4}-\d{2}-\d{2}/).exec(t))}catch{return!1}}extractAllFields(t){if(!t)return{};let e={};return this._extractDateTimeFields(t,e),this._extractTripInfoFields(t,e),this._extractMeasurementFields(t,e),this._extractAssetInfo(t,e),this._extractLocationFields(t,e),this._extractZoneFields(t,e),e}_extractDateTimeFields(t,e){let i=t.startTime??t.timestamp??"";e.dateStart=this.isTimestamp(i)?this.formatTimestampForDisplay(i):i;let n=t.endTime??"";e.dateEnd=this.isTimestamp(n)?this.formatTimestampForDisplay(n):n;let o=t.creationDate??"",r=String(o);e.creationDate=this.isTimestamp(r)?this.formatTimestampForDisplay(r):r}_extractTripInfoFields(t,e){let i=t.tripId??t.id??"";e.id=typeof i=="string"?i:String(i)}_formatValue(t,e,i){if(t==null)return"";try{return`${Number(t).toFixed(i)} ${e}`}catch{return String(t??"")}}_extractMeasurementFields(t,e){let i=t.distance??t.distance??null;e.distance=this._formatValue(i,"km",2);let n=t.duration??t.drivingTime??null;e.drivingTime=this._formatValue(n,"min",2);let o=t.maxSpeed??t.maxes?.speed;if(e.maxSpeed=this._formatValue(o,"km/h",2),e.distance&&e.drivingTime)try{let s=Number(e.distance.replace(" km","")),a=Number(e.drivingTime.replace(" min",""))/60;a>0?e.averageSpeed=`${(s/a).toFixed(2)} km/h`:e.averageSpeed=""}catch{e.averageSpeed=""}else e.averageSpeed="";let r=t.fuelUsed??t.fuel??null;e.fuelUsed=this._formatValue(r,"L",2);let l=t.idleTime;if(l!=null)try{e.idleTime=`${(Number(l)/60).toFixed(2)} min`}catch{e.idleTime=String(l??"")}else e.idleTime=""}_extractAssetInfo(t,e){let i=t.asset;f(i)&&(e["asset.name"]=i.name??"")}_extractLocationFields(t,e){let i=t.startLocation||t.start;f(i)&&(e.startAddress=i.address??"",e["start.latitude"]=this._formatValue(i.lat,"",6),e["start.longitude"]=this._formatValue(i.lon,"",6),e["start.odometer"]=this._formatValue(i.odometer,"km",2),e["start.hours"]=this._formatValue(i.hours,"h",2));let n=t.endLocation||t.end;f(n)&&(e.endAddress=n.address??"",e["end.latitude"]=this._formatValue(n.lat,"",6),e["end.longitude"]=this._formatValue(n.lon,"",6),e["end.odometer"]=this._formatValue(n.odometer,"km",2),e["end.hours"]=this._formatValue(n.hours,"h",2))}_extractZoneFields(t,e){let i=t.zones??[];if(Array.isArray(i)){let n=i.map(r=>r.name).filter(Boolean),o=i.map(r=>r.id).filter(Boolean);e["zones.names"]=n.join(", "),e["zones.ids"]=o.join(", "),e["zones.count"]=String(i.length)}else e["zones.names"]="",e["zones.ids"]="",e["zones.count"]="0"}compareFields(t,e){let i=this.extractAllFields(t),n=this.extractAllFields(e),o=new Set([...Object.keys(i),...Object.keys(n)]),r=["dateStart","dateEnd","id","distance","drivingTime","averageSpeed","maxSpeed","fuelUsed","idleTime"];return[...r.filter(s=>o.has(s)),...Array.from(o).filter(s=>!r.includes(s)).sort((s,a)=>s.localeCompare(a))].map(s=>{let a=i[s]||"",c=n[s]||"",u,h=a,T=c,D=C=>{if(!C)return"";try{return String(parseFloat(C))}catch{return C.trim()}},E=D(a),k=D(c);return!a&&c?(u="missing_test",h="\u274C MISSING"):a&&!c?(u="missing_prod",T="\u274C MISSING"):E!==k&&a&&c?(u="different",h=`\u{1F539} ${a}`,T=`\u{1F538} ${c}`):E===k&&a?(u="identical",h=`\u2705 ${a}`,T=`\u2705 ${c}`):u="identical",{field:s,testValue:a,prodValue:c,status:u,displayTest:h,displayProd:T}})}static \u0275fac=function(e){return new(e||p)};static \u0275prov=N({token:p,factory:p.\u0275fac,providedIn:"root"})};var le=class p{telemetryService=w(ee);eventsService=w(te);tripsService=w(ne);getUnifiedTimeline(t,e,i,n,o){let r=this.telemetryService.getTelemetryComparison(t,e,i,n,o),l=this.eventsService.getEventsComparison(t,e,i,n,o),s=this.tripsService.getTripsComparison(t,e,i,n,o);return $({telemetry:r,events:l,trips:s}).pipe(S(({telemetry:a,events:c,trips:u})=>{let h=this.mergeRecordsChronologically(a,c,u),T=this.calculateUnifiedSummary(h,e,i);return{records:h,summary:T,rawData:{telemetry:a,events:c,trips:u}}}),A(a=>(console.error("\u274C Unified timeline error:",a),b({records:[],summary:this.getEmptyUnifiedSummary(e,i),rawData:{telemetry:{alignedRecords:[],testRecords:[],prodRecords:[]},events:{alignedRecords:[],testRecords:[],prodRecords:[]},trips:{alignedRecords:[],testRecords:[],prodRecords:[]}}}))))}mergeRecordsChronologically(t,e,i){let n=[];return t.alignedRecords.forEach((o,r)=>{n.push(this.convertToUnifiedRecord("telemetry",o,r))}),e.alignedRecords.forEach((o,r)=>{n.push(this.convertToUnifiedRecord("event",o,r))}),i.alignedRecords.forEach((o,r)=>{n.push(this.convertToUnifiedRecord("trip_start",o,r)),n.push(this.convertToUnifiedRecord("trip_end",o,r))}),n.sort((o,r)=>{try{let l=new Date(o.timestamp).getTime(),s=new Date(r.timestamp).getTime();return isNaN(l)||isNaN(s)?(console.warn("\u26A0\uFE0F Invalid timestamp found:",{recordA:o.type,timestampA:o.timestamp,recordB:r.type,timestampB:r.timestamp}),0):l-s}catch(l){return console.error("\u274C Error sorting records:",l,{recordA:o,recordB:r}),0}})}convertToUnifiedRecord(t,e,i){let n=e.testRecord,o=e.prodRecord,r=this.extractTimestamp(n,t)??this.extractTimestamp(o,t)??new Date().toISOString(),l;n&&o?l="both-environments":n&&!o?l="cypherView-only":l="key-only";let{matchingFields:s,totalFields:a,matchPercentage:c}=this.calculateRecordMatching(t,e);return{type:t,timestamp:r,index:i,timestampDiff:e.timestampDiff,testRecord:n,prodRecord:o,status:l,matchingFields:s,totalFields:a,matchPercentage:c,data:e}}extractTimestamp(t,e){if(F(t))return null;let i=this.getTimestampKeys(e);for(let n of i){let o=t[n];if(f(o))try{let r=typeof o=="string"?o:o.toString(),l=new Date(r);if(!isNaN(l.getTime()))return r}catch{console.warn("\u26A0\uFE0F Invalid timestamp format encountered:",o)}}return null}getTimestampKeys(t){switch(t){case"event":return["eventDate","eventTime","timestamp","received","date"];case"trip_start":return["startTime","timestamp","date"];case"trip_end":return["endTime","timestamp","date"];default:return["timestamp","received","date"]}}calculateRecordMatching(t,e){let i=[];switch(t){case"telemetry":i=this.telemetryService.compareFields(e.testRecord,e.prodRecord);break;case"event":i=this.eventsService.compareFields(e.testRecord,e.prodRecord);break;case"trip_start":case"trip_end":i=this.tripsService.compareFields(e.testRecord,e.prodRecord);break}let n=i.length,o=i.filter(l=>l.status==="identical").length,r=n>0?o/n*100:0;return{matchingFields:o,totalFields:n,matchPercentage:r}}calculateUnifiedSummary(t,e,i){let n=t.length,o=t.filter(C=>C.type==="telemetry").length,r=t.filter(C=>C.type==="event").length,l=t.filter(C=>C.type==="trip_start"||C.type==="trip_end").length,s=t.filter(C=>C.status==="both-environments").length,a=t.filter(C=>C.status==="cypherView-only").length,c=t.filter(C=>C.status==="key-only").length,u=t.reduce((C,P)=>C+(P.matchingFields??0),0),h=t.reduce((C,P)=>C+(P.totalFields??0),0),T=h>0?u/h*100:0,D="\u{1F534} Poor";T>=95?D="\u{1F7E2} Excellent":T>=85?D="\u{1F7E1} Good":T>=70&&(D="\u{1F7E0} Fair");let E=i.getTime()-e.getTime(),k=Math.round(E/(1e3*60*60)*10)/10;return{totalRecords:n,telemetryCount:o,eventsCount:r,tripsCount:l,bothPresentCount:s,testOnlyCount:a,prodOnlyCount:c,overallMatchRate:T,qualityStatus:D,timeRange:{start:e.toISOString(),end:i.toISOString(),duration:`${k}h`}}}getEmptyUnifiedSummary(t,e){let i=e.getTime()-t.getTime(),n=Math.round(i/(1e3*60*60)*10)/10;return{totalRecords:0,telemetryCount:0,eventsCount:0,tripsCount:0,bothPresentCount:0,testOnlyCount:0,prodOnlyCount:0,overallMatchRate:0,qualityStatus:"\u274C No Data",timeRange:{start:t.toISOString(),end:e.toISOString(),duration:`${n}h`}}}exportAsJson(t){return JSON.stringify({summary:t.summary,records:t.records,metadata:{generated:new Date().toISOString(),tool:"CypherView Unified Timeline",version:"1.0"}},null,2)}exportAsTextReport(t){let{summary:e,records:i}=t,n=`UNIFIED TIMELINE COMPARISON REPORT
`;return n+=`Generated: ${new Date().toISOString()}
`,n+=`
`,n+=`SUMMARY:
`,n+=`--------
`,n+=`Total Records: ${e.totalRecords}
`,n+=`- Telemetry: ${e.telemetryCount}
`,n+=`- Events: ${e.eventsCount}
`,n+=`- Trips: ${e.tripsCount}
`,n+=`
`,n+=`Status Distribution:
`,n+=`- Both Environments: ${e.bothPresentCount}
`,n+=`- CypherView Only: ${e.testOnlyCount}
`,n+=`- Key Only: ${e.prodOnlyCount}
`,n+=`
`,n+=`Overall Match Rate: ${e.overallMatchRate.toFixed(1)}% (${e.qualityStatus})
`,n+=`Time Range: ${e.timeRange.start} - ${e.timeRange.end} (${e.timeRange.duration})
`,n+=`
`,n+=`CHRONOLOGICAL TIMELINE:
`,n+=`=======================
`,i.forEach((o,r)=>{n+=`
[${r+1}] ${o.timestamp} - ${o.type.toUpperCase()}
`,n+=`Status: ${o.status}
`,o.matchPercentage!==void 0&&(n+=`Field Match: ${o.matchingFields}/${o.totalFields} (${o.matchPercentage.toFixed(1)}%)
`),o.timestampDiff!==void 0&&(n+=`Time Diff: \xB1${o.timestampDiff.toFixed(1)}s
`),n+=`---
`}),n}static \u0275fac=function(e){return new(e||p)};static \u0275prov=N({token:p,factory:p.\u0275fac,providedIn:"root"})};var Je=(p,t)=>t.field;function Ze(p,t){if(p&1&&(m(0,"p-message",5),g(1),d()),p&2){let e=v();y(),O(e.errorMessage())}}function Ye(p,t){if(p&1){let e=W();m(0,"p-button",12),M("onClick",function(){x(e);let n=v(2);return R(n.restartAnalysis())}),d()}p&2&&I("outlined",!0)}function Qe(p,t){if(p&1&&(m(0,"div",10)(1,"span"),g(2),d(),U(3,Ye,1,1,"p-button",11),d()),p&2){let e=v();y(2),O(e.analysisComplete()?"Analysis Configuration":"Asset Selection"),y(),z(e.analysisComplete()?3:-1)}}function Xe(p,t){if(p&1){let e=W();m(0,"div",7)(1,"div",13)(2,"div",14)(3,"strong",15),g(4,"Client:"),d(),m(5,"span",16),g(6),d()(),m(7,"div",14)(8,"strong",15),g(9,"Asset:"),d(),m(10,"span",16),g(11),d()(),m(12,"div",14)(13,"strong",15),g(14,"Period:"),d(),m(15,"span",16),g(16),K(17,"date"),K(18,"date"),d()(),m(19,"div",14)(20,"strong",15),g(21,"Duration:"),d(),m(22,"span",16),g(23),d()()(),m(24,"div",17)(25,"p-button",18),M("onClick",function(){x(e);let n=v();return R(n.toggleSearchArea())}),d()()()}if(p&2){let e,i=v();y(6),O(i.selectedClientName()),y(5),O(i.selectedAssetName()),y(5),me("",j(17,6,i.startDate(),"short")," - ",j(18,9,i.endDate(),"short")),y(7),O((e=i.selectedTimeRange())==null?null:e.label),y(2),I("outlined",!0)}}function et(p,t){p&1&&(m(0,"div",24),Q(1,"p-progress-spinner",38),d())}function tt(p,t){p&1&&(m(0,"div",24),Q(1,"p-progress-spinner",38),d())}function nt(p,t){if(p&1&&(m(0,"div",35)(1,"div",39)(2,"strong",40),g(3,"Start:"),d(),m(4,"span",41),g(5),K(6,"date"),d()(),m(7,"div",39)(8,"strong",40),g(9,"End:"),d(),m(10,"span",41),g(11),K(12,"date"),d()(),m(13,"div",42)(14,"strong",40),g(15,"Duration:"),d(),m(16,"span",41),g(17),d()()()),p&2){let e,i=v(2);y(5),O(j(6,3,i.startDate(),"short")),y(6),O(j(12,6,i.endDate(),"short")),y(6),O((e=i.selectedTimeRange())==null?null:e.label)}}function it(p,t){if(p&1){let e=W();m(0,"p-button",43),M("onClick",function(){x(e);let n=v(2);return R(n.clearAnalysis())}),d(),m(1,"p-button",44),M("onClick",function(){x(e);let n=v(2);return R(n.expandedRecords().size>0?n.collapseAllRecords():n.expandAllRecords())}),d()}if(p&2){let e=v(2);I("outlined",!0),y(),I("label",e.expandedRecords().size>0?"Collapse All":"Expand All")("icon",e.expandedRecords().size>0?"pi pi-minus":"pi pi-plus")("outlined",!0)}}function rt(p,t){if(p&1){let e=W();m(0,"div")(1,"div",19)(2,"div",20)(3,"label",21),g(4,"Client"),d(),m(5,"div",22)(6,"p-autocomplete",23),J("ngModelChange",function(n){x(e);let o=v();return H(o.selectedClient,n)||(o.selectedClient=n),R(n)}),M("completeMethod",function(n){x(e);let o=v();return R(o.onSearchClients(n))})("onSelect",function(n){x(e);let o=v();return R(o.onClientSelect(n))})("onUnselect",function(){x(e);let n=v();return R(n.onClientUnselect())})("onClear",function(){x(e);let n=v();return R(n.onClientUnselect())}),d(),U(7,et,2,0,"div",24),d()(),m(8,"div",20)(9,"label",25),g(10,"Asset"),d(),m(11,"div",22)(12,"p-autocomplete",26),J("ngModelChange",function(n){x(e);let o=v();return H(o.selectedAsset,n)||(o.selectedAsset=n),R(n)}),M("completeMethod",function(n){x(e);let o=v();return R(o.onSearchAssets(n))})("onSelect",function(n){x(e);let o=v();return R(o.onAssetSelect(n))})("onUnselect",function(){x(e);let n=v();return R(n.onAssetUnselect())})("onClear",function(){x(e);let n=v();return R(n.onAssetUnselect())}),d(),U(13,tt,2,0,"div",24),d()()(),m(14,"div",19)(15,"div",20)(16,"label",27),g(17,"Start Date"),d(),m(18,"p-datepicker",28),J("ngModelChange",function(n){x(e);let o=v();return H(o.startDate,n)||(o.startDate=n),R(n)}),M("onSelect",function(n){x(e);let o=v();return R(o.onStartDateChange(n))}),d()(),m(19,"div",20)(20,"label",29),g(21,"Duration"),d(),m(22,"p-select",30),J("ngModelChange",function(n){x(e);let o=v();return H(o.selectedTimeRange,n)||(o.selectedTimeRange=n),R(n)}),M("onChange",function(n){x(e);let o=v();return R(o.onTimeRangeChange(n.value))}),d()()(),m(23,"div",19)(24,"div",20)(25,"label",31),g(26,"Key API Username"),d(),m(27,"input",32),J("ngModelChange",function(n){x(e);let o=v();return H(o.keyApiUsername,n)||(o.keyApiUsername=n),R(n)}),d()(),m(28,"div",20)(29,"label",33),g(30,"Key API Password"),d(),m(31,"input",34),J("ngModelChange",function(n){x(e);let o=v();return H(o.keyApiPassword,n)||(o.keyApiPassword=n),R(n)}),d()()(),U(32,nt,18,9,"div",35),m(33,"div",36)(34,"p-button",37),M("onClick",function(){x(e);let n=v();return R(n.onAnalyzeTelemetry())}),d(),U(35,it,2,4),d()()}if(p&2){let e=v();y(6),G("ngModel",e.selectedClient),I("suggestions",e.filteredClients())("minLength",0)("delay",100)("showClear",!0)("forceSelection",!0)("completeOnFocus",!0)("dropdown",!0),y(),z(e.loadingClients()?7:-1),y(5),G("ngModel",e.selectedAsset),I("suggestions",e.filteredAssets())("minLength",0)("delay",100)("disabled",!e.selectedClient())("showClear",!0)("forceSelection",!0)("completeOnFocus",!0)("dropdown",!0),y(),z(e.loadingAssets()?13:-1),y(5),G("ngModel",e.startDate),I("showTime",!0)("showSeconds",!1)("showIcon",!0)("showClear",!0),y(4),G("ngModel",e.selectedTimeRange),I("options",e.timeRangeOptions())("showClear",!0),y(5),G("ngModel",e.keyApiUsername),y(4),G("ngModel",e.keyApiPassword),y(),z(e.startDate()&&e.selectedTimeRange()?32:-1),y(2),I("disabled",!e.isReadyForAnalysis()||e.isAnalyzing())("loading",e.isAnalyzing()),y(),z(e.analysisComplete()?35:-1)}}function ot(p,t){p&1&&(m(0,"div",9),Q(1,"p-progress-spinner",45),m(2,"h3",46),g(3," Analyzing Telemetry Data "),d(),m(4,"p",47),g(5," Fetching and comparing data from CypherView and Key environments... "),d()())}function st(p,t){if(p&1){let e=W();m(0,"div",56)(1,"div",57)(2,"span",58),g(3,"\u{1F4CA} Unified Timeline:"),d(),m(4,"span",59),g(5),K(6,"number"),d()()(),m(7,"div",60)(8,"span",61),g(9,"Show:"),d(),m(10,"div",62)(11,"p-button",63),M("onClick",function(){x(e);let n=v(2);return R(n.toggleTelemetryFilter())}),d(),m(12,"p-button",63),M("onClick",function(){x(e);let n=v(2);return R(n.toggleEventsFilter())}),d(),m(13,"p-button",63),M("onClick",function(){x(e);let n=v(2);return R(n.toggleTripsFilter())}),d()()()}if(p&2){let e=t,i=v(2);y(5),Ce("",e.totalRecords," records (\u{1F4E1}",e.telemetryCount," \u26A1",e.eventsCount," \u{1F697}",e.tripsCount,") \u2022 ",e.bothPresentCount," both \u2022 ",j(6,16,e.overallMatchRate,"1.0-0"),"% match \u2022 ",e.qualityStatus),y(6),I("label",i.telemetryFilterLabel())("severity",i.showTelemetry()?"primary":"secondary")("outlined",!i.showTelemetry()),y(),I("label",i.eventsFilterLabel())("severity",i.showEvents()?"info":"secondary")("outlined",!i.showEvents()),y(),I("label",i.tripsFilterLabel())("severity",i.showTrips()?"help":"secondary")("outlined",!i.showTrips())}}function at(p,t){if(p&1&&(m(0,"div",56)(1,"div",57)(2,"span",58),g(3,"\u{1F4CA} Telemetry Only:"),d(),m(4,"span",59),g(5),K(6,"number"),d()()()),p&2){let e=t;y(5),ve("",e.totalAligned," records \u2022 ",e.bothPresent," both \u2022 ",j(6,4,e.matchRate,"1.0-0"),"% match \u2022 ",e.qualityStatus)}}function lt(p,t){if(p&1&&U(0,at,7,7,"div",56),p&2){let e,i=v(2);z((e=i.comparisonSummary())?0:-1,e)}}function dt(p,t){if(p&1&&(m(0,"span",68),g(1),K(2,"number"),d()),p&2){let e=v();y(),oe("(\xB1",j(2,1,e.timestampDiff,"1.0-0"),"s)")}}function ct(p,t){if(p&1&&(m(0,"div")(1,"div",75),g(2),d(),m(3,"div",71)(4,"span",76),g(5),d(),m(6,"span",77),g(7,"vs"),d(),m(8,"span",78),g(9),d()()()),p&2){let e=t.$implicit;re("grid grid-cols-[150px_1fr] gap-2 px-2 py-1 border-b border-gray-100 text-[0.7rem] items-center even:bg-gray-50 last:border-b-0 field-row "+e.status),y(2),oe(" ",e.field," "),y(2),ce("has-value",e.testValue),y(),O(e.displayTest),y(3),ce("has-value",e.prodValue),y(),O(e.displayProd)}}function mt(p,t){if(p&1){let e=W();m(0,"div",64),M("keydown",function(n){x(e);let o=v(2);return R(o.onKeyDown(n))}),m(1,"div",65)(2,"div"),g(3),d(),m(4,"span",66),g(5),d(),m(6,"span",67),g(7),d(),U(8,dt,3,4,"span",68),d(),m(9,"div",69)(10,"div",70),g(11,"Field"),d(),m(12,"div",71)(13,"span",72),g(14,"\u{1F539} CypherView"),d(),m(15,"span",73),g(16,"vs"),d(),m(17,"span",74),g(18,"\u{1F538} Key API"),d()()(),m(19,"div"),ge(20,ct,10,9,"div",54,Je),d()()}if(p&2){let e=t,i=v(2);re("border border-gray-200 rounded bg-white outline-none focus:ring-2 focus:ring-blue-200 compact-record "+i.getRecordStatus(e)),y(2),re("px-2 py-0.5 rounded-xl text-[0.6rem] font-bold uppercase tracking-wide min-w-fit record-type-badge "+i.getRecordTypeBadgeClass(e)),y(),oe(" ",i.getRecordTypeDisplay(e)," "),y(2),O(i.getRecordStatusIcon(e)),y(2),O(i.getRecordTimestamp(e)),y(),z(e.timestampDiff!==void 0?8:-1),y(12),ye(i.getFieldComparisons(e))}}function pt(p,t){p&1&&(m(0,"div",55),g(1," No telemetry records found. "),d())}function ut(p,t){if(p&1){let e=W();U(0,st,14,19)(1,lt,1,1),m(2,"div",6)(3,"div",48)(4,"p-button",49),M("onClick",function(){x(e);let n=v();return R(n.goToRecord(0))}),d(),m(5,"p-button",50),M("onClick",function(){x(e);let n=v();return R(n.goToPreviousRecord())}),d(),m(6,"span",51),g(7),d(),m(8,"p-button",52),M("onClick",function(){x(e);let n=v();return R(n.goToNextRecord())}),d(),m(9,"p-button",53),M("onClick",function(){x(e);let n=v();return R(n.goToRecord(n.totalRecords()-1))}),d()()(),U(10,mt,22,8,"div",54)(11,pt,2,0,"div",55)}if(p&2){let e,i,n=v();z((e=n.unifiedSummary())?0:1,e),y(4),I("disabled",!n.hasPrevious())("outlined",!0),y(),I("disabled",!n.hasPrevious())("outlined",!0),y(2),O(n.recordPosition()),y(),I("disabled",!n.hasNext())("outlined",!0),y(),I("disabled",!n.hasNext())("outlined",!0),y(),z((i=n.currentRecord())?10:11,i)}}function gt(p,t){if(p&1&&(m(0,"div",79)(1,"h3",80),g(2," Selected Configuration "),d(),m(3,"div",81)(4,"div",82)(5,"strong",83),g(6,"Client:"),d(),m(7,"span",84),g(8),d()(),m(9,"div",82)(10,"strong",83),g(11,"Asset:"),d(),m(12,"span",84),g(13),d()(),m(14,"div",82)(15,"strong",83),g(16,"Time Range:"),d(),m(17,"span",84),g(18),K(19,"date"),K(20,"date"),d()(),m(21,"div",82)(22,"strong",83),g(23,"Duration:"),d(),m(24,"span",84),g(25),d()()()(),m(26,"div")(27,"div",9),Q(28,"i",85),m(29,"h3",46),g(30," Ready for Telemetry Analysis "),d(),m(31,"p",47),g(32,' Click "Analyze Telemetry" to compare data between CypherView and Key environments. '),d(),m(33,"p",86),g(34),d()()()),p&2){let e,i,n=v();y(8),O(n.selectedClientName()),y(5),O(n.selectedAssetName()),y(5),me("",j(19,8,n.startDate(),"short")," - ",j(20,11,n.endDate(),"short")),y(7),O((e=n.selectedTimeRange())==null?null:e.label),y(9),he(" ",n.selectedClientName()," \u2192 ",n.selectedAssetName()," (",(i=n.selectedTimeRange())==null?null:i.label,") ")}}function yt(p,t){p&1&&(m(0,"div",9),Q(1,"i",87),m(2,"h3",46),g(3," Complete Configuration "),d(),m(4,"p",47),g(5," Please select a client, asset, start date, and duration to begin telemetry analysis. "),d()())}var de=class p{clientsService=w(Se);assetsService=w(we);authDataService=w(De);utilityService=w(Me);telemetryComparisonService=w(ee);eventsComparisonService=w(te);tripsComparisonService=w(ne);unifiedTimelineService=w(le);title="Telemetry Comparison";clients=_([]);assets=_([]);filteredClients=_([]);filteredAssets=_([]);selectedClient=_(null);selectedAsset=_(null);loadingClients=_(!1);loadingAssets=_(!1);errorMessage=_(null);currentOwnerId=_(null);startDate=_(null);selectedTimeRange=_(null);timeRangeOptions=_([{label:"20 minutes",value:"20min",hours:.33},{label:"1 hour",value:"1h",hours:1},{label:"4 hours",value:"4h",hours:4},{label:"12 hours",value:"12h",hours:12}]);keyApiUsername=_("");keyApiPassword=_("");unifiedTimeline=_([]);unifiedSummary=_(null);isAnalyzing=_(!1);analysisComplete=_(!1);expandedRecords=_(new Set);alignedRecords=_([]);comparisonSummary=_(null);showCompactSummary=_(!0);showFullSearchForm=_(!1);showTelemetry=_(!0);showEvents=_(!0);showTrips=_(!0);currentRecordIndex=_(0);pageSize=_(1);showPagination=_(!0);selectedClientName=V(()=>this.selectedClient()?.label??"Unknown");selectedAssetName=V(()=>this.selectedAsset()?.label??"Unknown");endDate=V(()=>{let t=this.startDate(),e=this.selectedTimeRange();return!t||!e?null:new Date(t.getTime()+e.hours*60*60*1e3)});isReadyForAnalysis=V(()=>!!(f(this.selectedClient()?.value)&&f(this.selectedAsset()?.value)&&f(this.startDate())&&f(this.selectedTimeRange())&&this.keyApiUsername().trim()&&this.keyApiPassword().trim()));filteredRecords=V(()=>{let t=this.unifiedTimeline().length>0?this.unifiedTimeline():this.alignedRecords();return this.unifiedTimeline().length>0?t.filter(e=>{if(this.isUnifiedTimelineRecord(e)){if(e.type==="telemetry")return this.showTelemetry();if(e.type==="event")return this.showEvents();if(e.type==="trip_start"||e.type==="trip_end")return this.showTrips()}return!0}):this.showTelemetry()?t:[]});currentRecord=V(()=>{let t=this.filteredRecords(),e=this.currentRecordIndex();return t[e]??null});totalRecords=V(()=>this.filteredRecords().length);hasPrevious=V(()=>this.currentRecordIndex()>0);hasNext=V(()=>this.currentRecordIndex()<this.totalRecords()-1);recordPosition=V(()=>{let t=this.currentRecordIndex()+1,e=this.totalRecords();return`${t} of ${e}`});telemetryFilterLabel=V(()=>`\u{1F4E1} Telemetry (${this.unifiedTimeline().filter(e=>e.type==="telemetry").length})`);eventsFilterLabel=V(()=>`\u26A1 Events (${this.unifiedTimeline().filter(e=>e.type==="event").length})`);tripsFilterLabel=V(()=>`\u{1F697} Trips (${this.unifiedTimeline().filter(e=>e.type==="trip_start"||e.type==="trip_end").length})`);constructor(){}isUnifiedTimelineRecord(t){return f(t)&&typeof t=="object"&&t!==null&&"type"in t}ngOnInit(){let t=new Date,e=new Date(t.getTime()-3600*1e3);this.startDate.set(e),this.selectedTimeRange.set(this.timeRangeOptions()[1]);let i=this.authDataService.getUserProfile();f(i?.owner?.id)?(this.currentOwnerId.set(i.owner.id),this.loadInitialClients(i.owner.id)):this.errorMessage.set("Unable to determine user owner ID")}loadInitialClients(t){this.loadingClients.set(!0),this.errorMessage.set(null);let e={state:{value:"active",operator:"="}},i=this.utilityService.constructRqlFilter(e);this.clientsService.listClients(t,0,100,"name:asc",i).subscribe({next:n=>{let o=n.items?.map(r=>({label:r.name||`Client ${r.id}`,value:r.id}))??[];this.clients.set(o),this.filteredClients.set(o),this.loadingClients.set(!1)},error:n=>{this.errorMessage.set("Failed to load clients. Please try again."),this.loadingClients.set(!1)}})}onSearchClients(t){let e=t.query?.trim()||"",i=this.currentOwnerId();if(!f(i))return;this.loadingClients.set(!0);let n={state:{value:"active",operator:"="}};e.length>0&&(n.name={value:`*${e}*`,operator:"="});let o=this.utilityService.constructRqlFilter(n);this.clientsService.listClients(i,0,100,"name:asc",o).subscribe({next:r=>{let l=r.items?.map(s=>({label:s.name||`Client ${s.id}`,value:s.id}))??[];this.filteredClients.set(l),this.loadingClients.set(!1)},error:r=>{this.filteredClients.set([]),this.loadingClients.set(!1)}})}onClientSelect(t){let e=t.value;this.selectedClient.set(e),this.selectedAsset.set(null),this.assets.set([]),this.filteredAssets.set([]),e?.value&&this.loadInitialAssets(e.value)}onClientUnselect(){this.selectedClient.set(null),this.selectedAsset.set(null),this.assets.set([]),this.filteredAssets.set([])}loadInitialAssets(t){this.loadingAssets.set(!0),this.errorMessage.set(null),this.assetsService.listAssets(t,0,1e3).subscribe({next:e=>{let i=e.items?.map(n=>({label:n.name||`Asset ${n.id}`,value:n.id,assetData:n}))??[];this.assets.set(i),this.filteredAssets.set(i),this.loadingAssets.set(!1)},error:()=>{this.errorMessage.set("Failed to load assets. Please try again."),this.loadingAssets.set(!1)}})}onSearchAssets(t){let e=t.query.trim().toLowerCase(),i=this.assets();if(!e){this.filteredAssets.set(i);return}let n=i.filter(o=>o.label.toLowerCase().includes(e));this.filteredAssets.set(n)}onAssetSelect(t){let e=t.value;this.selectedAsset.set(e),e?.value&&f(this.selectedClient()?.value)}onAssetUnselect(){this.selectedAsset.set(null)}onStartDateChange(t){this.startDate.set(t)}onTimeRangeChange(t){if(this.selectedTimeRange.set(t),t&&this.startDate()){let e=this.startDate();if(e){let i=new Date,n=t.hours*60*60*1e3;if(new Date(e.getTime()+n)>i){let r=new Date(i.getTime()-n);this.startDate.set(r)}}}}getDeviceNameFromAsset(t){let e=t.assetData;return!e?.devices||!Array.isArray(e.devices)||e.devices.length===0?void 0:e.devices[0]?.name??void 0}onAnalyzeTelemetry(){let t=this.selectedClient(),e=this.selectedAsset(),i=this.startDate(),n=this.endDate(),o=this.selectedTimeRange();if(this.isReadyForAnalysis()&&i&&n&&f(e?.value)){this.isAnalyzing.set(!0),this.errorMessage.set(null),this.analysisComplete.set(!1),this.unifiedTimeline.set([]),this.unifiedSummary.set(null),this.alignedRecords.set([]),this.comparisonSummary.set(null);let r=this.keyApiUsername().trim(),l=this.keyApiPassword().trim();this.telemetryComparisonService.setKeyApiCredentials(r,l),this.eventsComparisonService.setKeyApiCredentials(r,l),this.tripsComparisonService.setKeyApiCredentials(r,l);let s=this.getDeviceNameFromAsset(e);this.unifiedTimelineService.getUnifiedTimeline(e.value,i,n,200,s).subscribe({next:a=>{let c=a.records.filter(h=>h.testRecord);if(a.rawData.telemetry.testRecords.length+a.rawData.events.testRecords.length+a.rawData.trips.testRecords.length===0){this.isAnalyzing.set(!1),this.analysisComplete.set(!1),this.errorMessage.set(`No CypherView data found for ${e?.label} during the selected time period (${o?.label}). Please verify that the device was pointing to CypherView ingestion services during this time.`);return}this.unifiedTimeline.set(a.records),this.unifiedSummary.set(a.summary),this.isAnalyzing.set(!1),this.analysisComplete.set(!0),this.currentRecordIndex.set(0),this.expandAllRecords()},error:a=>{this.errorMessage.set("Failed to analyze unified timeline. Please try again."),this.isAnalyzing.set(!1),this.analysisComplete.set(!1)}})}else this.errorMessage.set("Please complete all fields including Key API credentials.")}toggleRecordExpansion(t){let e=this.expandedRecords(),i=new Set(e);i.has(t)?i.delete(t):i.add(t),this.expandedRecords.set(i)}getFieldComparisons(t){if(this.isUnifiedTimelineRecord(t))switch(t.type){case"telemetry":return this.telemetryComparisonService.compareFields(t.testRecord,t.prodRecord);case"event":return this.eventsComparisonService.compareFields(t.testRecord,t.prodRecord);case"trip_start":case"trip_end":return this.tripsComparisonService.compareFields(t.testRecord,t.prodRecord);default:return[]}else{let e=t;return this.telemetryComparisonService.compareFields(e.testRecord,e.prodRecord)}}getRecordTimestamp(t){if(this.isUnifiedTimelineRecord(t)){let e=t.timestamp;try{return new Date(e).toLocaleString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return e}}else{let e=t,i=e.testRecord||e.prodRecord;if(!i)return"UNKNOWN TIME";let n=i.timestamp??i.date??i.received;if(F(n))return"UNKNOWN TIME";try{return new Date(n).toLocaleString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return n}}}getRecordStatus(t){if(this.isUnifiedTimelineRecord(t))return t.status;{let e=t;return e.testRecord&&e.prodRecord?"both-environments":e.testRecord?"cypherView-only":"key-only"}}getRecordStatusIcon(t){if(this.isUnifiedTimelineRecord(t))return t.testRecord&&t.prodRecord?"\u2705":t.testRecord?"\u{1F539}":"\u{1F538}";{let e=t;return e.testRecord&&e.prodRecord?"\u2705":e.testRecord?"\u{1F539}":"\u{1F538}"}}getRecordTypeDisplay(t){if(this.isUnifiedTimelineRecord(t))switch(t.type){case"telemetry":return"TELEMETRY";case"event":return"EVENT";case"trip_start":return"TRIP START";case"trip_end":return"TRIP END";default:return"UNKNOWN"}else return"TELEMETRY"}getRecordTypeBadgeClass(t){if(this.isUnifiedTimelineRecord(t))switch(t.type){case"telemetry":return"badge-telemetry";case"event":return"badge-event";case"trip_start":case"trip_end":return"badge-trip";default:return"badge-unknown"}else return"badge-telemetry"}clearAnalysis(){this.alignedRecords.set([]),this.comparisonSummary.set(null),this.analysisComplete.set(!1),this.expandedRecords.set(new Set),this.currentRecordIndex.set(0)}goToPreviousRecord(){this.hasPrevious()&&this.currentRecordIndex.update(t=>t-1)}goToNextRecord(){this.hasNext()&&this.currentRecordIndex.update(t=>t+1)}goToRecord(t){t>=0&&t<this.totalRecords()&&this.currentRecordIndex.set(t)}expandAllRecords(){let t=this.totalRecords(),e=new Set(Array.from({length:t},(i,n)=>n));this.expandedRecords.set(e)}collapseAllRecords(){this.expandedRecords.set(new Set)}toggleSearchArea(){this.showCompactSummary.update(t=>!t),this.showFullSearchForm.update(t=>!t)}restartAnalysis(){this.analysisComplete.set(!1),this.unifiedTimeline.set([]),this.unifiedSummary.set(null),this.alignedRecords.set([]),this.comparisonSummary.set(null),this.errorMessage.set(null),this.currentRecordIndex.set(0),this.expandedRecords.set(new Set),this.showTelemetry.set(!0),this.showEvents.set(!0),this.showTrips.set(!0),this.showCompactSummary.set(!1),this.showFullSearchForm.set(!1)}toggleTelemetryFilter(){this.showTelemetry.update(t=>!t),this.resetToFirstRecord()}toggleEventsFilter(){this.showEvents.update(t=>!t),this.resetToFirstRecord()}toggleTripsFilter(){this.showTrips.update(t=>!t),this.resetToFirstRecord()}resetToFirstRecord(){this.currentRecordIndex.set(0)}onKeyDown(t){t.key==="ArrowLeft"||t.key==="ArrowUp"?(t.preventDefault(),this.goToPreviousRecord()):t.key==="ArrowRight"||t.key==="ArrowDown"?(t.preventDefault(),this.goToNextRecord()):t.key==="Home"?(t.preventDefault(),this.goToRecord(0)):t.key==="End"&&(t.preventDefault(),this.goToRecord(this.totalRecords()-1))}static \u0275fac=function(e){return new(e||p)};static \u0275cmp=pe({type:p,selectors:[["app-telemetry-comparison"]],decls:20,vars:4,consts:[["title",""],[1,"p-4","max-w-6xl","mx-auto"],[1,"mb-4","p-4","bg-gradient-to-br","from-white","to-gray-50","rounded-lg","border","border-gray-200","shadow-sm"],[1,"text-3xl","font-bold","text-gray-800","mb-2"],[1,"text-sm","text-gray-600","m-0"],["severity","error",1,"mb-6"],[1,"mb-2"],[1,"flex","justify-between","items-center","gap-4"],["header","Unified Timeline Analysis",1,"analysis-panel","compact-card"],[1,"text-center","py-12","px-8","bg-gray-50","rounded","border-2","border-dashed","border-gray-200"],[1,"flex","justify-between","items-center","w-full"],["icon","pi pi-refresh","label","New Search","size","small","severity","secondary",3,"outlined"],["icon","pi pi-refresh","label","New Search","size","small","severity","secondary",3,"onClick","outlined"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-3","flex-1","min-w-0"],[1,"flex","gap-2","items-baseline"],[1,"text-gray-600","text-xs","font-semibold","uppercase","tracking-wider","whitespace-nowrap"],[1,"text-gray-800","text-sm","font-medium"],[1,"flex","gap-2"],["icon","pi pi-pencil","label","Edit","size","small","severity","secondary",3,"onClick","outlined"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-4"],[1,"flex","flex-col","gap-1"],["for","client-autocomplete",1,"font-medium","text-gray-600","text-xs","uppercase","tracking-wider"],[1,"relative","w-full"],["id","client-autocomplete","placeholder","Search for a client...","field","label","inputStyleClass","w-full",1,"w-full",3,"ngModelChange","completeMethod","onSelect","onUnselect","onClear","ngModel","suggestions","minLength","delay","showClear","forceSelection","completeOnFocus","dropdown"],[1,"absolute","right-10","top-1/2","transform","-translate-y-1/2","z-10","pointer-events-none","flex","items-center","justify-center"],["for","asset-autocomplete",1,"font-medium","text-gray-600","text-xs","uppercase","tracking-wider"],["id","asset-autocomplete","placeholder","Search for an asset...","field","label","inputStyleClass","w-full",1,"w-full",3,"ngModelChange","completeMethod","onSelect","onUnselect","onClear","ngModel","suggestions","minLength","delay","disabled","showClear","forceSelection","completeOnFocus","dropdown"],["for","start-date-picker",1,"font-medium","text-gray-600","text-xs","uppercase","tracking-wider"],["id","start-date-picker","placeholder","Select start date and time","hourFormat","24","inputStyleClass","w-full",1,"w-full",3,"ngModelChange","onSelect","ngModel","showTime","showSeconds","showIcon","showClear"],["for","time-range-select",1,"font-medium","text-gray-600","text-xs","uppercase","tracking-wider"],["id","time-range-select","placeholder","Select duration","optionLabel","label",1,"w-full",3,"ngModelChange","onChange","ngModel","options","showClear"],["for","key-username",1,"font-medium","text-gray-600","text-xs","uppercase","tracking-wider"],["id","key-username","type","text","placeholder","Enter Key API username","autocomplete","username",1,"p-inputtext","p-component","w-full",3,"ngModelChange","ngModel"],["for","key-password",1,"font-medium","text-gray-600","text-xs","uppercase","tracking-wider"],["id","key-password","type","password","placeholder","Enter Key API password","autocomplete","current-password",1,"p-inputtext","p-component","w-full",3,"ngModelChange","ngModel"],[1,"mb-3","p-3","bg-gray-50","rounded","border","border-gray-200"],[1,"flex","justify-start","pt-2","border-t","border-gray-200"],["label","Analyze Telemetry","icon","pi pi-chart-scatter","severity","primary",3,"onClick","disabled","loading"],["strokeWidth","2",1,"w-[16px]","h-[16px]"],[1,"flex","justify-between","items-center","mb-2"],[1,"text-gray-600","text-sm","uppercase","tracking-wider"],[1,"text-gray-600","font-mono","text-sm"],[1,"flex","justify-between","items-center"],["label","Clear Results","icon","pi pi-times","severity","secondary",3,"onClick","outlined"],["severity","secondary",3,"onClick","label","icon","outlined"],["strokeWidth","2",1,"mb-4"],[1,"my-4","text-gray-600","text-xl","font-medium"],[1,"my-2","text-gray-500"],[1,"flex","justify-center","items-center","gap-1","p-1","bg-gray-50","rounded","border","border-gray-200"],["icon","pi pi-angle-double-left","size","small","severity","secondary",3,"onClick","disabled","outlined"],["icon","pi pi-angle-left","size","small","severity","secondary",3,"onClick","disabled","outlined"],[1,"px-2","font-semibold","text-gray-600","text-xs","min-w-[60px]","text-center"],["icon","pi pi-angle-right","size","small","severity","secondary",3,"onClick","disabled","outlined"],["icon","pi pi-angle-double-right","size","small","severity","secondary",3,"onClick","disabled","outlined"],[3,"class"],[1,"p-12","text-center","text-gray-500","bg-gray-50","rounded-lg","border","border-gray-200"],[1,"mb-2","p-2","px-3","bg-gray-50","rounded","border-l-4","border-green-500"],[1,"flex","gap-2","items-center","text-sm"],[1,"font-semibold","text-gray-600"],[1,"text-gray-500"],[1,"flex","items-center","gap-3","mb-2","p-2","bg-gray-50","rounded","border","border-gray-200"],[1,"font-semibold","text-gray-600","text-xs","uppercase","tracking-wider","whitespace-nowrap"],[1,"flex","gap-2","flex-wrap"],["size","small","styleClass","filter-btn",3,"onClick","label","severity","outlined"],[3,"keydown"],[1,"flex","items-center","gap-2","px-3","py-2","bg-gray-50","border-b","border-gray-200","text-xs"],[1,"text-base"],[1,"font-semibold","text-gray-700","flex-1"],[1,"text-gray-500","text-xs","bg-gray-200","px-1","py-0.5","rounded"],[1,"grid","grid-cols-[150px_1fr]","gap-2","px-2","py-2","bg-gray-200","border-b-2","border-gray-600","text-[0.7rem]","font-bold","uppercase","tracking-wide","text-gray-600"],[1,"flex","items-center","justify-start"],[1,"flex","items-center","gap-1","font-mono","text-[0.65rem]"],[1,"flex-1","text-center","text-blue-900","bg-blue-50","px-1","py-1","rounded","border-l-2","border-blue-500","font-semibold"],[1,"text-gray-500","text-[0.625rem]","font-semibold","min-w-fit"],[1,"flex-1","text-center","text-yellow-700","bg-yellow-50","px-1","py-1","rounded","border-l-2","border-yellow-400","font-semibold"],[1,"font-semibold","text-gray-600","break-words","text-[0.65rem]"],[1,"flex-1","px-1","py-0.5","rounded","break-all","cv-value"],[1,"text-gray-500","text-[0.625rem]","font-semibold"],[1,"flex-1","px-1","py-0.5","rounded","break-all","key-value"],[1,"mb-8","p-6","bg-gradient-to-br","from-gray-50","to-gray-100","rounded-lg","border-l-4","border-blue-500","shadow-sm"],[1,"m-0","mb-4","text-gray-600","text-lg","font-medium"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-4","gap-4"],[1,"flex","flex-col","gap-2","p-4","bg-white","rounded","shadow-sm"],[1,"text-gray-600","text-sm","uppercase","tracking-wider","font-semibold"],[1,"text-gray-800","text-base","font-medium"],[1,"pi","pi-chart-scatter","text-5xl","text-gray-500"],[1,"text-sm","text-gray-400","italic"],[1,"pi","pi-info-circle","text-5xl","text-gray-500"]],template:function(e,i){if(e&1&&(m(0,"div",1)(1,"div",2)(2,"h1",3),g(3),d(),m(4,"p",4)(5,"strong"),g(6,"Compare CypherView data with Key API data."),d(),g(7," This development tool analyzes and compares telemetry, events, and trips between both systems. "),d()(),U(8,Ze,2,1,"p-message",5),m(9,"div")(10,"p-card",6),ue(11,Qe,4,2,"ng-template",null,0,Te),U(13,Xe,26,12,"div",7)(14,rt,36,33,"div"),d(),m(15,"p-card",8),U(16,ot,6,0,"div",9)(17,ut,12,11)(18,gt,35,14)(19,yt,6,0,"div",9),d()()()),e&2){let n=fe(12);y(3),O(n),y(5),z(i.errorMessage()?8:-1),y(5),z(i.analysisComplete()&&i.showCompactSummary()?13:14),y(3),z(i.isAnalyzing()?16:i.analysisComplete()?17:i.isReadyForAnalysis()?18:19)}},dependencies:[xe,Pe,Oe,Fe,Ie,Ve,Ne,Ge,qe,Ke,$e,We,Be,Le,je,ke,Ee,ze,Ue,_e,be],styles:[".compact-record.both-environments[_ngcontent-%COMP%]{border-left:4px solid #28a745}.compact-record.cypherView-only[_ngcontent-%COMP%]{border-left:4px solid #007bff}.compact-record.key-only[_ngcontent-%COMP%]{border-left:4px solid #ff9800}.record-type-badge.badge-telemetry[_ngcontent-%COMP%]{background:#007bff26;color:#004085;border:1px solid rgba(0,123,255,.3)}.record-type-badge.badge-event[_ngcontent-%COMP%]{background:#ffc10726;color:#856404;border:1px solid rgba(255,193,7,.3)}.record-type-badge.badge-trip[_ngcontent-%COMP%]{background:#28a74526;color:#155724;border:1px solid rgba(40,167,69,.3)}.record-type-badge.badge-unknown[_ngcontent-%COMP%]{background:#6c757d26;color:#495057;border:1px solid rgba(108,117,125,.3)}.cv-value[_ngcontent-%COMP%]{background:#007bff14;border-left:2px solid #007bff;color:#004085}.cv-value.has-value[_ngcontent-%COMP%]{font-weight:500}.key-value[_ngcontent-%COMP%]{background:#ffc10726;border-left:2px solid #ffc107;color:#856404}.key-value.has-value[_ngcontent-%COMP%]{font-weight:500}.field-row.identical[_ngcontent-%COMP%]   .cv-value[_ngcontent-%COMP%], .field-row.identical[_ngcontent-%COMP%]   .key-value[_ngcontent-%COMP%]{color:#155724;font-weight:500}.field-row.different[_ngcontent-%COMP%]   .cv-value[_ngcontent-%COMP%], .field-row.different[_ngcontent-%COMP%]   .key-value[_ngcontent-%COMP%]{color:#721c24;font-weight:600;background-color:#dc35451a}.field-row.missing_test[_ngcontent-%COMP%]   .cv-value[_ngcontent-%COMP%], .field-row.missing_prod[_ngcontent-%COMP%]   .key-value[_ngcontent-%COMP%]{color:#721c24;font-weight:600;background:#dc354526;border-left-color:#dc3545}.compact-card[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:ng-deep   .p-card-header[_ngcontent-%COMP%]{padding:.75rem 1rem;font-size:.875rem;font-weight:600}.compact-card[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:ng-deep   .p-card-content[_ngcontent-%COMP%]{padding:.75rem 1rem}[_ngcontent-%COMP%]:ng-deep   .filter-btn[_ngcontent-%COMP%]   .p-button-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600}[_ngcontent-%COMP%]:ng-deep   .p-autocomplete[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%], [_ngcontent-%COMP%]:ng-deep   .p-datepicker[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%], [_ngcontent-%COMP%]:ng-deep   .p-select[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%], [_ngcontent-%COMP%]:ng-deep   .p-inputtext[_ngcontent-%COMP%]   .p-inputtext[_ngcontent-%COMP%]{padding:.5rem .75rem;font-size:.875rem;height:auto;min-height:2.25rem}[_ngcontent-%COMP%]:ng-deep   .p-autocomplete-input[_ngcontent-%COMP%], [_ngcontent-%COMP%]:ng-deep   .p-datepicker-input[_ngcontent-%COMP%]{padding:.5rem .75rem!important;font-size:.875rem!important;height:2.25rem!important}[_ngcontent-%COMP%]:ng-deep   .p-select[_ngcontent-%COMP%]{min-height:2.25rem}[_ngcontent-%COMP%]:ng-deep   .p-select[_ngcontent-%COMP%]   .p-select-label[_ngcontent-%COMP%]{padding:.5rem .75rem;font-size:.875rem}[_ngcontent-%COMP%]:ng-deep   .p-button[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.875rem}[_ngcontent-%COMP%]:ng-deep   .p-button.p-button-sm[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:.75rem}"]})};var ci=[{path:"",redirectTo:"telemetry-comparison",pathMatch:"full"},{path:"telemetry-comparison",component:de},{path:"analytical-report",component:He}];export{ci as DEVELOPMENT_ROUTES};
