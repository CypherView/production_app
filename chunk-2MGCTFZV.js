import{a as b}from"./chunk-XGZWX4PW.js";import{a as F}from"./chunk-KAPCDYJA.js";import{ja as A,la as L}from"./chunk-ZDWK5NB6.js";import{ta as D}from"./chunk-JAXNIEKX.js";import{Pc as m,T as n}from"./chunk-FEC2V4R3.js";import{F as u,K as g,Y as h,ba as a,j as l,la as S,na as E,r as y}from"./chunk-EG5ORV3B.js";import{a as p,b as v}from"./chunk-VB56BUGO.js";var f=class s{adapters=new Map;adapterTypes=new Map;injector=a(S);registrations=a(b,{optional:!0});constructor(){let e=this.registrations;if(n(e))for(let t of e)for(let r of t.types)this.adapterTypes.set(r.toLowerCase(),t.adapter)}getAdapter(e){let t=e.toLowerCase();if(this.adapters.has(t))return this.adapters.get(t)??null;let r=this.createAdapter(e);return r&&this.adapters.set(t,r),r}createAdapter(e){let t=this.adapterTypes.get(e.toLowerCase());if(!t)return null;try{return this.injector.get(t)}catch(r){return console.error(`Failed to create adapter for entity type: ${e}`,r),null}}static \u0275fac=function(t){return new(t||s)};static \u0275prov=h({token:s,factory:s.\u0275fac,providedIn:"root"})};var $=class s{messageService=a(D);detailsFactory=a(L);stateService=a(A);adapterFactory=a(f);versionUpdateService=a(F);destroyRef=a(E);loadEntityDetails(e,t){let r=this.detailsFactory.getDetailsComponent(e);this.loadEntityWithCallbacks(e,t,i=>this.handleLoadSuccess(i,e,r),()=>this.handleLoadError(e),`Failed to load ${e} details`)}softLoadEntityDetails(e,t){this.loadEntityWithCallbacks(e,t,r=>this.handleSoftLoadSuccess(r,e),()=>this.handleSoftLoadError(e),`Failed to refresh ${e} details`)}softLoadEntityDetailsObservable(e,t){try{let r=this.adapterFactory.getAdapter(e);return r?r.getById(t).pipe(m(this.destroyRef),y(i=>{let o=i;return n(o)?v(p({},o),{entityType:e}):null}),u(i=>this.versionUpdateService.isVersionMismatchError(i)?(this.versionUpdateService.handleVersionMismatch(`entity load: ${e}`),l(null)):(this.messageService.add({severity:"error",summary:"Error",detail:`Failed to refresh ${e} details`}),console.error("Soft load error:",i),l(null)))):(this.messageService.add({severity:"error",summary:"Error",detail:`No adapter available for entity type: ${e}`}),l(null))}catch(r){return this.messageService.add({severity:"error",summary:"Error",detail:`Failed to refresh ${e} details: ${r}`}),l(null)}}loadEntityWithCallbacks(e,t,r,i,o){this.stateService.isLoading.set(!0);try{let d=this.adapterFactory.getAdapter(e);if(!d){this.handleMissingService();return}d.getById(t).pipe(m(this.destroyRef),g(()=>this.stateService.isLoading.set(!1))).subscribe({next:c=>r(c),error:c=>{if(console.error(o,c),this.versionUpdateService.isVersionMismatchError(c)){this.versionUpdateService.handleVersionMismatch(`entity load: ${e}`);return}i()}})}catch(d){if(this.stateService.isLoading.set(!1),this.versionUpdateService.isVersionMismatchError(d)){this.versionUpdateService.handleVersionMismatch(`entity load: ${e}`);return}this.messageService.add({severity:"error",summary:"Error",detail:`${o}: ${d}`}),o.includes("Failed to load")&&this.stateService.closeDetailsPanel()}}handleMissingService(){this.stateService.isLoading.set(!1)}handleLoadSuccess(e,t,r){if(n(e)){let i=v(p({},e),{entityType:t});this.stateService.openDetailsPanel(i,r)}else this.messageService.add({severity:"error",summary:"Not Found",detail:`${t} not found`}),this.stateService.closeDetailsPanel()}handleSoftLoadSuccess(e,t){if(n(e)){let r=v(p({},e),{entityType:t});this.stateService.softRefreshSelectedItem(r)}else this.messageService.add({severity:"error",summary:"Not Found",detail:`${t} not found`})}handleLoadError(e){this.messageService.add({severity:"error",summary:"Error",detail:`Failed to load ${e} details`}),this.stateService.closeDetailsPanel()}handleSoftLoadError(e){this.messageService.add({severity:"error",summary:"Error",detail:`Failed to refresh ${e} details`})}static \u0275fac=function(t){return new(t||s)};static \u0275prov=h({token:s,factory:s.\u0275fac,providedIn:"root"})};export{$ as a};
