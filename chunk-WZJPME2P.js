import{a as Be}from"./chunk-DZQJ5BKT.js";import"./chunk-SR57S2NU.js";import{h as Ye,i as et,j as tt,k as it,l as ot,m as nt}from"./chunk-JHHTYGX5.js";import{a as Qe,b as We,c as Ke,d as Je,e as Xe}from"./chunk-FVFSV3SV.js";import{l as K}from"./chunk-YPVSUJNA.js";import"./chunk-UJGTUYJO.js";import{z as W}from"./chunk-GVCBKH6U.js";import"./chunk-PHOSYVDR.js";import{q as ze}from"./chunk-UUBV4PLA.js";import"./chunk-T2ASJLBG.js";import"./chunk-K3QSXHYQ.js";import{a as qe,b as He,c as $e,f as Ze}from"./chunk-L7NFYEY5.js";import"./chunk-BEAFDC2I.js";import"./chunk-53JQ5NAG.js";import"./chunk-GV42Z4ED.js";import"./chunk-SDMJKPKX.js";import{l as N}from"./chunk-HBFOC76W.js";import"./chunk-MI5GPO5K.js";import"./chunk-PH5YALHE.js";import{m as Ie}from"./chunk-6C6CC4KT.js";import{pa as re,ta as Re}from"./chunk-JAXNIEKX.js";import{Ab as Ue,E as Ee,J as Te,L as Ne,M as Me,N as ke,O as Le,Pc as O,Q as Ae,S as E,T as c,Tb as Q,U as y,Ub as Ge,Vb as T,Wa as B,Wb as je,Y as H,Yb as se,_ as D,_c as V,ca as $,e as z,fa as Z,ga as Oe,u as q,zb as Ve}from"./chunk-FEC2V4R3.js";import{D as pe,Db as S,Gc as xe,H as ce,Hc as F,Ic as w,Jb as x,Jc as Pe,K as de,Kb as P,Nb as fe,Ob as he,Pb as m,Qb as s,Rb as r,Rc as De,S as ue,Sb as d,Tc as Fe,Vc as G,Ya as a,Zb as _,Zc as L,ad as we,ba as l,bc as b,bd as A,cc as h,d as le,gc as ge,gd as R,ha as g,hc as ve,ia as v,ic as be,j as me,mb as C,mc as ne,na as k,oc as ye,rc as u,sb as I,sc as Ce,ta as f,tc as Se,uc as _e,va as j}from"./chunk-EG5ORV3B.js";import{a as U,b as ae}from"./chunk-VB56BUGO.js";var rt=()=>["./profile"],st=o=>({content:o,scrollable:!0,minSize:15}),at=o=>({content:o,scrollable:!0,maxSize:75}),lt=(o,e)=>[o,e],mt=()=>[25,75],pt=()=>[15,0];function ct(o,e){o&1&&d(0,"router-outlet",7)}function dt(o,e){o&1&&d(0,"router-outlet",8)}var J=class o{destroyRef=l(k);router=l(Me);activeTab=f("profile");constructor(){this.setupNavigationHandler()}setupNavigationHandler(){this.router.events.pipe(pe(e=>e instanceof Te),O(this.destroyRef)).subscribe({next:e=>this.handleNavigation(e)})}handleNavigation(e){this.activeTab.set("profile")}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=C({type:o,selectors:[["app-profile-container"]],decls:11,vars:19,consts:[["template1",""],["template2",""],[1,"flex","flex-col","h-full"],[3,"scrollable","value"],["routerLinkActive","p-tab-active",3,"value","routerLink"],[1,"flex-1","overflow-hidden"],["stateKey","layout",1,"h-full",3,"panels","panelSizes","minSizes","defaultLayout","responsive"],["name","primary"],["name","detail"]],template:function(t,i){if(t&1&&(s(0,"div",2)(1,"p-tabs",3)(2,"p-tablist")(3,"p-tab",4),u(4," Profile "),r()()(),s(5,"div",5)(6,"app-adaptive-layout",6),I(7,ct,1,0,"ng-template",null,0,G)(9,dt,1,0,"ng-template",null,1,G),r()()()),t&2){let n=ne(8),p=ne(10);a(),m("scrollable",!0)("value",i.activeTab()),a(2),m("value","profile")("routerLink",F(9,rt)),a(3),m("panels",Pe(14,lt,w(10,st,n),w(12,at,p)))("panelSizes",F(17,mt))("minSizes",F(18,pt))("defaultLayout","horizontal")("responsive",!0)}},dependencies:[Be,Ze,qe,He,$e,Ae,Ne,ke,Le],styles:["[_nghost-%COMP%]{display:block;height:100%}[_nghost-%COMP%]     .p-splitter-panel{transition-property:all;transition-duration:.3s;transition-timing-function:cubic-bezier(.4,0,.2,1)}[_nghost-%COMP%]     app-adaptive-layout app-adaptive-layout .p-splitter{border-width:0px}[_nghost-%COMP%]     .panel-transition{transition-property:all;transition-duration:.3s;transition-timing-function:cubic-bezier(.4,0,.2,1)}[_nghost-%COMP%]     p-splitter{height:100%}"]})};var ft=o=>({"icon-primary":o});function ht(o,e){if(o&1){let t=_();s(0,"div",6)(1,"span",9),b("click",function(){g(t);let n=h();return v(n.onEdit())}),r()()}o&2&&(a(),S("aria-label","Edit personal details"))}function gt(o,e){if(o&1){let t=_();s(0,"app-dynamic-form",10),b("formSubmit",function(n){g(t);let p=h();return v(p.onSubmit(n))}),r()}if(o&2){let t=h();m("fields",t.formFields)("actions",t.actions)}}function vt(o,e){if(o&1&&d(0,"app-grid",8),o&2){let t=h();m("data",t.userDetails())("columns",t.columns)("showGridLines",!1)("hideHeader",!0)}}var ee=class o{userProfile=A();http=l(Ee);utilsService=l(Ye);utilityService=l(ze);clientsService=l(Oe);authDataService=l(V);accountsService=l($);cdr=l(R);destroyRef=l(k);searchSubject=new le;formFields=[];userDetails=L(()=>{let e=this.userProfile();return E(e)?[]:[{key:"Name",value:y(e.name)?e.name:"N/A"},{key:"Email Address",value:y(e.emailAddress)?e.emailAddress:"N/A"},{key:"Mobile Number",value:y(e.mobile)?e.mobile.trim():"None"},{key:"Password",value:"********"},{key:"Time Zone",value:y(e.timeZoneId)?e.timeZoneId:"N/A"},{key:"Language",value:this.getLanguageName(e.language)},{key:"Default Client",value:c(e.defaultClient)&&D(e.defaultClient,"name")?e.defaultClient.name:"None"}]});isFormEditable=f(!1);isSubmitting=f(!1);clientSearchResults=f([]);timezones=[];languages=this.utilsService.getLanguages();columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:""}];actions=[{label:"Cancel",action:()=>this.isFormEditable.set(!1),severity:"secondary"},{label:"Save",action:e=>{this.onSubmit(e)},severity:"primary",disabled:e=>E(e)||e.pristine}];constructor(){j(()=>{this.userProfile()&&this.updateFormFields()})}ngOnInit(){this.loadTimezones(),this.setupClientSearch()}updateFormFields(){this.formFields=[Q("name","Name",this.userProfile()?.name,{name:"name",validations:[{name:"required",validator:N.required,message:"Name is required"}]}),Q("emailAddress","Email Address",this.userProfile()?.emailAddress,{name:"email",validations:[{name:"email",validator:N.email,message:"Invalid email"},{name:"required",validator:N.required,message:"Email is required"}]}),Q("mobile","Mobile Number",this.userProfile()?.mobile?.trim(),{name:"mobile",validations:[{name:"pattern",validator:N.pattern("^[0-9]*$"),message:"Mobile number must contain only numbers"},{name:"required",validator:N.required,message:"Mobile number is required"}]}),Ge("password","Password",{name:"password",validations:[{name:"required",validator:N.required,message:"Password is required"}]}),T("timeZoneId","Time Zone",this.timezones,this.userProfile()?.timeZoneId,{layout:"horizontal",labelWidth:"1/3",placeholder:"Select timezone",name:"timeZone",props:{appendTo:"body"}}),T("language","Language",this.languages.map(e=>({label:e.name,value:e.id})),this.userProfile()?.language,{layout:"horizontal",labelWidth:"1/3",placeholder:"Select language",name:"language",props:{appendTo:"body"}}),je("defaultClient","Default Client",this.userProfile()?.defaultClient?.name,this.clientSearchResults(),this.searchClient.bind(this),{name:"defaultClient",props:{forceSelection:!0,field:"name",placeholder:"Search for clients...",completeOnFocus:!0,appendTo:"body"},hint:"Enter a client name."})]}loadTimezones(){this.http.get("/assets/docs/timezones.json").subscribe(e=>{this.timezones=e.map(t=>({label:t.id,value:t.id})).sort((t,i)=>t.label.localeCompare(i.label)),this.updateFormFields()})}getDirtyValues(e){return Object.fromEntries(Object.entries(e.controls).filter(([t,i])=>i.dirty).map(([t,i])=>[t,i.value]))}getLanguageName(e){if(!y(e))return"N/A";let t=this.languages.find(i=>c(i)&&D(i,"id")&&i.id===e);return c(t)&&D(t,"name")?t.name:"N/A"}onSubmit(e){let t=this.userProfile();if(E(t))return;this.isSubmitting.set(!0);let i=this.getDirtyValues(e);Object.keys(i).length>0?this.accountsService.updateUser(t.id,i).subscribe({next:n=>{this.authDataService.setUserProfile(n),this.isFormEditable.set(!1)},error:()=>{this.isFormEditable.set(!0)},complete:()=>{this.isSubmitting.set(!1),this.cdr.detectChanges()}}):(this.isFormEditable.set(!1),this.isSubmitting.set(!1))}onEdit(){this.isFormEditable.set(!0)}setupClientSearch(){this.searchSubject.pipe(ce(Ve),O(this.destroyRef),ue(e=>{let t=this.authDataService.getUserProfile()?.owner;if(!c(t)||!D(t,"id"))throw new Error("Owner ID not found");let i=e.trim();if(i.length===0)return me({items:[]});let n={state:{value:"active",operator:"="},name:{value:`*${i}*`,operator:"="}},p=this.utilityService.constructRqlFilter(n);return this.clientsService.listClients(t.id,0,Ue,"name",p)})).subscribe({next:e=>{c(e)&&D(e,"items")&&(this.clientSearchResults.set(E(e.items)?[]:e.items),this.cdr.detectChanges())},error:e=>{console.error("Error searching clients:",e),this.clientSearchResults.set([])}})}searchClient(e){this.searchSubject.next(e)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=C({type:o,selectors:[["app-details"]],inputs:{userProfile:[1,"userProfile"]},decls:12,vars:6,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-user","!text-4xl",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click"],[3,"formSubmit","fields","actions"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"div",1),d(2,"span",2),s(3,"div",3)(4,"div",4)(5,"h2",5),u(6,"Personal Details"),r(),x(7,ht,2,1,"div",6),r(),s(8,"span"),u(9,"Complete the following personal details for yourself."),r()()(),x(10,gt,1,2,"app-dynamic-form",7)(11,vt,1,4,"app-grid",8),r()),t&2&&(a(2),m("ngClass",w(4,ft,i.isFormEditable())),S("aria-label","User icon"),a(5),P(i.isFormEditable()?-1:7),a(3),P(i.isFormEditable()?10:11))},dependencies:[W,K,q,z],styles:["[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{border:none;padding:.5rem 1rem}"]})};var bt=o=>({"icon-primary":o});function yt(o,e){if(o&1){let t=_();s(0,"div",6)(1,"span",9),b("click",function(){g(t);let n=h();return v(n.onEdit())}),r()()}}function Ct(o,e){if(o&1){let t=_();s(0,"app-dynamic-form",10),b("formSubmit",function(n){g(t);let p=h();return v(p.onSubmit(n))}),r()}if(o&2){let t=h();m("fields",t.formFields)("actions",t.actions)}}function St(o,e){if(o&1&&d(0,"app-grid",8),o&2){let t=h();m("data",t.settingsDetails())("columns",t.columns)("showGridLines",!1)("hideHeader",!0)}}var te=class o{accountsService=l($);authDataService=l(V);cdr=l(R);userProfile=A();isFormEditable=f(!1);isSubmitting=f(!1);columns=[{field:"key",header:"",transform:"uppercase"},{field:"value",header:"",transform:"capitalize"}];settingsDetails=L(()=>{let e=this.userProfile()?.notifySettings;return e?[{key:"Allow SMS from",value:e.smsTime?.from},{key:"Allow SMS to",value:e.smsTime?.to},{key:"Low Priority",value:this.formatLabel(e.actions?.low)},{key:"Medium Priority",value:this.formatLabel(e.actions?.medium)},{key:"High Priority",value:this.formatLabel(e.actions?.high)}]:[]});formFields=[{name:"smsTime",key:"smsTime",type:"group",fields:[se("from","Allow SMS from",this.userProfile()?.notifySettings?.smsTime?.from,{name:"from",placeholder:"Select time",props:{timeOnly:!0,showSeconds:!0},style:{width:"100%"}}),se("to","Allow SMS to",this.userProfile()?.notifySettings?.smsTime?.to,{name:"to",placeholder:"Select time",props:{timeOnly:!0,showSeconds:!0},style:{width:"100%"}})]},{key:"actions",type:"group",name:"actions",fields:[T("low","Low Priority",Object.values(B.LowEnum).map(e=>({label:this.formatLabel(e),value:e})),this.userProfile()?.notifySettings?.actions?.low,{name:"low",props:{appendTo:"body"}}),T("medium","Medium Priority",Object.values(B.MediumEnum).map(e=>({label:this.formatLabel(e),value:e})),this.userProfile()?.notifySettings?.actions?.medium,{name:"medium",props:{appendTo:"body"}}),T("high","High Priority",Object.values(B.HighEnum).map(e=>({label:this.formatLabel(e),value:e})),this.userProfile()?.notifySettings?.actions?.high,{name:"high",props:{appendTo:"body"}})]}];actions=[{label:"Cancel",action:()=>this.isFormEditable.set(!1),severity:"secondary"},{label:"Save",action:e=>{c(e)&&this.onSubmit(e)},severity:"primary",disabled:e=>!c(e)||e.pristine}];constructor(){j(()=>{let e=this.userProfile()?.notifySettings;e&&this.updateFormValues(this.formFields,e)})}updateFormValues(e,t){E(t)||e.forEach(i=>{i.type==="group"&&i.fields?this.updateFormValues(i.fields,t[i.key]):i.key&&t?.[i.key]!==void 0&&(i.value=t[i.key])})}getDirtyGroupValues(e,t){if(!c(e)||!y(t))return{};let i=e.get(t);return!c(i)||!c(i.controls)?{}:Object.keys(i.controls).filter(n=>{let p=e.get(`${t}.${n}`);return c(p)&&p.dirty}).reduce((n,p)=>{let M=e.get(`${t}.${p}`);return c(M)?ae(U({},n),{[p]:M.value}):n},{})}createUpdatedProfile(e,t){if(!c(e)||!H(t))return{};let i=H(t.smsTime)&&Object.keys(t.smsTime).length>0,n=H(t.actions)&&Object.keys(t.actions).length>0;return{notifySettings:U(U(U({},e.notifySettings),i?{smsTime:t.smsTime}:{}),n?{actions:t.actions}:{})}}onSubmit(e){let t=this.userProfile();if(!c(t))return;this.isSubmitting.set(!0);let i={smsTime:this.getDirtyGroupValues(e,"smsTime"),actions:this.getDirtyGroupValues(e,"actions")};if(!Object.values(i).some(M=>Object.keys(M).length>0)){this.isFormEditable.set(!1),this.isSubmitting.set(!1);return}let p=this.createUpdatedProfile(t,i);this.accountsService.updateUser(t.id,p).pipe(de(()=>{this.isSubmitting.set(!1),this.isFormEditable.set(!1)})).subscribe({next:M=>{this.authDataService.setUserProfile(M)}})}onEdit(){this.isFormEditable.update(e=>!e)}formatLabel(e){if(!y(e))return"";switch(e.toLowerCase()){case"emailsms":return"Email & SMS";case"sms":return"SMS";default:return e.charAt(0).toUpperCase()+e.slice(1)}}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=C({type:o,selectors:[["app-notifications"]],inputs:{userProfile:[1,"userProfile"]},decls:12,vars:6,consts:[[1,"card","pt-2"],[1,"mb-4","p-2","flex","justify-start","items-center"],[1,"pi","pi-bell","!text-4xl",3,"ngClass"],[1,"pl-6","flex-1"],[1,"flex","justify-between","items-center"],[1,"text-xl","font-semibold","m-0"],[1,"icon-light"],[3,"fields","actions"],["tableStyleClass","info-display !w-auto",3,"data","columns","showGridLines","hideHeader"],[1,"pi","pi-pen-to-square","action","hover","!text-2xl",3,"click"],[3,"formSubmit","fields","actions"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"div",1),d(2,"span",2),s(3,"div",3)(4,"div",4)(5,"h2",5),u(6,"Notifications"),r(),x(7,yt,2,0,"div",6),r(),s(8,"span"),u(9," Configure alert notification actions and allowed SMS times."),r()()(),x(10,Ct,1,2,"app-dynamic-form",7)(11,St,1,4,"app-grid",8),r()),t&2&&(a(2),m("ngClass",w(4,bt,i.isFormEditable())),S("aria-label","Notifications icon"),a(5),P(i.isFormEditable()?-1:7),a(3),P(i.isFormEditable()?10:11))},dependencies:[W,K,q,z],styles:["[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{border:none;padding:.5rem 1rem}"]})};var _t=(o,e)=>e.id;function xt(o,e){o&1&&(s(0,"span",8),u(1,"\xB7 current session"),r())}function Pt(o,e){if(o&1){let t=_();s(0,"div",3),d(1,"i",4),s(2,"div",5)(3,"b",6),u(4),r(),s(5,"span",7),u(6),De(7,"timeAgo"),x(8,xt,2,0,"span",8),r(),s(9,"span",9),u(10),r()(),s(11,"div",10)(12,"i",11),b("click",function(){let n=g(t).$implicit,p=h(2);return v(p.signOut(n))}),r()()(),d(13,"hr",12)}if(o&2){let t=e.$implicit,i=h(2);a(),S("aria-label","Device icon"),a(3),_e(" ",t==null?null:t.ip," @ ",t==null?null:t.hostname," "),a(2),Se("",Fe(7,7,t==null?null:t.start,i.timestamp())," "),a(2),P(t!=null&&t.current?8:-1),a(2),Ce((t==null?null:t.agent)||"Unknown device"),a(2),S("aria-label","Sign out session")}}function Dt(o,e){if(o&1&&fe(0,Pt,14,10,null,null,_t),o&2){let t=e.$implicit;he(t)}}var ie=class o{sessions=A.required();refreshSessions=we();authService=l(Z);confirmationService=l(re);refreshTrigger=f(0);timestamp=f(Date.now());isLoading=f(!1);sessionsList=L(()=>{this.refreshTrigger();let e=this.sessions();return c(e)?e:[]});refresh(){this.isLoading()||(this.refreshTrigger.update(e=>e+1),this.timestamp.set(Date.now()))}signOut(e){if(!c(e)||!D(e,"id")||!y(e.id)){console.warn("Invalid session data");return}this.confirmationService.confirm({header:"Confirmation",message:"Are you sure you want to force log out the selected session?",closable:!0,closeOnEscape:!0,icon:"pi pi-exclamation-triangle",rejectButtonProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptButtonProps:{label:"Ok"},accept:()=>{this.isLoading.set(!0),this.authService.signOut({session:e.id}).subscribe({next:()=>{this.refreshSessions.emit()},error:t=>{console.error("Failed to sign out session:",t)},complete:()=>{this.isLoading.set(!1)}})}})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=C({type:o,selectors:[["app-sessions"]],inputs:{sessions:[1,"sessions"]},outputs:{refreshSessions:"refreshSessions"},features:[xe([re,Re])],decls:5,vars:1,consts:[["dv",""],["list",""],[3,"value"],[1,"flex","justify-between","gap-4","p-2","pr-0","w-100","mt-2"],[1,"pi","pi-desktop","self-center","text-wrap","!text-xl-5"],[1,"flex","flex-col","self-start","flex-1"],[1,"mb-0"],[1,"muted"],[1,"ml-1"],[1,"text-sm","mt-1","muted"],[1,"align-self-end","ml-2"],[1,"pi","pi-trash","cursor-pointer","action","hover","!text-xl-25",3,"click"],[1,"my-2"]],template:function(t,i){t&1&&(s(0,"p-dataview",2,0),I(2,Dt,2,0,"ng-template",null,1,G),r(),d(4,"p-confirmdialog")),t&2&&m("value",i.sessionsList())},dependencies:[tt,et,ot,it,Ie,nt],encapsulation:2})};var Ft=["sessionsComponent"],wt=()=>["information","notifications","sessions"],Et=()=>[],oe=class o{userProfileService=l(Z);authDataService=l(V);cdr=l(R);destroyRef=l(k);sessionsComponent;userProfile=this.authDataService.profile;isLoading=f(!1);ngOnInit(){this.fetchUserProfile()}fetchUserProfile(){this.isLoading.set(!0),this.userProfileService.getUserProfile().pipe(O(this.destroyRef)).subscribe({next:e=>{this.authDataService.setUserProfile(e)},complete:()=>{this.isLoading.set(!1),this.cdr.detectChanges()}})}onRefresh(){this.fetchUserProfile(),this.sessionsComponent?.refresh()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=C({type:o,selectors:[["app-profile"]],viewQuery:function(t,i){if(t&1&&ge(Ft,5),t&2){let n;ve(n=be())&&(i.sessionsComponent=n.first)}},decls:19,vars:11,consts:[["sessionsComponent",""],[3,"value","multiple"],["value","information",3,"disabled"],[1,"uppercase"],["value","information"],[3,"userProfile"],["value","notifications"],["value","sessions"],[1,"flex","justify-between","items-center","py-4"],[1,"pi","pi-refresh","cursor-pointer","action","hover",3,"click"],[3,"refreshSessions","sessions"]],template:function(t,i){if(t&1){let n=_();s(0,"p-accordion",1)(1,"p-accordion-panel",2)(2,"p-accordion-header")(3,"span",3),u(4,"Information"),r()()(),s(5,"p-accordion-panel",4)(6,"p-accordion-content"),d(7,"app-details",5),r()(),s(8,"p-accordion-panel",6)(9,"p-accordion-content"),d(10,"app-notifications",5),r()(),s(11,"p-accordion-panel",7)(12,"p-accordion-content")(13,"div",8)(14,"span",3),u(15,"Active Sessions"),r(),s(16,"i",9),b("click",function(){return g(n),v(i.onRefresh())}),r()(),s(17,"app-sessions",10,0),b("refreshSessions",function(){return g(n),v(i.onRefresh())}),r()()()()}if(t&2){let n;m("value",F(9,wt))("multiple",!0),a(),m("disabled",!0),a(6),m("userProfile",i.userProfile()),a(3),m("userProfile",i.userProfile()),a(6),ye("animate-spin",i.isLoading()),S("aria-label","Refresh sessions"),a(),m("sessions",((n=i.userProfile())==null?null:n.sessions)||F(10,Et))}},dependencies:[Xe,Je,Qe,We,Ke,ee,te,ie],encapsulation:2})};var eo=[{path:"",component:J,children:[{path:"profile",component:oe}]}];export{eo as USERS_ROUTES};
