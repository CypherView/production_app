import{b as pt,c as Gt}from"./chunk-QJYXX6WB.js";import{b as De}from"./chunk-JJVUWK2A.js";import{e as qt}from"./chunk-FVFSV3SV.js";import{a as Lt,b as Qt,c as Te,d as Ae,f as Ut,g as Ht,h as jt}from"./chunk-T2ASJLBG.js";import{a as $t,b as Bt}from"./chunk-K3QSXHYQ.js";import{c as je,d as Se,h as Ft}from"./chunk-53JQ5NAG.js";import{b as Nt,c as He}from"./chunk-GV42Z4ED.js";import{A as Tt,C as At,D as Ue,P as It,j as Le,l as Qe,n as ge,r as me,x as Dt,z as ee}from"./chunk-HBFOC76W.js";import{a as Rt,b as zt}from"./chunk-MI5GPO5K.js";import{e as Et,f as Vt}from"./chunk-PH5YALHE.js";import{k as Be,l as ie,m as W}from"./chunk-6C6CC4KT.js";import{E as we,I as kt,Kb as Fe,S as B,T as $,Uc as St,e as J,ea as wt,hd as $e,n as Mt,o as xt,r as Pt,u as R,y as Ot}from"./chunk-FEC2V4R3.js";import{Ac as ye,Db as L,Fc as ke,Gb as qe,Gc as Ct,Hc as yt,Ic as Ie,Jb as g,Kb as m,Kc as bt,Lb as _t,Lc as vt,Mb as se,Nb as A,Ob as E,Pb as y,Qb as a,Rb as r,Rc as te,Sa as ht,Sb as u,Sc as ne,Y as xe,Ya as s,Zb as w,Zc as f,ad as q,ba as Q,bc as b,bd as S,cc as p,e as mt,gc as Y,ha as _,hc as K,ia as C,ic as Z,ja as oe,ka as ce,mb as I,nc as Pe,o as fe,oc as U,pa as ut,pb as ft,qc as Oe,rc as c,sc as v,ta as P,tc as D,uc as G,va as de,yc as _e,zc as Ce}from"./chunk-EG5ORV3B.js";import{a as V,b as F}from"./chunk-VB56BUGO.js";var Ge=class i{defaultBreakpoints={mobile:768,tablet:1024,desktop:1200};defaultOptions={enableAnimations:!0,responsiveBreakpoints:this.defaultBreakpoints,gapSizePx:16,minBlockHeight:200};resizeObserver;applyLayout(t,e,n,o={}){let l=V(V({},this.defaultOptions),o),d=t.nativeElement;if(!B(d))try{this.configureGridSystem(d,e,l),this.positionBlocks(d,e,n,l),this.setupResponsiveLayout(d,e,n,l),$(l.enableAnimations)&&this.enableLayoutAnimations(d)}catch{this.fallbackLayout(d,n,l)}}configureGridSystem(t,e,n){t.style.display="grid",t.style.gridTemplateColumns=`repeat(${e.grid.columns}, 1fr)`,t.style.gap=`${e.grid.gap??n.gapSizePx}px`,t.style.gridAutoRows="minmax(auto, max-content)",t.style.padding=`${n.gapSizePx}px`,t.style.minHeight="100%",t.style.width="100%",t.classList.add("dashboard-grid-container")}positionBlocks(t,e,n,o){for(let l of e.sections)this.positionSection(t,l,n,o)}positionSection(t,e,n,o){for(let[l,d]of e.blocks.entries()){let h=n.find(M=>M.block_id===d);if(!h)continue;let O=t.querySelector(`[data-block-id="${d}"]`);B(O)||this.applyBlockPosition(O,h,e,l,o)}}applyBlockPosition(t,e,n,o,l){if($(e.layout?.position?.gridArea))t.style.gridArea=e.layout?.position?.gridArea;else{let{row:d,col:h,colSpan:O}=n.position;if(O>=12){let M=d+o;t.style.gridArea=`${M} / ${h} / ${M+1} / ${h+O}`}else{let M=Math.max(1,Math.floor(O/3)),x=Math.floor(O/M),k=d+Math.floor(o/M),N=h+o%M*x;t.style.gridArea=`${k} / ${N} / ${k+1} / ${N+x}`}}this.applyBlockStyling(t,e,l)}applyBlockStyling(t,e,n){t.classList.add(`priority-${e.priority}`),e.visual?.theme&&t.classList.add(`theme-${e.visual.theme}`),$(e.visual?.elevation)&&t.classList.add(`elevation-${e.visual?.elevation}`),t.style.minHeight=`${n.minBlockHeight}px`,t.classList.add(`block-type-${e.block_type}`)}setupResponsiveLayout(t,e,n,o){this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver(d=>{for(let h of d){let O=h.contentRect.width;this.adjustLayoutForScreenSize(t,e,n,O,o)}}),this.resizeObserver.observe(t);let l=t.offsetWidth;this.adjustLayoutForScreenSize(t,e,n,l,o)}adjustLayoutForScreenSize(t,e,n,o,l){let d=l.responsiveBreakpoints;o<=d.mobile?this.applyMobileLayout(t,n):o<=d.tablet?this.applyTabletLayout(t,e):this.applyDesktopLayout(t,e,n)}applyMobileLayout(t,e){t.style.gridTemplateColumns="1fr",t.style.gap="12px",t.style.padding="12px";for(let[n,o]of Array.from(t.querySelectorAll("[data-block-id]")).entries()){let l=o;l.style.gridArea="auto",l.style.order=e[n]?.priority?.toString()||"0"}}applyTabletLayout(t,e){let n=Math.min(8,e.grid.columns);t.style.gridTemplateColumns=`repeat(${n}, 1fr)`;for(let o of e.sections){let l=n/e.grid.columns;for(let d of o.blocks){let h=t.querySelector(`[data-block-id="${d}"]`);if($(h)){let O=Math.max(1,Math.floor(o.position.colSpan*l)),{row:M,col:x}=o.position;h.style.gridArea=`${M} / ${Math.floor(x*l)} / ${M+1} / ${Math.floor(x*l)+O}`}}}}applyDesktopLayout(t,e,n){this.configureGridSystem(t,e,this.defaultOptions),this.positionBlocks(t,e,n,this.defaultOptions)}enableLayoutAnimations(t){t.style.transition="all 0.3s cubic-bezier(0.4, 0, 0.2, 1)";for(let e of t.querySelectorAll("[data-block-id]")){let n=e;n.style.transition="all 0.3s cubic-bezier(0.4, 0, 0.2, 1)"}}fallbackLayout(t,e,n){t.style.display="grid",t.style.gridTemplateColumns="repeat(auto-fit, minmax(300px, 1fr))",t.style.gap=`${n.gapSizePx}px`,t.style.padding=`${n.gapSizePx}px`;for(let[o,l]of Array.from(t.querySelectorAll("[data-block-id]")).entries()){let d=l;d.style.gridArea="auto",d.style.order=e[o]?.priority?.toString()||"0"}}calculateOptimalLayout(t,e){let n=this.calculateOptimalColumns(e),o=this.calculateOptimalSections(t,n);return{type:"dashboard",grid:{columns:n,rows:"auto",gap:16},sections:o}}calculateOptimalColumns(t){return t<768?1:t<1024?8:t<1440?12:16}calculateOptimalSections(t,e){let n=[],o=1,l=1;for(let d of[...t].sort((h,O)=>h.priority-O.priority)){let h=this.calculateBlockColSpan(d,e);l+h>e+1&&(o++,l=1),n.push({id:`section-${d.block_id}`,title:d.block_type,position:{row:o,col:l,colSpan:h},blocks:[d.block_id]}),l+=h}return n}calculateBlockColSpan(t,e){return{summary:Math.min(e,12),kpi:Math.min(Math.floor(e/3),4),chart:Math.min(Math.floor(e/2),6),alert:Math.min(Math.floor(e/2),6),table:Math.min(e,12),recommendation:Math.min(Math.floor(e/3),4),map_markers:Math.min(Math.floor(e/2),8)}[t.block_type]||Math.floor(e/3)}destroy(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=void 0)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=xe({token:i,factory:i.\u0275fac,providedIn:"root"})};function en(i,t){if(i&1&&u(0,"i",8),i&2){let e=p().$implicit,n=p(2);y("ngClass",n.getTrendIcon(e.trend)),L("aria-label",e.trend+" trend")}}function tn(i,t){if(i&1&&(a(0,"div",5)(1,"div",6)(2,"div",7),c(3),g(4,en,1,2,"i",8),r(),a(5,"div",9),c(6),r()(),u(7,"div",10),r()),i&2){let e=t.$implicit,n=p(2);y("ngClass",n.getHighlightClass(e)),s(3),D(" ",e.value," "),s(),m(e.trend?4:-1),s(2),v(e.label),s(),y("ngClass","severity-"+e.severity)}}function nn(i,t){if(i&1&&(a(0,"div",4),A(1,tn,8,5,"div",5,se),r()),i&2){let e=p();s(),E(e.block.content.highlights)}}var We=class i{block;getThemeClass(){return this.block.visual?.theme?`theme-${this.block.visual.theme}`:"theme-primary"}getHighlightClass(t){let e=[`severity-${t.severity}`];return t.trend&&e.push(`trend-${t.trend}`),e}getTrendIcon(t){switch(t){case"up":return"trend-up";case"down":return"trend-down";case"stable":return"trend-stable";default:return""}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-summary-block"]],inputs:{block:"block"},decls:8,vars:4,consts:[[1,"summary-block",3,"ngClass"],[1,"summary-header"],[1,"summary-title"],[1,"summary-narrative"],[1,"highlights"],[1,"highlight-item",3,"ngClass"],[1,"highlight-content"],[1,"highlight-value"],[3,"ngClass"],[1,"highlight-label"],[1,"highlight-indicator",3,"ngClass"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"h3",2),c(3),r()(),a(4,"div",3)(5,"p"),c(6),r()(),g(7,nn,3,0,"div",4),r()),e&2&&(y("ngClass",n.getThemeClass()),s(3),v(n.block.content.title),s(3),v(n.block.content.narrative),s(),m(n.block.content.highlights.length>0?7:-1))},dependencies:[R,J],styles:['@charset "UTF-8";.summary-block[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:28px;box-shadow:0 2px 8px #00000014,0 8px 24px #0000001f;transition:all .3s ease;border:1px solid #e5e7eb;border-left:4px solid transparent}.summary-block[_ngcontent-%COMP%]:hover{box-shadow:0 4px 16px #00000026,0 12px 32px #0000001a;border-color:#d1d5db}.summary-header[_ngcontent-%COMP%]{margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid var(--surface-100)}.summary-title[_ngcontent-%COMP%]{color:var(--text-color);font-size:1.375rem;font-weight:700;margin:0;letter-spacing:-.25px}.summary-narrative[_ngcontent-%COMP%]{margin-bottom:24px}.summary-narrative[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);line-height:1.7;margin:0;font-size:1rem}.highlights[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px}.highlight-item[_ngcontent-%COMP%]{background:#f9fafb;border-radius:10px;padding:18px;position:relative;transition:all .2s ease;border:1px solid #e5e7eb;overflow:hidden}.highlight-item[_ngcontent-%COMP%]:hover{box-shadow:0 2px 8px #0000001a;border-color:#d1d5db;background:#f3f4f6}.highlight-content[_ngcontent-%COMP%]{position:relative;z-index:2}.highlight-value[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:1.625rem;font-weight:700;color:var(--text-color);margin-bottom:6px}.highlight-value[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem;transition:transform .2s ease}.highlight-label[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--text-color-secondary);font-weight:600;text-transform:uppercase;letter-spacing:.5px}.highlight-indicator[_ngcontent-%COMP%]{position:absolute;right:0;top:0;bottom:0;width:4px;transition:width .3s ease}.highlight-item[_ngcontent-%COMP%]:hover   .highlight-indicator[_ngcontent-%COMP%]{width:8px}.trend-up[_ngcontent-%COMP%]{color:#22c55e}.trend-up[_ngcontent-%COMP%]:before{content:"\\2191"}.trend-down[_ngcontent-%COMP%]{color:#ef4444}.trend-down[_ngcontent-%COMP%]:before{content:"\\2193"}.trend-stable[_ngcontent-%COMP%]{color:#6b7280}.trend-stable[_ngcontent-%COMP%]:before{content:"\\2192"}.severity-good[_ngcontent-%COMP%]   .highlight-indicator[_ngcontent-%COMP%]{background:linear-gradient(180deg,#22c55e,#16a34a)}.severity-warning[_ngcontent-%COMP%]   .highlight-indicator[_ngcontent-%COMP%]{background:linear-gradient(180deg,#f59e0b,#d97706)}.severity-critical[_ngcontent-%COMP%]   .highlight-indicator[_ngcontent-%COMP%]{background:linear-gradient(180deg,#ef4444,#dc2626)}.severity-neutral[_ngcontent-%COMP%]   .highlight-indicator[_ngcontent-%COMP%]{background:linear-gradient(180deg,#6b7280,#4b5563)}.summary-block.theme-primary[_ngcontent-%COMP%]{border-left-color:#3b82f6}.summary-block.theme-warning[_ngcontent-%COMP%]{border-left-color:#f59e0b}.summary-block.theme-danger[_ngcontent-%COMP%]{border-left-color:#ef4444}.summary-block.theme-success[_ngcontent-%COMP%]{border-left-color:#22c55e}.summary-block.theme-info[_ngcontent-%COMP%]{border-left-color:#06b6d4}.dark[_nghost-%COMP%]   .summary-block[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .summary-block[_ngcontent-%COMP%]{background:var(--surface-800);border-color:var(--surface-600)}.dark[_nghost-%COMP%]   .highlight-item[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .highlight-item[_ngcontent-%COMP%]{background:var(--surface-700);border-color:var(--surface-600)}@media(max-width:768px){.summary-block[_ngcontent-%COMP%]{padding:16px}.highlights[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:12px}.summary-title[_ngcontent-%COMP%]{font-size:1.25rem}.highlight-value[_ngcontent-%COMP%]{font-size:1.5rem}}']})};function on(i,t){if(i&1&&(a(0,"div",8)(1,"div",9),u(2,"i",10),a(3,"span",11),c(4),r()(),a(5,"div",12),c(6),r()()),i&2){let e=p().$implicit,n=p();y("ngClass",n.getComparisonClass(e.comparison)),s(2),y("ngClass",n.getTrendIcon(e.comparison.trend)),L("aria-label",e.comparison.trend+" trend"),s(2),D(" ",n.formatPercentage(e.comparison.change_percentage)," "),s(2),G(" vs ",n.formatValue(e.comparison.previous_value,e.format),"",e.unit," ")}}function an(i,t){if(i&1&&(a(0,"div",4)(1,"div",5)(2,"div",6),c(3),r(),a(4,"div",7),c(5),r()(),g(6,on,7,6,"div",8),r()),i&2){let e=t.$implicit,n=p();y("ngClass",n.getMetricClasses(e)),s(3),G(" ",n.formatValue(e.value,e.format),"",e.unit," "),s(2),v(e.label),s(),m(e.comparison?6:-1)}}var Ye=class i{block;trackByMetric(t,e){return e.label}getBlockClasses(){let t=["kpi-block"];return this.block.visual?.theme&&t.push(`theme-${this.block.visual.theme}`),t}getOrientationClass(){return`orientation-${this.block.content.orientation}`}getMetricClasses(t){let e=[];return t.comparison&&e.push("has-comparison"),e}formatValue(t,e){switch(e){case"currency":return new Intl.NumberFormat("en-ZA",{style:"currency",currency:"ZAR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t);case"percentage":return t.toFixed(1);case"duration":{let n=Math.floor(t/60),o=t%60;return n>0?`${n}h ${o}m`:`${o}m`}case"number":default:return new Intl.NumberFormat("en-ZA").format(t)}}formatPercentage(t){return`${Math.abs(t).toFixed(1)}%`}getComparisonClass(t){return t.is_improvement?"improvement":"decline"}getTrendIcon(t){switch(t){case"up":return"trend-up";case"down":return"trend-down";case"stable":return"trend-stable";default:return""}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-kpi-block"]],inputs:{block:"block"},decls:7,vars:3,consts:[[1,"kpi-block",3,"ngClass"],[1,"kpi-header"],[1,"kpi-title"],[1,"metrics-container",3,"ngClass"],[1,"metric-item",3,"ngClass"],[1,"metric-main"],[1,"metric-value"],[1,"metric-label"],[1,"metric-comparison",3,"ngClass"],[1,"comparison-indicator"],[3,"ngClass"],[1,"comparison-percentage"],[1,"comparison-label"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"h4",2),c(3),r()(),a(4,"div",3),A(5,an,7,5,"div",4,n.trackByMetric,!0),r()()),e&2&&(y("ngClass",n.getBlockClasses()),s(3),v(n.block.content.title),s(),y("ngClass",n.getOrientationClass()),s(),E(n.block.content.metrics))},dependencies:[R,J],styles:['@charset "UTF-8";.kpi-block[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:24px;box-shadow:0 2px 8px #00000014,0 8px 24px #0000001f;transition:all .3s ease;border:1px solid #e5e7eb;border-left:4px solid #3b82f6}.kpi-block[_ngcontent-%COMP%]:hover{box-shadow:0 4px 16px #00000026,0 12px 32px #0000001a;border-color:#d1d5db}.kpi-header[_ngcontent-%COMP%]{margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid var(--surface-100)}.kpi-title[_ngcontent-%COMP%]{color:var(--text-color);font-size:1.125rem;font-weight:700;margin:0;text-transform:uppercase;letter-spacing:.5px}.metrics-container[_ngcontent-%COMP%]{display:grid;gap:20px}.metrics-container.orientation-horizontal[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}.metrics-container.orientation-vertical[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:16px}.metric-item[_ngcontent-%COMP%]{background:#f9fafb;border-radius:10px;padding:20px;transition:all .2s ease;border:1px solid #e5e7eb;position:relative;overflow:hidden}.metric-item[_ngcontent-%COMP%]:hover{background:#f3f4f6;box-shadow:0 2px 8px #0000001a;border-color:#d1d5db}.metric-main[_ngcontent-%COMP%]{margin-bottom:12px}.metric-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:var(--primary-600);line-height:1.2;margin-bottom:6px}.metric-label[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--text-color-secondary);font-weight:600;text-transform:uppercase;letter-spacing:.75px}.metric-comparison[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;padding-top:12px;border-top:1px solid var(--surface-200)}.metric-comparison.improvement[_ngcontent-%COMP%]{--comparison-color: #22c55e}.metric-comparison.decline[_ngcontent-%COMP%]{--comparison-color: #ef4444}.comparison-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;color:var(--comparison-color);font-weight:600}.comparison-indicator[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem;transition:transform .2s ease}.comparison-indicator[_ngcontent-%COMP%]   .comparison-percentage[_ngcontent-%COMP%]{font-size:.875rem}.comparison-label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-color-secondary)}.trend-up[_ngcontent-%COMP%]:before{content:"\\2197"}.trend-up[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounce-up 2s infinite}.trend-down[_ngcontent-%COMP%]:before{content:"\\2198"}.trend-down[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_bounce-down 2s infinite}.trend-stable[_ngcontent-%COMP%]:before{content:"\\2192"}@keyframes _ngcontent-%COMP%_bounce-up{0%,20%,50%,80%,to{transform:translateY(0)}40%{transform:translateY(-3px)}60%{transform:translateY(-1px)}}@keyframes _ngcontent-%COMP%_bounce-down{0%,20%,50%,80%,to{transform:translateY(0)}40%{transform:translateY(3px)}60%{transform:translateY(1px)}}.kpi-block.theme-primary[_ngcontent-%COMP%]{border-left-color:#3b82f6}.kpi-block.theme-success[_ngcontent-%COMP%]{border-left-color:#22c55e}.kpi-block.theme-warning[_ngcontent-%COMP%]{border-left-color:#f59e0b}.kpi-block.theme-danger[_ngcontent-%COMP%]{border-left-color:#ef4444}.dark[_nghost-%COMP%]   .kpi-block[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .kpi-block[_ngcontent-%COMP%]{background:var(--surface-800);border-color:var(--surface-600)}.dark[_nghost-%COMP%]   .metric-item[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .metric-item[_ngcontent-%COMP%]{background:var(--surface-700);border-color:var(--surface-600)}.dark[_nghost-%COMP%]   .metric-item[_ngcontent-%COMP%]:hover, .dark   [_nghost-%COMP%]   .metric-item[_ngcontent-%COMP%]:hover{background:var(--surface-600)}.dark[_nghost-%COMP%]   .metric-comparison[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .metric-comparison[_ngcontent-%COMP%]{border-top-color:var(--surface-600)}@media(max-width:768px){.kpi-block[_ngcontent-%COMP%]{padding:16px}.metrics-container.orientation-horizontal[_ngcontent-%COMP%]{grid-template-columns:1fr}.metric-value[_ngcontent-%COMP%]{font-size:1.875rem}.metric-item[_ngcontent-%COMP%]{padding:16px}}@media(max-width:480px){.metric-value[_ngcontent-%COMP%]{font-size:1.625rem}.metrics-container[_ngcontent-%COMP%]{gap:12px}}']})};var rn=["chartCanvas"],sn=["chartContainer"];function ln(i,t){if(i&1){let e=w();a(0,"div",3)(1,"h4",8),c(2),r(),a(3,"div",9)(4,"button",10),b("click",function(){_(e);let o=p();return C(o.downloadChart())}),a(5,"i",11),c(6,"\u2B07"),r()()()()}if(i&2){let e=p();s(2),v(e.block.content.title)}}function cn(i,t){i&1&&(a(0,"div",5),u(1,"div",12),a(2,"p"),c(3,"Loading chart..."),r()())}function dn(i,t){if(i&1&&(a(0,"div",6)(1,"p"),c(2),r()()),i&2){let e=p();s(2),v(e.block.content.description)}}function pn(i,t){if(i&1&&(a(0,"div",14),u(1,"span",15),a(2,"span",16),c(3),r(),a(4,"span",17),c(5),r()()),i&2){let e=t.$implicit;s(),Pe("background-color",e.color),s(2),v(e.label),s(2),v(e.value)}}function gn(i,t){if(i&1&&(a(0,"div",7)(1,"div",13),A(2,pn,6,4,"div",14,se),r()()),i&2){let e=p();s(2),E(e.legendItems)}}pt.register(...Gt);var Ke=class i{block;chartCanvas;chartContainer;chart;isLoading=!0;showCustomLegend=!1;legendItems=[];colorPalette=["#3b82f6","#ef4444","#22c55e","#f59e0b","#8b5cf6","#06b6d4","#f97316","#84cc16","#ec4899","#6b7280","#14b8a6","#f43f5e"];ngOnInit(){this.prepareLegendData()}ngAfterViewInit(){setTimeout(()=>{this.createChart()},100)}ngOnDestroy(){this.chart&&this.chart.destroy()}getBlockClasses(){let t=["chart-block"];return this.block.visual?.theme&&t.push(`theme-${this.block.visual.theme}`),t}createChart(){let t=this.chartCanvas.nativeElement.getContext("2d");if(!t)return;let e=this.getChartConfig();try{this.chart=new pt(t,e),this.isLoading=!1}catch(n){console.error("Error creating chart:",n),this.isLoading=!1}}getChartConfig(){let t={type:this.getChartType(),data:this.getChartData(),options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{legend:{display:!this.showCustomLegend,position:"bottom",labels:{padding:20,usePointStyle:!0,color:getComputedStyle(document.documentElement).getPropertyValue("--text-color")||"#374151"}},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#fff",bodyColor:"#fff",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:8,displayColors:!0,callbacks:{label:e=>{let n=e.dataset.label??"";return n&&(n+=": "),n+=this.formatTooltipValue(e.parsed.y??e.parsed),n}}}},scales:this.getScalesConfig(),animation:{duration:1e3,easing:"easeOutQuart"}}};return(this.block.content.chart_type==="line"||this.block.content.chart_type==="area")&&t.options&&(t.options.elements={line:{tension:.4},point:{radius:4,hoverRadius:8,borderWidth:2}}),t}getChartType(){return{line:"line",bar:"bar",pie:"pie",area:"line",scatter:"scatter",donut:"doughnut"}[this.block.content.chart_type]||"bar"}getChartData(){let t=this.block.content.data;if(["pie","donut"].includes(this.block.content.chart_type))return{labels:t.map(o=>o.label),datasets:[{data:t.map(o=>o.value),backgroundColor:t.map((o,l)=>o.color??this.colorPalette[l%this.colorPalette.length]),borderWidth:3,borderColor:"#fff",hoverBorderWidth:5,hoverOffset:10}]};let e=this.block.content.chart_type==="area",n=this.colorPalette[0];return{labels:t.map(o=>o.label),datasets:[{label:this.block.content.y_axis??"Value",data:t.map(o=>o.value),backgroundColor:this.block.content.chart_type==="line"||e?e?this.hexToRgba(n,.2):this.hexToRgba(n,.1):t.map((o,l)=>o.color??this.colorPalette[l%this.colorPalette.length]),borderColor:n,borderWidth:3,fill:e,pointBackgroundColor:n,pointBorderColor:"#fff",pointBorderWidth:2,pointHoverBackgroundColor:"#fff",pointHoverBorderColor:n,pointHoverBorderWidth:3}]}}getScalesConfig(){if(["pie","donut"].includes(this.block.content.chart_type))return{};let t=getComputedStyle(document.documentElement).getPropertyValue("--text-color-secondary")||"#6b7280",e=getComputedStyle(document.documentElement).getPropertyValue("--surface-200")||"#e5e7eb";return{x:{display:!0,title:{display:$(this.block.content.x_axis)&&this.block.content.x_axis!=="",text:this.block.content.x_axis,color:t},ticks:{color:t},grid:{color:e}},y:{display:!0,title:{display:$(this.block.content.y_axis)&&this.block.content.y_axis!=="",text:this.block.content.y_axis,color:t},ticks:{color:t,callback:n=>this.formatAxisValue(n)},grid:{color:e}}}}prepareLegendData(){["pie","donut"].includes(this.block.content.chart_type)&&(this.showCustomLegend=!0,this.legendItems=this.block.content.data.map((t,e)=>({label:t.label,color:t.color??this.colorPalette[e%this.colorPalette.length],value:this.formatTooltipValue(t.value)})))}formatTooltipValue(t){return new Intl.NumberFormat("en-ZA").format(t)}formatAxisValue(t){return t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString()}hexToRgba(t,e){let n=Number.parseInt(t.slice(1,3),16),o=Number.parseInt(t.slice(3,5),16),l=Number.parseInt(t.slice(5,7),16);return`rgba(${n}, ${o}, ${l}, ${e})`}downloadChart(){if(this.chart){let t=this.chart.toBase64Image("image/png",1),e=document.createElement("a");e.download=`${this.block.content.title??"chart"}.png`,e.href=t,e.click()}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-chart-block"]],viewQuery:function(e,n){if(e&1&&(Y(rn,7),Y(sn,5)),e&2){let o;K(o=Z())&&(n.chartCanvas=o.first),K(o=Z())&&(n.chartContainer=o.first)}},inputs:{block:"block"},decls:9,vars:5,consts:[["chartContainer",""],["chartCanvas",""],[1,"chart-block",3,"ngClass"],[1,"chart-header"],[1,"chart-container"],[1,"chart-loading"],[1,"chart-description"],[1,"chart-legend"],[1,"chart-title"],[1,"chart-actions"],["title","Download Chart",1,"action-btn",3,"click"],[1,"download-icon"],[1,"loading-spinner"],[1,"legend-items"],[1,"legend-item"],[1,"legend-color"],[1,"legend-label"],[1,"legend-value"]],template:function(e,n){e&1&&(a(0,"div",2),g(1,ln,7,1,"div",3),a(2,"div",4,0),u(4,"canvas",null,1),g(6,cn,4,0,"div",5),r(),g(7,dn,3,1,"div",6),g(8,gn,4,0,"div",7),r()),e&2&&(y("ngClass",n.getBlockClasses()),s(),m(n.block.content.title?1:-1),s(5),m(n.isLoading?6:-1),s(),m(n.block.content.description?7:-1),s(),m(n.showCustomLegend?8:-1))},dependencies:[R,J],styles:[".chart-block[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:24px;box-shadow:0 2px 8px #00000014,0 8px 24px #0000001f;transition:all .3s ease;border:1px solid #e5e7eb;border-left:4px solid #3b82f6}.chart-block[_ngcontent-%COMP%]:hover{box-shadow:0 4px 16px #00000026,0 12px 32px #0000001a;border-color:#d1d5db}.chart-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid var(--surface-100)}.chart-title[_ngcontent-%COMP%]{color:var(--text-color);font-size:1.125rem;font-weight:700;margin:0;text-transform:uppercase;letter-spacing:.5px}.chart-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.action-btn[_ngcontent-%COMP%]{background:var(--surface-100);border:1px solid var(--surface-200);border-radius:6px;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;color:var(--text-color-secondary)}.action-btn[_ngcontent-%COMP%]:hover{background:var(--primary-50);border-color:var(--primary-200);color:var(--primary-600);transform:scale(1.1)}.download-icon[_ngcontent-%COMP%]{font-size:14px;font-style:normal}.chart-container[_ngcontent-%COMP%]{position:relative;height:350px;width:100%;margin-bottom:16px}.chart-loading[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--surface-0);border-radius:8px;z-index:10}.chart-loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:12px 0 0;color:var(--text-color-secondary);font-size:.875rem}.loading-spinner[_ngcontent-%COMP%]{width:32px;height:32px;border:3px solid var(--surface-200);border-top:3px solid var(--primary-500);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.chart-description[_ngcontent-%COMP%]{margin-top:16px}.chart-description[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);line-height:1.5;margin:0;font-size:.875rem}.chart-legend[_ngcontent-%COMP%]{margin-top:20px;padding-top:16px;border-top:1px solid var(--surface-200)}.legend-items[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--surface-50);border-radius:6px;transition:all .2s ease}.legend-item[_ngcontent-%COMP%]:hover{background:var(--surface-100);transform:scale(1.02)}.legend-color[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:3px;flex-shrink:0}.legend-label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-color-secondary);flex:1}.legend-value[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:var(--text-color)}.chart-block.theme-primary[_ngcontent-%COMP%]{border-left-color:#3b82f6}.chart-block.theme-success[_ngcontent-%COMP%]{border-left-color:#22c55e}.chart-block.theme-warning[_ngcontent-%COMP%]{border-left-color:#f59e0b}.chart-block.theme-danger[_ngcontent-%COMP%]{border-left-color:#ef4444}.dark[_nghost-%COMP%]   .chart-block[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .chart-block[_ngcontent-%COMP%]{background:var(--surface-800)}.dark[_nghost-%COMP%]   .action-btn[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .action-btn[_ngcontent-%COMP%]{background:var(--surface-700);border-color:var(--surface-600)}.dark[_nghost-%COMP%]   .action-btn[_ngcontent-%COMP%]:hover, .dark   [_nghost-%COMP%]   .action-btn[_ngcontent-%COMP%]:hover{background:var(--surface-600);border-color:var(--surface-500)}.dark[_nghost-%COMP%]   .legend-item[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .legend-item[_ngcontent-%COMP%]{background:var(--surface-700)}.dark[_nghost-%COMP%]   .legend-item[_ngcontent-%COMP%]:hover, .dark   [_nghost-%COMP%]   .legend-item[_ngcontent-%COMP%]:hover{background:var(--surface-600)}.dark[_nghost-%COMP%]   .chart-legend[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .chart-legend[_ngcontent-%COMP%]{border-top-color:var(--surface-600)}.dark[_nghost-%COMP%]   .chart-loading[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .chart-loading[_ngcontent-%COMP%]{background:var(--surface-800)}@media(max-width:768px){.chart-block[_ngcontent-%COMP%]{padding:16px}.chart-container[_ngcontent-%COMP%]{height:280px}.chart-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}.legend-items[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media(max-width:480px){.chart-container[_ngcontent-%COMP%]{height:240px}}"]})};function mn(i,t){if(i&1&&(a(0,"div",16)(1,"div",17),u(2,"i",4),r(),a(3,"div",18)(4,"span",19),c(5),r(),a(6,"span",20),c(7),r()()()),i&2){let e=t.$implicit,n=p(2);y("ngClass","entity-"+e.type),s(2),y("ngClass",n.getEntityIcon(e.type)),s(3),v(e.name),s(2),v(e.id)}}function un(i,t){if(i&1&&(a(0,"div",11)(1,"div",14)(2,"strong"),c(3),r()(),a(4,"div",15),A(5,mn,8,4,"div",16,qe().trackByEntity,!0),r()()),i&2){let e=p();s(3),D("Affected ",e.getEntityTypeLabel(),":"),s(2),E(e.block.content.affected_entities)}}function hn(i,t){if(i&1){let e=w();a(0,"div",12)(1,"div",21)(2,"i",22),c(3,"\u{1F4A1}"),r(),a(4,"strong"),c(5,"Recommended Action:"),r()(),a(6,"p",23),c(7),r(),a(8,"div",24)(9,"button",25),b("click",function(){_(e);let o=p();return C(o.takeAction())}),c(10," Take Action "),r(),a(11,"button",26),b("click",function(){_(e);let o=p();return C(o.dismissAlert())}),c(12," Dismiss "),r()()()}if(i&2){let e=p();s(7),v(e.block.content.suggested_action)}}function fn(i,t){if(i&1&&(a(0,"div",13)(1,"small",27),c(2),r()()),i&2){let e=p();s(2),D("Event ID: ",e.block.content.source_event_id)}}var Ze=class i{block;trackByEntity(t,e){return e.id}getAlertClasses(){return[`severity-${this.block.content.severity}`]}getSeverityIconClass(){return`icon-${this.block.content.severity}`}getSeverityIcon(){switch(this.block.content.severity){case"critical":return"\u26A0";case"warning":return"\u26A1";case"info":return"\u2139";default:return"\u2022"}}getEntityTypeLabel(){let t=this.block.content.affected_entities;if(t.length===0)return"";let e=[...new Set(t.map(n=>n.type))];return e.length===1?e[0]+(t.length>1?"s":""):"entities"}getEntityIcon(t){switch(t){case"vehicle":return"\u{1F697}";case"driver":return"\u{1F464}";case"geofence":return"\u{1F4CD}";default:return"\u2022"}}formatTimestamp(t){try{let e=new Date(t),o=new Date().getTime()-e.getTime(),l=Math.floor(o/6e4),d=Math.floor(l/60),h=Math.floor(d/24);return l<1?"Just now":l<60?`${l}m ago`:d<24?`${d}h ago`:h<7?`${h}d ago`:e.toLocaleDateString("en-ZA",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return t}}takeAction(){}dismissAlert(){}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-alert-block"]],inputs:{block:"block"},decls:18,vars:11,consts:[[1,"alert-block",3,"ngClass"],[1,"alert-header"],[1,"alert-icon-title"],[1,"alert-icon",3,"ngClass"],[3,"ngClass"],[1,"alert-title-timestamp"],[1,"alert-title"],[1,"alert-timestamp"],[1,"alert-severity-badge",3,"ngClass"],[1,"alert-content"],[1,"alert-message"],[1,"affected-entities"],[1,"suggested-action"],[1,"source-event"],[1,"affected-header"],[1,"entity-list"],[1,"entity-item",3,"ngClass"],[1,"entity-icon"],[1,"entity-info"],[1,"entity-name"],[1,"entity-id"],[1,"action-header"],[1,"action-icon"],[1,"action-description"],[1,"action-buttons"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-secondary",3,"click"],[1,"event-id"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),u(4,"i",4),r(),a(5,"div",5)(6,"h4",6),c(7),r(),a(8,"span",7),c(9),r()()(),a(10,"div",8),c(11),r()(),a(12,"div",9)(13,"p",10),c(14),r(),g(15,un,7,1,"div",11),g(16,hn,13,1,"div",12),g(17,fn,3,1,"div",13),r()()),e&2&&(y("ngClass",n.getAlertClasses()),s(3),y("ngClass",n.getSeverityIconClass()),s(),y("ngClass",n.getSeverityIcon()),s(3),v(n.block.content.title),s(2),v(n.formatTimestamp(n.block.content.timestamp)),s(),y("ngClass","severity-"+n.block.content.severity),s(),D(" ",n.block.content.severity.toUpperCase()," "),s(3),v(n.block.content.message),s(),m(n.block.content.affected_entities.length>0?15:-1),s(),m(n.block.content.is_actionable&&n.block.content.suggested_action?16:-1),s(),m(n.block.content.source_event_id?17:-1))},dependencies:[R,J],styles:[".alert-block[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:24px;box-shadow:0 2px 8px #00000014,0 8px 24px #0000001f;transition:all .3s ease;border:1px solid #e5e7eb;border-left:4px solid;position:relative;overflow:hidden}.alert-block[_ngcontent-%COMP%]:hover{box-shadow:0 4px 16px #00000026,0 12px 32px #0000001a;border-color:#d1d5db}.alert-block.severity-critical[_ngcontent-%COMP%]{border-left-color:#ef4444;background:linear-gradient(135deg,#fff,#fef2f2)}.alert-block.severity-warning[_ngcontent-%COMP%]{border-left-color:#f59e0b;background:linear-gradient(135deg,#fff,#fffbeb)}.alert-block.severity-info[_ngcontent-%COMP%]{border-left-color:#3b82f6;background:linear-gradient(135deg,#fff,#eff6ff)}.alert-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid var(--surface-100)}.alert-icon-title[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:12px;flex:1}.alert-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .3s ease}.alert-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px;font-style:normal}.alert-icon.icon-critical[_ngcontent-%COMP%]{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;animation:_ngcontent-%COMP%_pulse-critical 2s infinite}.alert-icon.icon-warning[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;animation:_ngcontent-%COMP%_pulse-warning 3s infinite}.alert-icon.icon-info[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff}@keyframes _ngcontent-%COMP%_pulse-critical{0%,to{box-shadow:0 0 #ef4444b3}50%{box-shadow:0 0 0 10px #ef444400}}@keyframes _ngcontent-%COMP%_pulse-warning{0%,to{box-shadow:0 0 #f59e0b80}50%{box-shadow:0 0 0 8px #f59e0b00}}.alert-title-timestamp[_ngcontent-%COMP%]{flex:1}.alert-title[_ngcontent-%COMP%]{color:var(--text-color);font-size:1.0625rem;font-weight:700;margin:0 0 4px}.alert-timestamp[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-color-secondary);font-weight:500}.alert-severity-badge[_ngcontent-%COMP%]{background:var(--surface-100);color:var(--text-color);padding:4px 12px;border-radius:12px;font-size:.75rem;font-weight:700;letter-spacing:.5px;border:1px solid var(--surface-200)}.alert-severity-badge.severity-critical[_ngcontent-%COMP%]{background:#fef2f2;color:#dc2626;border-color:#fecaca}.alert-severity-badge.severity-warning[_ngcontent-%COMP%]{background:#fffbeb;color:#d97706;border-color:#fed7aa}.alert-severity-badge.severity-info[_ngcontent-%COMP%]{background:#eff6ff;color:#2563eb;border-color:#bfdbfe}.alert-content[_ngcontent-%COMP%]{space-y:16px}.alert-message[_ngcontent-%COMP%]{color:var(--text-color);line-height:1.6;margin:0 0 16px;font-size:.95rem}.affected-entities[_ngcontent-%COMP%]{margin:16px 0;padding:16px;background:var(--surface-50);border-radius:8px;border:1px solid var(--surface-200)}.affected-header[_ngcontent-%COMP%]{margin-bottom:12px}.affected-header[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text-color);font-size:.875rem}.entity-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:8px}.entity-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--surface-0);border-radius:6px;border:1px solid var(--surface-200);transition:all .2s ease}.entity-item[_ngcontent-%COMP%]:hover{background:var(--surface-100);transform:scale(1.02)}.entity-icon[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:12px}.entity-icon.entity-vehicle[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#3b82f6}.entity-icon.entity-driver[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#22c55e}.entity-icon.entity-geofence[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#f59e0b}.entity-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:0}.entity-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-color);font-size:.875rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.entity-id[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-color-secondary);font-family:monospace;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.suggested-action[_ngcontent-%COMP%]{margin:16px 0;padding:16px;background:linear-gradient(135deg,#eff6ff,#dbeafe);border:1px solid #bfdbfe;border-radius:8px}.action-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:8px}.action-header[_ngcontent-%COMP%]   .action-icon[_ngcontent-%COMP%]{font-size:16px}.action-header[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text-color);font-size:.875rem}.action-description[_ngcontent-%COMP%]{color:var(--text-color-secondary);line-height:1.5;margin:0 0 16px;font-size:.875rem}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:8px}.btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;border:none;font-weight:600;font-size:.875rem;cursor:pointer;transition:all .2s ease}.btn.btn-primary[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.btn.btn-primary[_ngcontent-%COMP%]:hover{background:#2563eb;transform:translateY(-1px);box-shadow:0 4px 12px #3b82f64d}.btn.btn-secondary[_ngcontent-%COMP%]{background:var(--surface-200);color:var(--text-color-secondary)}.btn.btn-secondary[_ngcontent-%COMP%]:hover{background:var(--surface-300);color:var(--text-color)}.source-event[_ngcontent-%COMP%]{margin-top:16px;text-align:right}.event-id[_ngcontent-%COMP%]{color:var(--text-color-secondary);font-size:.75rem;font-family:monospace;background:var(--surface-100);padding:2px 8px;border-radius:4px}.dark[_nghost-%COMP%]   .alert-block[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .alert-block[_ngcontent-%COMP%]{background:var(--surface-800)}.dark[_nghost-%COMP%]   .affected-entities[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .affected-entities[_ngcontent-%COMP%]{background:var(--surface-700);border-color:var(--surface-600)}.dark[_nghost-%COMP%]   .entity-item[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .entity-item[_ngcontent-%COMP%]{background:var(--surface-800);border-color:var(--surface-600)}.dark[_nghost-%COMP%]   .entity-item[_ngcontent-%COMP%]:hover, .dark   [_nghost-%COMP%]   .entity-item[_ngcontent-%COMP%]:hover{background:var(--surface-700)}.dark[_nghost-%COMP%]   .suggested-action[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .suggested-action[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f61a,#3b82f60d);border-color:#3b82f633}.dark[_nghost-%COMP%]   .event-id[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .event-id[_ngcontent-%COMP%]{background:var(--surface-700)}.dark[_nghost-%COMP%]   .alert-severity-badge.severity-critical[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .alert-severity-badge.severity-critical[_ngcontent-%COMP%]{background:#ef44441a;border-color:#ef444433}.dark[_nghost-%COMP%]   .alert-severity-badge.severity-warning[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .alert-severity-badge.severity-warning[_ngcontent-%COMP%]{background:#f59e0b1a;border-color:#f59e0b33}.dark[_nghost-%COMP%]   .alert-severity-badge.severity-info[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .alert-severity-badge.severity-info[_ngcontent-%COMP%]{background:#3b82f61a;border-color:#3b82f633}@media(max-width:768px){.alert-block[_ngcontent-%COMP%]{padding:16px}.alert-header[_ngcontent-%COMP%]{flex-direction:column;gap:12px;align-items:stretch}.alert-severity-badge[_ngcontent-%COMP%]{align-self:flex-start}.entity-list[_ngcontent-%COMP%]{grid-template-columns:1fr}.action-buttons[_ngcontent-%COMP%]{flex-direction:column}}"]})};var _n=i=>({fullscreen:i}),Cn=(i,t,e,n)=>({sortable:i,highlight:t,"sorted-asc":e,"sorted-desc":n}),yn=i=>({"highlight-row":i}),bn=(i,t,e)=>({highlight:i,numeric:t,text:e});function vn(i,t){if(i&1){let e=w();a(0,"div",1)(1,"h4",10),c(2),r(),a(3,"div",11)(4,"button",12),b("click",function(){_(e);let o=p();return C(o.exportTable())}),a(5,"i",13),c(6,"\u{1F4CA}"),r()(),a(7,"button",14),b("click",function(){_(e);let o=p();return C(o.toggleFullscreen())}),a(8,"i",15),c(9,"\u26F6"),r()()()()}if(i&2){let e=p();s(2),v(e.block.content.title)}}function Mn(i,t){if(i&1&&(a(0,"div",19),u(1,"i",20),r()),i&2){let e=p().$index,n=p();s(),y("ngClass",n.getSortIcon(e))}}function xn(i,t){if(i&1){let e=w();a(0,"th",16),b("click",function(){let o=_(e).$index,l=p();return C(l.sortColumn(o))}),a(1,"div",17)(2,"span",18),c(3),r(),g(4,Mn,2,1,"div",19),r()()}if(i&2){let e=t.$implicit,n=t.$index,o=p();y("ngClass",vt(4,Cn,o.block.content.sortable,n===o.block.content.highlight_column,o.sortState.column===n&&o.sortState.direction==="asc",o.sortState.column===n&&o.sortState.direction==="desc")),L("aria-sort",o.getSortAttribute(n)),s(3),v(e),s(),m(o.block.content.sortable?4:-1)}}function Pn(i,t){if(i&1&&(a(0,"span",25),c(1),r()),i&2){let e=p().$implicit,n=p(2);y("ngClass",n.getTrendClass(e)),s(),D(" ",n.getTrendIndicator(e)," ")}}function On(i,t){if(i&1&&(a(0,"td",22)(1,"div",23)(2,"span",24),c(3),r(),g(4,Pn,2,2,"span",25),r()()),i&2){let e=t.$implicit,n=t.$index,o=p(2);y("ngClass",bt(4,bn,n===o.block.content.highlight_column,o.isNumeric(e),!o.isNumeric(e)))("title",o.getCellTooltip(e,n)),s(3),v(o.formatCell(e,n)),s(),m(o.shouldShowTrend(e,n)?4:-1)}}function kn(i,t){if(i&1){let e=w();a(0,"tr",21),b("mouseenter",function(){let o=_(e).$index,l=p();return C(l.onRowHover(o))})("mouseleave",function(){_(e);let o=p();return C(o.onRowLeave())}),A(1,On,5,8,"td",22,se),r()}if(i&2){let e=t.$implicit,n=t.$index;y("ngClass",Ie(1,yn,n%2===0)),s(),E(e)}}function wn(i,t){if(i&1&&(a(0,"tr",8)(1,"td",26)(2,"div",27)(3,"i",28),c(4,"\u{1F4CB}"),r(),a(5,"p"),c(6,"No data available"),r()()()()),i&2){let e=p();s(),L("colspan",e.block.content.headers.length)}}function Sn(i,t){i&1&&(a(0,"span"),c(1," \u2022 "),r())}function Dn(i,t){if(i&1&&(a(0,"span"),c(1),a(2,"strong"),c(3),r(),g(4,Sn,2,0,"span"),r()),i&2){let e=t.$implicit,n=t.$index,o=t.$count;s(),D(" ",e.label,": "),s(2),v(e.value),s(),m(n!==o-1?4:-1)}}function Tn(i,t){if(i&1&&(a(0,"div",30),A(1,Dn,5,3,"span",null,se),r()),i&2){let e=p(2);s(),E(e.getSummaryStats())}}function An(i,t){if(i&1&&(a(0,"div",9)(1,"div",29),c(2),r(),g(3,Tn,3,0,"div",30),r()),i&2){let e=p();s(2),G(" Showing ",e.sortedRows.length," ",e.sortedRows.length===1?"row":"rows"," "),s(),m(e.showSummary?3:-1)}}var Je=class i{block;sortState={column:-1,direction:"asc"};isFullscreen=!1;hoveredRow=-1;get showSummary(){return this.block.content.summary?.enabled??!0}trackByRow(t,e){return`row-${t}-${e.join("-")}`}getBlockClasses(){let t=["table-block"];return this.block.visual?.theme&&t.push(`theme-${this.block.visual.theme}`),t}get sortedRows(){let t=this.block.content.rows;return!Array.isArray(t)||t.length===0?[]:this.sortState.column===-1||B(this.block.content.sortable)?t:[...t].sort((e,n)=>{let o=e[this.sortState.column],l=n[this.sortState.column],d=this.sortState.direction==="asc"?1:-1;return typeof o=="number"&&typeof l=="number"?(o-l)*d:String(o).localeCompare(String(l))*d})}sortColumn(t){B(this.block.content.sortable)||(this.sortState.column===t?this.sortState.direction=this.sortState.direction==="asc"?"desc":"asc":(this.sortState.column=t,this.sortState.direction="asc"))}getSortIcon(t){return this.sortState.column!==t?"sort-none":this.sortState.direction==="asc"?"sort-asc":"sort-desc"}getSortAttribute(t){return this.sortState.column!==t||B(this.block.content.sortable)?null:this.sortState.direction==="asc"?"ascending":"descending"}formatCell(t,e){if(typeof t=="number"){let n=this.block.content.headers[e].toLowerCase();if(n.includes("percent")||n.includes("%"))return`${t.toFixed(1)}%`;if(n.includes("distance")||n.includes("km"))return`${t.toLocaleString()} km`;if(n.includes("currency")||n.includes("cost")||n.includes("price"))return new Intl.NumberFormat("en-ZA",{style:"currency",currency:"ZAR",minimumFractionDigits:0}).format(t);if(n.includes("duration")||n.includes("time")){let o=Math.floor(t/60),l=t%60;return o>0?`${o}h ${l}m`:`${l}m`}return t.toLocaleString()}return String(t)}isNumeric(t){return typeof t=="number"}getCellTooltip(t,e){return`${this.block.content.headers[e]}: ${this.formatCell(t,e)}`}shouldShowTrend(t,e){return typeof t=="number"&&(this.block.content.headers[e].toLowerCase().includes("change")||this.block.content.headers[e].toLowerCase().includes("growth"))}getTrendClass(t){return typeof t!="number"?"trend-neutral":t>0?"trend-positive":t<0?"trend-negative":"trend-neutral"}getTrendIndicator(t){return typeof t!="number"?"":t>0?"\u2197":t<0?"\u2198":"\u2192"}onRowHover(t){this.hoveredRow=t}onRowLeave(){this.hoveredRow=-1}getSummaryStats(){let t=this.sortedRows;if(t.length===0)return[];let e=[{label:"Records",value:t.length.toString()}];if(this.block.content.summary?.enabled===!1)return e;let n=this.getColumnsToSummarize();for(let o of n){let l=this.block.content.headers[o.column_index],d=t.map(M=>M[o.column_index]).filter(M=>typeof M=="number");if(d.length===0)continue;let h=o.format??this.detectColumnFormat(o.column_index),O=o.label??l;for(let M of o.aggregations){let x=this.calculateAggregation(d,M),k=this.formatAggregationValue(x,h),N=this.getAggregationLabel(M,O);e.push({label:N,value:k})}}return e}getColumnsToSummarize(){return this.block.content.summary?.columns!==void 0&&this.block.content.summary.columns.length>0?this.block.content.summary.columns:[]}calculateAggregation(t,e){if(t.length===0)return 0;switch(e){case"count":return t.length;case"sum":return t.reduce((n,o)=>n+o,0);case"average":return t.reduce((n,o)=>n+o,0)/t.length;case"min":return Math.min(...t);case"max":return Math.max(...t);case"median":{let n=[...t].sort((l,d)=>l-d),o=Math.floor(n.length/2);return n.length%2===0?(n[o-1]+n[o])/2:n[o]}default:return 0}}formatAggregationValue(t,e){switch(e){case"percentage":return`${t.toFixed(1)}%`;case"currency":return new Intl.NumberFormat("en-ZA",{style:"currency",currency:"ZAR",minimumFractionDigits:0}).format(t);case"duration":{let n=Math.floor(t/60),o=Math.round(t%60);return n>0?`${n}h ${o}m`:`${o}m`}case"number":default:return t.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})}}getAggregationLabel(t,e){switch(t){case"count":return`${e} Count`;case"sum":return`${e} Total`;case"average":return`${e} Avg`;case"min":return`${e} Min`;case"max":return`${e} Max`;case"median":return`${e} Median`;default:return e}}detectColumnFormat(t){let e=this.block.content.headers[t].toLowerCase();return e.includes("percent")||e.includes("%")?"percentage":e.includes("currency")||e.includes("cost")||e.includes("price")?"currency":e.includes("duration")||e.includes("time")?"duration":"number"}isProbablyIdColumn(t){let e=this.block.content.headers[t].toLowerCase();return e.includes("id")||e.includes("number")||e.includes("code")||e==="#"}toggleFullscreen(){this.isFullscreen=!this.isFullscreen}exportTable(){let t=this.block.content.headers.join(","),e=this.sortedRows.map(h=>h.map(O=>`"${O}"`).join(",")).join(`
`),n=`${t}
${e}`,o=new Blob([n],{type:"text/csv"}),l=globalThis.URL.createObjectURL(o),d=document.createElement("a");d.href=l,d.download=`${this.block.content.title??"table-data"}.csv`,d.click(),globalThis.URL.revokeObjectURL(l)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-table-block"]],inputs:{block:"block"},decls:14,vars:7,consts:[[1,"table-block",3,"ngClass"],[1,"table-header"],[1,"table-container",3,"ngClass"],[1,"table-responsive"],[1,"data-table"],[1,"header-row"],[1,"header-cell",3,"ngClass"],[1,"data-row",3,"ngClass"],[1,"empty-row"],[1,"table-footer"],[1,"table-title"],[1,"table-actions"],["title","Export Data",1,"action-btn",3,"click"],[1,"export-icon"],["title","Toggle Fullscreen",1,"action-btn",3,"click"],[1,"fullscreen-icon"],[1,"header-cell",3,"click","ngClass"],[1,"header-content"],[1,"header-text"],[1,"sort-indicator"],[1,"sort-icon",3,"ngClass"],[1,"data-row",3,"mouseenter","mouseleave","ngClass"],[1,"data-cell",3,"ngClass","title"],[1,"cell-content"],[1,"cell-value"],[1,"cell-trend",3,"ngClass"],[1,"empty-cell"],[1,"empty-state"],[1,"empty-icon"],[1,"row-count"],[1,"table-summary"]],template:function(e,n){e&1&&(a(0,"div",0),g(1,vn,10,1,"div",1),a(2,"div",2)(3,"div",3)(4,"table",4)(5,"thead")(6,"tr",5),A(7,xn,5,9,"th",6,se),r()(),a(9,"tbody"),A(10,kn,3,3,"tr",7,n.trackByRow,!0),g(12,wn,7,1,"tr",8),r()()(),g(13,An,4,3,"div",9),r()()),e&2&&(y("ngClass",n.getBlockClasses()),s(),m(n.block.content.title?1:-1),s(),y("ngClass",Ie(5,_n,n.isFullscreen)),s(5),E(n.block.content.headers),s(3),E(n.sortedRows),s(2),m(n.sortedRows.length===0?12:-1),s(),m(n.block.content.rows.length?13:-1))},dependencies:[R,J],styles:['@charset "UTF-8";.table-block[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:24px;box-shadow:0 2px 8px #00000014,0 8px 24px #0000001f;transition:all .3s ease;border:1px solid #e5e7eb;border-left:4px solid #3b82f6}.table-block[_ngcontent-%COMP%]:hover{box-shadow:0 4px 16px #00000026,0 12px 32px #0000001a;border-color:#d1d5db}.table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid var(--surface-100)}.table-title[_ngcontent-%COMP%]{color:var(--text-color);font-size:1.125rem;font-weight:700;margin:0;text-transform:uppercase;letter-spacing:.5px}.table-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.action-btn[_ngcontent-%COMP%]{background:var(--surface-100);border:1px solid var(--surface-200);border-radius:6px;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;color:var(--text-color-secondary)}.action-btn[_ngcontent-%COMP%]:hover{background:var(--primary-50);border-color:var(--primary-200);color:var(--primary-600);transform:scale(1.1)}.export-icon[_ngcontent-%COMP%], .fullscreen-icon[_ngcontent-%COMP%]{font-size:14px;font-style:normal}.table-container[_ngcontent-%COMP%]{position:relative;transition:all .3s ease}.table-container.fullscreen[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--surface-0);z-index:1000;padding:20px;border-radius:0}.table-responsive[_ngcontent-%COMP%]{overflow-x:auto;border-radius:8px;border:1px solid var(--surface-200)}.data-table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0;font-size:.875rem}.header-row[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--surface-100),var(--surface-50))}.header-cell[_ngcontent-%COMP%]{padding:16px 12px;text-align:left;font-weight:600;color:var(--text-color);border-bottom:2px solid var(--surface-200);position:relative;-webkit-user-select:none;user-select:none;transition:all .2s ease}.header-cell.sortable[_ngcontent-%COMP%]{cursor:pointer}.header-cell.sortable[_ngcontent-%COMP%]:hover{background:var(--surface-200)}.header-cell.highlight[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--primary-100),var(--primary-50));border-bottom-color:var(--primary-300)}.header-cell.sorted-asc[_ngcontent-%COMP%], .header-cell.sorted-desc[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--primary-200),var(--primary-100))}.header-cell[_ngcontent-%COMP%]:first-child{border-top-left-radius:8px}.header-cell[_ngcontent-%COMP%]:last-child{border-top-right-radius:8px}.header-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:8px}.header-text[_ngcontent-%COMP%]{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.sort-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;width:16px;height:16px}.sort-icon[_ngcontent-%COMP%]{font-size:12px;color:var(--text-color-secondary);transition:all .2s ease}.sort-icon.sort-asc[_ngcontent-%COMP%]:before{content:"\\25b2";color:var(--primary-600)}.sort-icon.sort-desc[_ngcontent-%COMP%]:before{content:"\\25bc";color:var(--primary-600)}.sort-icon.sort-none[_ngcontent-%COMP%]:before{content:"\\21c5"}.data-row[_ngcontent-%COMP%]{transition:all .2s ease}.data-row[_ngcontent-%COMP%]:hover{background:var(--surface-50);transform:scale(1.002)}.data-row.highlight-row[_ngcontent-%COMP%]{background:#00000005}.data-cell[_ngcontent-%COMP%]{padding:12px;border-bottom:1px solid var(--surface-100);transition:all .2s ease}.data-cell.highlight[_ngcontent-%COMP%]{background:var(--primary-25);border-left:3px solid var(--primary-300)}.data-cell.numeric[_ngcontent-%COMP%]{text-align:right;font-variant-numeric:tabular-nums}.data-cell.text[_ngcontent-%COMP%]{text-align:left}.cell-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;justify-content:space-between}.cell-value[_ngcontent-%COMP%]{color:var(--text-color);font-weight:500}.cell-trend[_ngcontent-%COMP%]{font-size:.75rem;padding:2px 6px;border-radius:12px;font-weight:600}.cell-trend.trend-positive[_ngcontent-%COMP%]{background:#dcfce7;color:#166534}.cell-trend.trend-negative[_ngcontent-%COMP%]{background:#fef2f2;color:#dc2626}.cell-trend.trend-neutral[_ngcontent-%COMP%]{background:#f3f4f6;color:#6b7280}.empty-row[_ngcontent-%COMP%]   .empty-cell[_ngcontent-%COMP%]{padding:40px;text-align:center;border:none}.empty-row[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:8px;color:var(--text-color-secondary)}.empty-row[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:24px;opacity:.5}.empty-row[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.875rem}.table-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:16px;padding-top:16px;border-top:1px solid var(--surface-200);font-size:.875rem}.row-count[_ngcontent-%COMP%]{color:var(--text-color-secondary);font-weight:500}.table-summary[_ngcontent-%COMP%]{color:var(--text-color-secondary)}.table-summary[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text-color);font-weight:600}.dark[_nghost-%COMP%]   .table-block[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .table-block[_ngcontent-%COMP%]{background:var(--surface-800)}.dark[_nghost-%COMP%]   .header-row[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .header-row[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--surface-700),var(--surface-750))}.dark[_nghost-%COMP%]   .header-cell[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .header-cell[_ngcontent-%COMP%]{border-bottom-color:var(--surface-600)}.dark[_nghost-%COMP%]   .header-cell.highlight[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .header-cell.highlight[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f633,#3b82f61a);border-bottom-color:#3b82f64d}.dark[_nghost-%COMP%]   .header-cell.sorted-asc[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .header-cell.sorted-asc[_ngcontent-%COMP%], .dark[_nghost-%COMP%]   .header-cell.sorted-desc[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .header-cell.sorted-desc[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f64d,#3b82f633)}.dark[_nghost-%COMP%]   .data-row[_ngcontent-%COMP%]:hover, .dark   [_nghost-%COMP%]   .data-row[_ngcontent-%COMP%]:hover{background:var(--surface-700)}.dark[_nghost-%COMP%]   .data-row.highlight-row[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .data-row.highlight-row[_ngcontent-%COMP%]{background:#ffffff05}.dark[_nghost-%COMP%]   .data-cell[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .data-cell[_ngcontent-%COMP%]{border-bottom-color:var(--surface-700)}.dark[_nghost-%COMP%]   .data-cell.highlight[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .data-cell.highlight[_ngcontent-%COMP%]{background:#3b82f61a;border-left-color:#3b82f680}.dark[_nghost-%COMP%]   .table-footer[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .table-footer[_ngcontent-%COMP%]{border-top-color:var(--surface-600)}.dark[_nghost-%COMP%]   .action-btn[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .action-btn[_ngcontent-%COMP%]{background:var(--surface-700);border-color:var(--surface-600)}.dark[_nghost-%COMP%]   .action-btn[_ngcontent-%COMP%]:hover, .dark   [_nghost-%COMP%]   .action-btn[_ngcontent-%COMP%]:hover{background:var(--surface-600);border-color:var(--surface-500)}@media(max-width:768px){.table-block[_ngcontent-%COMP%]{padding:16px}.table-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:12px}.table-actions[_ngcontent-%COMP%]{align-self:flex-end}.header-cell[_ngcontent-%COMP%], .data-cell[_ngcontent-%COMP%]{padding:8px;font-size:.8rem}.table-footer[_ngcontent-%COMP%]{flex-direction:column;gap:8px;align-items:stretch}.table-summary[_ngcontent-%COMP%]{text-align:center}}']})};var En=i=>({actionable:i});function Vn(i,t){i&1&&(a(0,"span",11),c(1,"\u2713"),r())}function In(i,t){if(i&1&&(a(0,"div",7)(1,"div",9)(2,"div",10),g(3,Vn,2,0,"span",11),a(4,"h4",12),c(5),r()(),a(6,"span",13),c(7),r()(),a(8,"p",14),c(9),r(),a(10,"div",15)(11,"div",16)(12,"span",17),c(13,"Impact:"),r(),a(14,"span",18),c(15),r()(),a(16,"div",19)(17,"span",20),c(18,"Effort:"),r(),a(19,"span",21),u(20,"span",22)(21,"span",22)(22,"span",22),r(),a(23,"span",23),c(24),te(25,"titlecase"),r()()()()),i&2){let e=t.$implicit;y("ngClass",Ie(10,En,e.actionable)),s(3),m(e.actionable?3:-1),s(2),v(e.title),s(2),v(e.category),s(2),v(e.description),s(6),v(e.impact),s(4),y("ngClass","effort-"+e.effort),s(5),v(ne(25,8,e.effort))}}function Rn(i,t){if(i&1&&(a(0,"div",8)(1,"span",24),c(2),r()()),i&2){let e=p();s(2),G(" ",e.getActionableCount()," actionable recommendation",e.getActionableCount()>1?"s":""," ")}}var Xe=class i{block;getBlockClasses(){let t=[];return this.block.visual?.theme&&t.push(`theme-${this.block.visual.theme}`),t}getPriorityClass(){return`priority-${this.block.content.priority}`}getActionableCount(){return this.block.content.recommendations.filter(t=>t.actionable).length}trackByRec(t,e){return e.id}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-recommendation-block"]],inputs:{block:"block"},decls:14,vars:7,consts:[[1,"recommendation-block",3,"ngClass"],[1,"block-header"],[1,"header-content"],[1,"header-icon"],[1,"block-title"],[1,"priority-badge",3,"ngClass"],[1,"recommendations-list"],[1,"recommendation-card",3,"ngClass"],[1,"block-footer"],[1,"rec-header"],[1,"rec-title-row"],[1,"actionable-icon"],[1,"rec-title"],[1,"category-badge"],[1,"rec-description"],[1,"rec-footer"],[1,"impact-section"],[1,"impact-label"],[1,"impact-text"],[1,"effort-indicator"],[1,"effort-label"],[1,"effort-dots",3,"ngClass"],[1,"dot"],[1,"effort-text"],[1,"footer-stat"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),c(4,"\u{1F4A1}"),r(),a(5,"h3",4),c(6),r()(),a(7,"span",5),c(8),te(9,"uppercase"),r()(),a(10,"div",6),A(11,In,26,12,"div",7,n.trackByRec,!0),r(),g(13,Rn,3,2,"div",8),r()),e&2&&(y("ngClass",n.getBlockClasses()),s(6),v(n.block.content.title),s(),y("ngClass",n.getPriorityClass()),s(),D(" ",ne(9,5,n.block.content.priority)," "),s(3),E(n.block.content.recommendations),s(2),m(n.getActionableCount()>0?13:-1))},dependencies:[R,J,xt,Mt],styles:[".recommendation-block[_ngcontent-%COMP%]{background:var(--surface-0, #ffffff);border-radius:12px;border:1px solid var(--surface-200, #e5e7eb);border-left:4px solid var(--primary-500, #3b82f6);overflow:hidden;transition:all .2s ease}.recommendation-block[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #00000014}.recommendation-block.theme-info[_ngcontent-%COMP%]{border-left-color:#06b6d4}.recommendation-block.theme-success[_ngcontent-%COMP%]{border-left-color:#22c55e}.recommendation-block.theme-warning[_ngcontent-%COMP%]{border-left-color:#f59e0b}.recommendation-block.theme-danger[_ngcontent-%COMP%]{border-left-color:#ef4444}.block-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid var(--surface-200, #e5e7eb);background:var(--surface-50, #f9fafb)}.header-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.header-icon[_ngcontent-%COMP%]{font-size:1.5rem}.block-title[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;font-weight:600;color:var(--text-color, #1f2937)}.priority-badge[_ngcontent-%COMP%]{padding:4px 12px;border-radius:20px;font-size:.75rem;font-weight:600;letter-spacing:.5px}.priority-badge.priority-low[_ngcontent-%COMP%]{background:#dcfce7;color:#166534}.priority-badge.priority-medium[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.priority-badge.priority-high[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.priority-badge.priority-critical[_ngcontent-%COMP%]{background:#fecaca;color:#7f1d1d}.recommendations-list[_ngcontent-%COMP%]{padding:16px;display:flex;flex-direction:column;gap:12px}.recommendation-card[_ngcontent-%COMP%]{background:var(--surface-50, #f9fafb);border:1px solid var(--surface-200, #e5e7eb);border-radius:8px;padding:16px;transition:all .2s ease}.recommendation-card[_ngcontent-%COMP%]:hover{background:var(--surface-100, #f3f4f6);border-color:var(--surface-300, #d1d5db)}.recommendation-card.actionable[_ngcontent-%COMP%]{border-left:3px solid #22c55e}.rec-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:8px}.rec-title-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex:1}.actionable-icon[_ngcontent-%COMP%]{color:#22c55e;font-weight:700;font-size:1rem}.rec-title[_ngcontent-%COMP%]{margin:0;font-size:.975rem;font-weight:600;color:var(--text-color, #1f2937)}.category-badge[_ngcontent-%COMP%]{padding:2px 8px;background:var(--surface-200, #e5e7eb);color:var(--text-color-secondary, #6b7280);border-radius:4px;font-size:.75rem;font-weight:500;white-space:nowrap}.rec-description[_ngcontent-%COMP%]{margin:0 0 12px;font-size:.875rem;color:var(--text-color-secondary, #6b7280);line-height:1.5}.rec-footer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:16px;flex-wrap:wrap}.impact-section[_ngcontent-%COMP%]{flex:1;min-width:200px}.impact-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;color:var(--text-color-secondary, #6b7280);margin-right:4px}.impact-text[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-color, #1f2937)}.effort-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.effort-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;color:var(--text-color-secondary, #6b7280)}.effort-dots[_ngcontent-%COMP%]{display:flex;gap:3px}.effort-dots[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;background:var(--surface-300, #d1d5db)}.effort-dots.effort-low[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]:nth-child(1){background:#22c55e}.effort-dots.effort-medium[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]:nth-child(1), .effort-dots.effort-medium[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]:nth-child(2){background:#f59e0b}.effort-dots.effort-high[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{background:#ef4444}.effort-text[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-color-secondary, #6b7280)}.block-footer[_ngcontent-%COMP%]{padding:12px 20px;border-top:1px solid var(--surface-200, #e5e7eb);background:var(--surface-50, #f9fafb)}.footer-stat[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-color-secondary, #6b7280)}.dark[_nghost-%COMP%]   .recommendation-block[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .recommendation-block[_ngcontent-%COMP%]{background:var(--surface-800);border-color:var(--surface-600)}.dark[_nghost-%COMP%]   .block-header[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .block-header[_ngcontent-%COMP%]{background:var(--surface-700);border-bottom-color:var(--surface-600)}.dark[_nghost-%COMP%]   .block-title[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .block-title[_ngcontent-%COMP%]{color:var(--text-color)}.dark[_nghost-%COMP%]   .priority-badge.priority-low[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .priority-badge.priority-low[_ngcontent-%COMP%]{background:#22c55e33;color:#86efac}.dark[_nghost-%COMP%]   .priority-badge.priority-medium[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .priority-badge.priority-medium[_ngcontent-%COMP%]{background:#f59e0b33;color:#fcd34d}.dark[_nghost-%COMP%]   .priority-badge.priority-high[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .priority-badge.priority-high[_ngcontent-%COMP%]{background:#ef444433;color:#fca5a5}.dark[_nghost-%COMP%]   .recommendation-card[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .recommendation-card[_ngcontent-%COMP%]{background:var(--surface-700);border-color:var(--surface-600)}.dark[_nghost-%COMP%]   .recommendation-card[_ngcontent-%COMP%]:hover, .dark   [_nghost-%COMP%]   .recommendation-card[_ngcontent-%COMP%]:hover{background:var(--surface-600)}.dark[_nghost-%COMP%]   .rec-title[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .rec-title[_ngcontent-%COMP%]{color:var(--text-color)}.dark[_nghost-%COMP%]   .category-badge[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .category-badge[_ngcontent-%COMP%]{background:var(--surface-600);color:var(--text-color-secondary)}.dark[_nghost-%COMP%]   .block-footer[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .block-footer[_ngcontent-%COMP%]{background:var(--surface-700);border-top-color:var(--surface-600)}@media(max-width:768px){.block-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}.rec-header[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.rec-footer[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.impact-section[_ngcontent-%COMP%]{min-width:100%}}"]})};var zn=["dashboardContainer"];function Nn(i,t){i&1&&(oe(),a(0,"svg",20),u(1,"path",61)(2,"path",62),r())}function qn(i,t){i&1&&(oe(),a(0,"svg",21),u(1,"circle",63),r())}function Fn(i,t){if(i&1){let e=w();a(0,"button",64),b("click",function(){_(e);let o=p(2);return C(o.showAllVehicles=!o.showAllVehicles)}),c(1),oe(),a(2,"svg",65),u(3,"polyline",66),r()()}if(i&2){let e=p(2);s(),D(" ",e.showAllVehicles?"Show less":"Show all"," "),s(),U("rotated",e.showAllVehicles)}}function $n(i,t){if(i&1&&(a(0,"div",43)(1,"span",36),c(2),r()()),i&2){let e=p(2);s(2),v(e.getVehicleDisplayText())}}function Bn(i,t){if(i&1&&(a(0,"span",67),c(1),r()),i&2){let e=t.$implicit;s(),v(e)}}function Ln(i,t){if(i&1&&(a(0,"div",44),A(1,Bn,2,1,"span",67,se),r()),i&2){let e=p(2);s(),E(e.vehicleNames)}}function Qn(i,t){if(i&1&&(a(0,"div",45)(1,"div",28),oe(),a(2,"svg",29),u(3,"circle",68)(4,"path",69),r()(),ce(),a(5,"div",34)(6,"span",35),c(7,"Analysis Query"),r(),a(8,"span",70),c(9),r()()()),i&2){let e=p(2);s(9),D('"',e.userQuery,'"')}}function Un(i,t){if(i&1){let e=w();a(0,"div",2)(1,"div",7)(2,"div",8)(3,"div",9),oe(),a(4,"svg",10),u(5,"rect",11)(6,"rect",12)(7,"rect",13)(8,"rect",14),r()(),ce(),a(9,"div",15)(10,"h1",16),c(11,"Fleet Analytics Report"),r(),a(12,"span",17),c(13,"AI-Powered Insights"),r()()(),a(14,"div",18)(15,"button",19),b("click",function(){_(e);let o=p();return C(o.onRecalculate())}),g(16,Nn,3,0,":svg:svg",20),g(17,qn,2,0,":svg:svg",21),c(18),r(),a(19,"button",22),b("click",function(){_(e);let o=p();return C(o.onPrint())}),oe(),a(20,"svg",20),u(21,"polyline",23)(22,"path",24)(23,"rect",25),r(),c(24," Print "),r()()(),ce(),a(25,"div",26)(26,"div",27)(27,"div",28),oe(),a(28,"svg",29),u(29,"rect",30)(30,"line",31)(31,"line",32)(32,"line",33),r()(),ce(),a(33,"div",34)(34,"span",35),c(35,"Analysis Period"),r(),a(36,"span",36),c(37),r()()(),a(38,"div",37)(39,"div",28),oe(),a(40,"svg",29),u(41,"path",38)(42,"circle",39)(43,"circle",40),r()(),ce(),a(44,"div",34)(45,"div",41)(46,"span",35),c(47),r(),g(48,Fn,4,3,"button",42),r(),g(49,$n,3,1,"div",43),g(50,Ln,3,0,"div",44),r()(),g(51,Qn,10,1,"div",45),r(),a(52,"div",46)(53,"div",47),oe(),a(54,"svg",48),u(55,"path",49)(56,"polyline",50)(57,"line",51)(58,"line",52),r(),ce(),a(59,"span"),c(60,"Executive Summary"),r()(),a(61,"p",53),c(62),r()(),a(63,"div",54)(64,"div",55),oe(),a(65,"svg",56),u(66,"circle",57)(67,"polyline",58),r(),ce(),a(68,"span"),c(69),r()(),a(70,"div",55),oe(),a(71,"svg",56),u(72,"path",59)(73,"path",60),r(),ce(),a(74,"span"),c(75),r()()()()}if(i&2){let e=p();s(15),y("disabled",e.isRecalculating),s(),m(e.isRecalculating?-1:16),s(),m(e.isRecalculating?17:-1),s(),D(" ",e.isRecalculating?"Regenerating...":"Regenerate"," "),s(19),v(e.dateRange||"Not specified"),s(),U("expanded",e.showAllVehicles),s(9),D("Vehicles (",(e.vehicleNames==null?null:e.vehicleNames.length)||0,")"),s(),m(e.vehicleNames&&e.vehicleNames.length>2?48:-1),s(),m(e.showAllVehicles?-1:49),s(),m(e.showAllVehicles?50:-1),s(),m(e.userQuery?51:-1),s(11),v(e.response==null||e.response.response==null?null:e.response.response.summary),s(7),D("Generated: ",e.formatTimestamp((e.response==null||e.response.response==null?null:e.response.response.timestamp)||"")),s(6),D("ID: ",e.response==null||e.response.response==null?null:e.response.response.request_id)}}function Hn(i,t){if(i&1&&(a(0,"div",76)(1,"div",77),u(2,"div",78),r(),a(3,"span",79),c(4),r()()),i&2){let e=p(2);s(2),Pe("width",e.loadingProgress,"%"),s(2),D("",e.loadingProgress,"%")}}function jn(i,t){if(i&1&&(a(0,"div",3)(1,"div",71)(2,"div",72),u(3,"div",73)(4,"div",73)(5,"div",73),r(),a(6,"h3",74),c(7,"Generating Analytics Dashboard"),r(),a(8,"p",75),c(9," AI is analyzing your data and creating interactive visualizations... "),r(),g(10,Hn,5,3,"div",76),r()()),i&2){let e=p();s(10),m(e.loadingProgress>0?10:-1)}}function Gn(i,t){if(i&1){let e=w();a(0,"div",4)(1,"div",80)(2,"div",81),c(3,"\u26A0\uFE0F"),r(),a(4,"h4",82),c(5,"Dashboard Generation Failed"),r(),a(6,"p",83),c(7),r(),a(8,"div",84)(9,"button",85),b("click",function(){_(e);let o=p();return C(o.onRetry())}),a(10,"i",86),c(11,"\u{1F504}"),r(),c(12," Retry "),r(),a(13,"button",87),b("click",function(){_(e);let o=p();return C(o.onDismissError())}),c(14," Dismiss "),r()()()()}if(i&2){let e=p();s(7),v(e.error)}}function Wn(i,t){if(i&1&&u(0,"app-summary-block",90),i&2){let e=p().$implicit;y("block",e)}}function Yn(i,t){if(i&1&&u(0,"app-kpi-block",90),i&2){let e=p().$implicit;y("block",e)}}function Kn(i,t){if(i&1&&u(0,"app-chart-block",90),i&2){let e=p().$implicit;y("block",e)}}function Zn(i,t){if(i&1&&u(0,"app-alert-block",90),i&2){let e=p().$implicit;y("block",e)}}function Jn(i,t){if(i&1&&u(0,"app-table-block",90),i&2){let e=p().$implicit;y("block",e)}}function Xn(i,t){if(i&1&&u(0,"app-recommendation-block",90),i&2){let e=p().$implicit;y("block",e)}}function eo(i,t){i&1&&(a(0,"div",91)(1,"h4"),c(2,"Map Block"),r(),a(3,"p"),c(4,"Coming Soon"),r()())}function to(i,t){if(i&1&&(a(0,"div",88),g(1,Wn,1,1,"app-summary-block",90),g(2,Yn,1,1,"app-kpi-block",90),g(3,Kn,1,1,"app-chart-block",90),g(4,Zn,1,1,"app-alert-block",90),g(5,Jn,1,1,"app-table-block",90),g(6,Xn,1,1,"app-recommendation-block",90),g(7,eo,5,0,"div",91),r()),i&2){let e=t.$implicit,n=p(2);y("ngClass",n.getBlockClasses(e)),L("data-block-id",e.block_id)("data-block-type",e.block_type),s(),m(e.block_type==="summary"?1:-1),s(),m(e.block_type==="kpi"?2:-1),s(),m(e.block_type==="chart"?3:-1),s(),m(e.block_type==="alert"?4:-1),s(),m(e.block_type==="table"?5:-1),s(),m(e.block_type==="recommendation"?6:-1),s(),m(e.block_type==="map_markers"?7:-1)}}function no(i,t){if(i&1){let e=w();a(0,"div",89)(1,"div",92)(2,"div",93),c(3,"\u{1F4CA}"),r(),a(4,"h3"),c(5,"No Analytics Available"),r(),a(6,"p"),c(7,"No data blocks were generated for this analysis."),r(),a(8,"button",85),b("click",function(){_(e);let o=p(2);return C(o.onRecalculate())}),c(9," Generate New Report "),r()()()}}function oo(i,t){if(i&1&&(a(0,"div",5,0),A(2,to,8,10,"div",88,qe().trackByBlock,!0),g(4,no,10,0,"div",89),r()),i&2){let e=p();s(2),E(e.response==null||e.response.response==null?null:e.response.response.blocks),s(2),m((e.response==null||e.response.response==null||e.response.response.blocks==null?null:e.response.response.blocks.length)===0?4:-1)}}function io(i,t){if(i&1&&(a(0,"span",95)(1,"strong"),c(2),r(),c(3,"ms generation time "),r()),i&2){let e=p(2);s(2),v((e.response==null||e.response.response==null||e.response.response.metadata==null?null:e.response.response.metadata.generation_time)||"N/A")}}function ao(i,t){if(i&1&&(a(0,"span",95)(1,"strong"),c(2),r(),c(3," alerts "),r()),i&2){let e=p(2);s(2),v(e.getAlertCount())}}function ro(i,t){if(i&1&&(a(0,"div",6)(1,"div",94)(2,"span",95)(3,"strong"),c(4),r(),c(5," blocks "),r(),g(6,io,4,1,"span",95),g(7,ao,4,1,"span",95),r(),a(8,"div",96)(9,"small",97),c(10," Powered by CypherView AI Analytics "),r()()()),i&2){let e=p();s(4),v((e.response==null||e.response.response==null||e.response.response.blocks==null?null:e.response.response.blocks.length)||0),s(2),m(!(e.response==null||e.response.response==null)&&e.response.response.metadata?6:-1),s(),m(e.getAlertCount()>0?7:-1)}}var et=class i{layoutService=Q(Ge);response;isLoading=!1;error;loadingProgress=0;userQuery;dateRange;vehicleNames;clientTimeZone;clientLanguage;showAllVehicles=!1;recalculate=new ut;dashboardContainer;isRecalculating=!1;ngAfterViewInit(){this.response?.response?.layout&&this.dashboardContainer&&setTimeout(()=>this.applyLayout(),100)}ngOnDestroy(){this.layoutService.destroy()}trackByBlock(t,e){return e.block_id}applyLayout(){this.response?.response?.layout&&this.dashboardContainer&&this.layoutService.applyLayout(this.dashboardContainer,this.response.response.layout,this.response.response.blocks,{enableAnimations:!0,gapSizePx:16,minBlockHeight:200})}getBlockClasses(t){let e=[`block-${t.block_type}`,`priority-${t.priority}`];return t.visual?.theme&&e.push(`theme-${t.visual.theme}`),t.visual?.elevation!==void 0&&t.visual.elevation!==null&&e.push(`elevation-${t.visual.elevation}`),e}formatTimestamp(t){try{let e=this.clientLanguage!=null&&this.clientLanguage==="af"?"af-ZA":"en-ZA",n={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:this.clientTimeZone??"Africa/Johannesburg"};return new Date(t).toLocaleString(e,n)}catch{return t}}getAlertCount(){return this.response?.response?.blocks?.filter(t=>t.block_type==="alert").length??0}getVehicleDisplayText(){return!this.vehicleNames||this.vehicleNames.length===0?"No vehicles selected":this.vehicleNames.length<=2?this.vehicleNames.join(", "):`${this.vehicleNames.slice(0,2).join(", ")} +${this.vehicleNames.length-2} more`}onRecalculate(){this.isRecalculating=!0,this.recalculate.emit()}resetRecalculatingState(){this.isRecalculating=!1}onPrint(){window.print()}onRetry(){this.error=void 0}onDismissError(){this.error=void 0}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-analytics-dashboard"]],viewQuery:function(e,n){if(e&1&&Y(zn,5),e&2){let o;K(o=Z())&&(n.dashboardContainer=o.first)}},inputs:{response:"response",isLoading:"isLoading",error:"error",loadingProgress:"loadingProgress",userQuery:"userQuery",dateRange:"dateRange",vehicleNames:"vehicleNames",clientTimeZone:"clientTimeZone",clientLanguage:"clientLanguage"},outputs:{recalculate:"recalculate"},decls:6,vars:6,consts:[["dashboardContainer",""],[1,"analytics-dashboard"],[1,"dashboard-header"],[1,"loading-container"],[1,"error-container"],[1,"dashboard-content"],[1,"dashboard-footer"],[1,"header-top-bar"],[1,"header-branding"],[1,"brand-icon"],["width","32","height","32","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["x","3","y","3","width","7","height","7","rx","1","fill","currentColor","opacity","0.8"],["x","14","y","3","width","7","height","7","rx","1","fill","currentColor","opacity","0.6"],["x","3","y","14","width","7","height","7","rx","1","fill","currentColor","opacity","0.6"],["x","14","y","14","width","7","height","7","rx","1","fill","currentColor","opacity","0.4"],[1,"brand-text"],[1,"dashboard-title"],[1,"dashboard-subtitle"],[1,"header-actions"],[1,"action-btn","recalculate-btn",3,"click","disabled"],["width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2",1,"spinning"],[1,"action-btn","print-btn",3,"click"],["points","6,9 6,2 18,2 18,9"],["d","M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"],["x","6","y","14","width","12","height","8"],[1,"context-cards"],[1,"context-card","date-card"],[1,"card-icon"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["x","3","y","4","width","18","height","18","rx","2","ry","2"],["x1","16","y1","2","x2","16","y2","6"],["x1","8","y1","2","x2","8","y2","6"],["x1","3","y1","10","x2","21","y2","10"],[1,"card-content"],[1,"card-label"],[1,"card-value"],[1,"context-card","vehicles-card"],["d","M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9L18 10l-2-4H8L6 10l-2.5 1.1C2.7 11.3 2 12.1 2 13v3c0 .6.4 1 1 1h2"],["cx","7","cy","17","r","2"],["cx","17","cy","17","r","2"],[1,"card-header-row"],[1,"toggle-vehicles-btn"],[1,"vehicles-container"],[1,"vehicles-list-full"],[1,"context-card","query-card"],[1,"summary-section"],[1,"summary-header"],["width","18","height","18","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"],["points","14,2 14,8 20,8"],["x1","16","y1","13","x2","8","y2","13"],["x1","16","y1","17","x2","8","y2","17"],[1,"summary-text"],[1,"header-meta"],[1,"meta-item"],["width","14","height","14","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["cx","12","cy","12","r","10"],["points","12,6 12,12 16,14"],["d","M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"],["d","M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"],["d","M23 4v6h-6M1 20v-6h6"],["d","M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"],["cx","12","cy","12","r","10","stroke-dasharray","32","stroke-dashoffset","32"],[1,"toggle-vehicles-btn",3,"click"],["width","12","height","12","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["points","6,9 12,15 18,9"],[1,"vehicle-chip"],["cx","11","cy","11","r","8"],["d","m21 21-4.35-4.35"],[1,"card-value","query-text"],[1,"loading-content"],[1,"loading-spinner"],[1,"spinner-ring"],[1,"loading-title"],[1,"loading-description"],[1,"loading-progress"],[1,"progress-bar"],[1,"progress-fill"],[1,"progress-text"],[1,"error-content"],[1,"error-icon"],[1,"error-title"],[1,"error-message"],[1,"error-actions"],[1,"btn","btn-primary",3,"click"],[1,"retry-icon"],[1,"btn","btn-secondary",3,"click"],[1,"dashboard-block",3,"ngClass"],[1,"empty-dashboard"],[3,"block"],[1,"placeholder-block"],[1,"empty-content"],[1,"empty-icon"],[1,"footer-stats"],[1,"stat-item"],[1,"footer-actions"],[1,"powered-by"]],template:function(e,n){e&1&&(a(0,"div",1),g(1,Un,76,15,"div",2),g(2,jn,11,1,"div",3),g(3,Gn,15,1,"div",4),g(4,oo,5,1,"div",5),g(5,ro,11,3,"div",6),r()),e&2&&(L("data-layout-type",n.response==null||n.response.response==null||n.response.response.layout==null?null:n.response.response.layout.type),s(),m(!(n.response==null||n.response.response==null)&&n.response.response.summary?1:-1),s(),m(n.isLoading?2:-1),s(),m(n.error?3:-1),s(),m(n.response!=null&&n.response.response&&!n.isLoading&&!n.error?4:-1),s(),m(n.response!=null&&n.response.response&&!n.isLoading&&!n.error?5:-1))},dependencies:[R,J,We,Ye,Ke,Ze,Je,Xe],styles:[".analytics-dashboard[_ngcontent-%COMP%]{min-height:100vh;background:#f3f4f6;transition:all .3s ease}.analytics-dashboard[data-layout-type=dashboard][_ngcontent-%COMP%]{display:flex;flex-direction:column}.dashboard-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fff,#f8fafc);border-bottom:1px solid #e2e8f0;padding:0;box-shadow:0 4px 20px #00000014}.header-top-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px 32px;border-bottom:1px solid #e2e8f0;background:#fff}.header-branding[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.brand-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:48px;height:48px;background:linear-gradient(135deg,var(--primary-500) 0%,var(--primary-600) 100%);border-radius:12px;color:#fff;box-shadow:0 4px 12px #3b82f64d}.brand-text[_ngcontent-%COMP%]{display:flex;flex-direction:column}.dashboard-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--text-color);margin:0;letter-spacing:-.025em}.dashboard-subtitle[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-color-secondary);font-weight:500}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}.action-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 18px;background:var(--surface-0);border:1px solid var(--surface-200);border-radius:8px;color:var(--text-color-secondary);font-size:.875rem;font-weight:600;cursor:pointer;transition:all .2s ease}.action-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex-shrink:0}.action-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--primary-50);border-color:var(--primary-300);color:var(--primary-600);transform:translateY(-1px);box-shadow:0 4px 12px #3b82f626}.action-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.action-btn.recalculate-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,var(--primary-500),var(--primary-600));border-color:var(--primary-500);color:#fff}.action-btn[_ngcontent-%COMP%]   .spinning[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}.context-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;padding:24px 32px;background:#f8fafc}.context-card[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:14px;padding:16px 20px;background:#fff;border-radius:12px;border:1px solid #e2e8f0;transition:all .2s ease}.context-card[_ngcontent-%COMP%]:hover{border-color:var(--primary-200);box-shadow:0 4px 12px #0000000f}.card-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:10px;flex-shrink:0}.card-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:.9}.date-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dbeafe,#bfdbfe);color:#2563eb}.vehicles-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dcfce7,#bbf7d0);color:#16a34a}.query-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fef3c7,#fde68a);color:#d97706}.card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;min-width:0;flex:1}.card-header-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:8px}.card-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;color:var(--text-color-secondary)}.toggle-vehicles-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;padding:4px 8px;background:transparent;border:1px solid var(--surface-200);border-radius:4px;font-size:.6875rem;font-weight:500;color:var(--primary-600);cursor:pointer;transition:all .2s ease}.toggle-vehicles-btn[_ngcontent-%COMP%]:hover{background:var(--primary-50);border-color:var(--primary-200)}.toggle-vehicles-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transition:transform .2s ease}.toggle-vehicles-btn[_ngcontent-%COMP%]   svg.rotated[_ngcontent-%COMP%]{transform:rotate(180deg)}.card-value[_ngcontent-%COMP%]{font-size:.9375rem;font-weight:500;color:var(--text-color);line-height:1.4}.card-value.query-text[_ngcontent-%COMP%]{font-style:italic;color:var(--text-color-secondary)}.vehicles-container[_ngcontent-%COMP%]{margin-top:2px}.vehicles-list-full[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}.vehicle-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:4px 10px;background:linear-gradient(135deg,#dcfce7,#bbf7d0);border:1px solid #86efac;border-radius:16px;font-size:.8125rem;font-weight:500;color:#166534;white-space:nowrap}.vehicles-card.expanded[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{gap:8px}.summary-section[_ngcontent-%COMP%]{padding:24px 32px;background:#fff;border-top:1px solid #e2e8f0}.summary-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:12px;color:var(--primary-600);font-weight:600;font-size:.9375rem}.summary-header[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:.8}.summary-text[_ngcontent-%COMP%]{font-size:1rem;line-height:1.7;color:var(--text-color);margin:0;max-width:none}.header-meta[_ngcontent-%COMP%]{display:flex;gap:24px;padding:14px 32px;background:#f1f5f9;border-top:1px solid #e2e8f0}.meta-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:.8125rem;color:var(--text-color-secondary)}.meta-item[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:.6}.loading-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:400px;padding:40px 20px}.loading-content[_ngcontent-%COMP%]{text-align:center;max-width:400px}.loading-spinner[_ngcontent-%COMP%]{position:relative;width:80px;height:80px;margin:0 auto 24px}.spinner-ring[_ngcontent-%COMP%]{position:absolute;border:3px solid transparent;border-top:3px solid var(--primary-500);border-radius:50%;animation:_ngcontent-%COMP%_spin 1.5s linear infinite}.spinner-ring[_ngcontent-%COMP%]:nth-child(1){width:60px;height:60px;top:10px;left:10px}.spinner-ring[_ngcontent-%COMP%]:nth-child(2){width:45px;height:45px;top:17.5px;left:17.5px;animation-delay:-.2s;border-top-color:var(--primary-400)}.spinner-ring[_ngcontent-%COMP%]:nth-child(3){width:30px;height:30px;top:25px;left:25px;animation-delay:-.4s;border-top-color:var(--primary-300)}.loading-title[_ngcontent-%COMP%]{color:var(--text-color);font-size:1.5rem;font-weight:600;margin:0 0 8px}.loading-description[_ngcontent-%COMP%]{color:var(--text-color-secondary);line-height:1.5;margin:0 0 20px}.loading-progress[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.loading-progress[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{flex:1;height:8px;background:var(--surface-200);border-radius:4px;overflow:hidden}.loading-progress[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]   .progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,var(--primary-500),var(--primary-400));transition:width .3s ease;border-radius:4px}.loading-progress[_ngcontent-%COMP%]   .progress-text[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:var(--text-color-secondary);min-width:40px}.error-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:400px;padding:40px 20px}.error-content[_ngcontent-%COMP%]{text-align:center;max-width:400px;padding:32px;background:var(--surface-0);border-radius:12px;border:1px solid var(--surface-200)}.error-icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:16px}.error-title[_ngcontent-%COMP%]{color:var(--text-color);font-size:1.25rem;font-weight:600;margin:0 0 8px}.error-message[_ngcontent-%COMP%]{color:var(--text-color-secondary);line-height:1.5;margin:0 0 24px}.error-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:center}.dashboard-content[_ngcontent-%COMP%]{flex:1;max-width:1400px;margin:0 auto;width:100%;padding:24px;min-height:400px;display:grid;grid-template-columns:repeat(12,1fr);gap:20px;align-content:start}.dashboard-block[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1);grid-column:span 12;min-height:0}.dashboard-block.block-summary[_ngcontent-%COMP%], .dashboard-block.block-kpi[_ngcontent-%COMP%], .dashboard-block.block-table[_ngcontent-%COMP%], .dashboard-block.block-recommendation[_ngcontent-%COMP%], .dashboard-block.block-chart[_ngcontent-%COMP%]{grid-column:span 12}.dashboard-block.block-alert[_ngcontent-%COMP%]{grid-column:span 6}.dashboard-block.priority-1[_ngcontent-%COMP%]{z-index:10}.dashboard-block.priority-2[_ngcontent-%COMP%]{z-index:8}.dashboard-block.priority-3[_ngcontent-%COMP%]{z-index:6}.dashboard-block.theme-primary[_ngcontent-%COMP%]{--block-accent: var(--primary-500)}.dashboard-block.theme-success[_ngcontent-%COMP%]{--block-accent: #22c55e}.dashboard-block.theme-warning[_ngcontent-%COMP%]{--block-accent: #f59e0b}.dashboard-block.theme-danger[_ngcontent-%COMP%]{--block-accent: #ef4444}.dashboard-block.theme-info[_ngcontent-%COMP%]{--block-accent: #06b6d4}.dashboard-block.elevation-1[_ngcontent-%COMP%]{box-shadow:0 2px 4px #0000001a}.dashboard-block.elevation-2[_ngcontent-%COMP%]{box-shadow:0 4px 8px #00000026}.dashboard-block.elevation-3[_ngcontent-%COMP%]{box-shadow:0 8px 16px #0003}.placeholder-block[_ngcontent-%COMP%]{background:var(--surface-0);border:2px dashed var(--surface-300);border-radius:8px;padding:40px 20px;text-align:center;color:var(--text-color-secondary)}.placeholder-block[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 8px;font-weight:600}.placeholder-block[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.875rem}.empty-dashboard[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:300px;padding:40px 20px}.empty-content[_ngcontent-%COMP%]{text-align:center;max-width:300px}.empty-content[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:64px;opacity:.3;margin-bottom:16px;display:block}.empty-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--text-color);margin:0 0 8px}.empty-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-color-secondary);margin:0 0 20px}.dashboard-footer[_ngcontent-%COMP%]{background:var(--surface-0);border-top:1px solid var(--surface-200);padding:16px 24px;display:flex;justify-content:space-between;align-items:center}.footer-stats[_ngcontent-%COMP%]{display:flex;gap:16px;font-size:.875rem}.footer-stats[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]{color:var(--text-color-secondary)}.footer-stats[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text-color);font-weight:600}.powered-by[_ngcontent-%COMP%]{color:var(--text-color-secondary);font-size:.75rem}.btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;border:none;font-weight:600;font-size:.875rem;cursor:pointer;transition:all .2s ease;display:inline-flex;align-items:center;gap:6px}.btn.btn-primary[_ngcontent-%COMP%]{background:var(--primary-500);color:#fff}.btn.btn-primary[_ngcontent-%COMP%]:hover{background:var(--primary-600);transform:translateY(-1px);box-shadow:0 4px 12px #3b82f64d}.btn.btn-secondary[_ngcontent-%COMP%]{background:var(--surface-200);color:var(--text-color-secondary)}.btn.btn-secondary[_ngcontent-%COMP%]:hover{background:var(--surface-300);color:var(--text-color)}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.dark[_nghost-%COMP%]   .dashboard-header[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .dashboard-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--surface-900),var(--surface-800));border-bottom-color:var(--surface-700)}.dark[_nghost-%COMP%]   .header-top-bar[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .header-top-bar[_ngcontent-%COMP%]{background:var(--surface-900);border-bottom-color:var(--surface-700)}.dark[_nghost-%COMP%]   .context-cards[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .context-cards[_ngcontent-%COMP%]{background:var(--surface-800)}.dark[_nghost-%COMP%]   .context-card[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .context-card[_ngcontent-%COMP%]{background:var(--surface-900);border-color:var(--surface-700)}.dark[_nghost-%COMP%]   .context-card[_ngcontent-%COMP%]:hover, .dark   [_nghost-%COMP%]   .context-card[_ngcontent-%COMP%]:hover{border-color:var(--primary-700)}.dark[_nghost-%COMP%]   .date-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .date-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2563eb33,#2563eb4d);color:#60a5fa}.dark[_nghost-%COMP%]   .vehicles-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .vehicles-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#16a34a33,#16a34a4d);color:#4ade80}.dark[_nghost-%COMP%]   .toggle-vehicles-btn[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .toggle-vehicles-btn[_ngcontent-%COMP%]{border-color:var(--surface-600);color:var(--primary-400)}.dark[_nghost-%COMP%]   .toggle-vehicles-btn[_ngcontent-%COMP%]:hover, .dark   [_nghost-%COMP%]   .toggle-vehicles-btn[_ngcontent-%COMP%]:hover{background:var(--surface-700);border-color:var(--surface-500)}.dark[_nghost-%COMP%]   .vehicle-chip[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .vehicle-chip[_ngcontent-%COMP%]{background:linear-gradient(135deg,#16a34a33,#16a34a4d);border-color:#4ade804d;color:#4ade80}.dark[_nghost-%COMP%]   .query-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .query-card[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#d9770633,#d977064d);color:#fbbf24}.dark[_nghost-%COMP%]   .summary-section[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .summary-section[_ngcontent-%COMP%]{background:var(--surface-900);border-top-color:var(--surface-700)}.dark[_nghost-%COMP%]   .header-meta[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .header-meta[_ngcontent-%COMP%]{background:var(--surface-800);border-top-color:var(--surface-700)}.dark[_nghost-%COMP%]   .action-btn[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .action-btn[_ngcontent-%COMP%]{background:var(--surface-800);border-color:var(--surface-700)}.dark[_nghost-%COMP%]   .action-btn[_ngcontent-%COMP%]:hover:not(:disabled), .dark   [_nghost-%COMP%]   .action-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--surface-700);border-color:var(--surface-600)}.dark[_nghost-%COMP%]   .action-btn.recalculate-btn[_ngcontent-%COMP%]:hover:not(:disabled), .dark   [_nghost-%COMP%]   .action-btn.recalculate-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,var(--primary-600),var(--primary-700));border-color:var(--primary-600)}.dark[_nghost-%COMP%]   .error-content[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .error-content[_ngcontent-%COMP%]{background:var(--surface-800);border-color:var(--surface-600)}.dark[_nghost-%COMP%]   .dashboard-footer[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .dashboard-footer[_ngcontent-%COMP%]{background:var(--surface-800);border-top-color:var(--surface-600)}@media(max-width:1200px){.dashboard-content[_ngcontent-%COMP%]{gap:16px;padding:20px}.dashboard-block.block-alert[_ngcontent-%COMP%]{grid-column:span 6}}@media(max-width:992px){.dashboard-content[_ngcontent-%COMP%]{gap:16px}.dashboard-block.block-alert[_ngcontent-%COMP%]{grid-column:span 12}}@media(max-width:768px){.header-top-bar[_ngcontent-%COMP%]{flex-direction:column;gap:16px;padding:16px 20px;align-items:stretch}.header-branding[_ngcontent-%COMP%]{justify-content:center}.brand-icon[_ngcontent-%COMP%]{width:40px;height:40px}.dashboard-title[_ngcontent-%COMP%]{font-size:1.25rem}.dashboard-subtitle[_ngcontent-%COMP%]{font-size:.8125rem}.header-actions[_ngcontent-%COMP%]{justify-content:center}.context-cards[_ngcontent-%COMP%]{grid-template-columns:1fr;padding:16px 20px;gap:12px}.context-card[_ngcontent-%COMP%]{padding:14px 16px}.summary-section[_ngcontent-%COMP%]{padding:20px}.summary-text[_ngcontent-%COMP%]{font-size:.9375rem}.header-meta[_ngcontent-%COMP%]{flex-direction:column;gap:8px;padding:12px 20px;align-items:flex-start}.dashboard-content[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:16px;padding:16px}.dashboard-block[_ngcontent-%COMP%], .dashboard-block.block-summary[_ngcontent-%COMP%], .dashboard-block.block-kpi[_ngcontent-%COMP%], .dashboard-block.block-chart[_ngcontent-%COMP%], .dashboard-block.block-alert[_ngcontent-%COMP%], .dashboard-block.block-table[_ngcontent-%COMP%]{grid-column:span 1}.dashboard-footer[_ngcontent-%COMP%]{padding:12px 16px;flex-direction:column;gap:8px}.footer-stats[_ngcontent-%COMP%]{justify-content:center;flex-wrap:wrap}}@media print{.header-actions[_ngcontent-%COMP%], .action-btn[_ngcontent-%COMP%], .toggle-vehicles-btn[_ngcontent-%COMP%]{display:none!important}.analytics-dashboard[_ngcontent-%COMP%]{background:#fff!important;min-height:auto!important}.dashboard-header[_ngcontent-%COMP%]{box-shadow:none!important;background:#fff!important;border-bottom:2px solid #333!important}.header-top-bar[_ngcontent-%COMP%]{background:#fff!important;border-bottom:1px solid #ccc!important}.brand-icon[_ngcontent-%COMP%]{background:#333!important;box-shadow:none!important}.context-cards[_ngcontent-%COMP%]{background:#fff!important}.context-card[_ngcontent-%COMP%]{background:#f5f5f5!important;box-shadow:none!important;border:1px solid #ccc!important}.summary-section[_ngcontent-%COMP%]{background:#fff!important;border:1px solid #ccc!important}.dashboard-block[_ngcontent-%COMP%], .block-container[_ngcontent-%COMP%]{break-inside:avoid;page-break-inside:avoid;margin-bottom:16px}.dashboard-grid[_ngcontent-%COMP%]{display:block!important}.dashboard-section[_ngcontent-%COMP%]{display:block!important;break-inside:avoid;page-break-inside:avoid}table[_ngcontent-%COMP%]{break-inside:auto}tr[_ngcontent-%COMP%], .chart-container[_ngcontent-%COMP%]{break-inside:avoid;page-break-inside:avoid}.header-meta[_ngcontent-%COMP%]{background:#f5f5f5!important;border-top:1px solid #ccc!important}}"],data:{animation:[]}})};var tt=class i{sanitizer=Q(kt);transform(t){if(!t)return"";let e=this.escapeHtml(t);return e=e.replaceAll(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replaceAll(/__(.*?)__/g,"<strong>$1</strong>"),e=e.replaceAll(/\*([^*]+)\*/g,"<em>$1</em>"),e=e.replaceAll(/_([^_]+)_/g,"<em>$1</em>"),e=e.replaceAll(/`([^`]+)`/g,"<code>$1</code>"),e=e.replaceAll(/^&gt;\s*(.*)$/gm,"<blockquote>$1</blockquote>"),e=e.replaceAll(/^[*-]\s+(.*)$/gm,"<li>$1</li>"),e=e.replaceAll(/(<li>.*<\/li>\n?)+/g,"<ul>$&</ul>"),e=e.replaceAll(/^\d+[.)]\s+(.*)$/gm,"<li>$1</li>"),e=e.replaceAll(`
`,"<br>"),e=e.replaceAll(/<br><(ul|ol|blockquote)/g,"<$1"),e=e.replaceAll(/<\/(ul|ol|blockquote)><br>/g,"</$1>"),e=e.replaceAll("</li><br>","</li>"),this.sanitizer.bypassSecurityTrustHtml(e)}escapeHtml(t){let e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replaceAll(/[&<>"']/g,n=>e[n])}static \u0275fac=function(e){return new(e||i)};static \u0275pipe=ft({name:"formatMarkdown",type:i,pure:!0})};var lo=(i,t)=>t.label;function co(i,t){if(i&1){let e=w();a(0,"button",12),b("click",function(){let o=_(e).$implicit,l=p();return C(l.selectPreset(o.days))}),c(1),r()}if(i&2){let e=t.$implicit;s(),D(" ",e.label," ")}}function po(i,t){if(i&1){let e=w();a(0,"div",11)(1,"div",13),u(2,"i",14),a(3,"span"),c(4),r()(),a(5,"p-button",15),b("onClick",function(){_(e);let o=p();return C(o.onConfirm())}),r()()}if(i&2){let e=p();s(4),v(e.formattedRange())}}var nt=class i{initialStart=S(null);initialEnd=S(null);minDate=S(new Date(new Date().setFullYear(new Date().getFullYear()-1)));maxDate=S(new Date);dateRangeSelected=q();startDate=P(null);endDate=P(null);datePresets=[{label:"Today",days:0},{label:"Yesterday",days:1},{label:"Last 7 days",days:7},{label:"Last 30 days",days:30},{label:"Last 90 days",days:90}];canConfirm=f(()=>{let t=this.startDate(),e=this.endDate();return t!==null&&e!==null&&t<=e});formattedRange=f(()=>{let t=this.startDate(),e=this.endDate();if(!t||!e)return"";let n=o=>o.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return t.toDateString()===e.toDateString()?n(t):`${n(t)} - ${n(e)}`});selectPreset(t){let e=new Date,n=new Date;t===0?(this.startDate.set(n),this.endDate.set(e)):t===1?(n.setDate(n.getDate()-1),e.setDate(e.getDate()-1),this.startDate.set(n),this.endDate.set(e)):(n.setDate(n.getDate()-t),this.startDate.set(n),this.endDate.set(e))}onConfirm(){let t=this.startDate(),e=this.endDate();t&&e&&this.dateRangeSelected.emit({start:t,end:e})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-inline-date-picker"]],inputs:{initialStart:[1,"initialStart"],initialEnd:[1,"initialEnd"],minDate:[1,"minDate"],maxDate:[1,"maxDate"]},outputs:{dateRangeSelected:"dateRangeSelected"},decls:16,vars:11,consts:[[1,"inline-date-picker"],[1,"date-presets"],["type","button",1,"preset-btn"],[1,"date-selectors"],[1,"date-field"],["id","start-date-label",1,"date-label"],["dateFormat","M dd, yy","placeholder","Select start date","appendTo","body","styleClass","compact-calendar","aria-labelledby","start-date-label",3,"ngModelChange","ngModel","minDate","maxDate","showIcon","showButtonBar"],[1,"date-separator"],["aria-hidden","true",1,"pi","pi-arrow-right"],["id","end-date-label",1,"date-label"],["dateFormat","M dd, yy","placeholder","Select end date","appendTo","body","styleClass","compact-calendar","aria-labelledby","end-date-label",3,"ngModelChange","ngModel","minDate","maxDate","showIcon","showButtonBar"],[1,"selection-summary"],["type","button",1,"preset-btn",3,"click"],[1,"summary-text"],[1,"pi","pi-calendar-plus"],["label","Confirm","icon","pi pi-check","size","small","styleClass","confirm-btn",3,"onClick"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1),A(2,co,2,1,"button",2,lo),r(),a(4,"div",3)(5,"div",4)(6,"span",5),c(7,"Start Date"),r(),a(8,"p-datepicker",6),ye("ngModelChange",function(l){return Ce(n.startDate,l)||(n.startDate=l),l}),r()(),a(9,"div",7),u(10,"i",8),r(),a(11,"div",4)(12,"span",9),c(13,"End Date"),r(),a(14,"p-datepicker",10),ye("ngModelChange",function(l){return Ce(n.endDate,l)||(n.endDate=l),l}),r()()(),g(15,po,6,1,"div",11),r()),e&2&&(s(2),E(n.datePresets),s(6),_e("ngModel",n.startDate),y("minDate",n.minDate())("maxDate",n.endDate()||n.maxDate())("showIcon",!0)("showButtonBar",!0),s(6),_e("ngModel",n.endDate),y("minDate",n.startDate()||n.minDate())("maxDate",n.maxDate())("showIcon",!0)("showButtonBar",!0),s(),m(n.canConfirm()?15:-1))},dependencies:[R,ee,ge,me,Se,je,W,ie],styles:["[_nghost-%COMP%]{display:block}.inline-date-picker[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;padding:.5rem;background-color:var(--card-background-color, #f8fafc);border-radius:.5rem;border:1px solid var(--input-border-color, #e2e8f0)}.date-presets[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.375rem}.preset-btn[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:.75rem;font-weight:500;background-color:var(--input-background-color, #ffffff);border:1px solid var(--input-border-color, #d1d5db);border-radius:1rem;color:var(--text-color, #4b5563);cursor:pointer;transition:all .15s ease}.preset-btn[_ngcontent-%COMP%]:hover{background-color:rgba(var(--color-primary-rgb, 59, 130, 246),.1);border-color:var(--color-primary-color, #3b82f6);color:var(--color-primary-color, #3b82f6)}.date-selectors[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:.5rem;flex-wrap:wrap}.date-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem;flex:1;min-width:140px}.date-label[_ngcontent-%COMP%]{font-size:.6875rem;font-weight:600;color:var(--text-color-secondary, #64748b);text-transform:uppercase;letter-spacing:.025em}.date-separator[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding-bottom:.5rem;color:var(--text-color-secondary, #94a3b8)}.date-separator[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem}  .compact-calendar .p-datepicker{font-size:.875rem}  .compact-calendar .p-inputtext{font-size:.8125rem;padding:.5rem .75rem}  .compact-calendar .p-datepicker-trigger{width:2rem}.selection-summary[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.75rem;padding:.5rem .75rem;background-color:rgba(var(--color-primary-rgb, 59, 130, 246),.1);border-radius:.375rem;border:1px solid var(--color-primary-color, #3b82f6)}.summary-text[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.8125rem;font-weight:500;color:var(--color-primary-color, #3b82f6)}.summary-text[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}  .confirm-btn{background:var(--color-primary-color, #3b82f6);border:none;font-weight:600}  .confirm-btn:hover{filter:brightness(.9)}@media(max-width:480px){.date-selectors[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.date-separator[_ngcontent-%COMP%]{transform:rotate(90deg);padding:.25rem 0}.date-field[_ngcontent-%COMP%]{min-width:100%}}"]})};var go=(i,t)=>t.id;function mo(i,t){if(i&1){let e=w();a(0,"button",10),b("click",function(){_(e);let o=p();return C(o.selectAll())}),c(1," Select All "),r()}}function uo(i,t){if(i&1){let e=w();a(0,"button",10),b("click",function(){_(e);let o=p();return C(o.clearAll())}),c(1," Clear All "),r()}}function ho(i,t){i&1&&(a(0,"div",8),u(1,"i",11),a(2,"p"),c(3,"No vehicles found"),r()())}function fo(i,t){if(i&1&&(a(0,"span",17),c(1),r()),i&2){let e=p().$implicit;s(),v(e.registration)}}function _o(i,t){i&1&&u(0,"i",18)}function Co(i,t){if(i&1){let e=w();a(0,"label",13)(1,"input",14),b("change",function(){let o=_(e).$implicit,l=p(2);return C(l.toggleVehicle(o))}),r(),a(2,"div",15)(3,"span",16),c(4),r(),g(5,fo,2,1,"span",17),r(),g(6,_o,1,0,"i",18),r()}if(i&2){let e=t.$implicit,n=p(2);U("selected",n.isSelected(e.id)),s(),y("checked",n.isSelected(e.id)),s(3),v(e.name),s(),m(e.registration?5:-1),s(),m(n.isSelected(e.id)?6:-1)}}function yo(i,t){if(i&1&&A(0,Co,7,6,"label",12,go),i&2){let e=p();E(e.filteredVehicles())}}function bo(i,t){if(i&1){let e=w();a(0,"div",9)(1,"div",19),u(2,"i",11),a(3,"span"),c(4),r()(),a(5,"p-button",20),b("onClick",function(){_(e);let o=p();return C(o.onConfirm())}),r()()}if(i&2){let e=p();s(4),G("",e.selectedCount()," vehicle",e.selectedCount()===1?"":"s"," selected")}}var ot=class i{vehicles=S([]);initialSelection=S([]);maxSelection=S(null);vehiclesSelected=q();searchTerm=P("");selectedIds=P(new Set);filteredVehicles=f(()=>{let t=this.searchTerm().toLowerCase(),e=this.vehicles();return t.length===0?e:e.filter(n=>n.name.toLowerCase().includes(t)||(n.registration?.toLowerCase()?.includes(t)??!1))});selectedCount=f(()=>this.selectedIds().size);canConfirm=f(()=>this.selectedIds().size>0);allSelected=f(()=>{let t=this.vehicles(),e=this.selectedIds();return t.length>0&&t.every(n=>e.has(n.id))});selectedVehicles=f(()=>{let t=this.selectedIds();return this.vehicles().filter(e=>t.has(e.id))});isSelected(t){return this.selectedIds().has(t)}toggleVehicle(t){let e=new Set(this.selectedIds());if(e.has(t.id))e.delete(t.id);else{let n=this.maxSelection();if(n!==null&&e.size>=n)return;e.add(t.id)}this.selectedIds.set(e)}selectAll(){let t=this.maxSelection(),e=this.vehicles();if(t!==null&&e.length>t){let n=e.slice(0,t).map(o=>o.id);this.selectedIds.set(new Set(n))}else this.selectedIds.set(new Set(e.map(n=>n.id)))}clearAll(){this.selectedIds.set(new Set)}onConfirm(){let t=this.selectedVehicles();t.length>0&&this.vehiclesSelected.emit(t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-inline-vehicle-selector"]],inputs:{vehicles:[1,"vehicles"],initialSelection:[1,"initialSelection"],maxSelection:[1,"maxSelection"]},outputs:{vehiclesSelected:"vehiclesSelected"},decls:12,vars:4,consts:[[1,"inline-vehicle-selector"],[1,"selector-header"],[1,"search-box"],[1,"pi","pi-search"],["type","text","pInputText","","placeholder","Search vehicles...",1,"search-input",3,"ngModelChange","ngModel"],[1,"header-actions"],["type","button",1,"action-btn"],[1,"vehicle-list"],[1,"empty-state"],[1,"selection-summary"],["type","button",1,"action-btn",3,"click"],[1,"pi","pi-car"],[1,"vehicle-item",3,"selected"],[1,"vehicle-item"],["type","checkbox",3,"change","checked"],[1,"vehicle-info"],[1,"vehicle-name"],[1,"vehicle-reg"],[1,"pi","pi-check","selected-icon"],[1,"summary-text"],["label","Confirm","icon","pi pi-check","size","small","styleClass","confirm-btn",3,"onClick"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),u(3,"i",3),a(4,"input",4),b("ngModelChange",function(l){return n.searchTerm.set(l)}),r()(),a(5,"div",5),g(6,mo,2,0,"button",6)(7,uo,2,0,"button",6),r()(),a(8,"div",7),g(9,ho,4,0,"div",8)(10,yo,2,0),r(),g(11,bo,6,2,"div",9),r()),e&2&&(s(4),y("ngModel",n.searchTerm()),s(2),m(n.allSelected()?7:6),s(3),m(n.filteredVehicles().length===0?9:10),s(2),m(n.canConfirm()?11:-1))},dependencies:[R,ee,Le,ge,me,W,ie,Ue,At],styles:["[_nghost-%COMP%]{display:block}.inline-vehicle-selector[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;padding:.5rem;background-color:var(--card-background-color, #f8fafc);border-radius:.5rem;border:1px solid var(--input-border-color, #e2e8f0)}.selector-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}.search-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;flex:1;min-width:150px;padding:.375rem .625rem;background-color:var(--input-background-color, #ffffff);border:1px solid var(--input-border-color, #d1d5db);border-radius:.375rem}.search-box[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--text-color-secondary, #9ca3af);font-size:.875rem}.search-input[_ngcontent-%COMP%]{flex:1;border:none;outline:none;font-size:.8125rem;background:transparent;color:var(--text-color, #374151)}.search-input[_ngcontent-%COMP%]::placeholder{color:var(--text-color-secondary, #9ca3af)}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.375rem}.action-btn[_ngcontent-%COMP%]{padding:.375rem .625rem;font-size:.75rem;font-weight:500;background:transparent;border:1px solid var(--input-border-color, #d1d5db);border-radius:.375rem;color:var(--text-color, #4b5563);cursor:pointer;transition:all .15s ease}.action-btn[_ngcontent-%COMP%]:hover{background-color:var(--surface-hover, #f3f4f6);border-color:var(--text-color-secondary, #9ca3af)}.vehicle-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.375rem;max-height:200px;overflow-y:auto;padding:.25rem}.vehicle-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem .625rem;background-color:var(--input-background-color, #ffffff);border:1.5px solid transparent;border-radius:.5rem;cursor:pointer;transition:all .15s ease}.vehicle-item[_ngcontent-%COMP%]:hover{background-color:var(--surface-hover, #f0f2f5)}.vehicle-item.selected[_ngcontent-%COMP%]{background-color:rgba(var(--color-primary-rgb, 59, 130, 246),.1);border-color:var(--color-primary-color, #3b82f6)}.vehicle-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:1rem;height:1rem;accent-color:var(--color-primary-color, #3b82f6);cursor:pointer;flex-shrink:0}.vehicle-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:0}.vehicle-name[_ngcontent-%COMP%]{font-size:.8125rem;font-weight:500;color:var(--text-color, #1e293b);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vehicle-reg[_ngcontent-%COMP%]{font-size:.6875rem;color:var(--text-color-secondary, #64748b)}.selected-icon[_ngcontent-%COMP%]{color:var(--color-primary-color, #3b82f6);font-size:.875rem;flex-shrink:0}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1.5rem;color:var(--text-color-secondary, #9ca3af)}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:.5rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.8125rem}.selection-summary[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.75rem;padding:.5rem .75rem;background-color:rgba(var(--color-primary-rgb, 59, 130, 246),.1);border-radius:.375rem;border:1px solid var(--color-primary-color, #3b82f6)}.summary-text[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.8125rem;font-weight:500;color:var(--color-primary-color, #3b82f6)}.summary-text[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}  .confirm-btn{background:var(--color-primary-color, #3b82f6);border:none;font-weight:600}  .confirm-btn:hover{filter:brightness(.9)}"]})};var vo=(i,t)=>t.id;function Mo(i,t){if(i&1){let e=w();a(0,"button",9),b("click",function(){_(e);let o=p();return C(o.selectAll())}),c(1," Select All "),r()}}function xo(i,t){if(i&1){let e=w();a(0,"button",9),b("click",function(){_(e);let o=p();return C(o.clearAll())}),c(1," Clear All "),r()}}function Po(i,t){i&1&&u(0,"i",12)}function Oo(i,t){if(i&1){let e=w();a(0,"input",16),b("click",function(o){return _(e),C(o.stopPropagation())})("change",function(){_(e);let o=p().$implicit,l=p();return C(l.toggleDataType(o))}),r()}if(i&2){let e=p().$implicit,n=p();y("checked",n.isSelected(e.id))}}function ko(i,t){i&1&&c(0," Collecting... ")}function wo(i,t){if(i&1&&c(0),i&2){let e=p().$implicit;D(" ",e.description," ")}}function So(i,t){if(i&1){let e=w();a(0,"button",10),b("click",function(){let o=_(e).$implicit,l=p();return C(l.toggleDataType(o))}),a(1,"div",11),g(2,Po,1,0,"i",12)(3,Oo,1,1,"input",13),r(),u(4,"i"),a(5,"span",14),c(6),r(),a(7,"span",15),g(8,ko,1,0)(9,wo,1,1),r()()}if(i&2){let e=t.$implicit,n=p();U("selected",n.isSelected(e.id))("collecting",n.isCollecting(e.id)),y("disabled",n.isCollecting(e.id)),s(2),m(n.isCollecting(e.id)?2:3),s(2),Oe(ke("pi ",e.icon," card-icon")),s(2),v(e.label),s(2),m(n.isCollecting(e.id)?8:9)}}function Do(i,t){if(i&1&&(a(0,"div",7),u(1,"i",17),a(2,"span"),c(3),r()()),i&2){let e=p();s(3),G("",e.collectingCount()," data type",e.collectingCount()===1?"":"s"," currently collecting")}}function To(i,t){if(i&1){let e=w();a(0,"div",8)(1,"div",18),u(2,"i",19),a(3,"span"),c(4),r()(),a(5,"p-button",20),b("onClick",function(){_(e);let o=p();return C(o.onConfirm())}),r()()}if(i&2){let e=p();s(4),G("",e.newSelectionCount()," new data type",e.newSelectionCount()===1?"":"s"," to collect")}}function Ao(i,t){i&1&&(a(0,"div",8)(1,"div",18),u(2,"i",19),a(3,"span"),c(4,"Select data types to collect"),r()(),u(5,"p-button",21),r()),i&2&&(s(5),y("disabled",!0))}var Eo=[{id:"trips",label:"Trips",description:"Journey data with start/end locations and times",icon:"pi-map-marker"},{id:"events",label:"Events",description:"Driver behavior events like harsh braking, speeding",icon:"pi-exclamation-triangle"},{id:"telemetry",label:"Telemetry",description:"Real-time sensor data: speed, fuel, engine status",icon:"pi-chart-line"},{id:"alerts",label:"Alerts",description:"System alerts and notifications",icon:"pi-bell"}],it=class i{dataTypes=S(Eo);initialSelection=S([]);collectingTypes=S([]);dataTypesSelected=q();selectedIds=P(new Set);selectedCount=f(()=>this.selectedIds().size);collectingCount=f(()=>this.collectingTypes().length);newSelectionCount=f(()=>{let t=this.selectedIds(),e=new Set(this.collectingTypes());return Array.from(t).filter(n=>!e.has(n)).length});canConfirm=f(()=>this.newSelectionCount()>0);allSelected=f(()=>{let t=this.dataTypes(),e=this.selectedIds();return t.length>0&&t.every(n=>e.has(n.id))});hasCollectingTypes=f(()=>this.collectingTypes().length>0);isSelected(t){return this.selectedIds().has(t)}isCollecting(t){return this.collectingTypes().includes(t)}toggleDataType(t){if(this.isCollecting(t.id))return;let e=new Set(this.selectedIds());e.has(t.id)?e.delete(t.id):e.add(t.id),this.selectedIds.set(e)}selectAll(){this.selectedIds.set(new Set(this.dataTypes().map(t=>t.id)))}clearAll(){let t=new Set(this.collectingTypes());this.selectedIds.set(t)}onConfirm(){let t=new Set(this.collectingTypes()),e=Array.from(this.selectedIds()).filter(n=>!t.has(n));e.length>0&&this.dataTypesSelected.emit(e)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-inline-data-type-selector"]],inputs:{dataTypes:[1,"dataTypes"],initialSelection:[1,"initialSelection"],collectingTypes:[1,"collectingTypes"]},outputs:{dataTypesSelected:"dataTypesSelected"},decls:13,vars:3,consts:[[1,"inline-data-type-selector"],[1,"selector-header"],[1,"header-label"],[1,"header-actions"],["type","button",1,"action-btn"],[1,"data-type-grid"],["type","button",1,"data-type-card",3,"selected","collecting","disabled"],[1,"collecting-status"],[1,"selection-summary"],["type","button",1,"action-btn",3,"click"],["type","button",1,"data-type-card",3,"click","disabled"],[1,"card-checkbox"],[1,"pi","pi-spin","pi-spinner","collecting-spinner"],["type","checkbox",3,"checked"],[1,"card-label"],[1,"card-description"],["type","checkbox",3,"click","change","checked"],[1,"pi","pi-info-circle"],[1,"summary-text"],[1,"pi","pi-database"],["label","Add to Collection","icon","pi pi-plus","size","small","styleClass","confirm-btn",3,"onClick"],["label","Start Collection","icon","pi pi-play","size","small","styleClass","confirm-btn",3,"disabled"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"span",2),c(3,"Select data to analyze:"),r(),a(4,"div",3),g(5,Mo,2,0,"button",4)(6,xo,2,0,"button",4),r()(),a(7,"div",5),A(8,So,10,11,"button",6,vo),r(),g(10,Do,4,2,"div",7),g(11,To,6,2,"div",8)(12,Ao,6,1,"div",8),r()),e&2&&(s(5),m(n.allSelected()?6:5),s(3),E(n.dataTypes()),s(2),m(n.hasCollectingTypes()?10:-1),s(),m(n.canConfirm()?11:!n.hasCollectingTypes()&&n.selectedCount()===0?12:-1))},dependencies:[R,W,ie],styles:["[_nghost-%COMP%]{display:block}.inline-data-type-selector[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;padding:.75rem;background-color:var(--card-background-color, #ffffff);border-radius:.75rem;border:1px solid var(--input-border-color, #cbd5e1);box-shadow:0 2px 8px #00000014}.selector-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.5rem}.header-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:var(--text-color, #334155)}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.375rem}.action-btn[_ngcontent-%COMP%]{padding:.25rem .625rem;font-size:.75rem;font-weight:500;background:transparent;border:1px solid var(--input-border-color, #d1d5db);border-radius:.375rem;color:var(--text-color, #4b5563);cursor:pointer;transition:all .15s ease}.action-btn[_ngcontent-%COMP%]:hover{background-color:var(--surface-hover, #f3f4f6);border-color:var(--text-color-secondary, #9ca3af)}.data-type-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:.5rem}@media(max-width:400px){.data-type-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.data-type-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;gap:.25rem;padding:.75rem;background-color:var(--surface-hover, #f8fafc);border:2px solid var(--input-border-color, #e2e8f0);border-radius:.5rem;cursor:pointer;transition:all .15s ease;text-align:left;position:relative;box-shadow:0 1px 2px #0000000d}.data-type-card[_ngcontent-%COMP%]:hover{background-color:var(--surface-ground, #f1f5f9);border-color:var(--color-primary-color, #3b82f6);box-shadow:0 2px 4px rgba(var(--color-primary-rgb, 59, 130, 246),.15)}.data-type-card.selected[_ngcontent-%COMP%]{background-color:rgba(var(--color-primary-rgb, 59, 130, 246),.1);border-color:var(--color-primary-color, #3b82f6);box-shadow:0 2px 4px rgba(var(--color-primary-rgb, 59, 130, 246),.2)}.data-type-card.selected[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{color:var(--color-primary-color, #3b82f6)}.data-type-card.collecting[_ngcontent-%COMP%]{background-color:#fef3c7;border-color:#f59e0b;cursor:not-allowed;opacity:.9;box-shadow:0 2px 4px #f59e0b26}.data-type-card.collecting[_ngcontent-%COMP%]   .card-icon[_ngcontent-%COMP%]{color:#d97706}.data-type-card.collecting[_ngcontent-%COMP%]   .card-description[_ngcontent-%COMP%]{color:#b45309;font-style:italic}.data-type-card.collecting[_ngcontent-%COMP%]:hover{background-color:#fef3c7;border-color:#f59e0b}.card-checkbox[_ngcontent-%COMP%]{position:absolute;top:.5rem;right:.5rem}.card-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:.875rem;height:.875rem;accent-color:var(--color-primary-color, #3b82f6);cursor:pointer}.card-checkbox[_ngcontent-%COMP%]   .collecting-spinner[_ngcontent-%COMP%]{font-size:.875rem;color:#f59e0b}.card-icon[_ngcontent-%COMP%]{font-size:1.25rem;color:var(--color-primary-color, #3b82f6);margin-bottom:.25rem}.card-label[_ngcontent-%COMP%]{font-size:.8125rem;font-weight:600;color:var(--text-color, #1e293b)}.card-description[_ngcontent-%COMP%]{font-size:.6875rem;color:var(--text-color-secondary, #64748b);line-height:1.3}.collecting-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem .75rem;background-color:#fef3c7;border-radius:.375rem;border:1px solid #f59e0b;font-size:.75rem;color:#b45309}.collecting-status[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem;color:#d97706}.selection-summary[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.75rem;padding:.5rem .75rem;background-color:rgba(var(--color-primary-rgb, 59, 130, 246),.1);border-radius:.375rem;border:1px solid var(--color-primary-color, #3b82f6)}.summary-text[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.8125rem;font-weight:500;color:var(--color-primary-color, #3b82f6)}.summary-text[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}  .confirm-btn{background:var(--color-primary-color, #3b82f6);border:none;font-weight:600}  .confirm-btn:hover{filter:brightness(.9)}"]})};var Wt=(i,t)=>t.id;function Vo(i,t){if(i&1){let e=w();a(0,"app-inline-date-picker",10),b("dateRangeSelected",function(o){_(e);let l=p(2);return C(l.onDateRangeSelected(o))}),r()}}function Io(i,t){if(i&1){let e=w();a(0,"app-inline-vehicle-selector",11),b("vehiclesSelected",function(o){_(e);let l=p(2);return C(l.onVehiclesSelected(o))}),r()}if(i&2){let e=p(2);y("vehicles",e.availableVehicles())}}function Ro(i,t){if(i&1){let e=w();a(0,"app-inline-data-type-selector",12),b("dataTypesSelected",function(o){_(e);let l=p(2);return C(l.onDataTypesSelected(o))}),r()}if(i&2){let e=p(2);y("initialSelection",e.selectedDataTypesFromMessage())("collectingTypes",e.collectingDataTypes())}}function zo(i,t){if(i&1&&(a(0,"div",3),g(1,Vo,1,0,"app-inline-date-picker"),g(2,Io,1,1,"app-inline-vehicle-selector",8),g(3,Ro,1,2,"app-inline-data-type-selector",9),r()),i&2){let e=p();s(),m(e.isDatePicker()?1:-1),s(),m(e.isVehicleSelector()?2:-1),s(),m(e.isDataTypeSelector()?3:-1)}}function No(i,t){i&1&&c(0," Select data types to collect: ")}function qo(i,t){i&1&&c(0," Select one or more options: ")}function Fo(i,t){if(i&1){let e=w();a(0,"label",22)(1,"input",23),b("change",function(){let o=_(e).$implicit,l=p(3);return C(l.toggleActionSelection(o.id))}),r(),a(2,"span",24),c(3),r()()}if(i&2){let e=t.$implicit,n=p(3);U("selected",n.isActionSelected(e.id)),s(),y("checked",n.isActionSelected(e.id)),s(2),v(e.label)}}function $o(i,t){if(i&1&&c(0),i&2){let e=p(3);D(" Start Data Collection (",e.selectedActionIds().size," selected) ")}}function Bo(i,t){if(i&1&&c(0),i&2){let e=p(3);D(" Apply Selected (",e.selectedActionIds().size,") ")}}function Lo(i,t){if(i&1){let e=w();a(0,"div",14)(1,"span",15),g(2,No,1,0)(3,qo,1,0),r(),a(4,"button",16),b("click",function(){_(e);let o=p(2);return C(o.selectAllActions())}),c(5," Select All "),r()(),a(6,"div",17),A(7,Fo,4,4,"label",18,Wt),r(),a(9,"div",19)(10,"button",20),b("click",function(){_(e);let o=p(2);return C(o.submitSelectedActions())}),u(11,"i",21),g(12,$o,1,1)(13,Bo,1,1),r()()}if(i&2){let e=p(2);s(2),m(e.isDataTypeMultiSelect()?2:3),s(5),E(e.suggestedActions()),s(3),y("disabled",!e.hasSelectedActions()),s(2),m(e.isDataTypeMultiSelect()?12:13)}}function Qo(i,t){if(i&1){let e=w();a(0,"button",26),b("click",function(){let o=_(e).$implicit,l=p(3);return C(l.onActionClick(o))}),c(1),r()}if(i&2){let e=t.$implicit;s(),D(" ",e.label," ")}}function Uo(i,t){if(i&1&&A(0,Qo,2,1,"button",25,Wt),i&2){let e=p(2);E(e.suggestedActions())}}function Ho(i,t){if(i&1&&(a(0,"div",13),g(1,Lo,14,3)(2,Uo,2,0),r()),i&2){let e=p();U("multi-select-mode",e.isMultiSelectMode()),s(),m(e.isMultiSelectMode()?1:2)}}function jo(i,t){if(i&1&&(a(0,"span",7),u(1,"i",27),r()),i&2){let e=p();y("ngClass",e.statusClass()),s(),y("ngClass",e.statusIcon())}}var Go=new Set(["trips","events","telemetry","alerts"]),at=class i{message=S.required();isDisabled=S(!1);collectingDataTypes=S([]);actionSelected=q();multiActionsSelected=q();dateRangeSelected=q();vehiclesSelected=q();dataTypesSelected=q();selectedActionIds=P(new Set);isUser=f(()=>this.message().sender==="user");isAssistant=f(()=>this.message().sender==="assistant");isSystem=f(()=>this.message().sender==="system");formattedTime=f(()=>this.formatTime(this.message().timestamp));suggestedActions=f(()=>this.message().metadata?.suggestedActions??[]);hasSuggestedActions=f(()=>this.suggestedActions().length>0);interactiveType=f(()=>this.message().metadata?.interactiveType);hasInteractiveComponent=f(()=>!!this.interactiveType());isDatePicker=f(()=>this.interactiveType()==="date_picker");isVehicleSelector=f(()=>this.interactiveType()==="vehicle_selector");isDataTypeSelector=f(()=>this.interactiveType()==="data_type_selector");availableVehicles=f(()=>(this.message().metadata?.availableVehicles??[]).map(e=>({id:e.id,name:e.name,registration:void 0})));selectedDataTypesFromMessage=f(()=>this.message().metadata?.selectedDataTypes??[]);isMultiSelectMode=f(()=>this.suggestedActions().length>=2);isDataTypeMultiSelect=f(()=>{let t=this.suggestedActions();return t.length>=2&&t.every(e=>Go.has(e.value.toLowerCase()))});isActionSelected(t){return this.selectedActionIds().has(t)}selectedActions=f(()=>{let t=this.selectedActionIds();return this.suggestedActions().filter(e=>t.has(e.id))});hasSelectedActions=f(()=>this.selectedActionIds().size>0);statusIcon=f(()=>{switch(this.message().status){case"sending":return"pi pi-clock";case"sent":return"pi pi-check";case"delivered":return"pi pi-check-circle";case"error":return"pi pi-exclamation-circle";default:return""}});statusClass=f(()=>this.message().status==="error"?"text-red-500":"text-blue-400");onActionClick(t){this.actionSelected.emit(t)}toggleActionSelection(t){this.selectedActionIds.update(e=>{let n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n})}selectAllActions(){let t=this.suggestedActions().map(e=>e.id);this.selectedActionIds.set(new Set(t))}submitSelectedActions(){let t=this.selectedActions();t.length>0&&(this.multiActionsSelected.emit(t),this.selectedActionIds.set(new Set))}onDateRangeSelected(t){this.dateRangeSelected.emit(t)}onVehiclesSelected(t){this.vehiclesSelected.emit(t)}onDataTypesSelected(t){this.dataTypesSelected.emit(t)}formatTime(t){return t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-chat-message"]],inputs:{message:[1,"message"],isDisabled:[1,"isDisabled"],collectingDataTypes:[1,"collectingDataTypes"]},outputs:{actionSelected:"actionSelected",multiActionsSelected:"multiActionsSelected",dateRangeSelected:"dateRangeSelected",vehiclesSelected:"vehiclesSelected",dataTypesSelected:"dataTypesSelected"},decls:10,vars:13,consts:[[1,"message-wrapper"],[1,"message-bubble"],[1,"message-content",3,"innerHTML"],[1,"interactive-component"],[1,"suggested-actions",3,"multi-select-mode"],[1,"message-footer"],[1,"message-time"],[1,"message-status",3,"ngClass"],[3,"vehicles"],[3,"initialSelection","collectingTypes"],[3,"dateRangeSelected"],[3,"vehiclesSelected","vehicles"],[3,"dataTypesSelected","initialSelection","collectingTypes"],[1,"suggested-actions"],[1,"multi-select-header"],[1,"multi-select-label"],["type","button",1,"select-all-btn",3,"click"],[1,"checkbox-actions"],[1,"checkbox-action",3,"selected"],[1,"multi-select-footer"],["type","button",1,"submit-selection-btn",3,"click","disabled"],[1,"pi","pi-check"],[1,"checkbox-action"],["type","checkbox",3,"change","checked"],[1,"checkbox-label"],["type","button",1,"action-chip"],["type","button",1,"action-chip",3,"click"],[3,"ngClass"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1),u(2,"div",2),te(3,"formatMarkdown"),g(4,zo,4,3,"div",3),g(5,Ho,3,3,"div",4),a(6,"div",5)(7,"span",6),c(8),r(),g(9,jo,2,2,"span",7),r()()()),e&2&&(U("user-message",n.isUser())("assistant-message",n.isAssistant())("system-message",n.isSystem()),s(2),y("innerHTML",ne(3,11,n.message().content),ht),s(2),m(n.hasInteractiveComponent()?4:-1),s(),m(n.hasSuggestedActions()?5:-1),s(3),v(n.formattedTime()),s(),m(n.isUser()?9:-1))},dependencies:[R,J,W,He,ee,nt,ot,it,tt],styles:['[_nghost-%COMP%]{display:block}.message-wrapper[_ngcontent-%COMP%]{display:flex;margin-bottom:.5rem;padding:0 1rem;animation:_ngcontent-%COMP%_slideIn .2s ease-out}.message-wrapper.user-message[_ngcontent-%COMP%]{justify-content:flex-end}.message-wrapper.user-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background-color:var(--color-primary-color, #3b82f6);border-radius:.5rem .5rem 0;max-width:75%;margin-left:3rem;position:relative;box-shadow:0 1px 1px #00000014}.message-wrapper.user-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]:after{content:"";position:absolute;right:-8px;bottom:0;width:0;height:0;border:8px solid transparent;border-left-color:var(--color-primary-color, #3b82f6);border-bottom-color:var(--color-primary-color, #3b82f6);border-right:0;border-bottom:0}.message-wrapper.user-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{color:var(--color-primary-contrast, #ffffff)}.message-wrapper.user-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#ffffffb3}.message-wrapper.assistant-message[_ngcontent-%COMP%]{justify-content:flex-start}.message-wrapper.assistant-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background-color:var(--card-background-color, #ffffff);border-radius:.5rem .5rem .5rem 0;max-width:85%;margin-right:3rem;position:relative;box-shadow:0 1px 2px #00000014;border:1px solid var(--input-border-color, #e2e8f0)}.message-wrapper.assistant-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]:after{content:"";position:absolute;left:-8px;bottom:0;width:0;height:0;border:8px solid transparent;border-right-color:var(--card-background-color, #ffffff);border-bottom-color:var(--card-background-color, #ffffff);border-left:0;border-bottom:0}.message-wrapper.assistant-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{color:var(--text-color, #1e293b)}.message-wrapper.assistant-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:var(--text-color-secondary, #64748b)}.message-wrapper.system-message[_ngcontent-%COMP%]{justify-content:center;padding:.25rem 1rem}.message-wrapper.system-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background-color:var(--surface-hover, rgba(225, 245, 254, .92));border-radius:.5rem;max-width:90%;text-align:center;font-size:.8125rem;color:var(--text-color-secondary, #64748b);padding:.375rem .75rem;box-shadow:0 1px 1px #0000000d}.message-wrapper.system-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]:after{display:none}.message-bubble[_ngcontent-%COMP%]{padding:.5rem .625rem .375rem;position:relative;word-wrap:break-word}.message-content[_ngcontent-%COMP%]{font-size:.9375rem;line-height:1.4;white-space:pre-wrap;word-break:break-word}.message-content   [_nghost-%COMP%]     strong, .message-content   [_nghost-%COMP%]     b{font-weight:600}.message-content   [_nghost-%COMP%]     em, .message-content   [_nghost-%COMP%]     i{font-style:italic}.message-content   [_nghost-%COMP%]     code{background-color:#0000000f;padding:.125rem .375rem;border-radius:.25rem;font-family:SF Mono,Monaco,Inconsolata,Roboto Mono,monospace;font-size:.85em}.message-content   [_nghost-%COMP%]     ul, .message-content   [_nghost-%COMP%]     ol{margin:.375rem 0;padding-left:1.25rem}.message-content   [_nghost-%COMP%]     li{margin-bottom:.125rem}.message-content   [_nghost-%COMP%]     blockquote{margin:.375rem 0;padding-left:.625rem;border-left:3px solid var(--color-primary-color, #3b82f6);color:var(--text-color-secondary, #64748b);font-style:italic}.message-content   [_nghost-%COMP%]     p{margin:0 0 .375rem}.message-content   [_nghost-%COMP%]     p:last-child{margin-bottom:0}.interactive-component[_ngcontent-%COMP%]{margin-top:.625rem;padding-top:.625rem;border-top:1px solid var(--input-border-color, rgba(0, 0, 0, .06))}.suggested-actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.625rem;padding-top:.625rem;border-top:1px solid var(--input-border-color, rgba(0, 0, 0, .06))}.suggested-actions.multi-select-mode[_ngcontent-%COMP%]{flex-direction:column;gap:.75rem}.multi-select-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:.5rem}.multi-select-label[_ngcontent-%COMP%]{font-size:.8125rem;font-weight:500;color:var(--text-color-secondary, #64748b)}.select-all-btn[_ngcontent-%COMP%]{padding:.25rem .625rem;font-size:.75rem;font-weight:500;background:transparent;border:1px solid var(--input-border-color, #d1d7db);border-radius:.375rem;color:var(--text-color-secondary, #64748b);cursor:pointer;transition:all .15s ease}.select-all-btn[_ngcontent-%COMP%]:hover{background:var(--surface-hover, #f0f2f5);border-color:var(--input-border-color, #8696a0)}.checkbox-actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.checkbox-action[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem .75rem;background:var(--surface-hover, #f0f2f5);border:1.5px solid transparent;border-radius:.5rem;cursor:pointer;transition:all .15s ease;-webkit-user-select:none;user-select:none}.checkbox-action[_ngcontent-%COMP%]:hover{background:var(--surface-ground, #e9edef)}.checkbox-action.selected[_ngcontent-%COMP%]{background:rgba(var(--color-primary-rgb, 59, 130, 246),.1);border-color:var(--color-primary-color, #3b82f6)}.checkbox-action[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:1rem;height:1rem;accent-color:var(--color-primary-color, #3b82f6);cursor:pointer}.checkbox-label[_ngcontent-%COMP%]{font-size:.8125rem;font-weight:500;color:var(--text-color, #1e293b)}.multi-select-footer[_ngcontent-%COMP%]{margin-top:.25rem}.submit-selection-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;width:100%;padding:.625rem 1rem;font-size:.875rem;font-weight:600;background:var(--color-primary-color, #3b82f6);border:none;border-radius:.5rem;color:var(--color-primary-contrast, #ffffff);cursor:pointer;transition:all .2s ease}.submit-selection-btn[_ngcontent-%COMP%]:hover:not(:disabled){filter:brightness(.9);transform:translateY(-1px);box-shadow:0 4px 8px rgba(var(--color-primary-rgb, 59, 130, 246),.3)}.submit-selection-btn[_ngcontent-%COMP%]:disabled{background:var(--input-border-color, #d1d7db);cursor:not-allowed;transform:none;box-shadow:none}.submit-selection-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem}.action-chip[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.8125rem;font-weight:500;background:var(--surface-hover, #f0f2f5);border:1px solid var(--input-border-color, #d1d7db);border-radius:1.25rem;color:var(--color-primary-color, #3b82f6);cursor:pointer;transition:all .15s ease;white-space:nowrap}.action-chip[_ngcontent-%COMP%]:hover{background:rgba(var(--color-primary-rgb, 59, 130, 246),.1);border-color:var(--color-primary-color, #3b82f6);transform:translateY(-1px)}.action-chip[_ngcontent-%COMP%]:active{transform:translateY(0)}.message-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;gap:.25rem;margin-top:.125rem}.message-time[_ngcontent-%COMP%]{font-size:.6875rem}.message-status[_ngcontent-%COMP%]{font-size:.75rem;display:flex;align-items:center}.message-status.sent[_ngcontent-%COMP%], .message-status.delivered[_ngcontent-%COMP%]{color:var(--text-color-secondary, #667781)}.message-status.read[_ngcontent-%COMP%]{color:var(--color-primary-color, #3b82f6)}.message-status[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}']})};var Wo=["inputField"],Re=class i{disabled=S(!1);placeholder=S("Type your message...");isLoading=S(!1);messageSent=q();messageText=P("");inputField;onSend(){let t=this.messageText().trim();t&&!this.disabled()&&!this.isLoading()&&(this.messageSent.emit(t),this.messageText.set(""),this.resetTextareaHeight())}onKeyDown(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),this.onSend())}onInput(t){let e=t.target;this.messageText.set(e.value),this.autoResizeTextarea(e)}autoResizeTextarea(t){t.style.height="auto";let e=150;t.style.height=Math.min(t.scrollHeight,e)+"px"}resetTextareaHeight(){this.inputField?.nativeElement!==void 0&&(this.inputField.nativeElement.style.height="auto")}focus(){this.inputField?.nativeElement?.focus()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-chat-input"]],viewQuery:function(e,n){if(e&1&&Y(Wo,5),e&2){let o;K(o=Z())&&(n.inputField=o.first)}},inputs:{disabled:[1,"disabled"],placeholder:[1,"placeholder"],isLoading:[1,"isLoading"]},outputs:{messageSent:"messageSent"},decls:5,vars:6,consts:[["inputField",""],[1,"chat-input-container"],[1,"input-wrapper"],["rows","1",1,"chat-textarea",3,"input","keydown","placeholder","disabled","value"],["pButton","","type","button","aria-label","Send message","tooltipPosition","top",1,"send-button",3,"click","disabled","icon","pTooltip"]],template:function(e,n){if(e&1){let o=w();a(0,"div",1)(1,"div",2)(2,"textarea",3,0),b("input",function(d){return _(o),C(n.onInput(d))})("keydown",function(d){return _(o),C(n.onKeyDown(d))}),r()(),a(4,"button",4),b("click",function(){return _(o),C(n.onSend())}),r()()}e&2&&(s(2),y("placeholder",n.placeholder())("disabled",n.disabled()||n.isLoading())("value",n.messageText()),s(2),y("disabled",n.disabled()||n.isLoading()||!n.messageText().trim())("icon",n.isLoading()?"pi pi-spin pi-spinner":"pi pi-send")("pTooltip","Send message (Enter)"))},dependencies:[R,ee,W,Be,Vt,Et],styles:["[_nghost-%COMP%]{display:block}.chat-input-container[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:.75rem;padding:.75rem 1rem;background-color:var(--card-background-color, #ffffff);border-top:1px solid var(--input-border-color, #e2e8f0);border-radius:0 0 .5rem .5rem;box-shadow:0 -2px 8px #0000000a}.input-wrapper[_ngcontent-%COMP%]{flex:1;position:relative}.chat-textarea[_ngcontent-%COMP%]{width:100%;min-height:2.5rem;max-height:150px;padding:.625rem 1rem;font-size:.9375rem;line-height:1.5;color:var(--input-font-color, #1e293b);background-color:var(--input-background-color, #ffffff)!important;border:2px solid var(--color-primary-color, #3b82f6);border-radius:1.25rem;resize:none;overflow-y:auto;transition:border-color .2s ease,box-shadow .2s ease,background-color .2s ease}.chat-textarea[_ngcontent-%COMP%]:focus{outline:none;background-color:var(--input-background-color, #ffffff)!important;border-color:var(--color-primary-color, #2563eb);box-shadow:0 0 0 3px rgba(var(--color-primary-rgb, 59, 130, 246),.2)}.chat-textarea[_ngcontent-%COMP%]:disabled{background-color:var(--input-background-color, #f1f5f9)!important;color:var(--input-placeholder-color, #64748b);border-color:var(--input-border-color, #cbd5e1);cursor:not-allowed;opacity:.7}.chat-textarea[_ngcontent-%COMP%]::placeholder{color:var(--input-placeholder-color, #94a3b8)}.send-button[_ngcontent-%COMP%]{flex-shrink:0;width:2.5rem;height:2.5rem;padding:0;border-radius:50%;background:var(--color-primary-color, #3b82f6)!important;border:none;color:var(--color-primary-contrast, #ffffff);cursor:pointer;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.send-button[_ngcontent-%COMP%]:hover:not(:disabled){filter:brightness(.9);transform:scale(1.05)}.send-button[_ngcontent-%COMP%]:active:not(:disabled){transform:scale(.98)}.send-button[_ngcontent-%COMP%]:disabled{background:var(--input-border-color, #d1d5db)!important;cursor:not-allowed;transform:none;opacity:.6}.send-button[_ngcontent-%COMP%]     .p-button-icon{font-size:1rem}"]})};var Kt=(i,t)=>t.vehicleId,Zt=(i,t)=>t.dataType;function Yo(i,t){if(i&1&&(a(0,"div",4)(1,"span",9),c(2),r(),a(3,"span",10),c(4),r()()),i&2){let e=p();L("data-level",e.confidenceColor()),s(2),D("",e.confidence(),"%"),s(2),v(e.confidenceLabel())}}function Ko(i,t){i&1&&(a(0,"div",6),u(1,"i",11),a(2,"span"),c(3,"Building query..."),r()())}function Zo(i,t){if(i&1&&(a(0,"li",16),u(1,"i",17),c(2),r()),i&2){let e=t.$implicit;s(2),D(" ",e," ")}}function Jo(i,t){if(i&1&&(a(0,"div",13)(1,"span",14),c(2,"Recent changes:"),r(),a(3,"ul",15),A(4,Zo,3,1,"li",16,_t),r()()),i&2){let e=p(2);s(4),E(e.changes())}}function Xo(i,t){if(i&1&&(a(0,"p",12),c(1),r(),g(2,Jo,6,0,"div",13)),i&2){let e=p();s(),v(e.query()),s(),m(e.hasChanges()?2:-1)}}function ei(i,t){i&1&&(a(0,"div",7)(1,"div",18),u(2,"i",3),r(),a(3,"h3",19),c(4,"Your Query Preview"),r(),a(5,"p",20),c(6," As you chat, your analysis request will appear here. "),r(),a(7,"div",21)(8,"div",22)(9,"span",23),c(10,"1"),r(),a(11,"span",24),c(12,"Describe what you want to analyze"),r()(),a(13,"div",22)(14,"span",23),c(15,"2"),r(),a(16,"span",24),c(17,"Select data types to include"),r()(),a(18,"div",22)(19,"span",23),c(20,"3"),r(),a(21,"span",24),c(22,"Generate your report"),r()()()())}function ti(i,t){if(i&1&&(a(0,"div",29),u(1,"i",35),a(2,"span"),c(3),r()()),i&2){let e=p(3);s(3),D("Collecting: ",e.dataTypesLabel())}}function ni(i,t){if(i&1&&(a(0,"div",32),u(1,"i",11),a(2,"span"),c(3),r()()),i&2){let e=p(3);s(3),v(e.statusMessage())}}function oi(i,t){if(i&1&&(a(0,"div",33)(1,"div",36)(2,"span",37),c(3),r(),a(4,"span",38),c(5,"Vehicles"),r()(),a(6,"div",36)(7,"span",37),c(8),te(9,"number"),r(),a(10,"span",38),c(11,"Records"),r()()()),i&2){let e=p(3);s(3),G("",e.completedVehiclesCount(),"/",e.vehicleProgress().length),s(5),v(ne(9,3,e.totalRecordsCollected()))}}function ii(i,t){i&1&&u(0,"i",41)}function ai(i,t){i&1&&u(0,"i",42)}function ri(i,t){i&1&&u(0,"i",43)}function si(i,t){i&1&&u(0,"i",44)}function li(i,t){i&1&&u(0,"i",11)}function ci(i,t){i&1&&u(0,"i",49)}function di(i,t){if(i&1&&c(0),i&2){let e=p().$implicit;D(" (",e.recordCount,") ")}}function pi(i,t){if(i&1&&(a(0,"span",48),g(1,li,1,0,"i",11)(2,ci,1,0,"i",49),c(3),g(4,di,1,1),r()),i&2){let e=t.$implicit;L("data-status",e.status),s(),m(e.status==="collecting"?1:e.status==="complete"?2:-1),s(2),D(" ",e.dataType," "),s(),m(e.recordCount>0?4:-1)}}function gi(i,t){if(i&1&&(a(0,"div",39)(1,"div",40),g(2,ii,1,0,"i",41)(3,ai,1,0,"i",42)(4,ri,1,0,"i",43)(5,si,1,0,"i",44),a(6,"span",45),c(7),r(),a(8,"span",46),c(9),te(10,"number"),r()(),a(11,"div",47),A(12,pi,5,4,"span",48,Zt),r()()),i&2){let e=t.$implicit;L("data-status",e.status),s(2),m(e.status==="pending"?2:e.status==="collecting"?3:e.status==="complete"?4:e.status==="error"?5:-1),s(5),v(e.vehicleName),s(2),D("",ne(10,4,e.recordsCollected)," records"),s(3),E(e.dataTypesProgress)}}function mi(i,t){if(i&1&&(a(0,"div",34),A(1,gi,14,6,"div",39,Kt),r()),i&2){let e=p(3);s(),E(e.vehicleProgress())}}function ui(i,t){if(i&1&&(a(0,"div",27),g(1,ti,4,1,"div",29),a(2,"div",30),u(3,"p-progressBar",31),r(),g(4,ni,4,1,"div",32),g(5,oi,12,5,"div",33),g(6,mi,3,0,"div",34),r()),i&2){let e=p(2);s(),m(e.dataTypesLabel()?1:-1),s(2),y("value",e.collectionProgress())("showValue",!0),s(),m(e.statusMessage()?4:-1),s(),m(e.hasVehicleProgress()?5:-1),s(),m(e.hasVehicleProgress()?6:-1)}}function hi(i,t){if(i&1&&(a(0,"div",53)(1,"span",55),c(2),te(3,"number"),r(),a(4,"span",56),c(5,"Trips"),r()()),i&2){let e=p(3);s(2),v(ne(3,1,e.collectedData().trips))}}function fi(i,t){if(i&1&&(a(0,"div",53)(1,"span",55),c(2),te(3,"number"),r(),a(4,"span",56),c(5,"Events"),r()()),i&2){let e=p(3);s(2),v(ne(3,1,e.collectedData().events))}}function _i(i,t){if(i&1&&(a(0,"div",53)(1,"span",55),c(2),te(3,"number"),r(),a(4,"span",56),c(5,"Telemetry"),r()()),i&2){let e=p(3);s(2),v(ne(3,1,e.collectedData().telemetry))}}function Ci(i,t){if(i&1&&(a(0,"div",53)(1,"span",55),c(2),te(3,"number"),r(),a(4,"span",56),c(5,"Alerts"),r()()),i&2){let e=p(3);s(2),v(ne(3,1,e.collectedData().alerts))}}function yi(i,t){i&1&&u(0,"i",43)}function bi(i,t){i&1&&u(0,"i",44)}function vi(i,t){i&1&&u(0,"i",60)}function Mi(i,t){i&1&&u(0,"i",49)}function xi(i,t){if(i&1&&c(0),i&2){let e=p().$implicit;D(" (",e.recordCount,") ")}}function Pi(i,t){if(i&1&&(a(0,"span",48),g(1,Mi,1,0,"i",49),c(2),g(3,xi,1,1),r()),i&2){let e=t.$implicit;L("data-status",e.status),s(),m(e.status==="complete"?1:-1),s(),D(" ",e.dataType," "),s(),m(e.recordCount>0?3:-1)}}function Oi(i,t){if(i&1&&(a(0,"div",39)(1,"div",40),g(2,yi,1,0,"i",43)(3,bi,1,0,"i",44)(4,vi,1,0,"i",60),a(5,"span",45),c(6),r(),a(7,"span",46),c(8),te(9,"number"),r()(),a(10,"div",47),A(11,Pi,4,4,"span",48,Zt),r()()),i&2){let e=t.$implicit;L("data-status",e.status),s(2),m(e.status==="complete"?2:e.status==="error"?3:4),s(4),v(e.vehicleName),s(2),D("",ne(9,4,e.recordsCollected)," records"),s(3),E(e.dataTypesProgress)}}function ki(i,t){if(i&1&&(a(0,"div",54)(1,"div",57)(2,"span"),c(3,"Per Vehicle Breakdown"),r(),a(4,"span",58),c(5),r()(),a(6,"div",59),A(7,Oi,13,6,"div",39,Kt),r()()),i&2){let e=p(3);s(5),D("",e.vehicleProgress().length," vehicles"),s(2),E(e.vehicleProgress())}}function wi(i,t){if(i&1&&(a(0,"div",28)(1,"div",50)(2,"div",51),u(3,"i",17),a(4,"span"),c(5,"Collection Complete"),r()(),a(6,"div",52),g(7,hi,6,3,"div",53),g(8,fi,6,3,"div",53),g(9,_i,6,3,"div",53),g(10,Ci,6,3,"div",53),r()(),g(11,ki,9,1,"div",54),r()),i&2){let e=p(2);s(7),m(e.collectedData().trips>0?7:-1),s(),m(e.collectedData().events>0?8:-1),s(),m(e.collectedData().telemetry>0?9:-1),s(),m(e.collectedData().alerts>0?10:-1),s(),m(e.hasVehicleProgress()?11:-1)}}function Si(i,t){if(i&1&&(a(0,"div",8)(1,"div",25),u(2,"i",26),a(3,"span"),c(4,"Data Status"),r()(),g(5,ui,7,6,"div",27)(6,wi,12,5,"div",28),r()),i&2){let e=p();s(5),m(e.isCollecting()?5:e.hasCollectedData()?6:-1)}}var rt=class i{query=S("");confidence=S(0);changes=S([]);isLoading=S(!1);isCollecting=S(!1);collectionProgress=S(0);collectedData=S(null);dataTypes=S([]);statusMessage=S("");currentVehicle=S("");vehicleProgress=S([]);hasQuery=f(()=>this.query().length>0);hasChanges=f(()=>this.changes().length>0);hasCollectedData=f(()=>this.collectedData()!==null);hasVehicleProgress=f(()=>this.vehicleProgress().length>0);dataTypesLabel=f(()=>{let t=this.dataTypes();return t.length===0?"":t.map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(", ")});completedVehiclesCount=f(()=>this.vehicleProgress().filter(t=>t.status==="complete").length);totalRecordsCollected=f(()=>this.vehicleProgress().reduce((t,e)=>t+e.recordsCollected,0));confidenceColor=f(()=>{let t=this.confidence();return t>=80?"high":t>=50?"medium":"low"});confidenceLabel=f(()=>{let t=this.confidence();return t>=90?"Ready":t>=70?"Good":t>=50?"Building":"Starting"});static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-query-preview"]],inputs:{query:[1,"query"],confidence:[1,"confidence"],changes:[1,"changes"],isLoading:[1,"isLoading"],isCollecting:[1,"isCollecting"],collectionProgress:[1,"collectionProgress"],collectedData:[1,"collectedData"],dataTypes:[1,"dataTypes"],statusMessage:[1,"statusMessage"],currentVehicle:[1,"currentVehicle"],vehicleProgress:[1,"vehicleProgress"]},decls:12,vars:3,consts:[[1,"query-preview-panel"],[1,"panel-header"],[1,"header-title"],[1,"pi","pi-file-edit"],[1,"confidence-badge"],[1,"query-content"],[1,"loading-state"],[1,"empty-state"],[1,"data-status-section"],[1,"confidence-value"],[1,"confidence-label"],[1,"pi","pi-spin","pi-spinner"],[1,"query-text"],[1,"changes-section"],[1,"changes-label"],[1,"changes-list"],[1,"change-item"],[1,"pi","pi-check-circle"],[1,"empty-state-icon"],[1,"empty-state-title"],[1,"empty-state-description"],[1,"empty-state-steps"],[1,"step"],[1,"step-number"],[1,"step-text"],[1,"section-header"],[1,"pi","pi-database"],[1,"collection-progress"],[1,"collected-data"],[1,"data-types-label"],[1,"progress-bar-container"],["styleClass","collection-progress-bar",3,"value","showValue"],[1,"status-message"],[1,"collection-stats"],[1,"vehicle-progress-list"],[1,"pi","pi-list"],[1,"stat-item"],[1,"stat-value"],[1,"stat-label"],[1,"vehicle-progress-item"],[1,"vehicle-header"],[1,"pi","pi-clock","status-icon","pending"],[1,"pi","pi-spin","pi-spinner","status-icon","collecting"],[1,"pi","pi-check-circle","status-icon","complete"],[1,"pi","pi-exclamation-circle","status-icon","error"],[1,"vehicle-name"],[1,"vehicle-records"],[1,"data-type-badges"],[1,"data-type-badge"],[1,"pi","pi-check"],[1,"collection-summary"],[1,"summary-header"],[1,"summary-totals"],[1,"total-item"],[1,"vehicle-breakdown"],[1,"total-value"],[1,"total-label"],[1,"breakdown-header"],[1,"vehicle-count"],[1,"vehicle-progress-list","completed"],[1,"pi","pi-minus-circle","status-icon","skipped"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),u(3,"i",3),a(4,"span"),c(5,"Current Query"),r()(),g(6,Yo,5,3,"div",4),r(),a(7,"div",5),g(8,Ko,4,0,"div",6)(9,Xo,3,2)(10,ei,23,0,"div",7),r(),g(11,Si,7,1,"div",8),r()),e&2&&(s(6),m(n.confidence()>0?6:-1),s(2),m(n.isLoading()?8:n.hasQuery()?9:10),s(3),m(n.isCollecting()||n.hasCollectedData()?11:-1))},dependencies:[R,De,Ae,Te,Pt],styles:["[_nghost-%COMP%]{display:block;height:100%}.query-preview-panel[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;background-color:#fff;border:1px solid #e5e7eb;border-radius:.5rem;overflow:hidden}.panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.875rem 1rem;background-color:#f9fafb;border-bottom:1px solid #e5e7eb}.header-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-weight:600;font-size:.875rem;color:#374151}.header-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem;color:#6b7280}.confidence-badge[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;padding:.25rem .625rem;border-radius:.375rem;font-size:.75rem}.confidence-badge[data-level=high][_ngcontent-%COMP%]{background-color:#dcfce7;color:#166534}.confidence-badge[data-level=medium][_ngcontent-%COMP%]{background-color:#fef3c7;color:#92400e}.confidence-badge[data-level=low][_ngcontent-%COMP%]{background-color:#fee2e2;color:#991b1b}.confidence-badge[_ngcontent-%COMP%]   .confidence-value[_ngcontent-%COMP%]{font-weight:700;font-size:.875rem}.confidence-badge[_ngcontent-%COMP%]   .confidence-label[_ngcontent-%COMP%]{font-size:.625rem;text-transform:uppercase;letter-spacing:.025em}.query-content[_ngcontent-%COMP%]{flex:1;padding:1rem;overflow-y:auto}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:2rem;color:#6b7280;font-size:.875rem}.loading-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.25rem;color:#3b82f6}.query-text[_ngcontent-%COMP%]{font-size:.9375rem;line-height:1.6;color:#1f2937;margin:0;padding:.75rem;background-color:#f3f4f6;border-radius:.375rem;border-left:3px solid #3b82f6}.changes-section[_ngcontent-%COMP%]{margin-top:1rem;padding-top:1rem;border-top:1px solid #e5e7eb}.changes-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:600;color:#6b7280;text-transform:uppercase;letter-spacing:.025em}.changes-list[_ngcontent-%COMP%]{margin:.5rem 0 0;padding:0;list-style:none}.change-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;font-size:.8125rem;color:#059669;margin-bottom:.25rem}.change-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1.5rem;text-align:center;height:100%}.empty-state-icon[_ngcontent-%COMP%]{width:3.5rem;height:3.5rem;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#eff6ff,#dbeafe);border-radius:50%;margin-bottom:1rem}.empty-state-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.5rem;color:#3b82f6}.empty-state-title[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.9375rem;font-weight:600;color:#374151}.empty-state-description[_ngcontent-%COMP%]{margin:0 0 1.25rem;font-size:.8125rem;color:#6b7280;max-width:200px}.empty-state-steps[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.625rem;width:100%;max-width:220px}.step[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.625rem;padding:.5rem .75rem;background-color:#f9fafb;border-radius:.375rem;text-align:left}.step[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{width:1.25rem;height:1.25rem;display:flex;align-items:center;justify-content:center;background-color:#e5e7eb;border-radius:50%;font-size:.6875rem;font-weight:600;color:#6b7280;flex-shrink:0}.step[_ngcontent-%COMP%]   .step-text[_ngcontent-%COMP%]{font-size:.6875rem;color:#6b7280;line-height:1.3}.data-status-section[_ngcontent-%COMP%]{padding:1rem;background-color:#f9fafb;border-top:1px solid #e5e7eb}.section-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-weight:600;font-size:.8125rem;color:#374151;margin-bottom:.75rem}.section-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem;color:#6b7280}.collection-progress[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.625rem}.collection-progress[_ngcontent-%COMP%]   .progress-label[_ngcontent-%COMP%]{display:block;margin-top:.375rem;font-size:.75rem;color:#6b7280}.data-types-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;font-size:.75rem;font-weight:500;color:#374151}.data-types-label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem;color:#6b7280}.progress-bar-container[_ngcontent-%COMP%]     .collection-progress-bar{height:.5rem;border-radius:.25rem}.status-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;font-size:.75rem;color:#3b82f6}.status-message[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem}.collection-stats[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:.5rem 0;border-top:1px solid #e5e7eb}.stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.stat-item[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#1f2937}.stat-item[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.625rem;text-transform:uppercase;letter-spacing:.025em;color:#6b7280}.vehicle-progress-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;max-height:200px;overflow-y:auto;padding:.5rem 0;border-top:1px solid #e5e7eb}.vehicle-progress-item[_ngcontent-%COMP%]{padding:.5rem;background-color:#fff;border:1px solid #e5e7eb;border-radius:.375rem;font-size:.75rem}.vehicle-progress-item[data-status=collecting][_ngcontent-%COMP%]{border-left:3px solid #3b82f6;background-color:#eff6ff}.vehicle-progress-item[data-status=complete][_ngcontent-%COMP%]{border-left:3px solid #10b981;background-color:#f0fdf4}.vehicle-progress-item[data-status=error][_ngcontent-%COMP%]{border-left:3px solid #ef4444;background-color:#fef2f2}.vehicle-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;margin-bottom:.375rem}.vehicle-header[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{font-size:.75rem}.vehicle-header[_ngcontent-%COMP%]   .status-icon.pending[_ngcontent-%COMP%]{color:#9ca3af}.vehicle-header[_ngcontent-%COMP%]   .status-icon.collecting[_ngcontent-%COMP%]{color:#3b82f6}.vehicle-header[_ngcontent-%COMP%]   .status-icon.complete[_ngcontent-%COMP%]{color:#10b981}.vehicle-header[_ngcontent-%COMP%]   .status-icon.error[_ngcontent-%COMP%]{color:#ef4444}.vehicle-header[_ngcontent-%COMP%]   .vehicle-name[_ngcontent-%COMP%]{flex:1;font-weight:500;color:#374151;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vehicle-header[_ngcontent-%COMP%]   .vehicle-records[_ngcontent-%COMP%]{font-size:.6875rem;color:#6b7280;white-space:nowrap}.data-type-badges[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.25rem}.data-type-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.25rem;padding:.125rem .375rem;font-size:.625rem;font-weight:500;border-radius:.25rem;text-transform:capitalize}.data-type-badge[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.625rem}.data-type-badge[data-status=pending][_ngcontent-%COMP%]{background-color:#f3f4f6;color:#6b7280}.data-type-badge[data-status=collecting][_ngcontent-%COMP%]{background-color:#dbeafe;color:#1d4ed8}.data-type-badge[data-status=complete][_ngcontent-%COMP%]{background-color:#dcfce7;color:#166534}.data-type-badge[data-status=skipped][_ngcontent-%COMP%]{background-color:#f3f4f6;color:#9ca3af}.collected-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.collection-summary[_ngcontent-%COMP%]{padding:.75rem;background-color:#f0fdf4;border:1px solid #bbf7d0;border-radius:.5rem}.summary-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;font-size:.8125rem;font-weight:600;color:#166534;margin-bottom:.5rem}.summary-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem;color:#22c55e}.summary-totals[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.75rem}.total-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:.375rem .75rem;background-color:#fff;border-radius:.375rem;min-width:60px}.total-item[_ngcontent-%COMP%]   .total-value[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;color:#166534}.total-item[_ngcontent-%COMP%]   .total-label[_ngcontent-%COMP%]{font-size:.625rem;text-transform:uppercase;letter-spacing:.025em;color:#6b7280}.vehicle-breakdown[_ngcontent-%COMP%]{border-top:1px solid #e5e7eb;padding-top:.75rem}.breakdown-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem;font-size:.75rem;font-weight:600;color:#374151}.breakdown-header[_ngcontent-%COMP%]   .vehicle-count[_ngcontent-%COMP%]{font-weight:400;color:#6b7280}.vehicle-progress-list.completed[_ngcontent-%COMP%]{max-height:250px}.data-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;font-size:.8125rem}.data-item.success[_ngcontent-%COMP%]{color:#059669}.data-item.success[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#10b981}.data-item.skipped[_ngcontent-%COMP%]{color:#6b7280}.data-item.skipped[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#9ca3af}.dark[_nghost-%COMP%]   .query-preview-panel[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .query-preview-panel[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .query-preview-panel[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .query-preview-panel[_ngcontent-%COMP%]{background-color:#1f2937;border-color:#374151}.dark[_nghost-%COMP%]   .panel-header[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .panel-header[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .panel-header[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .panel-header[_ngcontent-%COMP%]{background-color:#111827;border-bottom-color:#374151}.dark[_nghost-%COMP%]   .header-title[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .header-title[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .header-title[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .header-title[_ngcontent-%COMP%]{color:#e5e7eb}.dark[_nghost-%COMP%]   .header-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .header-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .header-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .header-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#9ca3af}.dark[_nghost-%COMP%]   .query-text[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .query-text[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .query-text[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .query-text[_ngcontent-%COMP%]{background-color:#374151;color:#f3f4f6;border-left-color:#3b82f6}.dark[_nghost-%COMP%]   .changes-section[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .changes-section[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .changes-section[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .changes-section[_ngcontent-%COMP%]{border-top-color:#374151}.dark[_nghost-%COMP%]   .empty-state-icon[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .empty-state-icon[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .empty-state-icon[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .empty-state-icon[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1e3a5f,#1e40af)}.dark[_nghost-%COMP%]   .empty-state-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .empty-state-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .empty-state-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .empty-state-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#60a5fa}.dark[_nghost-%COMP%]   .empty-state-title[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .empty-state-title[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .empty-state-title[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .empty-state-title[_ngcontent-%COMP%]{color:#e5e7eb}.dark[_nghost-%COMP%]   .empty-state-description[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .empty-state-description[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .empty-state-description[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .empty-state-description[_ngcontent-%COMP%]{color:#9ca3af}.dark[_nghost-%COMP%]   .step[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .step[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .step[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .step[_ngcontent-%COMP%]{background-color:#374151}.dark[_nghost-%COMP%]   .step[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .step[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .step[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .step[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background-color:#4b5563;color:#9ca3af}.dark[_nghost-%COMP%]   .step[_ngcontent-%COMP%]   .step-text[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .step[_ngcontent-%COMP%]   .step-text[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .step[_ngcontent-%COMP%]   .step-text[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .step[_ngcontent-%COMP%]   .step-text[_ngcontent-%COMP%]{color:#9ca3af}.dark[_nghost-%COMP%]   .data-status-section[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .data-status-section[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .data-status-section[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .data-status-section[_ngcontent-%COMP%]{background-color:#111827;border-top-color:#374151}.dark[_nghost-%COMP%]   .section-header[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .section-header[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .section-header[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .section-header[_ngcontent-%COMP%]{color:#e5e7eb}.dark[_nghost-%COMP%]   .section-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .section-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .section-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .section-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#9ca3af}.dark[_nghost-%COMP%]   .data-types-label[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .data-types-label[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .data-types-label[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .data-types-label[_ngcontent-%COMP%]{color:#e5e7eb}.dark[_nghost-%COMP%]   .data-types-label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .data-types-label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .data-types-label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .data-types-label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#9ca3af}.dark[_nghost-%COMP%]   .status-message[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .status-message[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .status-message[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .status-message[_ngcontent-%COMP%]{color:#60a5fa}.dark[_nghost-%COMP%]   .collection-stats[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .collection-stats[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .collection-stats[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .collection-stats[_ngcontent-%COMP%]{border-top-color:#374151}.dark[_nghost-%COMP%]   .collection-stats[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .collection-stats[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .collection-stats[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .collection-stats[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{color:#f3f4f6}.dark[_nghost-%COMP%]   .vehicle-progress-list[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .vehicle-progress-list[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .vehicle-progress-list[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .vehicle-progress-list[_ngcontent-%COMP%]{border-top-color:#374151}.dark[_nghost-%COMP%]   .vehicle-progress-item[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .vehicle-progress-item[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .vehicle-progress-item[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .vehicle-progress-item[_ngcontent-%COMP%]{background-color:#374151;border-color:#4b5563}.dark[_nghost-%COMP%]   .vehicle-progress-item[data-status=collecting][_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .vehicle-progress-item[data-status=collecting][_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .vehicle-progress-item[data-status=collecting][_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .vehicle-progress-item[data-status=collecting][_ngcontent-%COMP%]{background-color:#1e3a5f}.dark[_nghost-%COMP%]   .vehicle-progress-item[data-status=complete][_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .vehicle-progress-item[data-status=complete][_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .vehicle-progress-item[data-status=complete][_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .vehicle-progress-item[data-status=complete][_ngcontent-%COMP%]{background-color:#064e3b}.dark[_nghost-%COMP%]   .vehicle-progress-item[data-status=error][_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .vehicle-progress-item[data-status=error][_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .vehicle-progress-item[data-status=error][_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .vehicle-progress-item[data-status=error][_ngcontent-%COMP%]{background-color:#7f1d1d}.dark[_nghost-%COMP%]   .vehicle-header[_ngcontent-%COMP%]   .vehicle-name[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .vehicle-header[_ngcontent-%COMP%]   .vehicle-name[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .vehicle-header[_ngcontent-%COMP%]   .vehicle-name[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .vehicle-header[_ngcontent-%COMP%]   .vehicle-name[_ngcontent-%COMP%]{color:#e5e7eb}.dark[_nghost-%COMP%]   .vehicle-header[_ngcontent-%COMP%]   .vehicle-records[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .vehicle-header[_ngcontent-%COMP%]   .vehicle-records[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .vehicle-header[_ngcontent-%COMP%]   .vehicle-records[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .vehicle-header[_ngcontent-%COMP%]   .vehicle-records[_ngcontent-%COMP%]{color:#9ca3af}.dark[_nghost-%COMP%]   .data-type-badge[data-status=pending][_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .data-type-badge[data-status=pending][_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .data-type-badge[data-status=pending][_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .data-type-badge[data-status=pending][_ngcontent-%COMP%]{background-color:#374151;color:#9ca3af}.dark[_nghost-%COMP%]   .data-type-badge[data-status=collecting][_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .data-type-badge[data-status=collecting][_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .data-type-badge[data-status=collecting][_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .data-type-badge[data-status=collecting][_ngcontent-%COMP%]{background-color:#1e40af;color:#93c5fd}.dark[_nghost-%COMP%]   .data-type-badge[data-status=complete][_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .data-type-badge[data-status=complete][_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .data-type-badge[data-status=complete][_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .data-type-badge[data-status=complete][_ngcontent-%COMP%]{background-color:#065f46;color:#a7f3d0}.dark[_nghost-%COMP%]   .collection-summary[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .collection-summary[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .collection-summary[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .collection-summary[_ngcontent-%COMP%]{background-color:#064e3b;border-color:#065f46}.dark[_nghost-%COMP%]   .summary-header[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .summary-header[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .summary-header[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .summary-header[_ngcontent-%COMP%]{color:#a7f3d0}.dark[_nghost-%COMP%]   .summary-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .summary-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .summary-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .summary-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#34d399}.dark[_nghost-%COMP%]   .total-item[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .total-item[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .total-item[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .total-item[_ngcontent-%COMP%]{background-color:#1f2937}.dark[_nghost-%COMP%]   .total-item[_ngcontent-%COMP%]   .total-value[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .total-item[_ngcontent-%COMP%]   .total-value[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .total-item[_ngcontent-%COMP%]   .total-value[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .total-item[_ngcontent-%COMP%]   .total-value[_ngcontent-%COMP%]{color:#a7f3d0}.dark[_nghost-%COMP%]   .total-item[_ngcontent-%COMP%]   .total-label[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .total-item[_ngcontent-%COMP%]   .total-label[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .total-item[_ngcontent-%COMP%]   .total-label[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .total-item[_ngcontent-%COMP%]   .total-label[_ngcontent-%COMP%]{color:#9ca3af}.dark[_nghost-%COMP%]   .vehicle-breakdown[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .vehicle-breakdown[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .vehicle-breakdown[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .vehicle-breakdown[_ngcontent-%COMP%]{border-top-color:#374151}.dark[_nghost-%COMP%]   .breakdown-header[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .breakdown-header[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .breakdown-header[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .breakdown-header[_ngcontent-%COMP%]{color:#e5e7eb}.dark[_nghost-%COMP%]   .breakdown-header[_ngcontent-%COMP%]   .vehicle-count[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .breakdown-header[_ngcontent-%COMP%]   .vehicle-count[_ngcontent-%COMP%], [data-theme=dark][_nghost-%COMP%]   .breakdown-header[_ngcontent-%COMP%]   .vehicle-count[_ngcontent-%COMP%], [data-theme=dark]   [_nghost-%COMP%]   .breakdown-header[_ngcontent-%COMP%]   .vehicle-count[_ngcontent-%COMP%]{color:#9ca3af}"]})};var ze=class i{http=Q(we);authTokenManagerService=Q(Fe);apiUrlService=Q($e);_session=P(null);_messages=P([]);_isConnecting=P(!1);_isTyping=P(!1);_error=P(null);_currentQuery=P("");_queryConfidence=P(0);_dataCollectionStatus=P({isCollecting:!1,progress:0,dataTypes:[],collectedData:null});_apiSessionCreationPromise=null;_formDateRange=P(null);_formSelectedVehicles=P([]);_formSelectedDataTypes=P([]);_conversationPhase=P("greeting");_availableVehicles=P([]);session=this._session.asReadonly();messages=this._messages.asReadonly();isConnecting=this._isConnecting.asReadonly();isTyping=this._isTyping.asReadonly();error=this._error.asReadonly();currentQuery=this._currentQuery.asReadonly();queryConfidence=this._queryConfidence.asReadonly();dataCollectionStatus=this._dataCollectionStatus.asReadonly();formDateRange=this._formDateRange.asReadonly();formSelectedVehicles=this._formSelectedVehicles.asReadonly();formSelectedDataTypes=this._formSelectedDataTypes.asReadonly();conversationPhase=this._conversationPhase.asReadonly();isSessionActive=f(()=>this._session()?.status==="active");hasMessages=f(()=>this._messages().length>0);canGenerate=f(()=>this._currentQuery().length>0&&this._queryConfidence()>=50);hasDateRange=f(()=>this._formDateRange()!==null);hasVehicles=f(()=>this._formSelectedVehicles().length>0);hasDataTypes=f(()=>this._formSelectedDataTypes().length>0);isFormComplete=f(()=>this.hasDateRange()&&this.hasVehicles()&&this.hasDataTypes());chatApiBaseUrl=P("https://cypherview-reporting-develop-function.azurewebsites.net/api");useMockResponses=P(!1);async startSession(t){this._isConnecting.set(!0),this._error.set(null);try{this.useMockResponses()?await this.mockStartSession(t):await this.apiStartSession(t)}catch(e){let n=e instanceof Error?e.message:"Failed to start session";throw this._error.set(n),e}finally{this._isConnecting.set(!1)}}async sendMessage(t){let e=this._session();if(!e)throw new Error("No active session");let n=this.createUserMessage(e.id,t);this._messages.update(o=>[...o,n]),this._isTyping.set(!0),this._error.set(null);try{this.useMockResponses()?await this.mockSendMessage(e.id,t):await this.apiSendMessage(e.id,t),this._messages.update(o=>o.map(l=>l.id===n.id?F(V({},l),{status:"delivered"}):l))}catch(o){this._messages.update(d=>d.map(h=>h.id===n.id?F(V({},h),{status:"error"}):h));let l=o instanceof Error?o.message:"Failed to send message";throw this._error.set(l),o}finally{this._isTyping.set(!1)}}async submitDataContext(t){if(this._apiSessionCreationPromise)try{await this._apiSessionCreationPromise}catch{}let e=this._session();if(!e)throw new Error("No active session");if(e.id.startsWith("guided-")){console.warn("API session not yet created, attempting to create now..."),await this.startApiSessionFromGuidedFlow();let n=this._session();if(!n||n.id.startsWith("guided-"))throw new Error("Failed to create API session for context submission")}this._isTyping.set(!0),this._error.set(null);try{let n=this._session();if(!n)throw new Error("Session lost during context submission");this.useMockResponses()?await this.mockSubmitContext(n.id,t):await this.apiSubmitContext(n.id,t)}catch(n){let o=n instanceof Error?n.message:"Failed to submit data context";throw this._error.set(o),n}finally{this._isTyping.set(!1)}}async endSession(){let t=this._session();if(t)try{this.useMockResponses()||await this.apiEndSession(t.id)}finally{this._session.update(e=>e?F(V({},e),{status:"completed"}):null)}}reset(){this._session.set(null),this._messages.set([]),this._isConnecting.set(!1),this._isTyping.set(!1),this._error.set(null),this._currentQuery.set(""),this._queryConfidence.set(0),this._dataCollectionStatus.set({isCollecting:!1,progress:0,dataTypes:[],collectedData:null}),this._formDateRange.set(null),this._formSelectedVehicles.set([]),this._formSelectedDataTypes.set([]),this._conversationPhase.set("greeting"),this._apiSessionCreationPromise=null}setAvailableVehicles(t){this._availableVehicles.set(t),this._messages.update(e=>e.map(n=>n.metadata?.interactiveType==="vehicle_selector"?F(V({},n),{metadata:F(V({},n.metadata),{availableVehicles:t.map(o=>({id:o.id,name:o.name}))})}):n))}setDateRange(t,e){this._formDateRange.set({start:t,end:e});let n=l=>l.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),o=t.toDateString()===e.toDateString()?n(t):`${n(t)} to ${n(e)}`;this.addSystemMessage(`Date range selected: **${o}**`),this._conversationPhase.set("vehicle_selection"),this.promptForVehicleSelection()}setSelectedVehicles(t){this._formSelectedVehicles.set(t);let e=t.length===1?t[0].name:t.length<=3?t.map(n=>n.name).join(", "):`${t.length} vehicles`;this.addSystemMessage(`Vehicles selected: **${e}**`),this._conversationPhase.set("data_type_selection"),this.promptForDataTypeSelection()}setSelectedDataTypes(t){let e=this._formSelectedDataTypes(),n=[...new Set([...e,...t])];this._formSelectedDataTypes.set(n),this.updateDataTypeSelectorMessage(n);let o=t.map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(", ");this.addSystemMessage(`Data types selected: **${o}**`),this._conversationPhase.set("query_building"),this.promptForQueryBuilding()}updateDataTypeSelectorMessage(t){this._messages.update(e=>e.map(n=>n.metadata?.interactiveType==="data_type_selector"?F(V({},n),{metadata:F(V({},n.metadata),{selectedDataTypes:t})}):n))}async startGuidedSession(t,e){this._isConnecting.set(!0),this._error.set(null);try{await this.delay(300);let n=`guided-${this.generateId()}`,o=new Date,l={id:n,createdAt:o,lastActivity:o,expiresAt:new Date(o.getTime()+1800*1e3),status:"active",context:{clientId:t,clientName:e,dateRange:{startDate:"",endDate:""},vehicleIds:[],vehicleNames:[]},currentQuery:"",messageCount:0};this._session.set(l),this._conversationPhase.set("date_selection");let d=this.createAssistantMessage(n,`Hello! I'll help you build an analytical report for **${e}**.

Let's start by selecting the date range for your analysis.`,{interactiveType:"date_picker"});this._messages.set([d])}finally{this._isConnecting.set(!1)}}addSystemMessage(t){let e=this._session();if(!e)return;let n={id:this.generateId(),sessionId:e.id,sender:"system",content:t,timestamp:new Date,status:"delivered"};this._messages.update(o=>[...o,n])}promptForVehicleSelection(){let t=this._session();if(!t)return;let e=this._availableVehicles(),n=this.createAssistantMessage(t.id,`Now, which vehicles would you like to include in this report?

Select one or more vehicles from the list below.`,{interactiveType:"vehicle_selector",availableVehicles:e.map(o=>({id:o.id,name:o.name}))});this._messages.update(o=>[...o,n])}promptForDataTypeSelection(){let t=this._session();if(!t)return;let e=this.createAssistantMessage(t.id,`What data would you like to analyze?

Select the types of data you're interested in.`,{interactiveType:"data_type_selector"});this._messages.update(n=>[...n,e])}promptForQueryBuilding(){let t=this._session();if(!t)return;let e=this._formDateRange(),n=this._formSelectedVehicles(),o=this._formSelectedDataTypes(),l=k=>k.toLocaleDateString("en-US",{month:"short",day:"numeric"}),d=e?e.start.toDateString()===e.end.toDateString()?l(e.start):`${l(e.start)} - ${l(e.end)}`:"",h=n.length===1?n[0].name:`${n.length} vehicles`,O=o.map(k=>k.charAt(0).toUpperCase()+k.slice(1)).join(", "),M=`Analyze ${O.toLowerCase()} data for ${h} from ${d}`;this._currentQuery.set(M),this._queryConfidence.set(50);let x=this.createAssistantMessage(t.id,`I'm ready to collect **${O}** for **${h}** during **${d}**.

What specific insights are you looking for? For example:
\u2022 Driver safety analysis
\u2022 Fuel efficiency trends
\u2022 Vehicle utilization
\u2022 Route optimization`,{suggestedActions:[{id:"1",label:"Driver safety",action:"select",value:"safety"},{id:"2",label:"Fuel efficiency",action:"select",value:"fuel"},{id:"3",label:"General overview",action:"select",value:"overview"}],queryUpdate:{query:M,confidence:50,changes:["Set date range","Selected vehicles","Chose data types"]}});this._messages.update(k=>[...k,x])}async startApiSessionFromGuidedFlow(){let t=this._session(),e=this._formDateRange(),n=this._formSelectedVehicles();if(!t||!e||n.length===0){console.warn("Cannot start API session: missing required data");return}if(t.id&&!t.id.startsWith("guided-"))return;if(this._apiSessionCreationPromise)return this._apiSessionCreationPromise;let o={clientId:t.context.clientId,clientName:t.context.clientName,dateRange:{startDate:e.start.toISOString(),endDate:e.end.toISOString()},vehicleIds:n.map(l=>l.id),vehicleNames:n.map(l=>l.name)};return this._isConnecting.set(!0),this._apiSessionCreationPromise=(async()=>{try{this.useMockResponses()?this._session.update(l=>l?F(V({},l),{context:o}):null):await this.apiStartSession(o,!0)}catch(l){let d=l instanceof Error?l.message:"Failed to start API session";throw this._error.set(d),console.error("API session start failed:",l),l}finally{this._isConnecting.set(!1),this._apiSessionCreationPromise=null}})(),this._apiSessionCreationPromise}setDataCollectionStarted(t,e){let n=e.map(o=>({vehicleId:o.id,vehicleName:o.name,status:"pending",dataTypesProgress:t.map(l=>({dataType:l,status:"pending",recordCount:0})),recordsCollected:0}));this._dataCollectionStatus.set({isCollecting:!0,progress:0,dataTypes:t,collectedData:null,currentPhase:"initializing",currentVehicle:void 0,vehicleProgress:n,statusMessage:`Preparing to collect ${t.join(", ")} for ${e.length} vehicles...`}),this.startApiSessionFromGuidedFlow()}updateDataCollectionProgress(t){this._dataCollectionStatus.update(e=>F(V({},e),{progress:t}))}updateCollectionStatusMessage(t){this._dataCollectionStatus.update(e=>F(V({},e),{statusMessage:t}))}startVehicleCollection(t,e){this._dataCollectionStatus.update(n=>{let o=n.vehicleProgress?.map(l=>l.vehicleId===t?F(V({},l),{status:"collecting"}):l);return F(V({},n),{currentPhase:"collecting",currentVehicle:e,vehicleProgress:o,statusMessage:`Collecting data for ${e}...`})})}updateVehicleDataTypeProgress(t,e,n,o="collecting"){this._dataCollectionStatus.update(l=>{let d=l.vehicleProgress?.map(z=>{if(z.vehicleId!==t)return z;let T=z.dataTypesProgress.map(ae=>ae.dataType===e?F(V({},ae),{status:o,recordCount:n}):ae),re=T.reduce((ae,Ne)=>ae+Ne.recordCount,0);return F(V({},z),{dataTypesProgress:T,recordsCollected:re})}),h=(d?.length??0)*l.dataTypes.length,O=d?.reduce((z,T)=>z+T.dataTypesProgress.filter(re=>re.status==="complete"||re.status==="skipped").length,0)??0,M=h>0?Math.round(O/h*100):0,x=e.charAt(0).toUpperCase()+e.slice(1),k=d?.find(z=>z.vehicleId===t)?.vehicleName??"",N=o==="complete"?`${k}: ${x} complete (${n} records)`:`${k}: Collecting ${x.toLowerCase()}...`;return F(V({},l),{progress:M,vehicleProgress:d,statusMessage:N})})}completeVehicleCollection(t){this._dataCollectionStatus.update(e=>{let n=e.vehicleProgress?.map(d=>d.vehicleId===t?F(V({},d),{status:"complete"}):d),o=n?.filter(d=>d.status==="complete").length??0,l=n?.length??0;return F(V({},e),{vehicleProgress:n,statusMessage:`Completed ${o} of ${l} vehicles`})})}setVehicleCollectionError(t,e){this._dataCollectionStatus.update(n=>{let o=n.vehicleProgress?.map(l=>l.vehicleId===t?F(V({},l),{status:"error",error:e}):l);return F(V({},n),{vehicleProgress:o})})}setDataCollectionComplete(t){this._dataCollectionStatus.update(e=>F(V({},e),{isCollecting:!1,progress:100,collectedData:t,currentPhase:"complete",currentVehicle:void 0,statusMessage:"Data collection complete"}))}async mockStartSession(t){await this.delay(500);let e=this.generateId(),n=new Date,o={id:e,createdAt:n,lastActivity:n,expiresAt:new Date(n.getTime()+1800*1e3),status:"active",context:t,currentQuery:"",messageCount:0};this._session.set(o);let l=t.vehicleNames.slice(0,3).join(", "),d=t.vehicleNames.length,h=d>3?`${l} and ${d-3} more`:l,O=new Date(t.dateRange.startDate),M=new Date(t.dateRange.endDate),x=`${O.toLocaleDateString()} to ${M.toLocaleDateString()}`,k=this.createAssistantMessage(e,`I see you've selected **${h}** for **${x}**.

What data would you like to analyze? You can select multiple types.`,{suggestedActions:[{id:"1",label:"Trips",action:"select",value:"trips"},{id:"2",label:"Events",action:"select",value:"events"},{id:"3",label:"Telemetry",action:"select",value:"telemetry"},{id:"4",label:"Alerts",action:"select",value:"alerts"}]});this._messages.set([k])}async mockSendMessage(t,e){await this.delay(800+Math.random()*400);let n=e.toLowerCase(),o=this._dataCollectionStatus(),l=o.isCollecting,d=o.dataTypes;if(l){let N=d.map(T=>T.charAt(0).toUpperCase()+T.slice(1)).join(", "),z=this.createAssistantMessage(t,`I'm currently collecting **${N}** data (${o.progress}% complete).

Feel free to ask questions about what you're looking for in the analysis, and I'll have more insights once the data collection is complete.`,{queryUpdate:{query:this._currentQuery(),confidence:this._queryConfidence(),changes:[]}});this._messages.update(T=>[...T,z]);return}let h=[];if(n.includes("trip")&&h.push("trips"),n.includes("event")&&h.push("events"),n.includes("telemetry")&&h.push("telemetry"),n.includes("alert")&&h.push("alerts"),h.length>0&&!o.collectedData){let N=h.map(T=>T.charAt(0).toUpperCase()+T.slice(1)).join(" and "),z=this.createAssistantMessage(t,`I'll collect **${N}** data for your selected vehicles. This may take a moment depending on the data volume.

You can continue chatting while I gather the data.`,{triggerDataCollection:{dataTypes:h},queryUpdate:{query:`Analyze ${N.toLowerCase()} data`,confidence:25,changes:h.map(T=>`Added ${T} analysis`)}});this._messages.update(T=>[...T,z]),this._currentQuery.set(z.metadata?.queryUpdate?.query??""),this._queryConfidence.set(z.metadata?.queryUpdate?.confidence??0);return}let O="",M=[],x;if(n.includes("safety")||n.includes("driver"))O=`I'll focus on **driver safety analysis**. Based on your data, I can analyze:

\u2022 Harsh braking events
\u2022 Speeding incidents
\u2022 Rapid acceleration

Would you like me to compare drivers against each other, or show trends over time?`,M=[{id:"1",label:"Compare drivers",action:"select",value:"compare_drivers"},{id:"2",label:"Show trends",action:"select",value:"show_trends"},{id:"3",label:"Both",action:"select",value:"compare_and_trends"}],x={query:`${this._currentQuery()} with focus on driver safety`,confidence:Math.min(this._queryConfidence()+25,100),changes:["Added driver safety focus"]};else if(n.includes("compare")||n.includes("both")||n.includes("trend")){let N=n.includes("compare")||n.includes("both"),z=n.includes("trend")||n.includes("both"),T=[];N&&T.push("driver comparison"),z&&T.push("daily trends"),O=`I've updated the query to include **${T.join(" and ")}**.

Anything else you'd like to add, or are you ready to generate the report?`,M=[{id:"1",label:"Add fuel analysis",action:"append",value:"add_fuel"},{id:"2",label:"Add speed analysis",action:"append",value:"add_speed"},{id:"3",label:"Generate Report",action:"select",value:"generate"}],x={query:`${this._currentQuery()}, including ${T.join(" and ")}`,confidence:Math.min(this._queryConfidence()+30,95),changes:T.map(re=>`Added ${re}`)}}else n.includes("generate")||n.includes("ready")?(O=`Your query is ready:

> "${this._currentQuery()}"

Confidence: **${this._queryConfidence()}%**

Click the **Generate Report** button below to create your analysis.`,M=[],x={query:this._currentQuery(),confidence:95,changes:["Query finalized"]}):(O=`I understand you're interested in "${e}". Could you tell me more about what specific aspects you'd like to analyze?

For example:
\u2022 Driver behavior and safety
\u2022 Fuel efficiency
\u2022 Route optimization
\u2022 Vehicle utilization`,M=[{id:"1",label:"Driver safety",action:"select",value:"safety"},{id:"2",label:"Fuel efficiency",action:"select",value:"fuel"},{id:"3",label:"General overview",action:"select",value:"overview"}]);let k=this.createAssistantMessage(t,O,{suggestedActions:M,queryUpdate:x});this._messages.update(N=>[...N,k]),x&&(this._currentQuery.set(x.query),this._queryConfidence.set(x.confidence))}async mockSubmitContext(t,e){await this.delay(600);let n=0,o=0,l=new Set;for(let x of Object.values(e.vehicles)){n+=x.data_summary.trip_count,o+=x.data_summary.event_count;for(let k of x.events)k.startsWith("eventType:")&&k.replace("eventType:","").split(",").forEach(z=>l.add(z))}let d=e.metadata.total_vehicles,h=Array.from(l),O=`I've analyzed your data. Here's what I found:

`;O+=`\u2022 **${n} trips** across ${d} vehicles
`,O+=`\u2022 **${o} events**`,h.length>0&&(O+=` including: ${h.join(", ")}`),O+=`

What would you like to focus on in your analysis?`;let M=this.createAssistantMessage(t,O,{suggestedActions:[{id:"1",label:"Driver safety",action:"select",value:"focus:safety"},{id:"2",label:"Vehicle comparison",action:"select",value:"focus:comparison"},{id:"3",label:"Trip analysis",action:"select",value:"focus:trips"},{id:"4",label:"General overview",action:"select",value:"focus:overview"}],queryUpdate:{query:`Analyze ${n} trips and ${o} events for ${d} vehicles`,confidence:40,changes:["Data context received",`Identified ${o} events`]},dataInsights:{totalTrips:n,totalEvents:o,totalTelemetry:0,totalAlerts:0,eventTypesFound:h,suggestedFocusAreas:["Driver Safety","Speed Compliance","Vehicle Comparison"]}});this._messages.update(x=>[...x,M]),this._currentQuery.set(M.metadata?.queryUpdate?.query??""),this._queryConfidence.set(M.metadata?.queryUpdate?.confidence??0)}async apiStartSession(t,e=!1){let n={auth_token:this.authTokenManagerService.getAccessToken()??"",base_url:this.apiUrlService.getCurrentApiUrl(),context:{client_id:t.clientId,client_name:t.clientName,date_range:{start_date:t.dateRange.startDate,end_date:t.dateRange.endDate},vehicle_ids:t.vehicleIds,vehicle_names:t.vehicleNames}},o=await fe(this.http.post(`${this.chatApiBaseUrl()}/chat/sessions`,n)),l={id:o.session_id,createdAt:new Date(o.created_at),lastActivity:new Date(o.created_at),expiresAt:new Date(o.expires_at),status:o.status,context:t,currentQuery:this._currentQuery(),messageCount:e?this._messages().length:1};if(this._session.set(l),!e){let d=this.createAssistantMessage(o.session_id,o.initial_message.content,{suggestedActions:o.initial_message.suggested_actions.map(h=>({id:h.id,label:h.label,action:h.action,value:h.value}))});this._messages.set([d])}}async apiSendMessage(t,e){let n=this.buildMessageWithContext(e),o={auth_token:this.authTokenManagerService.getAccessToken()??"",base_url:this.apiUrlService.getCurrentApiUrl(),content:n},l=await fe(this.http.post(`${this.chatApiBaseUrl()}/chat/sessions/${t}/messages`,o)),d=this.createAssistantMessage(t,l.assistant_message.content,{suggestedActions:l.assistant_message.metadata.suggested_actions?.map(h=>({id:h.id,label:h.label,action:h.action,value:h.value})),queryUpdate:l.assistant_message.metadata.query_update?{query:l.assistant_message.metadata.query_update.query,confidence:l.assistant_message.metadata.query_update.confidence,changes:l.assistant_message.metadata.query_update.changes}:void 0,triggerDataCollection:l.assistant_message.metadata.trigger_data_collection?{dataTypes:l.assistant_message.metadata.trigger_data_collection.data_types}:void 0});this._messages.update(h=>[...h,d]),l.assistant_message.metadata.query_update&&(this._currentQuery.set(l.assistant_message.metadata.query_update.query),this._queryConfidence.set(l.assistant_message.metadata.query_update.confidence))}async apiSubmitContext(t,e){let n={auth_token:this.authTokenManagerService.getAccessToken()??"",base_url:this.apiUrlService.getCurrentApiUrl(),summarized_data:e},o=await fe(this.http.post(`${this.chatApiBaseUrl()}/chat/sessions/${t}/context`,n)),l=this.createAssistantMessage(t,o.assistant_message.content,{suggestedActions:o.assistant_message.metadata.suggested_actions.map(d=>({id:d.id,label:d.label,action:d.action,value:d.value})),queryUpdate:{query:o.assistant_message.metadata.query_update.query,confidence:o.assistant_message.metadata.query_update.confidence,changes:o.assistant_message.metadata.query_update.changes},dataInsights:{totalTrips:o.assistant_message.metadata.data_insights.total_trips,totalEvents:o.assistant_message.metadata.data_insights.total_events,totalTelemetry:o.assistant_message.metadata.data_insights.total_telemetry,totalAlerts:o.assistant_message.metadata.data_insights.total_alerts,eventTypesFound:o.assistant_message.metadata.data_insights.event_types_found,suggestedFocusAreas:o.assistant_message.metadata.data_insights.suggested_focus_areas}});this._messages.update(d=>[...d,l]),this._currentQuery.set(o.assistant_message.metadata.query_update.query),this._queryConfidence.set(o.assistant_message.metadata.query_update.confidence)}async apiEndSession(t){let e={auth_token:this.authTokenManagerService.getAccessToken()??"",base_url:this.apiUrlService.getCurrentApiUrl(),reason:"user_completed"};await fe(this.http.post(`${this.chatApiBaseUrl()}/chat/sessions/${t}/end`,e))}createUserMessage(t,e){return{id:this.generateId(),sessionId:t,sender:"user",content:e,timestamp:new Date,status:"sending"}}createAssistantMessage(t,e,n){return{id:this.generateId(),sessionId:t,sender:"assistant",content:e,timestamp:new Date,status:"delivered",metadata:n}}generateId(){return`${Date.now()}-${Math.random().toString(36).substring(2,9)}`}buildMessageWithContext(t){let e=this._dataCollectionStatus();if(!e.isCollecting||e.dataTypes.length===0)return t;let n=e.dataTypes.map(O=>O.charAt(0).toUpperCase()+O.slice(1)).join(", "),o=e.vehicleProgress??[],l=o.filter(O=>O.status==="complete").length,d=o.length,h="[SYSTEM CONTEXT: Data collection is currently in progress. ";return h+=`Collecting: ${n}. `,h+=`Progress: ${e.progress}% (${l}/${d} vehicles). `,e.currentVehicle!==void 0&&e.currentVehicle!==""&&(h+=`Currently processing: ${e.currentVehicle}. `),h+=`Do not suggest adding data types that are already being collected.]

`,h+t}delay(t){return new Promise(e=>setTimeout(e,t))}static \u0275fac=function(e){return new(e||i)};static \u0275prov=xe({token:i,factory:i.\u0275fac})};var Di=["messagesContainer"],Ti=()=>[],Ai=(i,t)=>t.id,Ei=(i,t)=>t.text;function Vi(i,t){i&1&&(a(0,"div",15),u(1,"i",16),a(2,"span"),c(3,"Active"),r()())}function Ii(i,t){if(i&1&&(a(0,"div",4)(1,"div",13),u(2,"i",14),a(3,"span"),c(4,"Report Query Builder"),r()(),g(5,Vi,4,0,"div",15),r()),i&2){let e=p();s(5),m(e.isSessionActive()?5:-1)}}function Ri(i,t){i&1&&(a(0,"div",6),u(1,"i",17),a(2,"span"),c(3,"Starting session..."),r()())}function zi(i,t){i&1&&(a(0,"div",7),u(1,"i",18),a(2,"p"),c(3," Please select a client from the sidebar to start building your report. "),r()())}function Ni(i,t){i&1&&(a(0,"div",6),u(1,"i",17),a(2,"span"),c(3,"Starting guided session..."),r()())}function qi(i,t){i&1&&(a(0,"div",7),u(1,"i",18),a(2,"p"),c(3," Please select a date range and at least one vehicle to start building your query. "),r()())}function Fi(i,t){if(i&1){let e=w();a(0,"div",8),u(1,"i",19),a(2,"p"),c(3,"Ready to start building your report query."),r(),a(4,"button",20),b("click",function(){_(e);let o=p();return C(o.startSession())}),a(5,"span",21),c(6,"Start Chat Session"),r()()()}}function $i(i,t){if(i&1){let e=w();a(0,"button",31),b("click",function(){let o=_(e).$implicit,l=p(3);return C(l.onPromptStarterClick(o))}),u(1,"i"),a(2,"span",32),c(3),r(),a(4,"span",33),c(5),r()()}if(i&2){let e=t.$implicit;s(),Oe(ke("pi ",e.icon," prompt-icon")),s(2),v(e.text),s(2),v(e.description)}}function Bi(i,t){if(i&1&&(a(0,"div",22)(1,"div",26),u(2,"i",27),a(3,"span"),c(4,"Get started with a suggestion:"),r()(),a(5,"div",28),A(6,$i,6,5,"button",29,Ei),r(),a(8,"p",30),c(9," Or type your own question below "),r()()),i&2){let e=p(2);s(6),E(e.promptStarters)}}function Li(i,t){if(i&1){let e=w();a(0,"app-chat-message",34),b("actionSelected",function(o){_(e);let l=p(2);return C(l.onActionSelected(o))})("multiActionsSelected",function(o){_(e);let l=p(2);return C(l.onMultiActionsSelected(o))})("dateRangeSelected",function(o){_(e);let l=p(2);return C(l.onDateRangeSelected(o))})("vehiclesSelected",function(o){_(e);let l=p(2);return C(l.onVehiclesSelected(o))})("dataTypesSelected",function(o){_(e);let l=p(2);return C(l.onDataTypesSelected(o))}),r()}if(i&2){let e=t.$implicit,n=p(2);y("message",e)("isDisabled",n.dataCollectionStatus().isCollecting)("collectingDataTypes",n.dataCollectionStatus().dataTypes)}}function Qi(i,t){i&1&&(a(0,"div",24)(1,"div",35),u(2,"span",36)(3,"span",36)(4,"span",36),r()())}function Ui(i,t){if(i&1&&(a(0,"span",39),c(1),r()),i&2){let e=p(3);s(),G(" ",e.completedVehiclesCount(),"/",e.dataCollectionStatus().vehicleProgress.length," vehicles ")}}function Hi(i,t){if(i&1&&(a(0,"div",41),c(1),r()),i&2){let e=p(3);s(),D(" ",e.dataCollectionStatus().statusMessage," ")}}function ji(i,t){if(i&1&&(a(0,"div",25)(1,"div",37),u(2,"i",17),a(3,"span",38),c(4,"Collecting data..."),r(),g(5,Ui,2,2,"span",39),r(),u(6,"p-progressBar",40),g(7,Hi,2,1,"div",41),r()),i&2){let e=p(2);s(5),m(e.dataCollectionStatus().vehicleProgress?5:-1),s(),y("value",e.dataCollectionStatus().progress)("showValue",!0),s(),m(e.dataCollectionStatus().statusMessage?7:-1)}}function Gi(i,t){if(i&1&&(g(0,Bi,10,0,"div",22),A(1,Li,1,3,"app-chat-message",23,Ai),g(3,Qi,5,0,"div",24),g(4,ji,8,4,"div",25)),i&2){let e=p();m(e.showPromptStarters()?0:-1),s(),E(e.messages()),s(2),m(e.isTyping()?3:-1),s(),m(e.dataCollectionStatus().isCollecting?4:-1)}}function Wi(i,t){if(i&1&&(a(0,"div",9),u(1,"i",42),a(2,"span"),c(3),r()()),i&2){let e=p();s(3),v(e.error())}}function Yi(i,t){if(i&1){let e=w();a(0,"app-chat-input",43),b("messageSent",function(o){_(e);let l=p();return C(l.onSendMessage(o))}),r()}if(i&2){let e=p();y("disabled",!e.isSessionActive())("isLoading",e.isTyping())}}function Ki(i,t){if(i&1){let e=w();a(0,"div",11)(1,"button",44),b("click",function(){_(e);let o=p();return C(o.onGenerateReport())}),a(2,"span",21),c(3,"Generate Report"),r()()()}}function Zi(i,t){if(i&1&&(a(0,"div",12),u(1,"app-query-preview",45),r()),i&2){let e=p();s(),y("query",e.currentQuery())("confidence",e.queryConfidence())("changes",e.queryChanges())("isLoading",e.isTyping())("isCollecting",e.dataCollectionStatus().isCollecting)("collectionProgress",e.dataCollectionStatus().progress)("collectedData",e.collectedDataSummary())("dataTypes",e.dataCollectionStatus().dataTypes)("statusMessage",e.dataCollectionStatus().statusMessage??"")("currentVehicle",e.dataCollectionStatus().currentVehicle??"")("vehicleProgress",e.dataCollectionStatus().vehicleProgress??yt(11,Ti))}}var st=class i{chatSessionService=Q(ze);dateRange=S(null);selectedVehicles=S([]);clientInfo=S(null);fullWidthMode=S(!1);guidedMode=S(!1);availableVehiclesForSelection=S([]);generateReport=q();dataCollectionTriggered=q();queryUpdated=q();confidenceUpdated=q();dateRangeSelected=q();vehiclesSelected=q();dataTypesSelected=q();messagesContainer;chatInput;messages=this.chatSessionService.messages;isTyping=this.chatSessionService.isTyping;isConnecting=this.chatSessionService.isConnecting;currentQuery=this.chatSessionService.currentQuery;queryConfidence=this.chatSessionService.queryConfidence;error=this.chatSessionService.error;session=this.chatSessionService.session;dataCollectionStatus=this.chatSessionService.dataCollectionStatus;formDateRange=this.chatSessionService.formDateRange;formSelectedVehicles=this.chatSessionService.formSelectedVehicles;formSelectedDataTypes=this.chatSessionService.formSelectedDataTypes;conversationPhase=this.chatSessionService.conversationPhase;canStartSession=f(()=>{let t=this.dateRange(),e=this.selectedVehicles(),n=this.clientInfo();return t!==null&&e.length>0&&n!==null});canStartGuidedSession=f(()=>this.clientInfo()!==null);isSessionActive=f(()=>this.session()?.status==="active");canGenerateReport=f(()=>this.currentQuery().length>0&&this.queryConfidence()>=50);queryChanges=f(()=>{let t=this.messages();for(let e=t.length-1;e>=0;e--){let n=t[e].metadata?.queryUpdate?.changes;if(n&&n.length>0)return n}return[]});collectedDataSummary=f(()=>this.dataCollectionStatus().collectedData);completedVehiclesCount=f(()=>{let t=this.dataCollectionStatus().vehicleProgress;return t?t.filter(e=>e.status==="complete").length:0});promptStarters=[{icon:"pi-shield",text:"Analyze driver safety scores",description:"Review speeding, harsh braking, and acceleration events"},{icon:"pi-chart-line",text:"Show fuel efficiency trends",description:"Compare consumption patterns across vehicles"},{icon:"pi-car",text:"Compare vehicle utilization",description:"Identify underused or overworked assets"},{icon:"pi-exclamation-triangle",text:"Highlight maintenance alerts",description:"Find vehicles needing attention"}];showPromptStarters=f(()=>this.isSessionActive()&&this.messages().length===0&&!this.isTyping());sessionStarted=!1;viewInitialized=!1;constructor(){de(()=>{let t=this.messages().length,e=this.isTyping(),n=this.dataCollectionStatus().isCollecting,o=this.isSessionActive();this.viewInitialized&&(t>0||e||n||o)&&setTimeout(()=>this.scrollToBottom(),50)}),de(()=>{let t=this.guidedMode(),e=this.canStartGuidedSession(),n=this.isSessionActive(),o=this.isConnecting();t&&e&&!n&&!o&&!this.sessionStarted&&(this.sessionStarted=!0,this.startGuidedSession())}),de(()=>{let t=this.availableVehiclesForSelection();t.length>0&&this.chatSessionService.setAvailableVehicles(t.map(e=>({id:e.id,name:e.name})))}),de(()=>{let t=this.currentQuery();t&&this.queryUpdated.emit(t)}),de(()=>{let t=this.queryConfidence();this.confidenceUpdated.emit(t)})}ngAfterViewInit(){this.viewInitialized=!0,this.messages().length>0&&this.scrollToBottom()}ngOnDestroy(){this.chatSessionService.endSession()}async startSession(){let t=this.dateRange(),e=this.selectedVehicles(),n=this.clientInfo();if(!t||e.length===0||!n)return;let o={clientId:n.id,clientName:n.name,dateRange:{startDate:t.start.toISOString(),endDate:t.end.toISOString()},vehicleIds:e.map(l=>l.id),vehicleNames:e.map(l=>l.name)};try{await this.chatSessionService.startSession(o),this.focusInput()}catch(l){console.error("Failed to start chat session:",l)}}async onSendMessage(t){try{await this.chatSessionService.sendMessage(t);let n=this.messages()[this.messages().length-1]?.metadata?.triggerDataCollection;n&&n.dataTypes.length>0&&this.dataCollectionTriggered.emit(n.dataTypes)}catch(e){console.error("Failed to send message:",e)}}async onActionSelected(t){if(t.value==="generate"||t.value==="generate_report"){this.onGenerateReport();return}await this.onSendMessage(t.label)}async onMultiActionsSelected(t){if(t.length===0)return;let e=t.map(l=>l.value.toLowerCase()).filter(l=>["trips","events","telemetry","alerts"].includes(l)),n=t.filter(l=>!["trips","events","telemetry","alerts"].includes(l.value.toLowerCase()));e.length>0&&this.dataCollectionTriggered.emit(e);let o=t.map(l=>l.label).join(", ");e.length>0&&n.length===0?await this.onSendMessage(`I'd like to include: ${o}`):e.length===0&&n.length>0?await this.onSendMessage(`I want to: ${o}`):await this.onSendMessage(`Selected options: ${o}`)}async onPromptStarterClick(t){await this.onSendMessage(t.text)}onGenerateReport(){let t=this.currentQuery();t&&this.generateReport.emit(t)}async submitDataContext(t){try{let e=0,n=0,o=0,l=0;for(let h of Object.values(t.vehicles))e+=h.data_summary.trip_count,n+=h.data_summary.event_count,o+=h.data_summary.telemetry_count,l+=h.data_summary.alert_count;let d={trips:e,events:n,telemetry:o,alerts:l};this.chatSessionService.setDataCollectionComplete(d),await this.chatSessionService.submitDataContext(t)}catch(e){console.error("Failed to submit data context:",e)}}updateCollectionProgress(t){this.chatSessionService.updateDataCollectionProgress(t)}startDataCollection(t){let e=this.selectedVehicles().map(n=>({id:n.id,name:n.name}));this.chatSessionService.setDataCollectionStarted(t,e)}focusInput(){setTimeout(()=>{this.chatInput?.focus()},100)}scrollToBottom(){requestAnimationFrame(()=>{requestAnimationFrame(()=>{let t=this.messagesContainer?.nativeElement;if(this.fullWidthMode()&&t!=null){let e=t.closest(".chat-area");e!=null&&(t=e)}t?.scrollTo({top:t.scrollHeight,behavior:"smooth"})})})}clearSession(){this.chatSessionService.endSession(),this.sessionStarted=!1}async startGuidedSession(){let t=this.clientInfo();if(t)try{let e=this.availableVehiclesForSelection();e.length>0&&this.chatSessionService.setAvailableVehicles(e.map(n=>({id:n.id,name:n.name}))),await this.chatSessionService.startGuidedSession(t.id,t.name),this.focusInput()}catch(e){console.error("Failed to start guided session:",e)}}onDateRangeSelected(t){this.chatSessionService.setDateRange(t.start,t.end),this.dateRangeSelected.emit(t)}onVehiclesSelected(t){this.chatSessionService.setSelectedVehicles(t),this.vehiclesSelected.emit(t)}onDataTypesSelected(t){let e=t.filter(n=>["trips","events","telemetry","alerts"].includes(n));this.chatSessionService.setSelectedDataTypes(e),this.dataTypesSelected.emit(t),e.length>0&&this.dataCollectionTriggered.emit(e)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-query-chat"]],viewQuery:function(e,n){if(e&1&&(Y(Di,5),Y(Re,5)),e&2){let o;K(o=Z())&&(n.messagesContainer=o.first),K(o=Z())&&(n.chatInput=o.first)}},inputs:{dateRange:[1,"dateRange"],selectedVehicles:[1,"selectedVehicles"],clientInfo:[1,"clientInfo"],fullWidthMode:[1,"fullWidthMode"],guidedMode:[1,"guidedMode"],availableVehiclesForSelection:[1,"availableVehiclesForSelection"]},outputs:{generateReport:"generateReport",dataCollectionTriggered:"dataCollectionTriggered",queryUpdated:"queryUpdated",confidenceUpdated:"confidenceUpdated",dateRangeSelected:"dateRangeSelected",vehiclesSelected:"vehiclesSelected",dataTypesSelected:"dataTypesSelected"},features:[Ct([ze])],decls:16,vars:8,consts:[["messagesContainer",""],[1,"query-chat-container"],[1,"chat-layout"],[1,"chat-panel"],[1,"chat-header"],[1,"messages-area"],[1,"connecting-state"],[1,"setup-required"],[1,"start-session"],[1,"error-banner"],["placeholder","Type your message or select a suggestion...",3,"disabled","isLoading"],[1,"generate-button-container"],[1,"preview-panel"],[1,"header-info"],[1,"pi","pi-comments"],[1,"session-status","active"],[1,"pi","pi-circle-fill"],[1,"pi","pi-spin","pi-spinner"],[1,"pi","pi-info-circle"],[1,"pi","pi-play-circle"],["pButton","","type","button","label","Start Chat Session","icon","pi pi-comments",1,"p-button-primary",3,"click"],[1,"p-button-label"],[1,"prompt-starters"],[3,"message","isDisabled","collectingDataTypes"],[1,"typing-indicator"],[1,"collection-progress-inline"],[1,"prompt-starters-header"],[1,"pi","pi-lightbulb"],[1,"prompt-starters-grid"],["type","button",1,"prompt-starter-card"],[1,"prompt-starters-hint"],["type","button",1,"prompt-starter-card",3,"click"],[1,"prompt-text"],[1,"prompt-description"],[3,"actionSelected","multiActionsSelected","dateRangeSelected","vehiclesSelected","dataTypesSelected","message","isDisabled","collectingDataTypes"],[1,"typing-bubble"],[1,"dot"],[1,"progress-header"],[1,"progress-title"],[1,"progress-count"],["styleClass","inline-progress-bar",3,"value","showValue"],[1,"progress-detail"],[1,"pi","pi-exclamation-triangle"],["placeholder","Type your message or select a suggestion...",3,"messageSent","disabled","isLoading"],["pButton","","type","button","label","Generate Report","icon","pi pi-chart-bar",1,"p-button-success","generate-button",3,"click"],[3,"query","confidence","changes","isLoading","isCollecting","collectionProgress","collectedData","dataTypes","statusMessage","currentVehicle","vehicleProgress"]],template:function(e,n){e&1&&(a(0,"div",1)(1,"div",2)(2,"div",3),g(3,Ii,6,1,"div",4),a(4,"div",5,0),g(6,Ri,4,0,"div",6)(7,zi,4,0,"div",7)(8,Ni,4,0,"div",6)(9,qi,4,0,"div",7)(10,Fi,7,0,"div",8)(11,Gi,5,3),r(),g(12,Wi,4,1,"div",9),g(13,Yi,1,2,"app-chat-input",10),g(14,Ki,4,0,"div",11),r(),g(15,Zi,2,12,"div",12),r()()),e&2&&(U("full-width-mode",n.fullWidthMode()),s(3),m(n.fullWidthMode()?-1:3),s(3),m(n.isConnecting()?6:!n.isSessionActive()&&n.guidedMode()&&!n.canStartGuidedSession()?7:!n.isSessionActive()&&n.guidedMode()&&n.canStartGuidedSession()?8:!n.isSessionActive()&&!n.guidedMode()&&!n.canStartSession()?9:!n.isSessionActive()&&!n.guidedMode()&&n.canStartSession()?10:11),s(6),m(n.error()?12:-1),s(),m(n.isSessionActive()?13:-1),s(),m(n.canGenerateReport()&&!n.fullWidthMode()?14:-1),s(),m(n.fullWidthMode()?-1:15))},dependencies:[R,W,Be,De,Ae,Te,at,Re,rt],styles:[`@charset "UTF-8";[_nghost-%COMP%]{display:block;height:100%}.query-chat-container[_ngcontent-%COMP%]{height:100%;min-height:500px}.query-chat-container.full-width-mode[_ngcontent-%COMP%]   .chat-layout[_ngcontent-%COMP%]{grid-template-columns:1fr}.query-chat-container.full-width-mode[_ngcontent-%COMP%]   .chat-panel[_ngcontent-%COMP%]{border:none;border-radius:0;background-color:transparent}.query-chat-container.full-width-mode[_ngcontent-%COMP%]   .messages-area[_ngcontent-%COMP%]{background-color:transparent;background-image:none}.query-chat-container.full-width-mode[_ngcontent-%COMP%]   app-chat-input[_ngcontent-%COMP%]{position:sticky;bottom:0;z-index:10;margin:0 .75rem .75rem}.query-chat-container.full-width-mode[_ngcontent-%COMP%]   app-chat-input[_ngcontent-%COMP%]     .chat-input-container{background-color:var(--card-background-color, #ffffff);border:1px solid var(--input-border-color, #e2e8f0);border-radius:1.5rem;box-shadow:0 4px 12px #0000001a;padding:.5rem .75rem}.query-chat-container.full-width-mode[_ngcontent-%COMP%]   app-chat-input[_ngcontent-%COMP%]     .chat-textarea{background-color:var(--input-background-color, #ffffff)!important;border:none!important;box-shadow:none!important;color:var(--input-font-color, #1e293b)}.query-chat-container.full-width-mode[_ngcontent-%COMP%]   app-chat-input[_ngcontent-%COMP%]     .chat-textarea:focus{box-shadow:none!important;border:none!important}.query-chat-container.full-width-mode[_ngcontent-%COMP%]   app-chat-input[_ngcontent-%COMP%]     .chat-textarea::placeholder{color:var(--input-placeholder-color, #64748b)}.query-chat-container.full-width-mode[_ngcontent-%COMP%]   app-chat-input[_ngcontent-%COMP%]     .send-button{background:var(--color-primary-color, #3b82f6)!important}.chat-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;gap:1rem;height:100%}@media(max-width:1024px){.chat-layout[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-template-rows:1fr auto}}.chat-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;background-color:var(--card-background-color, #ffffff);border:1px solid var(--input-border-color, #e5e7eb);border-radius:.5rem;overflow:hidden;min-height:400px}.chat-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.875rem 1rem;background:var(--color-primary-color, linear-gradient(135deg, #1e40af 0%, #3b82f6 100%));color:var(--color-primary-contrast, #ffffff)}.header-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-weight:600;font-size:.9375rem}.header-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.125rem}.session-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;font-size:.75rem;padding:.25rem .625rem;border-radius:9999px;background-color:#fff3}.session-status.active[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#4ade80;font-size:.5rem}.messages-area[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1rem 0;background-color:var(--surface-ground, #f3f4f6);background-image:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23e5e7eb' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")}.connecting-state[_ngcontent-%COMP%], .setup-required[_ngcontent-%COMP%], .start-session[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center;color:var(--text-color-secondary, #6b7280)}.connecting-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .setup-required[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .start-session[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:1rem;opacity:.6}.connecting-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .setup-required[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .start-session[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:.9375rem;max-width:300px}.prompt-starters[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:1.5rem}.prompt-starters-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.9375rem;font-weight:500;color:var(--text-color, #374151);margin-bottom:1rem}.prompt-starters-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#f59e0b;font-size:1.125rem}.prompt-starters-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:.75rem;width:100%;max-width:500px}.prompt-starter-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;gap:.375rem;padding:.875rem;background-color:var(--card-background-color, #ffffff);border:1px solid var(--input-border-color, #e5e7eb);border-radius:.5rem;cursor:pointer;transition:all .15s ease;text-align:left}.prompt-starter-card[_ngcontent-%COMP%]:hover{border-color:var(--color-primary-color, #3b82f6);background-color:rgba(var(--color-primary-rgb, 59, 130, 246),.05);transform:translateY(-1px);box-shadow:0 2px 8px rgba(var(--color-primary-rgb, 59, 130, 246),.15)}.prompt-starter-card[_ngcontent-%COMP%]   .prompt-icon[_ngcontent-%COMP%]{font-size:1.125rem;color:var(--color-primary-color, #3b82f6)}.prompt-starter-card[_ngcontent-%COMP%]   .prompt-text[_ngcontent-%COMP%]{font-size:.8125rem;font-weight:600;color:var(--text-color, #1f2937);line-height:1.3}.prompt-starter-card[_ngcontent-%COMP%]   .prompt-description[_ngcontent-%COMP%]{font-size:.6875rem;color:var(--text-color-secondary, #6b7280);line-height:1.3}.prompt-starters-hint[_ngcontent-%COMP%]{margin:1rem 0 0;font-size:.75rem;color:var(--text-color-secondary, #9ca3af)}.connecting-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--color-primary-color, #3b82f6)}.typing-indicator[_ngcontent-%COMP%]{display:flex;padding:0 .75rem;margin-bottom:.75rem}.typing-bubble[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem;padding:.75rem 1rem;background-color:var(--card-background-color, #ffffff);border-radius:1rem 1rem 1rem .25rem;box-shadow:0 1px 2px #00000014}.dot[_ngcontent-%COMP%]{width:.5rem;height:.5rem;background-color:var(--text-color-secondary, #9ca3af);border-radius:50%;animation:_ngcontent-%COMP%_typing 1.4s infinite ease-in-out}.dot[_ngcontent-%COMP%]:nth-child(1){animation-delay:0s}.dot[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.dot[_ngcontent-%COMP%]:nth-child(3){animation-delay:.4s}@keyframes _ngcontent-%COMP%_typing{0%,60%,to{transform:translateY(0);opacity:.4}30%{transform:translateY(-.375rem);opacity:1}}.collection-progress-inline[_ngcontent-%COMP%]{margin:.75rem;padding:.75rem 1rem;background-color:var(--card-background-color, #ffffff);border-radius:.5rem;box-shadow:0 1px 2px #00000014}.collection-progress-inline[_ngcontent-%COMP%]     .inline-progress-bar{height:.5rem;border-radius:.25rem}.progress-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem;font-size:.875rem;color:var(--color-primary-color, #3b82f6)}.progress-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.progress-title[_ngcontent-%COMP%]{flex:1;font-weight:500}.progress-count[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-color-secondary, #6b7280);font-weight:600}.progress-detail[_ngcontent-%COMP%]{margin-top:.5rem;font-size:.75rem;color:#059669;display:flex;align-items:center;gap:.25rem}.progress-detail[_ngcontent-%COMP%]:before{content:"\\2192";opacity:.6}.progress-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem;font-size:.875rem;color:var(--color-primary-color, #3b82f6)}.progress-message[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.error-banner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;background-color:#fef2f2;border-top:1px solid #fecaca;color:#991b1b;font-size:.875rem}.error-banner[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.generate-button-container[_ngcontent-%COMP%]{padding:.75rem 1rem;background-color:var(--surface-ground, #f9fafb);border-top:1px solid var(--input-border-color, #e5e7eb)}.generate-button[_ngcontent-%COMP%]{width:100%;justify-content:center;font-weight:600}@media(max-width:1024px){.preview-panel[_ngcontent-%COMP%]{max-height:300px}}`]})};var Ji=["vehiclePanel"],Xi=["datePanel"],ea=["dataTypesPanel"],Jt=(i,t)=>t.id;function ta(i,t){if(i&1&&(a(0,"div",16)(1,"span",35),c(2),r(),a(3,"span",36),c(4),r()()),i&2){let e=p();L("data-level",e.confidenceLevel()),s(2),D("",e.summary().queryConfidence,"%"),s(2),v(e.confidenceLabel())}}function na(i,t){if(i&1){let e=w();a(0,"div",37),b("click",function(){let o=_(e).$implicit,l=p();return C(l.toggleVehicle(o.id))}),a(1,"p-checkbox",38),b("ngModelChange",function(){let o=_(e).$implicit,l=p();return C(l.toggleVehicle(o.id))}),r(),a(2,"label",39),c(3),r()()}if(i&2){let e=t.$implicit,n=p();s(),y("ngModel",n.isVehicleSelected(e.id))("binary",!0)("inputId","vehicle-"+e.id),s(),y("for","vehicle-"+e.id),s(),D(" ",e.name," ")}}function oa(i,t){i&1&&(a(0,"div",29),c(1,"No vehicles available"),r())}function ia(i,t){i&1&&u(0,"i",41)}function aa(i,t){if(i&1){let e=w();a(0,"p-checkbox",46),b("ngModelChange",function(){_(e);let o=p().$implicit,l=p();return C(l.toggleDataType(o.id))}),r()}if(i&2){let e=p().$implicit,n=p();y("ngModel",n.isDataTypeSelected(e.id))("binary",!0)("inputId","datatype-"+e.id)("disabled",n.isDataTypeCollecting(e.id))}}function ra(i,t){i&1&&c(0," Collecting... ")}function sa(i,t){if(i&1&&c(0),i&2){let e=p().$implicit;D(" ",e.description," ")}}function la(i,t){if(i&1){let e=w();a(0,"div",40),b("click",function(){let o=_(e).$implicit,l=p();return C(l.toggleDataType(o.id))}),g(1,ia,1,0,"i",41)(2,aa,1,4,"p-checkbox",42),a(3,"div",43)(4,"label",44),u(5,"i"),c(6),r(),a(7,"span",45),g(8,ra,1,0)(9,sa,1,1),r()()()}if(i&2){let e=t.$implicit,n=p();U("collecting",n.isDataTypeCollecting(e.id))("selected",n.isDataTypeSelected(e.id)),s(),m(n.isDataTypeCollecting(e.id)?1:2),s(3),y("for","datatype-"+e.id),s(),Oe(ke("pi ",e.icon)),s(),D(" ",e.label," "),s(2),m(n.isDataTypeCollecting(e.id)?8:9)}}var ca=[{id:"trips",label:"Trips",description:"Journey data with start/end locations",icon:"pi-map-marker"},{id:"events",label:"Events",description:"Driver behavior events",icon:"pi-exclamation-triangle"},{id:"telemetry",label:"Telemetry",description:"Real-time sensor data",icon:"pi-chart-line"},{id:"alerts",label:"Alerts",description:"System alerts and notifications",icon:"pi-bell"}],lt=class i{vehiclePanel;datePanel;dataTypesPanel;summary=S.required();availableVehicles=S([]);selectedVehicleIds=S([]);collectingDataTypes=S([]);dateRangeClicked=q();vehiclesChanged=q();dateRangeChanged=q();dataTypesClicked=q();dataTypesChanged=q();localSelectedIds=P(new Set);localDateRange=P(null);localSelectedDataTypes=P(new Set);today=new Date;hasDateRange=f(()=>this.summary().dateRange!==null);dateRangeText=f(()=>{let t=this.summary().dateRange;if(!t)return"Not selected";let e=l=>l.toLocaleDateString("en-US",{month:"short",day:"numeric"}),n=e(t.start),o=e(t.end);return n===o?n:`${n} - ${o}`});vehicleText=f(()=>{let t=this.summary().vehicleCount;return t===0?"None selected":t===1?this.summary().vehicleNames[0]||"1 vehicle":t<=2?this.summary().vehicleNames.join(", "):`${t} vehicles`});dataTypesText=f(()=>{let t=this.summary().dataTypes;return t.length===0?"None":t.map(e=>this.capitalizeFirst(e)).join(", ")});confidenceLevel=f(()=>{let t=this.summary().queryConfidence;return t>=90?"high":t>=70?"medium":t>=50?"building":"low"});confidenceLabel=f(()=>{switch(this.confidenceLevel()){case"high":return"Ready";case"medium":return"Good";case"building":return"Building";default:return"Starting"}});showConfidence=f(()=>this.summary().currentQuery.length>0);capitalizeFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}localVehicleOptions=f(()=>{let t=this.availableVehicles(),e=this.localSelectedIds();return t.map(n=>F(V({},n),{selected:e.has(n.id)}))});onDateClick(t){this.datePanel?.toggle(t)}onVehicleClick(t){this.vehiclePanel?.toggle(t)}toggleVehicle(t){this.localSelectedIds.update(e=>{let n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n})}isVehicleSelected(t){return this.localSelectedIds().has(t)}applyVehicleChanges(){let t=Array.from(this.localSelectedIds());this.vehiclesChanged.emit(t),this.vehiclePanel?.hide()}cancelVehicleChanges(){let t=this.selectedVehicleIds();this.localSelectedIds.set(new Set(t)),this.vehiclePanel?.hide()}onDateRangeSelect(t){}applyDateChanges(){let t=this.localDateRange();t!==null&&t.length===2&&t[0]!==void 0&&t[1]!==void 0&&this.dateRangeChanged.emit({start:t[0],end:t[1]}),this.datePanel?.hide()}cancelDateChanges(){let t=this.summary().dateRange;t?this.localDateRange.set([t.start,t.end]):this.localDateRange.set(null),this.datePanel?.hide()}availableDataTypeOptions=f(()=>ca);isDataTypeCollecting(t){return this.collectingDataTypes().includes(t)}isDataTypeSelected(t){return this.localSelectedDataTypes().has(t)}hasCollectingDataTypes=f(()=>this.collectingDataTypes().length>0);newDataTypeSelectionCount=f(()=>{let t=this.localSelectedDataTypes(),e=new Set(this.collectingDataTypes()),n=new Set(this.summary().dataTypes);return Array.from(t).filter(o=>!e.has(o)&&!n.has(o)).length});onDataTypesClick(t){this.dataTypesPanel?.toggle(t)}toggleDataType(t){this.isDataTypeCollecting(t)||this.localSelectedDataTypes.update(e=>{let n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n})}applyDataTypeChanges(){let t=new Set(this.collectingDataTypes()),e=new Set(this.summary().dataTypes),n=Array.from(this.localSelectedDataTypes()).filter(o=>!t.has(o)&&!e.has(o));n.length>0&&this.dataTypesChanged.emit(n),this.dataTypesPanel?.hide()}cancelDataTypeChanges(){let t=this.summary().dataTypes,e=this.collectingDataTypes(),n=new Set([...t,...e]);this.localSelectedDataTypes.set(n),this.dataTypesPanel?.hide()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-chat-summary-header"]],viewQuery:function(e,n){if(e&1&&(Y(Ji,5),Y(Xi,5),Y(ea,5)),e&2){let o;K(o=Z())&&(n.vehiclePanel=o.first),K(o=Z())&&(n.datePanel=o.first),K(o=Z())&&(n.dataTypesPanel=o.first)}},inputs:{summary:[1,"summary"],availableVehicles:[1,"availableVehicles"],selectedVehicleIds:[1,"selectedVehicleIds"],collectingDataTypes:[1,"collectingDataTypes"]},outputs:{dateRangeClicked:"dateRangeClicked",vehiclesChanged:"vehiclesChanged",dateRangeChanged:"dateRangeChanged",dataTypesClicked:"dataTypesClicked",dataTypesChanged:"dataTypesChanged"},decls:63,vars:24,consts:[["datePanel",""],["vehiclePanel",""],["dataTypesPanel",""],[1,"chat-summary-header"],[1,"header-content"],[1,"header-title"],[1,"pi","pi-chart-bar"],[1,"summary-items"],["type","button","title","Click to change date range",1,"summary-item","clickable",3,"click"],[1,"pi","pi-calendar"],[1,"summary-value"],[1,"pi","pi-chevron-down","edit-icon"],["type","button","title","Click to edit vehicle selection",1,"summary-item","clickable",3,"click"],[1,"pi","pi-car"],["type","button","title","Click to edit data types",1,"summary-item","clickable",3,"click"],[1,"pi","pi-database"],[1,"confidence-badge"],["styleClass","header-edit-panel date-panel"],[1,"panel-content"],[1,"panel-header"],[1,"panel-body"],["selectionMode","range","dateFormat","M d",3,"ngModelChange","onSelect","ngModel","inline","showButtonBar","numberOfMonths","maxDate"],[1,"panel-footer"],["label","Cancel","severity","secondary","size","small",3,"onClick","text"],["label","Apply","severity","primary","size","small",3,"onClick"],["styleClass","header-edit-panel vehicle-panel"],[1,"selection-count"],[1,"panel-body","vehicle-list"],[1,"vehicle-item"],[1,"empty-state"],["label","Apply","severity","primary","size","small",3,"onClick","disabled"],["styleClass","header-edit-panel data-types-panel"],[1,"panel-body","data-types-list"],[1,"data-type-item",3,"collecting","selected"],["severity","primary","size","small",3,"onClick","label","disabled"],[1,"confidence-value"],[1,"confidence-label"],[1,"vehicle-item",3,"click"],[3,"ngModelChange","ngModel","binary","inputId"],[1,"vehicle-name",3,"for"],[1,"data-type-item",3,"click"],[1,"pi","pi-spin","pi-spinner","collecting-icon"],[3,"ngModel","binary","inputId","disabled"],[1,"data-type-info"],[1,"data-type-name",3,"for"],[1,"data-type-description"],[3,"ngModelChange","ngModel","binary","inputId","disabled"]],template:function(e,n){if(e&1){let o=w();a(0,"header",3)(1,"div",4)(2,"div",5),u(3,"i",6),a(4,"span"),c(5,"Report Builder"),r()(),a(6,"div",7)(7,"button",8),b("click",function(d){return _(o),C(n.onDateClick(d))}),u(8,"i",9),a(9,"span",10),c(10),r(),u(11,"i",11),r(),a(12,"button",12),b("click",function(d){return _(o),C(n.onVehicleClick(d))}),u(13,"i",13),a(14,"span",10),c(15),r(),u(16,"i",11),r(),a(17,"button",14),b("click",function(d){return _(o),C(n.onDataTypesClick(d))}),u(18,"i",15),a(19,"span",10),c(20),r(),u(21,"i",11),r()(),g(22,ta,5,3,"div",16),r()(),a(23,"p-popover",17,0)(25,"div",18)(26,"div",19)(27,"h4"),c(28,"Change Date Range"),r()(),a(29,"div",20)(30,"p-datepicker",21),ye("ngModelChange",function(d){return _(o),Ce(n.localDateRange,d)||(n.localDateRange=d),C(d)}),b("onSelect",function(d){return _(o),C(n.onDateRangeSelect(d))}),r()(),a(31,"div",22)(32,"p-button",23),b("onClick",function(){return _(o),C(n.cancelDateChanges())}),r(),a(33,"p-button",24),b("onClick",function(){return _(o),C(n.applyDateChanges())}),r()()()(),a(34,"p-popover",25,1)(36,"div",18)(37,"div",19)(38,"h4"),c(39,"Select Vehicles"),r(),a(40,"span",26),c(41),r()(),a(42,"div",27),A(43,na,4,5,"div",28,Jt,!1,oa,2,0,"div",29),r(),a(46,"div",22)(47,"p-button",23),b("onClick",function(){return _(o),C(n.cancelVehicleChanges())}),r(),a(48,"p-button",30),b("onClick",function(){return _(o),C(n.applyVehicleChanges())}),r()()()(),a(49,"p-popover",31,2)(51,"div",18)(52,"div",19)(53,"h4"),c(54,"Select Data Types"),r(),a(55,"span",26),c(56),r()(),a(57,"div",32),A(58,la,10,11,"div",33,Jt),r(),a(60,"div",22)(61,"p-button",23),b("onClick",function(){return _(o),C(n.cancelDataTypeChanges())}),r(),a(62,"p-button",34),b("onClick",function(){return _(o),C(n.applyDataTypeChanges())}),r()()()()}e&2&&(s(7),U("empty",!n.hasDateRange()),s(3),v(n.dateRangeText()),s(2),U("empty",n.summary().vehicleCount===0),s(3),v(n.vehicleText()),s(2),U("empty",n.summary().dataTypes.length===0),s(3),v(n.dataTypesText()),s(2),m(n.showConfidence()?22:-1),s(8),_e("ngModel",n.localDateRange),y("inline",!0)("showButtonBar",!1)("numberOfMonths",1)("maxDate",n.today),s(2),y("text",!0),s(9),D("",n.localSelectedIds().size," selected"),s(2),E(n.localVehicleOptions()),s(4),y("text",!0),s(),y("disabled",n.localSelectedIds().size===0),s(8),D("",n.newDataTypeSelectionCount()," to add"),s(2),E(n.availableDataTypeOptions()),s(3),y("text",!0),s(),y("label",n.hasCollectingDataTypes()?"Add to Collection":"Apply")("disabled",n.newDataTypeSelectionCount()===0))},dependencies:[R,jt,Ht,He,Nt,W,ie,ee,ge,me,Se,je],styles:["[_nghost-%COMP%]{display:block}.chat-summary-header[_ngcontent-%COMP%]{background:var(--color-primary-color, linear-gradient(135deg, #1e40af 0%, #3b82f6 100%));color:var(--color-primary-contrast, #ffffff);padding:.75rem 1rem;border-bottom:1px solid rgba(255,255,255,.1)}.header-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}.header-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-weight:600;font-size:1rem;white-space:nowrap}.header-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.125rem}.summary-items[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;flex:1;flex-wrap:wrap}.summary-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;padding:.25rem .625rem;background-color:#ffffff26;border-radius:9999px;font-size:.75rem;white-space:nowrap;border:none;color:inherit;font-family:inherit}.summary-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem;opacity:.9}.summary-item[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{font-weight:500}.summary-item[_ngcontent-%COMP%]   .edit-icon[_ngcontent-%COMP%]{font-size:.625rem;opacity:0;transition:opacity .2s ease;margin-left:.125rem}.summary-item.empty[_ngcontent-%COMP%]{opacity:.6;background-color:#ffffff14}.summary-item.clickable[_ngcontent-%COMP%]{cursor:pointer;transition:background-color .2s ease,transform .15s ease}.summary-item.clickable[_ngcontent-%COMP%]:hover{background-color:#ffffff40}.summary-item.clickable[_ngcontent-%COMP%]:hover   .edit-icon[_ngcontent-%COMP%]{opacity:1}.summary-item.clickable[_ngcontent-%COMP%]:active{transform:scale(.97)}.summary-item.clickable[_ngcontent-%COMP%]:focus{outline:2px solid rgba(255,255,255,.5);outline-offset:2px}.confidence-badge[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:.25rem .625rem;border-radius:.375rem;font-size:.75rem;margin-left:auto}.confidence-badge[data-level=high][_ngcontent-%COMP%]{background-color:#22c55e33;color:#bbf7d0}.confidence-badge[data-level=medium][_ngcontent-%COMP%]{background-color:#eab30833;color:#fef08a}.confidence-badge[data-level=building][_ngcontent-%COMP%]{background-color:#3b82f633;color:#bfdbfe}.confidence-badge[data-level=low][_ngcontent-%COMP%]{background-color:#ffffff1a;color:#ffffffb3}.confidence-badge[_ngcontent-%COMP%]   .confidence-value[_ngcontent-%COMP%]{font-weight:700;font-size:.875rem;line-height:1}.confidence-badge[_ngcontent-%COMP%]   .confidence-label[_ngcontent-%COMP%]{font-size:.5625rem;text-transform:uppercase;letter-spacing:.025em;opacity:.9}@media(max-width:640px){.header-content[_ngcontent-%COMP%]{gap:.5rem}.header-title[_ngcontent-%COMP%]{font-size:.875rem}.summary-items[_ngcontent-%COMP%]{gap:.5rem}.summary-item[_ngcontent-%COMP%]{font-size:.6875rem;padding:.1875rem .5rem}}  .header-edit-panel .p-popover-content{padding:0}  .header-edit-panel .panel-content{min-width:280px}  .header-edit-panel .panel-header{display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem;border-bottom:1px solid var(--surface-border)}  .header-edit-panel .panel-header h4{margin:0;font-size:.875rem;font-weight:600;color:var(--text-color)}  .header-edit-panel .panel-header .selection-count{font-size:.75rem;color:var(--text-color-secondary)}  .header-edit-panel .panel-body{padding:.75rem 1rem;max-height:300px;overflow-y:auto}  .header-edit-panel .panel-footer{display:flex;justify-content:flex-end;gap:.5rem;padding:.75rem 1rem;border-top:1px solid var(--surface-border)}  .header-edit-panel .vehicle-list{padding:.5rem}  .header-edit-panel .vehicle-item{display:flex;align-items:center;gap:.5rem;padding:.5rem;border-radius:.375rem;cursor:pointer;transition:background-color .15s ease}  .header-edit-panel .vehicle-item:hover{background-color:var(--surface-hover)}  .header-edit-panel .vehicle-item .vehicle-name{font-size:.875rem;color:var(--text-color);cursor:pointer;flex:1}  .header-edit-panel .empty-state{text-align:center;padding:1rem;color:var(--text-color-secondary);font-size:.875rem}  .header-edit-panel.date-panel .panel-body{padding:.5rem}  .header-edit-panel.data-types-panel .data-types-list{display:flex;flex-direction:column;gap:.375rem;padding:.5rem}  .header-edit-panel.data-types-panel .data-type-item{display:flex;align-items:flex-start;gap:.625rem;padding:.625rem;border-radius:.375rem;cursor:pointer;transition:background-color .15s ease,border-color .15s ease;border:1.5px solid transparent}  .header-edit-panel.data-types-panel .data-type-item:hover:not(.collecting){background-color:var(--surface-hover)}  .header-edit-panel.data-types-panel .data-type-item.selected:not(.collecting){background-color:rgba(var(--color-primary-rgb, 59, 130, 246),.1);border-color:var(--color-primary-color, #3b82f6)}  .header-edit-panel.data-types-panel .data-type-item.collecting{background-color:#fef3c7;border-color:#f59e0b;cursor:not-allowed;opacity:.9}  .header-edit-panel.data-types-panel .data-type-item.collecting .data-type-description{color:#b45309;font-style:italic}  .header-edit-panel.data-types-panel .data-type-item .collecting-icon{font-size:1rem;color:#f59e0b;margin-top:.125rem}  .header-edit-panel.data-types-panel .data-type-item .data-type-info{display:flex;flex-direction:column;gap:.125rem;flex:1}  .header-edit-panel.data-types-panel .data-type-item .data-type-name{display:flex;align-items:center;gap:.375rem;font-size:.875rem;font-weight:500;color:var(--text-color);cursor:pointer}  .header-edit-panel.data-types-panel .data-type-item .data-type-name i{font-size:.875rem;color:var(--primary-color)}  .header-edit-panel.data-types-panel .data-type-item .data-type-description{font-size:.75rem;color:var(--text-color-secondary);line-height:1.3}"]})};function da(i,t){i&1&&(a(0,"span",5),c(1,"(click to edit)"),r())}function pa(i,t){if(i&1&&(a(0,"div",6)(1,"div",12),u(2,"div",13),r(),a(3,"span",14),c(4),r()()),i&2){let e=p();L("data-level",e.confidenceLevel()),s(2),Pe("width",e.confidence(),"%"),s(2),G("",e.confidence(),"% - ",e.confidenceLabel())}}function ga(i,t){if(i&1){let e=w();a(0,"div",7)(1,"textarea",15),ye("ngModelChange",function(o){_(e);let l=p();return Ce(l.editedQuery,o)||(l.editedQuery=o),C(o)}),b("keydown",function(o){_(e);let l=p();return C(l.onKeyDown(o))}),r(),a(2,"div",16)(3,"p-button",17),b("onClick",function(){_(e);let o=p();return C(o.cancelEdit())}),r(),a(4,"p-button",18),b("onClick",function(){_(e);let o=p();return C(o.saveEdit())}),r()()()}if(i&2){let e=p();s(),_e("ngModel",e.editedQuery),y("autoResize",!0),s(2),y("text",!0)}}function ma(i,t){if(i&1&&(a(0,"p",20),c(1),r()),i&2){let e=p(2);s(),v(e.query())}}function ua(i,t){i&1&&(a(0,"p",21),c(1," Start chatting to build your analysis query... "),r())}function ha(i,t){if(i&1){let e=w();a(0,"div",19),b("click",function(){_(e);let o=p();return C(o.onQueryClick())})("keydown.enter",function(){_(e);let o=p();return C(o.onQueryClick())}),g(1,ma,2,1,"p",20)(2,ua,2,0,"p",21),r()}if(i&2){let e=p();U("empty",!e.hasQuery())("clickable",e.hasQuery()),L("tabindex",e.hasQuery()?0:null)("role",e.hasQuery()?"button":null)("aria-label",e.hasQuery()?"Click to edit query":null),s(),m(e.hasQuery()?1:2)}}function fa(i,t){if(i&1&&(a(0,"div",9),u(1,"p-progressBar",22),r()),i&2){let e=p();s(),y("value",e.collectionProgress())("showValue",!0)}}var ct=class i{query=S("");confidence=S(0);isLoading=S(!1);isCollecting=S(!1);collectionProgress=S(0);generateReport=q();queryChanged=q();isEditing=P(!1);editedQuery=P("");hasQuery=f(()=>this.query().length>0);canGenerate=f(()=>this.hasQuery()&&this.confidence()>=50);confidenceLevel=f(()=>{let t=this.confidence();return t>=90?"high":t>=70?"medium":t>=50?"building":"low"});confidenceLabel=f(()=>{switch(this.confidenceLevel()){case"high":return"Ready to generate";case"medium":return"Almost ready";case"building":return"Continue refining";default:return"Keep chatting..."}});queryPreview=f(()=>{let t=this.query();return t.length<=150?t:t.substring(0,147)+"..."});buttonLabel=f(()=>this.isCollecting()?"Collecting Data...":this.isLoading()?"Generating...":"Generate Report");onGenerateClick(){this.canGenerate()&&this.generateReport.emit()}onQueryClick(){this.hasQuery()&&(this.editedQuery.set(this.query()),this.isEditing.set(!0))}saveEdit(){let t=this.editedQuery().trim();t.length>0&&this.queryChanged.emit(t),this.isEditing.set(!1)}cancelEdit(){this.isEditing.set(!1),this.editedQuery.set("")}onKeyDown(t){t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),this.saveEdit()):t.key==="Escape"&&this.cancelEdit()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-chat-footer-preview"]],inputs:{query:[1,"query"],confidence:[1,"confidence"],isLoading:[1,"isLoading"],isCollecting:[1,"isCollecting"],collectionProgress:[1,"collectionProgress"]},outputs:{generateReport:"generateReport",queryChanged:"queryChanged"},decls:14,vars:7,consts:[[1,"chat-footer-preview"],[1,"query-section"],[1,"query-header"],[1,"query-label"],[1,"pi","pi-file-edit"],[1,"edit-hint"],[1,"confidence-indicator"],[1,"query-edit-container"],[1,"query-content",3,"empty","clickable"],[1,"collection-progress"],[1,"action-section"],["icon","pi pi-chart-bar","styleClass","generate-button",3,"onClick","label","disabled","loading"],[1,"confidence-bar"],[1,"confidence-fill"],[1,"confidence-text"],["pTextarea","","rows","3","placeholder","Enter your query...",1,"query-textarea",3,"ngModelChange","keydown","ngModel","autoResize"],[1,"edit-actions"],["icon","pi pi-times","label","Cancel","severity","secondary","size","small",3,"onClick","text"],["icon","pi pi-check","label","Save","severity","primary","size","small",3,"onClick"],[1,"query-content",3,"click","keydown.enter"],[1,"query-text"],[1,"query-placeholder"],["styleClass","collection-bar",3,"value","showValue"]],template:function(e,n){e&1&&(a(0,"footer",0)(1,"div",1)(2,"div",2)(3,"div",3),u(4,"i",4),a(5,"span"),c(6,"Generated Query"),r(),g(7,da,2,0,"span",5),r(),g(8,pa,5,5,"div",6),r(),g(9,ga,5,3,"div",7)(10,ha,3,8,"div",8),r(),g(11,fa,2,2,"div",9),a(12,"div",10)(13,"p-button",11),b("onClick",function(){return n.onGenerateClick()}),r()()()),e&2&&(s(7),m(n.hasQuery()&&!n.isEditing()?7:-1),s(),m(n.hasQuery()?8:-1),s(),m(n.isEditing()?9:10),s(2),m(n.isCollecting()?11:-1),s(2),y("label",n.buttonLabel())("disabled",!n.canGenerate())("loading",n.isLoading()||n.isCollecting()))},dependencies:[R,ee,Le,ge,me,W,ie,Ae,Te,Bt,$t],styles:["[_nghost-%COMP%]{display:block}.chat-footer-preview[_ngcontent-%COMP%]{background-color:var(--card-background-color, #ffffff);border-top:1px solid var(--input-border-color, #e2e8f0);padding:.75rem 1rem;display:flex;flex-direction:column;gap:.75rem;box-shadow:0 -2px 8px #0000000a}.query-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.query-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem}.query-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;font-size:.75rem;font-weight:600;color:var(--text-color-secondary, #64748b);text-transform:uppercase;letter-spacing:.025em}.query-label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem}.query-label[_ngcontent-%COMP%]   .edit-hint[_ngcontent-%COMP%]{font-size:.625rem;font-weight:400;text-transform:none;color:var(--text-color-secondary, #94a3b8);opacity:0;transition:opacity .2s ease}.confidence-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.confidence-indicator[data-level=high][_ngcontent-%COMP%]   .confidence-fill[_ngcontent-%COMP%]{background-color:#22c55e}.confidence-indicator[data-level=high][_ngcontent-%COMP%]   .confidence-text[_ngcontent-%COMP%]{color:#16a34a}.confidence-indicator[data-level=medium][_ngcontent-%COMP%]   .confidence-fill[_ngcontent-%COMP%]{background-color:#eab308}.confidence-indicator[data-level=medium][_ngcontent-%COMP%]   .confidence-text[_ngcontent-%COMP%]{color:#ca8a04}.confidence-indicator[data-level=building][_ngcontent-%COMP%]   .confidence-fill[_ngcontent-%COMP%]{background-color:var(--color-primary-color, #3b82f6)}.confidence-indicator[data-level=building][_ngcontent-%COMP%]   .confidence-text[_ngcontent-%COMP%]{color:var(--color-primary-color, #2563eb)}.confidence-indicator[data-level=low][_ngcontent-%COMP%]   .confidence-fill[_ngcontent-%COMP%]{background-color:var(--text-color-secondary, #94a3b8)}.confidence-indicator[data-level=low][_ngcontent-%COMP%]   .confidence-text[_ngcontent-%COMP%]{color:var(--text-color-secondary, #64748b)}.confidence-bar[_ngcontent-%COMP%]{width:60px;height:4px;background-color:var(--input-border-color, #e2e8f0);border-radius:9999px;overflow:hidden}.confidence-fill[_ngcontent-%COMP%]{height:100%;border-radius:9999px;transition:width .3s ease}.confidence-text[_ngcontent-%COMP%]{font-size:.6875rem;font-weight:500;white-space:nowrap}.query-content[_ngcontent-%COMP%]{background-color:var(--input-background-color, #ffffff);border:1px solid var(--input-border-color, #e2e8f0);border-radius:.5rem;padding:.625rem .75rem;min-height:2.5rem;max-height:6rem;overflow-y:auto}.query-content.empty[_ngcontent-%COMP%]{background-color:var(--surface-hover, #f1f5f9);border-style:dashed}.query-content.clickable[_ngcontent-%COMP%]{cursor:pointer;transition:all .2s ease}.query-content.clickable[_ngcontent-%COMP%]:hover{border-color:var(--color-primary-color, #3b82f6);background-color:var(--surface-hover, #f8fafc);box-shadow:0 0 0 2px rgba(var(--color-primary-rgb, 59, 130, 246),.1)}.query-content.clickable[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary-color, #3b82f6);box-shadow:0 0 0 2px rgba(var(--color-primary-rgb, 59, 130, 246),.2)}.query-section[_ngcontent-%COMP%]:hover   .edit-hint[_ngcontent-%COMP%]{opacity:1}.query-edit-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.query-edit-container[_ngcontent-%COMP%]   .query-textarea[_ngcontent-%COMP%]{width:100%;font-size:.8125rem;line-height:1.5;resize:none;border:1px solid var(--color-primary-color, #3b82f6);border-radius:.5rem;padding:.625rem .75rem;background-color:var(--input-background-color, #ffffff);color:var(--text-color, #1e293b);box-shadow:0 0 0 2px rgba(var(--color-primary-rgb, 59, 130, 246),.2)}.query-edit-container[_ngcontent-%COMP%]   .query-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary-color, #2563eb);box-shadow:0 0 0 3px rgba(var(--color-primary-rgb, 59, 130, 246),.3)}.query-edit-container[_ngcontent-%COMP%]   .edit-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem}.query-text[_ngcontent-%COMP%]{margin:0;font-size:.8125rem;color:var(--text-color, #334155);line-height:1.5;word-break:break-word}.query-placeholder[_ngcontent-%COMP%]{margin:0;font-size:.8125rem;color:var(--text-color-secondary, #94a3b8);font-style:italic}.collection-progress[_ngcontent-%COMP%]     .collection-bar{height:.375rem;border-radius:9999px}.collection-progress[_ngcontent-%COMP%]     .collection-bar .p-progressbar-value{background:linear-gradient(90deg,var(--color-primary-color, #3b82f6),var(--color-primary-color, #60a5fa))}.action-section[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.action-section[_ngcontent-%COMP%]     .generate-button{background:linear-gradient(135deg,#22c55e,#16a34a);border:none;font-weight:600;padding:.625rem 1.5rem;border-radius:.5rem;transition:all .2s ease}.action-section[_ngcontent-%COMP%]     .generate-button:not(:disabled):hover{background:linear-gradient(135deg,#16a34a,#15803d);transform:translateY(-1px);box-shadow:0 4px 12px #22c55e4d}.action-section[_ngcontent-%COMP%]     .generate-button:disabled{background:var(--input-border-color, #e2e8f0);color:var(--text-color-secondary, #94a3b8);cursor:not-allowed}.action-section[_ngcontent-%COMP%]     .generate-button .p-button-icon{margin-right:.5rem}@media(max-width:640px){.chat-footer-preview[_ngcontent-%COMP%]{padding:.625rem .75rem}.query-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.375rem}.action-section[_ngcontent-%COMP%]     .generate-button{width:100%;justify-content:center}}"]})};var dt=class i{http=Q(we);MAX_CONCURRENT_REQUESTS=10;MAX_RETRY_ATTEMPTS=3;RETRY_DELAY_BASE=1e3;HOURS_24_MS=1440*60*1e3;progressSubject=new mt({totalRequests:0,completedRequests:0,successfulRequests:0,failedRequests:0,percentage:0,message:"Initializing data collection..."});progress$=this.progressSubject.asObservable();splitInto24HourChunks(t,e){let n=[],o=new Date(t),l=new Date(e),d=new Date(o);for(;d<l;){let h=new Date(Math.min(d.getTime()+this.HOURS_24_MS,l.getTime()));n.push({start:d.toISOString(),end:h.toISOString()}),d=new Date(h)}return n}createHeaders(t){return new Ot({"x-access-token":t,"Content-Type":"application/json",Accept:"application/json"})}buildApiUrl(t,e,n,o,l){let d=`${t}/data/history/${e}/${n}`,h=new URLSearchParams({start:o,end:l});return`${d}?${h.toString()}`}async collectVehicleData(t,e,n,o,l,d=0){let h=this.createHeaders(l),O=this.buildApiUrl(o,t,e,n.start,n.end);try{let M=await fe(this.http.get(O,{headers:h}));if(B(M))throw new Error("No response received from API");return{dataType:t,vehicleId:e,data:M,chunk:n}}catch(M){let x=M;if(x.status===401||x.status===403)throw new Error("Authentication failed. Please provide a valid token.");if(x.status===429&&d<this.MAX_RETRY_ATTEMPTS){let k=Math.pow(2,d)*this.RETRY_DELAY_BASE;return await new Promise(N=>setTimeout(N,k)),this.collectVehicleData(t,e,n,o,l,d+1)}throw new Error(`Failed to collect ${t} data for vehicle ${e}: ${x.message||"Unknown error"}`)}}updateProgress(t){let e=this.progressSubject.value,n=V(V({},e),t),o=n.totalRequests,l=n.completedRequests;o>0&&(n.percentage=Math.round(l/o*100)),this.progressSubject.next(n)}aggregateResults(t,e,n){let o={vehicles:{},metadata:{start_date:n.startDate,end_date:n.endDate,vehicle_count:n.vehicleIds.length,data_types:n.dataTypes,collection_timestamp:new Date().toISOString(),successful_requests:t.length,failed_requests:e.length,total_requests:t.length+e.length,timezone:"Africa/Johannesburg",business_context:{fleet_type:"delivery",region:"south_africa",kpi_focus:["efficiency","safety","fuel_consumption"]}}},l=n.vehicleNames??{};return n.vehicleIds.forEach(d=>{let h=l[d]||d;o.vehicles[h]={vehicle_info:{id:d,name:h,active:!0},trips:[],events:[],telemetry:[],alerts:[],data_summary:{trip_count:0,event_count:0,telemetry_count:0,alert_count:0,date_range:{earliest:null,latest:null}}}}),t.forEach(d=>{if($(d.data?.items)&&Array.isArray(d.data.items)){let{dataType:h,vehicleId:O}=d,M=d.data.items,x=l[O]||O;if($(o.vehicles[x])){switch(h){case"trips":o.vehicles[x].trips.push(...M);break;case"events":o.vehicles[x].events.push(...M);break;case"telemetry":o.vehicles[x].telemetry.push(...M);break;case"alerts":o.vehicles[x].alerts.push(...M);break}let k=o.vehicles[x];k.data_summary.trip_count=k.trips.length,k.data_summary.event_count=k.events.length,k.data_summary.telemetry_count=k.telemetry.length,k.data_summary.alert_count=k.alerts.length,h==="trips"&&k.trips.forEach(N=>{let z=N.startTime;if(z){let T=k.data_summary;(B(T.date_range.earliest)||z<T.date_range.earliest)&&(T.date_range.earliest=z),(B(T.date_range.latest)||z>T.date_range.latest)&&(T.date_range.latest=z)}})}}}),o}async collectFleetData(t){try{if(!t.vehicleIds.length)throw new Error("At least one vehicle ID is required");if(!t.dataTypes.length)throw new Error("At least one data type is required");let e=new Date(t.startDate).getTime();if((new Date(t.endDate).getTime()-e)/(1440*60*1e3)>7)throw new Error("Date range cannot exceed 7 days for performance reasons");let l=this.splitInto24HourChunks(t.startDate,t.endDate),d=l.length*t.vehicleIds.length*t.dataTypes.length;this.updateProgress({totalRequests:d,completedRequests:0,successfulRequests:0,failedRequests:0,message:`Preparing to collect data from ${t.vehicleIds.length} vehicles...`});let h=[];for(let k of l)for(let N of t.vehicleIds)for(let z of t.dataTypes)h.push(()=>this.collectVehicleData(z,N,k,t.baseUrl,t.authToken));let O=[],M=[];for(let k=0;k<h.length;k+=this.MAX_CONCURRENT_REQUESTS){let N=h.slice(k,k+this.MAX_CONCURRENT_REQUESTS);(await Promise.allSettled(N.map(T=>T()))).forEach((T,re)=>{let ae=k+re,Ne=t.vehicleIds.length,ve=t.dataTypes.length,Ee=Ne*ve,Ve=Math.floor(ae/Ee),j=ae%Ee,le=Math.floor(j/ve),Me=j%ve,pe=t.vehicleIds[le],he=t.dataTypes[Me];T.status==="fulfilled"?(O.push(T.value),this.updateProgress({completedRequests:O.length+M.length,successfulRequests:O.length,currentVehicle:pe,currentDataType:he,message:`Collected ${he} data for ${pe}...`})):(M.push({vehicleId:pe,dataType:he,dateChunk:l[Ve],error:T.reason?.message??"Unknown error",statusCode:T.reason?.status,retryCount:0}),this.updateProgress({completedRequests:O.length+M.length,failedRequests:M.length,currentVehicle:pe,currentDataType:he,message:`Failed to collect ${he} data for ${pe}`}))}),k+this.MAX_CONCURRENT_REQUESTS<h.length&&await new Promise(T=>setTimeout(T,100))}this.updateProgress({message:"Aggregating collected data..."});let x=this.aggregateResults(O,M,t);return this.updateProgress({message:`Collection complete! Gathered ${O.length} successful responses${M.length>0?` with ${M.length} errors`:""}`}),{success:M.length===0||O.length>0,data:x,errors:M.length>0?M:void 0,progress:this.progressSubject.value}}catch(e){let n=e instanceof Error?e.message:"Unknown error occurred during data collection";return this.updateProgress({message:`Collection failed: ${n}`}),{success:!1,errors:[{vehicleId:"unknown",dataType:"trips",dateChunk:{start:t.startDate,end:t.endDate},error:n,retryCount:0}],progress:this.progressSubject.value}}}resetProgress(){this.progressSubject.next({totalRequests:0,completedRequests:0,successfulRequests:0,failedRequests:0,percentage:0,message:"Ready to collect data..."})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=xe({token:i,factory:i.\u0275fac,providedIn:"root"})};var _a=["queryChatComponent"];function Ca(i,t){if(i&1&&(a(0,"div",2)(1,"p-message",16),c(2),r()()),i&2){let e=p();s(2),v(e.errorMessage())}}function ya(i,t){if(i&1&&(a(0,"div",3)(1,"p-message",17),c(2),r()()),i&2){let e=p();s(2),v(e.successMessage())}}function ba(i,t){if(i&1){let e=w();a(0,"app-analytics-dashboard",18),b("recalculate",function(){_(e);let o=p();return C(o.onRecalculate())}),r()}if(i&2){let e,n,o=p();y("response",o.dashboardResponse())("isLoading",!1)("error",void 0)("userQuery",o.lastReportQuery())("dateRange",o.formatDateRange())("vehicleNames",o.getSelectedVehicleNames())("clientTimeZone",((e=o.selectedClientSignal())==null?null:e.timeZoneId)??void 0)("clientLanguage",((n=o.selectedClientSignal())==null?null:n.language)??void 0)}}function va(i,t){if(i&1&&(a(0,"div",15)(1,"div",19),u(2,"p-progressSpinner",20),a(3,"p",21),c(4),r(),a(5,"p",22),c(6,"Analysis may take up to 60 seconds"),r()()()),i&2){let e=p();s(4),v(e.loadingMessage())}}var Xt=class i{assetsService=Q(wt);clientDataService=Q(St);fb=Q(Dt);http=Q(we);apiUrlService=Q($e);authTokenManagerService=Q(Fe);telemetryDataCollectionService=Q(dt);title="Reporting - Analytical Review";assets=P([]);filteredAssets=P([]);_selectedAssetIds=P([]);loadingAssets=P(!1);errorMessage=P(null);successMessage=P(null);get selectedAssetIds(){return this._selectedAssetIds()}set selectedAssetIds(t){this._selectedAssetIds.set(t??[])}isTestingApi=P(!1);apiResponse=P(null);selectedTab=P(0);loadingMessage=P("Preparing report generation...");loadingInterval=null;collectionProgress=P(null);collectedData=P(null);isCollectingData=P(!1);collectionErrors=P([]);collectingDataTypes=P([]);apiForm;dataTypeOptions=P([{label:"Trips",value:"trips",selected:!0},{label:"Events",value:"events",selected:!0},{label:"Telemetry",value:"telemetry",selected:!1},{label:"Alerts",value:"alerts",selected:!0}]);analyzePerDay=P(!1);analyzePerVehicle=P(!1);useChatMode=P(!0);queryChatComponent;showChatView=P(!0);currentQuery=P("");currentConfidence=P(0);selectedDataTypesList=P([]);formStartDate=P(null);formEndDate=P(null);activeDatePreset=P(null);sampleRequests=P([{name:"Driver Safety Scorecard",description:"Comprehensive analysis of driver behavior including speeding, harsh braking, and acceleration events",query:"Generate a driver safety scorecard showing speeding incidents, harsh braking events, rapid acceleration, and overall safety rating with recommendations for improvement",dataTypes:["trips","events"]},{name:"Fuel Efficiency & Cost Analysis",description:"Detailed fuel consumption analysis with cost optimization recommendations",query:"Analyze fuel efficiency patterns, identify vehicles with poor MPG, calculate fuel costs per mile, and provide recommendations to reduce fuel consumption",dataTypes:["trips","telemetry"]},{name:"Vehicle Utilization Report",description:"Asset utilization analysis to identify underused or overworked vehicles",query:"Show vehicle utilization rates, idle time analysis, engine hours vs distance traveled, and identify vehicles that are underutilized or require better distribution",dataTypes:["trips","telemetry"]},{name:"Maintenance Insights",description:"Predictive maintenance analysis based on vehicle diagnostics and usage patterns",query:"Analyze diagnostic trouble codes, predict upcoming maintenance needs based on mileage and usage patterns, and identify vehicles requiring immediate attention",dataTypes:["events","telemetry"]},{name:"Route Optimization",description:"Route efficiency analysis with suggestions for optimization",query:"Analyze route efficiency, identify frequent detours or delays, calculate time spent in traffic, and suggest optimal routes to reduce travel time and fuel costs",dataTypes:["trips","events"]},{name:"Fleet Performance Dashboard",description:"Comprehensive fleet overview with key performance indicators",query:"Create a comprehensive fleet performance summary including total cost of ownership, vehicle availability, driver performance metrics, and operational efficiency KPIs",dataTypes:["trips","events","telemetry"]}]);apiDocumentation=P({overview:"The Analytical Review endpoint provides AI-powered fleet analytics by integrating with Telemetry API to collect real-time vehicle data and generate intelligent insights for dashboard visualization.",endpoint:{production:"https://cypherview-reporting-develop-function.azurewebsites.net/api/analytical-review",local:"http://localhost:7071/api/analytical-review",method:"POST"},headers:{"Content-Type":"application/json","x-functions-key":"[your-function-key] # Required in production"},rateLimit:{dateRangeMax:"7 days",vehiclesMax:"10 vehicles per request",timeout:"30-60 seconds",concurrent:"10 concurrent requests",requestsPerMinute:"100 requests per minute per client"}});selectedClientSignal=this.clientDataService.getSelectedClientSignal();safeStringify(t){if(t==null)return"";if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean")return String(t);if(typeof t=="object")try{return JSON.stringify(t)}catch{return"[Object]"}return typeof t=="function"?"[Function]":typeof t=="symbol"||typeof t=="bigint"?t.toString():"[Unknown]"}selectedAssetNames=f(()=>{let t=this._selectedAssetIds(),e=this.assets();if(!Array.isArray(e)||!Array.isArray(t))return"Loading...";let n=e.filter(o=>$(o?.value)&&t.includes(o.value));return n.length===0?"No vehicles selected":n.map(o=>this.safeStringify(o.label||o.value||"Unknown Vehicle")).join(", ")});isMultipleVehiclesSelected=f(()=>this._selectedAssetIds().length>1);isDateRangeGreaterThan2Days=f(()=>{let t=this.apiForm.get("startDate")?.value,e=this.apiForm.get("endDate")?.value;if(B(t)||B(e))return!1;let n=new Date(t);return(new Date(e).getTime()-n.getTime())/(1e3*60*60*24)>2});shouldDisableTelemetry=f(()=>this.isMultipleVehiclesSelected()&&this.isDateRangeGreaterThan2Days());reportSummary=f(()=>{let n=this.apiResponse()?.data?.response?.summary;return this.safeStringify(n)||"Report generated successfully."});formatDateRange=f(()=>{let t=this.apiForm.get("startDate")?.value,e=this.apiForm.get("endDate")?.value;if(B(t)||B(e))return"Date range not selected";try{let n=o=>B(o)?"Invalid Date":new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0});return`${n(t)} - ${n(e)}`}catch{return"Invalid date range"}});isReadyForTesting=f(()=>!!($(this.selectedClientSignal()?.id)&&this._selectedAssetIds().length>0&&$(this.apiForm.get("reportQuery")?.value)&&$(this.apiForm.get("startDate")?.value)&&$(this.apiForm.get("endDate")?.value)));lastReportQuery=P("");dashboardResponse=f(()=>{let t=this.apiResponse();if(B(t?.success)||B(t?.data))return;let e=t.data;if(!B(e?.response))return $(e.response.blocks)?e:this.transformLegacyResponse(t.data)});transformLegacyResponse(t){let e=t,n=this.safeStringify(e.response?.summary)||"Analysis completed successfully",o=new Date().toISOString();return{response:{request_id:e.response?.request_id??`req_${Date.now()}`,timestamp:o,summary:n,layout:{type:"dashboard",grid:{columns:12,rows:"auto",gap:16},sections:[{id:"main-summary",title:"Report Summary",position:{row:1,col:1,colSpan:12},blocks:["summary-block-1"]}]},blocks:[{block_id:"summary-block-1",block_type:"summary",priority:1,content:{title:"Fleet Analysis Report",narrative:n,highlights:[{label:"Vehicles Analyzed",value:this._selectedAssetIds().length,severity:"neutral"},{label:"Analysis Period",value:this.formatDateRange(),severity:"neutral"},{label:"Report Status",value:"Complete",severity:"good"}]},visual:{theme:"primary",elevation:1}}],metadata:{generation_time:1e3,data_sources:["telemetry_api"],confidence_score:95}}}}currentVehicleName=f(()=>{let t=this.collectionProgress()?.currentVehicle;return B(t)?"":this.assets().find(o=>o.value===t)?.label??t});selectedDataTypes=f(()=>this.dataTypeOptions().filter(t=>t.selected).map(t=>t.value));canAnalyzePerDay=f(()=>{let t=this.formStartDate(),e=this.formEndDate();return t==null||e==null?!1:(new Date(e).getTime()-new Date(t).getTime())/(1e3*60*60*24)>2});canAnalyzePerVehicle=f(()=>this._selectedAssetIds().length>1);analysisBreakdownText=f(()=>{let t=[];return this.analyzePerDay()&&this.canAnalyzePerDay()&&t.push("broken down by day"),this.analyzePerVehicle()&&this.canAnalyzePerVehicle()&&t.push("broken down by vehicle"),t.length===0?"":` Please provide the analysis ${t.join(" and ")}.`});analyticalReviewEndpoint=f(()=>"https://cypherview-reporting-develop-function.azurewebsites.net/api/analytical-review");chatDateRange=f(()=>{let t=this.formStartDate(),e=this.formEndDate();return t&&e?{start:t,end:e}:null});chatSelectedVehicles=f(()=>{let t=this._selectedAssetIds(),e=this.assets();return t.map(n=>{let o=e.find(l=>l.value===n);return o?{id:o.value,name:o.label}:null}).filter(n=>n!==null)});chatClientInfo=f(()=>{let t=this.selectedClientSignal(),e=t?.id,n=t?.name;return e!=null&&e!==""&&n!==void 0&&n!==null&&n!==""?{id:e,name:n}:null});availableVehiclesForChat=f(()=>this.assets().map(e=>({id:e.value,name:e.label})));headerSummary=f(()=>{let t=this.formStartDate(),e=this.formEndDate(),n=this._selectedAssetIds(),o=this.assets(),l=n.map(d=>o.find(O=>O.value===d)?.label??"").filter(d=>d.length>0);return{dateRange:t&&e?{start:t,end:e}:null,vehicleCount:n.length,vehicleNames:l,dataTypes:this.selectedDataTypesList(),queryConfidence:this.currentConfidence(),currentQuery:this.currentQuery()}});constructor(){this.apiForm=this.fb.group({startDate:[null,Qe.required],endDate:[null,Qe.required],reportQuery:["",Qe.required]});let t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59,999);this.apiForm.patchValue({startDate:e,endDate:n,reportQuery:"Show me fleet overview and any issues that need attention"}),this.formStartDate.set(e),this.formEndDate.set(n),this.apiForm.get("startDate")?.valueChanges.subscribe(o=>{this.formStartDate.set(o),this.activeDatePreset.set(null)}),this.apiForm.get("endDate")?.valueChanges.subscribe(o=>{this.formEndDate.set(o),this.activeDatePreset.set(null)}),de(()=>{let o=this.selectedClientSignal();$(o?.id)?(this.loadInitialAssets(o.id),this.errorMessage.set(null)):(this.assets.set([]),this.filteredAssets.set([]))}),de(()=>{this.shouldDisableTelemetry()&&this.dataTypeOptions.update(l=>l.map(d=>F(V({},d),{selected:d.value==="telemetry"?!1:d.selected})))})}loadInitialAssets(t){this.loadingAssets.set(!0),this.errorMessage.set(null),this.assetsService.listAssets(t,0,1e3,void 0,"state=active").subscribe({next:e=>{let n=e.items?.map(o=>({label:o.name||`Asset ${o.id}`,value:o.id,assetData:o}))??[];this.assets.set(n),this.filteredAssets.set(n),this.loadingAssets.set(!1)},error:()=>{this.errorMessage.set("Failed to load assets. Please try again."),this.loadingAssets.set(!1)}})}onSearchAssets(t){let e=t.query.trim().toLowerCase(),n=this.assets();if(!e){this.filteredAssets.set(n);return}let o=n.filter(l=>l.label.toLowerCase().includes(e));this.filteredAssets.set(o)}onAssetsChange(t){this.selectedAssetIds=t??[]}onDataTypeChange(t){if(t.value==="telemetry"&&this.isMultipleVehiclesSelected()&&!t.selected){this.errorMessage.set("Telemetry data is not available when multiple vehicles are selected."),setTimeout(()=>this.errorMessage.set(null),3e3);return}this.dataTypeOptions.update(e=>e.map(n=>n.value===t.value?F(V({},n),{selected:!n.selected}):n))}setDatePreset(t){let e=new Date;e.setHours(0,0,0,0);let n,o;switch(t){case"today":n=new Date(e),o=new Date(e),o.setHours(23,59,59,999);break;case"yesterday":n=new Date(e),n.setDate(n.getDate()-1),o=new Date(n),o.setHours(23,59,59,999);break;case"last7days":o=new Date(e),o.setHours(23,59,59,999),n=new Date(e),n.setDate(n.getDate()-6);break;case"thisMonth":n=new Date(e.getFullYear(),e.getMonth(),1),o=new Date(e),o.setHours(23,59,59,999);break;case"lastMonth":n=new Date(e.getFullYear(),e.getMonth()-1,1),o=new Date(e.getFullYear(),e.getMonth(),0),o.setHours(23,59,59,999);break;default:return}this.apiForm.patchValue({startDate:n,endDate:o},{emitEvent:!1}),this.formStartDate.set(n),this.formEndDate.set(o),this.activeDatePreset.set(t)}onLoadSampleRequest(t){this.apiForm.patchValue({reportQuery:t.query});let e=this.shouldDisableTelemetry();this.dataTypeOptions.update(n=>n.map(o=>F(V({},o),{selected:o.value==="telemetry"&&e?!1:t.dataTypes.includes(o.value)}))),e&&t.dataTypes.includes("telemetry")?this.successMessage.set(`Loaded query: ${t.name} (telemetry disabled due to selection)`):this.successMessage.set(`Loaded query: ${t.name}`),setTimeout(()=>this.successMessage.set(null),3e3),this.sampleRequests.update(n=>n.filter(o=>o.name!==t.name))}async onChatDataCollectionTriggered(t){let e=t;this.isCollectingData.set(!0),this.collectingDataTypes.set(t),this.collectionErrors.set([]),this.queryChatComponent?.startDataCollection(t);try{let n=this.selectedAssetIds,o=this.apiForm.value,l={},d=this.assets();for(let x of n){let k=d.find(N=>N.value===x);k&&(l[x]=k.label)}let h={vehicleIds:n,vehicleNames:l,startDate:o.startDate.toISOString(),endDate:o.endDate.toISOString(),dataTypes:e,baseUrl:this.apiUrlService.getCurrentApiUrl(),authToken:this.authTokenManagerService.getAccessToken()??""},O=this.telemetryDataCollectionService.progress$.subscribe(x=>{this.collectionProgress.set(x),this.queryChatComponent?.updateCollectionProgress(x.percentage)}),M=await this.telemetryDataCollectionService.collectFleetData(h);if(O.unsubscribe(),M.data&&this.collectedData.set(M.data),this.collectionErrors.set(M.errors??[]),this.isCollectingData.set(!1),this.collectingDataTypes.set([]),M.data){let x=this.buildSummarizedData(M.data);this.queryChatComponent?.submitDataContext(x).catch(k=>{console.error("Failed to submit data context:",k)})}}catch(n){console.error("Data collection failed:",n),this.errorMessage.set(n instanceof Error?n.message:"Data collection failed"),this.isCollectingData.set(!1),this.collectingDataTypes.set([])}}async onChatGenerateReport(t){this.apiForm.patchValue({reportQuery:t});let e=this.collectedData();if(!e){this.errorMessage.set("Please collect data first before generating the report.");return}await this.generateReportWithData(t,e)}onQueryUpdated(t){this.currentQuery.set(t)}onQueryChanged(t){this.currentQuery.set(t),this.apiForm.patchValue({reportQuery:t})}onConfidenceUpdated(t){this.currentConfidence.set(t)}onChatDateRangeSelected(t){this.formStartDate.set(t.start),this.formEndDate.set(t.end),this.apiForm.patchValue({startDate:t.start,endDate:t.end},{emitEvent:!1})}onChatVehiclesSelected(t){let e=t.map(n=>n.id);this._selectedAssetIds.set(e)}onChatDataTypesSelected(t){this.selectedDataTypesList.set(t),this.dataTypeOptions.update(e=>e.map(n=>F(V({},n),{selected:t.includes(n.value)})))}onHeaderVehiclesChanged(t){this._selectedAssetIds.set(t)}onHeaderDateRangeChanged(t){this.formStartDate.set(t.start),this.formEndDate.set(t.end),this.apiForm.patchValue({startDate:t.start,endDate:t.end},{emitEvent:!1}),this.activeDatePreset.set(null)}onHeaderDataTypesChanged(t){if(t.length===0)return;let e=t;this.onChatDataCollectionTriggered(e)}headerSelectedVehicleIds=f(()=>this._selectedAssetIds());headerAvailableVehicles=f(()=>{let t=this.assets(),e=this._selectedAssetIds();return t.map(n=>({id:n.value,name:n.label,selected:e.includes(n.value)}))});async onFooterGenerateReport(){let t=this.currentQuery();if(!t){this.errorMessage.set("Please build a query first by chatting.");return}let e=this.collectedData();if(!e){let n=this.selectedDataTypesList();if(n.length===0){this.errorMessage.set("Please specify data types in the chat first.");return}await this.onChatDataCollectionTriggered(n);return}await this.generateReportWithData(t,e)}onBackToChat(){this.showChatView.set(!0)}onNewReport(){this.apiResponse.set(null),this.collectedData.set(null),this.currentQuery.set(""),this.currentConfidence.set(0),this.selectedDataTypesList.set([]),this.showChatView.set(!0),this.errorMessage.set(null),this.successMessage.set(null),this.queryChatComponent?.clearSession()}async generateReportWithData(t,e){this.isTestingApi.set(!0),this.errorMessage.set(null),this.successMessage.set(null);try{let n=this.buildSummarizedData(e),o=this.buildRequestBody(t,e,n),l=new FormData,d=new Blob([JSON.stringify(o)],{type:"application/json"});l.append("request",d,"request.json");let h={aggregated_data:e,summarized_data:n},O=new Blob([JSON.stringify(h)],{type:"application/json"});l.append("data_file",O,"telemetry.json");let M=await fetch(this.analyticalReviewEndpoint(),{method:"POST",body:l});if(!M.ok)throw new Error(`HTTP ${M.status}: ${M.statusText}`);let x=await M.json();x.error!==void 0&&x.error!==null?this.apiResponse.set({success:!1,error:x.message??x.error,statusCode:M.status}):(this.apiResponse.set({success:!0,data:x,statusCode:M.status}),this.lastReportQuery.set(t),this.showChatView.set(!1))}catch(n){console.error("Report generation failed:",n),this.apiResponse.set({success:!1,error:n instanceof Error?n.message:"Report generation failed"})}finally{this.isTestingApi.set(!1)}}buildRequestBody(t,e,n){let o=this.selectedClientSignal();return{key_auth_token:this.authTokenManagerService.getAccessToken(),key_base_url:this.apiUrlService.getCurrentApiUrl(),report_query:t+this.analysisBreakdownText(),client_profile:{id:o?.id??"",name:o?.name??"",timeZoneId:o?.timeZoneId??"UTC",language:o?.language??"en",currency:o?.currency??"USD",measurementUnits:{distanceUnit:o?.measurementUnits?.distanceUnit||"km",speedUnit:o?.measurementUnits?.speedUnit||"km/h",volumeUnit:o?.measurementUnits?.volumeUnit||"l",weightUnit:o?.measurementUnits?.weightUnit||"kg",temperatureUnit:o?.measurementUnits?.temperatureUnit||"C",altitudeUnit:o?.measurementUnits?.altitudeUnit||"m",areaUnit:o?.measurementUnits?.areaUnit||"ha"}},user_role:"fleet_manager",analysis_type:"fleet_overview"}}async onTestApi(){if(!this.isReadyForTesting()){this.errorMessage.set("Please fill in all required fields before testing.");return}let t=this.selectedAssetIds,e=this.apiForm.value,n=this.selectedDataTypes();if(t.length===0)return;this.isTestingApi.set(!0),this.isCollectingData.set(!0),this.errorMessage.set(null),this.successMessage.set(null),this.apiResponse.set(null),this.collectedData.set(null),this.collectionErrors.set([]);let o=this.telemetryDataCollectionService.progress$.subscribe(l=>{this.collectionProgress.set(l),this.loadingMessage.set(l.message)});try{let l=new Date(e.startDate),d=new Date(e.endDate),h=this.assets(),O={};for(let k of t){let N=h.find(z=>z.value===k);N&&(O[k]=N.label)}let M={vehicleIds:t,vehicleNames:O,startDate:l.toISOString(),endDate:d.toISOString(),dataTypes:n.length>0?n:["trips","events","telemetry"],baseUrl:this.apiUrlService.getCurrentApiUrl(),authToken:this.authTokenManagerService.getAccessToken()??""},x=await this.telemetryDataCollectionService.collectFleetData(M);if(x.success&&x.data){this.collectedData.set(x.data),this.isCollectingData.set(!1);let k=this.selectedClientSignal(),N=this.analysisBreakdownText(),z=e.reportQuery+N,T={key_auth_token:this.authTokenManagerService.getAccessToken(),key_base_url:this.apiUrlService.getCurrentApiUrl(),report_query:z,client_profile:{id:k?.id,name:k?.name,timeZoneId:k?.timeZoneId??"UTC",language:k?.language??"en",currency:"ZAR",measurementUnits:k?.measurementUnits??{distanceUnit:"kilometres",speedUnit:"kilometresPerHour",volumeUnit:"litres",weightUnit:"kilograms",temperatureUnit:"celsius",altitudeUnit:"metres",areaUnit:"squareKilometres"}},user_role:"fleet_manager",analysis_type:"fleet_overview"},re={aggregated_data:x.data,summarized_data:this.buildSummarizedData(x.data)},ae=new Blob([JSON.stringify(re)],{type:"application/json"}),ve=ae.size/(1024*1024),Ee=20;if(ve>Ee){this.isTestingApi.set(!1),this.isCollectingData.set(!1),o.unsubscribe();let j=[];n.includes("telemetry")&&j.push('Remove "Telemetry" from data types (telemetry data is usually the largest)'),n.includes("events")&&j.push('Remove "Events" from data types'),t.length>3&&j.push(`Reduce the number of vehicles (currently ${t.length} selected)`);let le=new Date(e.startDate),pe=(new Date(e.endDate).getTime()-le.getTime())/(1e3*60*60*24);pe>7&&j.push(`Reduce the date range (currently ${pe.toFixed(1)} days)`);let he=j.length>0?`

Suggestions:
\u2022 ${j.join(`
\u2022 `)}`:"";this.errorMessage.set(`Payload size (${ve.toFixed(2)} MB) exceeds the maximum allowed size of ${Ee} MB. Please reduce the amount of data being sent.${he}`);return}this.lastReportQuery.set(z);let Ve=new FormData;Ve.append("request",new Blob([JSON.stringify(T)],{type:"application/json"}),"request.json"),Ve.append("data_file",ae,"telemetry.json"),this.loadingMessage.set("Generating AI-powered analysis..."),this.http.post(this.analyticalReviewEndpoint(),Ve).subscribe({next:j=>{let le=j,Me=$(le.error);this.apiResponse.set({success:!Me,data:j,error:Me?le.message??le.error:void 0,statusCode:200}),this.isTestingApi.set(!1),Me?this.errorMessage.set(`Analysis failed: ${le.message??le.error}`):this.successMessage.set("Report generated successfully!"),o.unsubscribe()},error:j=>{this.apiResponse.set({success:!1,error:j.error?.message??j.message??"Analysis failed",statusCode:j.status}),this.isTestingApi.set(!1),this.errorMessage.set(`Analysis failed: ${j.error?.message??j.message??"Unknown error"}`),o.unsubscribe()}})}else{this.isTestingApi.set(!1),this.isCollectingData.set(!1),x.errors&&this.collectionErrors.set(x.errors);let k=x.errors?.[0]?.error??"Data collection failed";this.errorMessage.set(`Data collection failed: ${k}`),o.unsubscribe()}}catch(l){this.isTestingApi.set(!1),this.isCollectingData.set(!1),this.errorMessage.set(`Data collection failed: ${l instanceof Error?l.message:"Unknown error"}`),o.unsubscribe()}}onClearResponse(){this.apiResponse.set(null),this.errorMessage.set(null),this.successMessage.set(null)}onRecalculate(){this.apiResponse.set(null),this.errorMessage.set(null),this.successMessage.set(null),this.onTestApi()}startLoadingMessages(){let t=this.selectedDataTypes(),e=this.selectedAssetIds,n=e.length===1?"selected vehicle":`${e.length} selected vehicles`,o=["Connecting to AI analysis engine...",`Gathering ${t.join(", ")} data for ${n}...`,"Processing telemetry information...","Analyzing fleet patterns and behaviors...","Identifying potential issues and insights...","Generating intelligent recommendations...","Finalizing comprehensive report...","Almost ready, applying finishing touches..."],l=0;this.loadingMessage.set(o[l]),this.loadingInterval=setInterval(()=>{l=(l+1)%o.length,this.loadingMessage.set(o[l])},3e3)}stopLoadingMessages(){$(this.loadingInterval)&&(clearInterval(this.loadingInterval),this.loadingInterval=null)}columnsWithSampleValues={trips:[],events:["eventType","eventClass"],alerts:["eventType","eventClass"],telemetry:["io.*.name"]};extractColumnNames(t,e){if(B(t)||t.length===0)return[];let n=this.flattenKeys(t[0]),o=this.columnsWithSampleValues[e]??[];return o.length===0?n:n.map(l=>{if(this.shouldEnhanceColumn(l,o)){let d=this.getUniqueValues(t,l);if(d.length>0)return`${l}:${d.join(",")}`}return l})}shouldEnhanceColumn(t,e){return e.some(n=>{if(n.includes("*")){let o=n.replaceAll(".",String.raw`\.`).replaceAll("*","[^.]+");return new RegExp(`^${o}$`).test(t)}return t===n})}getUniqueValues(t,e){let n=new Set,o=10;for(let l of t){if(n.size>=o)break;let d=this.getNestedValue(l,e);if(d!=null&&d!==""){let h;typeof d=="object"?h=JSON.stringify(d):typeof d=="string"?h=d:typeof d=="number"||typeof d=="boolean"?h=String(d):h="[Unknown]",n.add(h)}}return Array.from(n)}getNestedValue(t,e){let n=e.split("."),o=t;for(let l of n){if(o==null)return;if(typeof o=="object"&&o!==null)o=o[l];else return}return o}flattenKeys(t,e=""){let n=[];for(let o of Object.keys(t)){let l=e?`${e}.${o}`:o,d=t[o];$(d)&&typeof d=="object"&&d!==null&&!Array.isArray(d)?n.push(...this.flattenKeys(d,l)):n.push(l)}return n}buildSummarizedData(t){let e={vehicles:{},metadata:t.metadata};for(let[n,o]of Object.entries(t.vehicles))e.vehicles[n]={trips:this.extractColumnNames(o.trips,"trips"),events:this.extractColumnNames(o.events,"events"),telemetry:this.extractColumnNames(o.telemetry,"telemetry"),alerts:this.extractColumnNames(o.alerts,"alerts"),data_summary:o.data_summary};return e}ngOnDestroy(){this.stopLoadingMessages()}getSelectedVehicleNames(){let t=this._selectedAssetIds(),e=this.assets();return!Array.isArray(e)||!Array.isArray(t)?[]:e.filter(n=>$(n?.value)&&t.includes(n.value)).map(n=>n.label||n.value||"Unknown Vehicle")}onCopyRequestBody(){if(!this.isReadyForTesting())return;let t=this.selectedAssetIds,e=this.apiForm.value,n=this.selectedDataTypes(),o=this.selectedClientSignal();if(t.length===0)return;let l=new Date(e.startDate),d=new Date(e.endDate),h={client_id:o?.id,start_date:l.toISOString(),end_date:d.toISOString(),vehicle_ids:t,data_types:n.length>0?n:["trips","events","telemetry"],report_query:e.reportQuery,key_base_url:this.apiUrlService.getCurrentApiUrl(),key_auth_token:this.authTokenManagerService.getAccessToken(),client_profile:{id:o?.id,name:o?.name,timeZoneId:o?.timeZoneId??"UTC",language:o?.language??"en",currency:"ZAR",measurementUnits:o?.measurementUnits??{distanceUnit:"kilometres",speedUnit:"kilometresPerHour",volumeUnit:"litres",weightUnit:"kilograms",temperatureUnit:"celsius",altitudeUnit:"metres",areaUnit:"squareKilometres"}}};navigator.clipboard.writeText(JSON.stringify(h,null,2)).then(()=>{this.successMessage.set("Request body copied to clipboard!"),setTimeout(()=>this.successMessage.set(null),3e3)}).catch(()=>{this.errorMessage.set("Failed to copy to clipboard")})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-analytical-report"]],viewQuery:function(e,n){if(e&1&&Y(_a,5),e&2){let o;K(o=Z())&&(n.queryChatComponent=o.first)}},decls:16,vars:22,consts:[["queryChatComponent",""],[1,"analytical-report-container"],[1,"floating-message","error"],[1,"floating-message","success"],[1,"dashboard-view",3,"hidden"],[1,"dashboard-header"],["icon","pi pi-arrow-left","label","Back to Chat","severity","secondary","size","small",3,"onClick","outlined"],[1,"dashboard-actions"],["label","New Report","icon","pi pi-plus","severity","primary","size","small",3,"onClick"],[3,"response","isLoading","error","userQuery","dateRange","vehicleNames","clientTimeZone","clientLanguage"],[1,"chat-view",3,"hidden"],[3,"vehiclesChanged","dateRangeChanged","dataTypesChanged","summary","availableVehicles","selectedVehicleIds","collectingDataTypes"],[1,"chat-area"],[3,"dataCollectionTriggered","generateReport","queryUpdated","confidenceUpdated","dateRangeSelected","vehiclesSelected","dataTypesSelected","dateRange","selectedVehicles","clientInfo","fullWidthMode","guidedMode","availableVehiclesForSelection"],[3,"generateReport","queryChanged","query","confidence","isLoading","isCollecting","collectionProgress"],[1,"loading-overlay"],["severity","error"],["severity","success"],[3,"recalculate","response","isLoading","error","userQuery","dateRange","vehicleNames","clientTimeZone","clientLanguage"],[1,"loading-content"],["styleClass","w-12 h-12"],[1,"loading-message"],[1,"loading-hint"]],template:function(e,n){if(e&1){let o=w();a(0,"div",1),g(1,Ca,3,1,"div",2),g(2,ya,3,1,"div",3),a(3,"div",4)(4,"div",5)(5,"p-button",6),b("onClick",function(){return _(o),C(n.onBackToChat())}),r(),a(6,"div",7)(7,"p-button",8),b("onClick",function(){return _(o),C(n.onNewReport())}),r()()(),g(8,ba,1,8,"app-analytics-dashboard",9),r(),a(9,"div",10)(10,"app-chat-summary-header",11),b("vehiclesChanged",function(d){return _(o),C(n.onHeaderVehiclesChanged(d))})("dateRangeChanged",function(d){return _(o),C(n.onHeaderDateRangeChanged(d))})("dataTypesChanged",function(d){return _(o),C(n.onHeaderDataTypesChanged(d))}),r(),a(11,"div",12)(12,"app-query-chat",13,0),b("dataCollectionTriggered",function(d){return _(o),C(n.onChatDataCollectionTriggered(d))})("generateReport",function(d){return _(o),C(n.onChatGenerateReport(d))})("queryUpdated",function(d){return _(o),C(n.onQueryUpdated(d))})("confidenceUpdated",function(d){return _(o),C(n.onConfidenceUpdated(d))})("dateRangeSelected",function(d){return _(o),C(n.onChatDateRangeSelected(d))})("vehiclesSelected",function(d){return _(o),C(n.onChatVehiclesSelected(d))})("dataTypesSelected",function(d){return _(o),C(n.onChatDataTypesSelected(d))}),r()(),a(14,"app-chat-footer-preview",14),b("generateReport",function(){return _(o),C(n.onFooterGenerateReport())})("queryChanged",function(d){return _(o),C(n.onQueryChanged(d))}),r()(),g(15,va,7,1,"div",15),r()}if(e&2){let o;s(),m(n.errorMessage()?1:-1),s(),m(n.successMessage()?2:-1),s(),y("hidden",!n.dashboardResponse()||n.showChatView()),s(2),y("outlined",!0),s(3),m(n.dashboardResponse()?8:-1),s(),y("hidden",!n.showChatView()),s(),y("summary",n.headerSummary())("availableVehicles",n.headerAvailableVehicles())("selectedVehicleIds",n.headerSelectedVehicleIds())("collectingDataTypes",n.collectingDataTypes()),s(2),y("dateRange",n.chatDateRange())("selectedVehicles",n.chatSelectedVehicles())("clientInfo",n.chatClientInfo())("fullWidthMode",!0)("guidedMode",!0)("availableVehiclesForSelection",n.availableVehiclesForChat()),s(2),y("query",n.currentQuery())("confidence",n.currentConfidence())("isLoading",n.isTestingApi())("isCollecting",n.isCollectingData())("collectionProgress",((o=n.collectionProgress())==null?null:o.percentage)??0),s(),m(n.isTestingApi()&&!n.isCollectingData()?15:-1)}},dependencies:[R,ee,Tt,It,Ut,Ft,Se,Qt,Lt,De,W,ie,zt,Rt,Ue,qt,et,st,lt,ct],styles:[`[_nghost-%COMP%]{display:block;height:100%}.analytical-report-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;overflow:hidden;position:relative}.floating-message[_ngcontent-%COMP%]{position:fixed;top:1rem;left:50%;transform:translate(-50%);z-index:1000;max-width:90%;animation:_ngcontent-%COMP%_slideDown .3s ease-out}.floating-message.error[_ngcontent-%COMP%]     .p-message{background-color:var(--red-50, #fef2f2);border-color:var(--red-200, #fecaca)}.floating-message.success[_ngcontent-%COMP%]     .p-message{background-color:var(--green-50, #f0fdf4);border-color:var(--green-200, #bbf7d0)}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translate(-50%) translateY(-1rem)}to{opacity:1;transform:translate(-50%) translateY(0)}}.chat-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:hidden}.chat-view[hidden][_ngcontent-%COMP%]{display:none!important}.chat-view[_ngcontent-%COMP%]   app-chat-summary-header[_ngcontent-%COMP%]{flex-shrink:0}.chat-view[_ngcontent-%COMP%]   .chat-area[_ngcontent-%COMP%]{flex:1;overflow-y:auto;overflow-x:hidden;background-color:var(--surface-ground, #f1f5f9);background-image:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23cbd5e1' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")}.chat-view[_ngcontent-%COMP%]   app-chat-footer-preview[_ngcontent-%COMP%]{flex-shrink:0}.dashboard-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;overflow:hidden}.dashboard-view[hidden][_ngcontent-%COMP%]{display:none!important}.dashboard-view[_ngcontent-%COMP%]   .dashboard-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem 1rem;background-color:var(--card-background-color, #ffffff);border-bottom:1px solid var(--input-border-color, #e2e8f0);flex-shrink:0}.dashboard-view[_ngcontent-%COMP%]   .dashboard-header[_ngcontent-%COMP%]   .dashboard-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.dashboard-view[_ngcontent-%COMP%]   app-analytics-dashboard[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.loading-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:var(--mask-bg, rgba(255, 255, 255, .9));display:flex;align-items:center;justify-content:center;z-index:999}.loading-overlay[_ngcontent-%COMP%]   .loading-content[_ngcontent-%COMP%]{text-align:center}.loading-overlay[_ngcontent-%COMP%]   .loading-content[_ngcontent-%COMP%]   .loading-message[_ngcontent-%COMP%]{margin-top:1rem;font-size:1rem;font-weight:500;color:var(--color-primary-color, #1e40af)}.loading-overlay[_ngcontent-%COMP%]   .loading-content[_ngcontent-%COMP%]   .loading-hint[_ngcontent-%COMP%]{margin-top:.5rem;font-size:.875rem;color:var(--text-color-secondary, #64748b)}@media(max-width:640px){.dashboard-view[_ngcontent-%COMP%]   .dashboard-header[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem;align-items:stretch}.dashboard-view[_ngcontent-%COMP%]   .dashboard-header[_ngcontent-%COMP%]   .dashboard-actions[_ngcontent-%COMP%]{justify-content:flex-end}}`]})};export{Xt as a};
